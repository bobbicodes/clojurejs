(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function r(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?a.credentials="include":l.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(l){if(l.ep)return;l.ep=!0;const a=r(l);fetch(l.href,a)}})();const style="";class Text{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,r,s){let l=[];return this.decompose(0,e,l,2),s.length&&s.decompose(0,s.length,l,3),this.decompose(r,this.length,l,1),TextNode.from(l,this.length-(r-e)+s.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,r=this.length){let s=[];return this.decompose(e,r,s,0),TextNode.from(s,r-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let r=this.scanIdentical(e,1),s=this.length-this.scanIdentical(e,-1),l=new RawTextCursor(this),a=new RawTextCursor(e);for(let h=r,c=r;;){if(l.next(h),a.next(h),h=0,l.lineBreak!=a.lineBreak||l.done!=a.done||l.value!=a.value)return!1;if(c+=l.value.length,l.done||c>=s)return!0}}iter(e=1){return new RawTextCursor(this,e)}iterRange(e,r=this.length){return new PartialTextCursor(this,e,r)}iterLines(e,r){let s;if(e==null)s=this.iter();else{r==null&&(r=this.lines+1);let l=this.line(e).from;s=this.iterRange(l,Math.max(l,r==this.lines+1?this.length:r<=1?0:this.line(r-1).to))}return new LineCursor(s)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Text.empty:e.length<=32?new TextLeaf(e):TextNode.from(TextLeaf.split(e,[]))}}class TextLeaf extends Text{constructor(e,r=textLength(e)){super(),this.text=e,this.length=r}get lines(){return this.text.length}get children(){return null}lineInner(e,r,s,l){for(let a=0;;a++){let h=this.text[a],c=l+h.length;if((r?s:c)>=e)return new Line(l,c,s,h);l=c+1,s++}}decompose(e,r,s,l){let a=e<=0&&r>=this.length?this:new TextLeaf(sliceText(this.text,e,r),Math.min(r,this.length)-Math.max(0,e));if(l&1){let h=s.pop(),c=appendText(a.text,h.text.slice(),0,a.length);if(c.length<=32)s.push(new TextLeaf(c,h.length+a.length));else{let u=c.length>>1;s.push(new TextLeaf(c.slice(0,u)),new TextLeaf(c.slice(u)))}}else s.push(a)}replace(e,r,s){if(!(s instanceof TextLeaf))return super.replace(e,r,s);let l=appendText(this.text,appendText(s.text,sliceText(this.text,0,e)),r),a=this.length+s.length-(r-e);return l.length<=32?new TextLeaf(l,a):TextNode.from(TextLeaf.split(l,[]),a)}sliceString(e,r=this.length,s=`
`){let l="";for(let a=0,h=0;a<=r&&h<this.text.length;h++){let c=this.text[h],u=a+c.length;a>e&&h&&(l+=s),e<u&&r>a&&(l+=c.slice(Math.max(0,e-a),r-a)),a=u+1}return l}flatten(e){for(let r of this.text)e.push(r)}scanIdentical(){return 0}static split(e,r){let s=[],l=-1;for(let a of e)s.push(a),l+=a.length+1,s.length==32&&(r.push(new TextLeaf(s,l)),s=[],l=-1);return l>-1&&r.push(new TextLeaf(s,l)),r}}class TextNode extends Text{constructor(e,r){super(),this.children=e,this.length=r,this.lines=0;for(let s of e)this.lines+=s.lines}lineInner(e,r,s,l){for(let a=0;;a++){let h=this.children[a],c=l+h.length,u=s+h.lines-1;if((r?u:c)>=e)return h.lineInner(e,r,s,l);l=c+1,s=u+1}}decompose(e,r,s,l){for(let a=0,h=0;h<=r&&a<this.children.length;a++){let c=this.children[a],u=h+c.length;if(e<=u&&r>=h){let f=l&((h<=e?1:0)|(u>=r?2:0));h>=e&&u<=r&&!f?s.push(c):c.decompose(e-h,r-h,s,f)}h=u+1}}replace(e,r,s){if(s.lines<this.lines)for(let l=0,a=0;l<this.children.length;l++){let h=this.children[l],c=a+h.length;if(e>=a&&r<=c){let u=h.replace(e-a,r-a,s),f=this.lines-h.lines+u.lines;if(u.lines<f>>5-1&&u.lines>f>>5+1){let d=this.children.slice();return d[l]=u,new TextNode(d,this.length-(r-e)+s.length)}return super.replace(a,c,u)}a=c+1}return super.replace(e,r,s)}sliceString(e,r=this.length,s=`
`){let l="";for(let a=0,h=0;a<this.children.length&&h<=r;a++){let c=this.children[a],u=h+c.length;h>e&&a&&(l+=s),e<u&&r>h&&(l+=c.sliceString(e-h,r-h,s)),h=u+1}return l}flatten(e){for(let r of this.children)r.flatten(e)}scanIdentical(e,r){if(!(e instanceof TextNode))return 0;let s=0,[l,a,h,c]=r>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;l+=r,a+=r){if(l==h||a==c)return s;let u=this.children[l],f=e.children[a];if(u!=f)return s+u.scanIdentical(f,r);s+=u.length+1}}static from(e,r=e.reduce((s,l)=>s+l.length+1,-1)){let s=0;for(let m of e)s+=m.lines;if(s<32){let m=[];for(let w of e)w.flatten(m);return new TextLeaf(m,r)}let l=Math.max(32,s>>5),a=l<<1,h=l>>1,c=[],u=0,f=-1,d=[];function p(m){let w;if(m.lines>a&&m instanceof TextNode)for(let S of m.children)p(S);else m.lines>h&&(u>h||!u)?(g(),c.push(m)):m instanceof TextLeaf&&u&&(w=d[d.length-1])instanceof TextLeaf&&m.lines+w.lines<=32?(u+=m.lines,f+=m.length+1,d[d.length-1]=new TextLeaf(w.text.concat(m.text),w.length+1+m.length)):(u+m.lines>l&&g(),u+=m.lines,f+=m.length+1,d.push(m))}function g(){u!=0&&(c.push(d.length==1?d[0]:TextNode.from(d,f)),f=-1,u=d.length=0)}for(let m of e)p(m);return g(),c.length==1?c[0]:new TextNode(c,r)}}Text.empty=new TextLeaf([""],0);function textLength(o){let e=-1;for(let r of o)e+=r.length+1;return e}function appendText(o,e,r=0,s=1e9){for(let l=0,a=0,h=!0;a<o.length&&l<=s;a++){let c=o[a],u=l+c.length;u>=r&&(u>s&&(c=c.slice(0,s-l)),l<r&&(c=c.slice(r-l)),h?(e[e.length-1]+=c,h=!1):e.push(c)),l=u+1}return e}function sliceText(o,e,r){return appendText(o,[""],e,r)}class RawTextCursor{constructor(e,r=1){this.dir=r,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[r>0?1:(e instanceof TextLeaf?e.text.length:e.children.length)<<1]}nextInner(e,r){for(this.done=this.lineBreak=!1;;){let s=this.nodes.length-1,l=this.nodes[s],a=this.offsets[s],h=a>>1,c=l instanceof TextLeaf?l.text.length:l.children.length;if(h==(r>0?c:0)){if(s==0)return this.done=!0,this.value="",this;r>0&&this.offsets[s-1]++,this.nodes.pop(),this.offsets.pop()}else if((a&1)==(r>0?0:1)){if(this.offsets[s]+=r,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(l instanceof TextLeaf){let u=l.text[h+(r<0?-1:0)];if(this.offsets[s]+=r,u.length>Math.max(0,e))return this.value=e==0?u:r>0?u.slice(e):u.slice(0,u.length-e),this;e-=u.length}else{let u=l.children[h+(r<0?-1:0)];e>u.length?(e-=u.length,this.offsets[s]+=r):(r<0&&this.offsets[s]--,this.nodes.push(u),this.offsets.push(r>0?1:(u instanceof TextLeaf?u.text.length:u.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class PartialTextCursor{constructor(e,r,s){this.value="",this.done=!1,this.cursor=new RawTextCursor(e,r>s?-1:1),this.pos=r>s?e.length:0,this.from=Math.min(r,s),this.to=Math.max(r,s)}nextInner(e,r){if(r<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,r<0?this.pos-this.to:this.from-this.pos);let s=r<0?this.pos-this.from:this.to-this.pos;e>s&&(e=s),s-=e;let{value:l}=this.cursor.next(e);return this.pos+=(l.length+e)*r,this.value=l.length<=s?l:r<0?l.slice(l.length-s):l.slice(0,s),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class LineCursor{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:r,lineBreak:s,value:l}=this.inner.next(e);return r?(this.done=!0,this.value=""):s?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=l,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(e,r,s,l){this.from=e,this.to=r,this.number=s,this.text=l}get length(){return this.to-this.from}}let extend="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(o=>o?parseInt(o,36):1);for(let o=1;o<extend.length;o++)extend[o]+=extend[o-1];function isExtendingChar(o){for(let e=1;e<extend.length;e+=2)if(extend[e]>o)return extend[e-1]<=o;return!1}function isRegionalIndicator(o){return o>=127462&&o<=127487}const ZWJ=8205;function findClusterBreak(o,e,r=!0,s=!0){return(r?nextClusterBreak:prevClusterBreak)(o,e,s)}function nextClusterBreak(o,e,r){if(e==o.length)return e;e&&surrogateLow(o.charCodeAt(e))&&surrogateHigh(o.charCodeAt(e-1))&&e--;let s=codePointAt(o,e);for(e+=codePointSize(s);e<o.length;){let l=codePointAt(o,e);if(s==ZWJ||l==ZWJ||r&&isExtendingChar(l))e+=codePointSize(l),s=l;else if(isRegionalIndicator(l)){let a=0,h=e-2;for(;h>=0&&isRegionalIndicator(codePointAt(o,h));)a++,h-=2;if(a%2==0)break;e+=2}else break}return e}function prevClusterBreak(o,e,r){for(;e>0;){let s=nextClusterBreak(o,e-2,r);if(s<e)return s;e--}return 0}function surrogateLow(o){return o>=56320&&o<57344}function surrogateHigh(o){return o>=55296&&o<56320}function codePointAt(o,e){let r=o.charCodeAt(e);if(!surrogateHigh(r)||e+1==o.length)return r;let s=o.charCodeAt(e+1);return surrogateLow(s)?(r-55296<<10)+(s-56320)+65536:r}function fromCodePoint(o){return o<=65535?String.fromCharCode(o):(o-=65536,String.fromCharCode((o>>10)+55296,(o&1023)+56320))}function codePointSize(o){return o<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(o){return o[o.Simple=0]="Simple",o[o.TrackDel=1]="TrackDel",o[o.TrackBefore=2]="TrackBefore",o[o.TrackAfter=3]="TrackAfter",o}(MapMode||(MapMode={}));class ChangeDesc{constructor(e){this.sections=e}get length(){let e=0;for(let r=0;r<this.sections.length;r+=2)e+=this.sections[r];return e}get newLength(){let e=0;for(let r=0;r<this.sections.length;r+=2){let s=this.sections[r+1];e+=s<0?this.sections[r]:s}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let r=0,s=0,l=0;r<this.sections.length;){let a=this.sections[r++],h=this.sections[r++];h<0?(e(s,l,a),l+=a):l+=h,s+=a}}iterChangedRanges(e,r=!1){iterChanges(this,e,r)}get invertedDesc(){let e=[];for(let r=0;r<this.sections.length;){let s=this.sections[r++],l=this.sections[r++];l<0?e.push(s,l):e.push(l,s)}return new ChangeDesc(e)}composeDesc(e){return this.empty?e:e.empty?this:composeSets(this,e)}mapDesc(e,r=!1){return e.empty?this:mapSet(this,e,r)}mapPos(e,r=-1,s=MapMode.Simple){let l=0,a=0;for(let h=0;h<this.sections.length;){let c=this.sections[h++],u=this.sections[h++],f=l+c;if(u<0){if(f>e)return a+(e-l);a+=c}else{if(s!=MapMode.Simple&&f>=e&&(s==MapMode.TrackDel&&l<e&&f>e||s==MapMode.TrackBefore&&l<e||s==MapMode.TrackAfter&&f>e))return null;if(f>e||f==e&&r<0&&!c)return e==l||r<0?a:a+u;a+=u}l=f}if(e>l)throw new RangeError(`Position ${e} is out of range for changeset of length ${l}`);return a}touchesRange(e,r=e){for(let s=0,l=0;s<this.sections.length&&l<=r;){let a=this.sections[s++],h=this.sections[s++],c=l+a;if(h>=0&&l<=r&&c>=e)return l<e&&c>r?"cover":!0;l=c}return!1}toString(){let e="";for(let r=0;r<this.sections.length;){let s=this.sections[r++],l=this.sections[r++];e+=(e?" ":"")+s+(l>=0?":"+l:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(r=>typeof r!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(e)}static create(e){return new ChangeDesc(e)}}class ChangeSet extends ChangeDesc{constructor(e,r){super(e),this.inserted=r}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,(r,s,l,a,h)=>e=e.replace(l,l+(s-r),h),!1),e}mapDesc(e,r=!1){return mapSet(this,e,r,!0)}invert(e){let r=this.sections.slice(),s=[];for(let l=0,a=0;l<r.length;l+=2){let h=r[l],c=r[l+1];if(c>=0){r[l]=c,r[l+1]=h;let u=l>>1;for(;s.length<u;)s.push(Text.empty);s.push(h?e.slice(a,a+h):Text.empty)}a+=h}return new ChangeSet(r,s)}compose(e){return this.empty?e:e.empty?this:composeSets(this,e,!0)}map(e,r=!1){return e.empty?this:mapSet(this,e,r,!0)}iterChanges(e,r=!1){iterChanges(this,e,r)}get desc(){return ChangeDesc.create(this.sections)}filter(e){let r=[],s=[],l=[],a=new SectionIter(this);e:for(let h=0,c=0;;){let u=h==e.length?1e9:e[h++];for(;c<u||c==u&&a.len==0;){if(a.done)break e;let d=Math.min(a.len,u-c);addSection(l,d,-1);let p=a.ins==-1?-1:a.off==0?a.ins:0;addSection(r,d,p),p>0&&addInsert(s,r,a.text),a.forward(d),c+=d}let f=e[h++];for(;c<f;){if(a.done)break e;let d=Math.min(a.len,f-c);addSection(r,d,-1),addSection(l,d,a.ins==-1?-1:a.off==0?a.ins:0),a.forward(d),c+=d}}return{changes:new ChangeSet(r,s),filtered:ChangeDesc.create(l)}}toJSON(){let e=[];for(let r=0;r<this.sections.length;r+=2){let s=this.sections[r],l=this.sections[r+1];l<0?e.push(s):l==0?e.push([s]):e.push([s].concat(this.inserted[r>>1].toJSON()))}return e}static of(e,r,s){let l=[],a=[],h=0,c=null;function u(d=!1){if(!d&&!l.length)return;h<r&&addSection(l,r-h,-1);let p=new ChangeSet(l,a);c=c?c.compose(p.map(c)):p,l=[],a=[],h=0}function f(d){if(Array.isArray(d))for(let p of d)f(p);else if(d instanceof ChangeSet){if(d.length!=r)throw new RangeError(`Mismatched change set length (got ${d.length}, expected ${r})`);u(),c=c?c.compose(d.map(c)):d}else{let{from:p,to:g=p,insert:m}=d;if(p>g||p<0||g>r)throw new RangeError(`Invalid change range ${p} to ${g} (in doc of length ${r})`);let w=m?typeof m=="string"?Text.of(m.split(s||DefaultSplit)):m:Text.empty,S=w.length;if(p==g&&S==0)return;p<h&&u(),p>h&&addSection(l,p-h,-1),addSection(l,g-p,S),addInsert(a,l,w),h=g}}return f(e),u(!c),c}static empty(e){return new ChangeSet(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let r=[],s=[];for(let l=0;l<e.length;l++){let a=e[l];if(typeof a=="number")r.push(a,-1);else{if(!Array.isArray(a)||typeof a[0]!="number"||a.some((h,c)=>c&&typeof h!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(a.length==1)r.push(a[0],0);else{for(;s.length<l;)s.push(Text.empty);s[l]=Text.of(a.slice(1)),r.push(a[0],s[l].length)}}}return new ChangeSet(r,s)}static createSet(e,r){return new ChangeSet(e,r)}}function addSection(o,e,r,s=!1){if(e==0&&r<=0)return;let l=o.length-2;l>=0&&r<=0&&r==o[l+1]?o[l]+=e:e==0&&o[l]==0?o[l+1]+=r:s?(o[l]+=e,o[l+1]+=r):o.push(e,r)}function addInsert(o,e,r){if(r.length==0)return;let s=e.length-2>>1;if(s<o.length)o[o.length-1]=o[o.length-1].append(r);else{for(;o.length<s;)o.push(Text.empty);o.push(r)}}function iterChanges(o,e,r){let s=o.inserted;for(let l=0,a=0,h=0;h<o.sections.length;){let c=o.sections[h++],u=o.sections[h++];if(u<0)l+=c,a+=c;else{let f=l,d=a,p=Text.empty;for(;f+=c,d+=u,u&&s&&(p=p.append(s[h-2>>1])),!(r||h==o.sections.length||o.sections[h+1]<0);)c=o.sections[h++],u=o.sections[h++];e(l,f,a,d,p),l=f,a=d}}}function mapSet(o,e,r,s=!1){let l=[],a=s?[]:null,h=new SectionIter(o),c=new SectionIter(e);for(let u=-1;;)if(h.ins==-1&&c.ins==-1){let f=Math.min(h.len,c.len);addSection(l,f,-1),h.forward(f),c.forward(f)}else if(c.ins>=0&&(h.ins<0||u==h.i||h.off==0&&(c.len<h.len||c.len==h.len&&!r))){let f=c.len;for(addSection(l,c.ins,-1);f;){let d=Math.min(h.len,f);h.ins>=0&&u<h.i&&h.len<=d&&(addSection(l,0,h.ins),a&&addInsert(a,l,h.text),u=h.i),h.forward(d),f-=d}c.next()}else if(h.ins>=0){let f=0,d=h.len;for(;d;)if(c.ins==-1){let p=Math.min(d,c.len);f+=p,d-=p,c.forward(p)}else if(c.ins==0&&c.len<d)d-=c.len,c.next();else break;addSection(l,f,u<h.i?h.ins:0),a&&u<h.i&&addInsert(a,l,h.text),u=h.i,h.forward(h.len-d)}else{if(h.done&&c.done)return a?ChangeSet.createSet(l,a):ChangeDesc.create(l);throw new Error("Mismatched change set lengths")}}function composeSets(o,e,r=!1){let s=[],l=r?[]:null,a=new SectionIter(o),h=new SectionIter(e);for(let c=!1;;){if(a.done&&h.done)return l?ChangeSet.createSet(s,l):ChangeDesc.create(s);if(a.ins==0)addSection(s,a.len,0,c),a.next();else if(h.len==0&&!h.done)addSection(s,0,h.ins,c),l&&addInsert(l,s,h.text),h.next();else{if(a.done||h.done)throw new Error("Mismatched change set lengths");{let u=Math.min(a.len2,h.len),f=s.length;if(a.ins==-1){let d=h.ins==-1?-1:h.off?0:h.ins;addSection(s,u,d,c),l&&d&&addInsert(l,s,h.text)}else h.ins==-1?(addSection(s,a.off?0:a.len,u,c),l&&addInsert(l,s,a.textBit(u))):(addSection(s,a.off?0:a.len,h.off?0:h.ins,c),l&&!h.off&&addInsert(l,s,h.text));c=(a.ins>u||h.ins>=0&&h.len>u)&&(c||s.length>f),a.forward2(u),h.forward(u)}}}}class SectionIter{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,r=this.i-2>>1;return r>=e.length?Text.empty:e[r]}textBit(e){let{inserted:r}=this.set,s=this.i-2>>1;return s>=r.length&&!e?Text.empty:r[s].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class SelectionRange{constructor(e,r,s){this.from=e,this.to=r,this.flags=s}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,r=-1){let s,l;return this.empty?s=l=e.mapPos(this.from,r):(s=e.mapPos(this.from,1),l=e.mapPos(this.to,-1)),s==this.from&&l==this.to?this:new SelectionRange(s,l,this.flags)}extend(e,r=e){if(e<=this.anchor&&r>=this.anchor)return EditorSelection.range(e,r);let s=Math.abs(e-this.anchor)>Math.abs(r-this.anchor)?e:r;return EditorSelection.range(this.anchor,s)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)}static create(e,r,s){return new SelectionRange(e,r,s)}}class EditorSelection{constructor(e,r){this.ranges=e,this.mainIndex=r}map(e,r=-1){return e.empty?this:EditorSelection.create(this.ranges.map(s=>s.map(e,r)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new EditorSelection([this.main],0)}addRange(e,r=!0){return EditorSelection.create([e].concat(this.ranges),r?0:this.mainIndex+1)}replaceRange(e,r=this.mainIndex){let s=this.ranges.slice();return s[r]=e,EditorSelection.create(s,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(e.ranges.map(r=>SelectionRange.fromJSON(r)),e.main)}static single(e,r=e){return new EditorSelection([EditorSelection.range(e,r)],0)}static create(e,r=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let s=0,l=0;l<e.length;l++){let a=e[l];if(a.empty?a.from<=s:a.from<s)return EditorSelection.normalized(e.slice(),r);s=a.to}return new EditorSelection(e,r)}static cursor(e,r=0,s,l){return SelectionRange.create(e,e,(r==0?0:r<0?4:8)|(s==null?3:Math.min(2,s))|(l??33554431)<<5)}static range(e,r,s,l){let a=(s??33554431)<<5|(l==null?3:Math.min(2,l));return r<e?SelectionRange.create(r,e,24|a):SelectionRange.create(e,r,(r>e?4:0)|a)}static normalized(e,r=0){let s=e[r];e.sort((l,a)=>l.from-a.from),r=e.indexOf(s);for(let l=1;l<e.length;l++){let a=e[l],h=e[l-1];if(a.empty?a.from<=h.to:a.from<h.to){let c=h.from,u=Math.max(a.to,h.to);l<=r&&r--,e.splice(--l,2,a.anchor>a.head?EditorSelection.range(u,c):EditorSelection.range(c,u))}}return new EditorSelection(e,r)}}function checkSelection(o,e){for(let r of o.ranges)if(r.to>e)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(e,r,s,l,a){this.combine=e,this.compareInput=r,this.compare=s,this.isStatic=l,this.id=nextID++,this.default=e([]),this.extensions=typeof a=="function"?a(this):a}static define(e={}){return new Facet(e.combine||(r=>r),e.compareInput||((r,s)=>r===s),e.compare||(e.combine?(r,s)=>r===s:sameArray$1),!!e.static,e.enables)}of(e){return new FacetProvider([],this,0,e)}compute(e,r){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,r)}computeN(e,r){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,r)}from(e,r){return r||(r=s=>s),this.compute([e],s=>r(s.field(e)))}}function sameArray$1(o,e){return o==e||o.length==e.length&&o.every((r,s)=>r===e[s])}class FacetProvider{constructor(e,r,s,l){this.dependencies=e,this.facet=r,this.type=s,this.value=l,this.id=nextID++}dynamicSlot(e){var r;let s=this.value,l=this.facet.compareInput,a=this.id,h=e[a]>>1,c=this.type==2,u=!1,f=!1,d=[];for(let p of this.dependencies)p=="doc"?u=!0:p=="selection"?f=!0:((r=e[p.id])!==null&&r!==void 0?r:1)&1||d.push(e[p.id]);return{create(p){return p.values[h]=s(p),1},update(p,g){if(u&&g.docChanged||f&&(g.docChanged||g.selection)||ensureAll(p,d)){let m=s(p);if(c?!compareArray(m,p.values[h],l):!l(m,p.values[h]))return p.values[h]=m,1}return 0},reconfigure:(p,g)=>{let m,w=g.config.address[a];if(w!=null){let S=getAddr(g,w);if(this.dependencies.every(y=>y instanceof Facet?g.facet(y)===p.facet(y):y instanceof StateField?g.field(y,!1)==p.field(y,!1):!0)||(c?compareArray(m=s(p),S,l):l(m=s(p),S)))return p.values[h]=S,0}else m=s(p);return p.values[h]=m,1}}}}function compareArray(o,e,r){if(o.length!=e.length)return!1;for(let s=0;s<o.length;s++)if(!r(o[s],e[s]))return!1;return!0}function ensureAll(o,e){let r=!1;for(let s of e)ensureAddr(o,s)&1&&(r=!0);return r}function dynamicFacetSlot(o,e,r){let s=r.map(u=>o[u.id]),l=r.map(u=>u.type),a=s.filter(u=>!(u&1)),h=o[e.id]>>1;function c(u){let f=[];for(let d=0;d<s.length;d++){let p=getAddr(u,s[d]);if(l[d]==2)for(let g of p)f.push(g);else f.push(p)}return e.combine(f)}return{create(u){for(let f of s)ensureAddr(u,f);return u.values[h]=c(u),1},update(u,f){if(!ensureAll(u,a))return 0;let d=c(u);return e.compare(d,u.values[h])?0:(u.values[h]=d,1)},reconfigure(u,f){let d=ensureAll(u,s),p=f.config.facets[e.id],g=f.facet(e);if(p&&!d&&sameArray$1(r,p))return u.values[h]=g,0;let m=c(u);return e.compare(m,g)?(u.values[h]=g,0):(u.values[h]=m,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(e,r,s,l,a){this.id=e,this.createF=r,this.updateF=s,this.compareF=l,this.spec=a,this.provides=void 0}static define(e){let r=new StateField(nextID++,e.create,e.update,e.compare||((s,l)=>s===l),e);return e.provide&&(r.provides=e.provide(r)),r}create(e){let r=e.facet(initField).find(s=>s.field==this);return((r==null?void 0:r.create)||this.createF)(e)}slot(e){let r=e[this.id]>>1;return{create:s=>(s.values[r]=this.create(s),1),update:(s,l)=>{let a=s.values[r],h=this.updateF(a,l);return this.compareF(a,h)?0:(s.values[r]=h,1)},reconfigure:(s,l)=>l.config.address[this.id]!=null?(s.values[r]=l.field(this),0):(s.values[r]=this.create(s),1)}}init(e){return[this,initField.of({field:this,create:e})]}get extension(){return this}}const Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(o){return e=>new PrecExtension(e,o)}const Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),default:prec(Prec_.default),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};class PrecExtension{constructor(e,r){this.inner=e,this.prec=r}}class Compartment{of(e){return new CompartmentInstance(this,e)}reconfigure(e){return Compartment.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class CompartmentInstance{constructor(e,r){this.compartment=e,this.inner=r}}class Configuration{constructor(e,r,s,l,a,h){for(this.base=e,this.compartments=r,this.dynamicSlots=s,this.address=l,this.staticValues=a,this.facets=h,this.statusTemplate=[];this.statusTemplate.length<s.length;)this.statusTemplate.push(0)}staticFacet(e){let r=this.address[e.id];return r==null?e.default:this.staticValues[r>>1]}static resolve(e,r,s){let l=[],a=Object.create(null),h=new Map;for(let g of flatten(e,r,h))g instanceof StateField?l.push(g):(a[g.facet.id]||(a[g.facet.id]=[])).push(g);let c=Object.create(null),u=[],f=[];for(let g of l)c[g.id]=f.length<<1,f.push(m=>g.slot(m));let d=s==null?void 0:s.config.facets;for(let g in a){let m=a[g],w=m[0].facet,S=d&&d[g]||[];if(m.every(y=>y.type==0))if(c[w.id]=u.length<<1|1,sameArray$1(S,m))u.push(s.facet(w));else{let y=w.combine(m.map(v=>v.value));u.push(s&&w.compare(y,s.facet(w))?s.facet(w):y)}else{for(let y of m)y.type==0?(c[y.id]=u.length<<1|1,u.push(y.value)):(c[y.id]=f.length<<1,f.push(v=>y.dynamicSlot(v)));c[w.id]=f.length<<1,f.push(y=>dynamicFacetSlot(y,w,m))}}let p=f.map(g=>g(c));return new Configuration(e,h,p,c,u,a)}}function flatten(o,e,r){let s=[[],[],[],[],[]],l=new Map;function a(h,c){let u=l.get(h);if(u!=null){if(u<=c)return;let f=s[u].indexOf(h);f>-1&&s[u].splice(f,1),h instanceof CompartmentInstance&&r.delete(h.compartment)}if(l.set(h,c),Array.isArray(h))for(let f of h)a(f,c);else if(h instanceof CompartmentInstance){if(r.has(h.compartment))throw new RangeError("Duplicate use of compartment in extensions");let f=e.get(h.compartment)||h.inner;r.set(h.compartment,f),a(f,c)}else if(h instanceof PrecExtension)a(h.inner,h.prec);else if(h instanceof StateField)s[c].push(h),h.provides&&a(h.provides,c);else if(h instanceof FacetProvider)s[c].push(h),h.facet.extensions&&a(h.facet.extensions,Prec_.default);else{let f=h.extension;if(!f)throw new Error(`Unrecognized extension value in extension set (${h}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);a(f,c)}}return a(o,Prec_.default),s.reduce((h,c)=>h.concat(c))}function ensureAddr(o,e){if(e&1)return 2;let r=e>>1,s=o.status[r];if(s==4)throw new Error("Cyclic dependency between fields and/or facets");if(s&2)return s;o.status[r]=4;let l=o.computeSlot(o,o.config.dynamicSlots[r]);return o.status[r]=2|l}function getAddr(o,e){return e&1?o.config.staticValues[e>>1]:o.values[e>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:o=>o.some(e=>e),static:!0}),lineSeparator=Facet.define({combine:o=>o.length?o[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:o=>o.length?o[0]:!1});class Annotation{constructor(e,r){this.type=e,this.value=r}static define(){return new AnnotationType}}class AnnotationType{of(e){return new Annotation(this,e)}}class StateEffectType{constructor(e){this.map=e}of(e){return new StateEffect(this,e)}}class StateEffect{constructor(e,r){this.type=e,this.value=r}map(e){let r=this.type.map(this.value,e);return r===void 0?void 0:r==this.value?this:new StateEffect(this.type,r)}is(e){return this.type==e}static define(e={}){return new StateEffectType(e.map||(r=>r))}static mapEffects(e,r){if(!e.length)return e;let s=[];for(let l of e){let a=l.map(r);a&&s.push(a)}return s}}StateEffect.reconfigure=StateEffect.define();StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(e,r,s,l,a,h){this.startState=e,this.changes=r,this.selection=s,this.effects=l,this.annotations=a,this.scrollIntoView=h,this._doc=null,this._state=null,s&&checkSelection(s,r.newLength),a.some(c=>c.type==Transaction.time)||(this.annotations=a.concat(Transaction.time.of(Date.now())))}static create(e,r,s,l,a,h){return new Transaction(e,r,s,l,a,h)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let r of this.annotations)if(r.type==e)return r.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let r=this.annotation(Transaction.userEvent);return!!(r&&(r==e||r.length>e.length&&r.slice(0,e.length)==e&&r[e.length]=="."))}}Transaction.time=Annotation.define();Transaction.userEvent=Annotation.define();Transaction.addToHistory=Annotation.define();Transaction.remote=Annotation.define();function joinRanges(o,e){let r=[];for(let s=0,l=0;;){let a,h;if(s<o.length&&(l==e.length||e[l]>=o[s]))a=o[s++],h=o[s++];else if(l<e.length)a=e[l++],h=e[l++];else return r;!r.length||r[r.length-1]<a?r.push(a,h):r[r.length-1]<h&&(r[r.length-1]=h)}}function mergeTransaction(o,e,r){var s;let l,a,h;return r?(l=e.changes,a=ChangeSet.empty(e.changes.length),h=o.changes.compose(e.changes)):(l=e.changes.map(o.changes),a=o.changes.mapDesc(e.changes,!0),h=o.changes.compose(l)),{changes:h,selection:e.selection?e.selection.map(a):(s=o.selection)===null||s===void 0?void 0:s.map(l),effects:StateEffect.mapEffects(o.effects,l).concat(StateEffect.mapEffects(e.effects,a)),annotations:o.annotations.length?o.annotations.concat(e.annotations):e.annotations,scrollIntoView:o.scrollIntoView||e.scrollIntoView}}function resolveTransactionInner(o,e,r){let s=e.selection,l=asArray$1(e.annotations);return e.userEvent&&(l=l.concat(Transaction.userEvent.of(e.userEvent))),{changes:e.changes instanceof ChangeSet?e.changes:ChangeSet.of(e.changes||[],r,o.facet(lineSeparator)),selection:s&&(s instanceof EditorSelection?s:EditorSelection.single(s.anchor,s.head)),effects:asArray$1(e.effects),annotations:l,scrollIntoView:!!e.scrollIntoView}}function resolveTransaction(o,e,r){let s=resolveTransactionInner(o,e.length?e[0]:{},o.doc.length);e.length&&e[0].filter===!1&&(r=!1);for(let a=1;a<e.length;a++){e[a].filter===!1&&(r=!1);let h=!!e[a].sequential;s=mergeTransaction(s,resolveTransactionInner(o,e[a],h?s.changes.newLength:o.doc.length),h)}let l=Transaction.create(o,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return extendTransaction(r?filterTransaction(l):l)}function filterTransaction(o){let e=o.startState,r=!0;for(let l of e.facet(changeFilter)){let a=l(o);if(a===!1){r=!1;break}Array.isArray(a)&&(r=r===!0?a:joinRanges(r,a))}if(r!==!0){let l,a;if(r===!1)a=o.changes.invertedDesc,l=ChangeSet.empty(e.doc.length);else{let h=o.changes.filter(r);l=h.changes,a=h.filtered.mapDesc(h.changes).invertedDesc}o=Transaction.create(e,l,o.selection&&o.selection.map(a),StateEffect.mapEffects(o.effects,a),o.annotations,o.scrollIntoView)}let s=e.facet(transactionFilter);for(let l=s.length-1;l>=0;l--){let a=s[l](o);a instanceof Transaction?o=a:Array.isArray(a)&&a.length==1&&a[0]instanceof Transaction?o=a[0]:o=resolveTransaction(e,asArray$1(a),!1)}return o}function extendTransaction(o){let e=o.startState,r=e.facet(transactionExtender),s=o;for(let l=r.length-1;l>=0;l--){let a=r[l](o);a&&Object.keys(a).length&&(s=mergeTransaction(s,resolveTransactionInner(e,a,o.changes.newLength),!0))}return s==o?o:Transaction.create(e,o.changes,o.selection,s.effects,s.annotations,s.scrollIntoView)}const none$2=[];function asArray$1(o){return o==null?none$2:Array.isArray(o)?o:[o]}var CharCategory=function(o){return o[o.Word=0]="Word",o[o.Space=1]="Space",o[o.Other=2]="Other",o}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function hasWordChar(o){if(wordChar)return wordChar.test(o);for(let e=0;e<o.length;e++){let r=o[e];if(/\w/.test(r)||r>""&&(r.toUpperCase()!=r.toLowerCase()||nonASCIISingleCaseWordChar.test(r)))return!0}return!1}function makeCategorizer(o){return e=>{if(!/\S/.test(e))return CharCategory.Space;if(hasWordChar(e))return CharCategory.Word;for(let r=0;r<o.length;r++)if(e.indexOf(o[r])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(e,r,s,l,a,h){this.config=e,this.doc=r,this.selection=s,this.values=l,this.status=e.statusTemplate.slice(),this.computeSlot=a,h&&(h._state=this);for(let c=0;c<this.config.dynamicSlots.length;c++)ensureAddr(this,c<<1);this.computeSlot=null}field(e,r=!0){let s=this.config.address[e.id];if(s==null){if(r)throw new RangeError("Field is not present in this state");return}return ensureAddr(this,s),getAddr(this,s)}update(...e){return resolveTransaction(this,e,!0)}applyTransaction(e){let r=this.config,{base:s,compartments:l}=r;for(let h of e.effects)h.is(Compartment.reconfigure)?(r&&(l=new Map,r.compartments.forEach((c,u)=>l.set(u,c)),r=null),l.set(h.value.compartment,h.value.extension)):h.is(StateEffect.reconfigure)?(r=null,s=h.value):h.is(StateEffect.appendConfig)&&(r=null,s=asArray$1(s).concat(h.value));let a;r?a=e.startState.values.slice():(r=Configuration.resolve(s,l,this),a=new EditorState(r,this.doc,this.selection,r.dynamicSlots.map(()=>null),(c,u)=>u.reconfigure(c,this),null).values),new EditorState(r,e.newDoc,e.newSelection,a,(h,c)=>c.update(h,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:e},range:EditorSelection.cursor(r.from+e.length)}))}changeByRange(e){let r=this.selection,s=e(r.ranges[0]),l=this.changes(s.changes),a=[s.range],h=asArray$1(s.effects);for(let c=1;c<r.ranges.length;c++){let u=e(r.ranges[c]),f=this.changes(u.changes),d=f.map(l);for(let g=0;g<c;g++)a[g]=a[g].map(d);let p=l.mapDesc(f,!0);a.push(u.range.map(p)),l=l.compose(d),h=StateEffect.mapEffects(h,d).concat(StateEffect.mapEffects(asArray$1(u.effects),p))}return{changes:l,selection:EditorSelection.create(a,r.mainIndex),effects:h}}changes(e=[]){return e instanceof ChangeSet?e:ChangeSet.of(e,this.doc.length,this.facet(EditorState.lineSeparator))}toText(e){return Text.of(e.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(e=0,r=this.doc.length){return this.doc.sliceString(e,r,this.lineBreak)}facet(e){let r=this.config.address[e.id];return r==null?e.default:(ensureAddr(this,r),getAddr(this,r))}toJSON(e){let r={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let s in e){let l=e[s];l instanceof StateField&&this.config.address[l.id]!=null&&(r[s]=l.spec.toJSON(this.field(e[s]),this))}return r}static fromJSON(e,r={},s){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let l=[];if(s){for(let a in s)if(Object.prototype.hasOwnProperty.call(e,a)){let h=s[a],c=e[a];l.push(h.init(u=>h.spec.fromJSON(c,u)))}}return EditorState.create({doc:e.doc,selection:EditorSelection.fromJSON(e.selection),extensions:r.extensions?l.concat([r.extensions]):l})}static create(e={}){let r=Configuration.resolve(e.extensions||[],new Map),s=e.doc instanceof Text?e.doc:Text.of((e.doc||"").split(r.staticFacet(EditorState.lineSeparator)||DefaultSplit)),l=e.selection?e.selection instanceof EditorSelection?e.selection:EditorSelection.single(e.selection.anchor,e.selection.head):EditorSelection.single(0);return checkSelection(l,s.length),r.staticFacet(allowMultipleSelections)||(l=l.asSingle()),new EditorState(r,s,l,r.dynamicSlots.map(()=>null),(a,h)=>h.create(a),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||`
`}get readOnly(){return this.facet(readOnly)}phrase(e,...r){for(let s of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(s,e)){e=s[e];break}return r.length&&(e=e.replace(/\$(\$|\d*)/g,(s,l)=>{if(l=="$")return"$";let a=+(l||1);return!a||a>r.length?s:r[a-1]})),e}languageDataAt(e,r,s=-1){let l=[];for(let a of this.facet(languageData))for(let h of a(this,r,s))Object.prototype.hasOwnProperty.call(h,e)&&l.push(h[e]);return l}charCategorizer(e){return makeCategorizer(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:r,from:s,length:l}=this.doc.lineAt(e),a=this.charCategorizer(e),h=e-s,c=e-s;for(;h>0;){let u=findClusterBreak(r,h,!1);if(a(r.slice(u,h))!=CharCategory.Word)break;h=u}for(;c<l;){let u=findClusterBreak(r,c);if(a(r.slice(c,u))!=CharCategory.Word)break;c=u}return h==c?null:EditorSelection.range(h+s,c+s)}}EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=Facet.define({combine:o=>o.length?o[0]:4});EditorState.lineSeparator=lineSeparator;EditorState.readOnly=readOnly;EditorState.phrases=Facet.define({compare(o,e){let r=Object.keys(o),s=Object.keys(e);return r.length==s.length&&r.every(l=>o[l]==e[l])}});EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=StateEffect.define();function combineConfig(o,e,r={}){let s={};for(let l of o)for(let a of Object.keys(l)){let h=l[a],c=s[a];if(c===void 0)s[a]=h;else if(!(c===h||h===void 0))if(Object.hasOwnProperty.call(r,a))s[a]=r[a](c,h);else throw new Error("Config merge conflict for field "+a)}for(let l in e)s[l]===void 0&&(s[l]=e[l]);return s}class RangeValue{eq(e){return this==e}range(e,r=e){return Range$1.create(e,r,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=!1;RangeValue.prototype.mapMode=MapMode.TrackDel;let Range$1=class W{constructor(e,r,s){this.from=e,this.to=r,this.value=s}static create(e,r,s){return new W(e,r,s)}};function cmpRange(o,e){return o.from-e.from||o.value.startSide-e.value.startSide}class Chunk{constructor(e,r,s,l){this.from=e,this.to=r,this.value=s,this.maxPoint=l}get length(){return this.to[this.to.length-1]}findIndex(e,r,s,l=0){let a=s?this.to:this.from;for(let h=l,c=a.length;;){if(h==c)return h;let u=h+c>>1,f=a[u]-e||(s?this.value[u].endSide:this.value[u].startSide)-r;if(u==h)return f>=0?h:c;f>=0?c=u:h=u+1}}between(e,r,s,l){for(let a=this.findIndex(r,-1e9,!0),h=this.findIndex(s,1e9,!1,a);a<h;a++)if(l(this.from[a]+e,this.to[a]+e,this.value[a])===!1)return!1}map(e,r){let s=[],l=[],a=[],h=-1,c=-1;for(let u=0;u<this.value.length;u++){let f=this.value[u],d=this.from[u]+e,p=this.to[u]+e,g,m;if(d==p){let w=r.mapPos(d,f.startSide,f.mapMode);if(w==null||(g=m=w,f.startSide!=f.endSide&&(m=r.mapPos(d,f.endSide),m<g)))continue}else if(g=r.mapPos(d,f.startSide),m=r.mapPos(p,f.endSide),g>m||g==m&&f.startSide>0&&f.endSide<=0)continue;(m-g||f.endSide-f.startSide)<0||(h<0&&(h=g),f.point&&(c=Math.max(c,m-g)),s.push(f),l.push(g-h),a.push(m-h))}return{mapped:s.length?new Chunk(l,a,s,c):null,pos:h}}}class RangeSet{constructor(e,r,s,l){this.chunkPos=e,this.chunk=r,this.nextLayer=s,this.maxPoint=l}static create(e,r,s,l){return new RangeSet(e,r,s,l)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let r of this.chunk)e+=r.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:r=[],sort:s=!1,filterFrom:l=0,filterTo:a=this.length}=e,h=e.filter;if(r.length==0&&!h)return this;if(s&&(r=r.slice().sort(cmpRange)),this.isEmpty)return r.length?RangeSet.of(r):this;let c=new LayerCursor(this,null,-1).goto(0),u=0,f=[],d=new RangeSetBuilder;for(;c.value||u<r.length;)if(u<r.length&&(c.from-r[u].from||c.startSide-r[u].value.startSide)>=0){let p=r[u++];d.addInner(p.from,p.to,p.value)||f.push(p)}else c.rangeIndex==1&&c.chunkIndex<this.chunk.length&&(u==r.length||this.chunkEnd(c.chunkIndex)<r[u].from)&&(!h||l>this.chunkEnd(c.chunkIndex)||a<this.chunkPos[c.chunkIndex])&&d.addChunk(this.chunkPos[c.chunkIndex],this.chunk[c.chunkIndex])?c.nextChunk():((!h||l>c.to||a<c.from||h(c.from,c.to,c.value))&&(d.addInner(c.from,c.to,c.value)||f.push(Range$1.create(c.from,c.to,c.value))),c.next());return d.finishInner(this.nextLayer.isEmpty&&!f.length?RangeSet.empty:this.nextLayer.update({add:f,filter:h,filterFrom:l,filterTo:a}))}map(e){if(e.empty||this.isEmpty)return this;let r=[],s=[],l=-1;for(let h=0;h<this.chunk.length;h++){let c=this.chunkPos[h],u=this.chunk[h],f=e.touchesRange(c,c+u.length);if(f===!1)l=Math.max(l,u.maxPoint),r.push(u),s.push(e.mapPos(c));else if(f===!0){let{mapped:d,pos:p}=u.map(c,e);d&&(l=Math.max(l,d.maxPoint),r.push(d),s.push(p))}}let a=this.nextLayer.map(e);return r.length==0?a:new RangeSet(s,r,a||RangeSet.empty,l)}between(e,r,s){if(!this.isEmpty){for(let l=0;l<this.chunk.length;l++){let a=this.chunkPos[l],h=this.chunk[l];if(r>=a&&e<=a+h.length&&h.between(a,e-a,r-a,s)===!1)return}this.nextLayer.between(e,r,s)}}iter(e=0){return HeapCursor.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,r=0){return HeapCursor.from(e).goto(r)}static compare(e,r,s,l,a=-1){let h=e.filter(p=>p.maxPoint>0||!p.isEmpty&&p.maxPoint>=a),c=r.filter(p=>p.maxPoint>0||!p.isEmpty&&p.maxPoint>=a),u=findSharedChunks(h,c,s),f=new SpanCursor(h,u,a),d=new SpanCursor(c,u,a);s.iterGaps((p,g,m)=>compare(f,p,d,g,m,l)),s.empty&&s.length==0&&compare(f,0,d,0,0,l)}static eq(e,r,s=0,l){l==null&&(l=1e9-1);let a=e.filter(d=>!d.isEmpty&&r.indexOf(d)<0),h=r.filter(d=>!d.isEmpty&&e.indexOf(d)<0);if(a.length!=h.length)return!1;if(!a.length)return!0;let c=findSharedChunks(a,h),u=new SpanCursor(a,c,0).goto(s),f=new SpanCursor(h,c,0).goto(s);for(;;){if(u.to!=f.to||!sameValues(u.active,f.active)||u.point&&(!f.point||!u.point.eq(f.point)))return!1;if(u.to>l)return!0;u.next(),f.next()}}static spans(e,r,s,l,a=-1){let h=new SpanCursor(e,null,a).goto(r),c=r,u=h.openStart;for(;;){let f=Math.min(h.to,s);if(h.point){let d=h.activeForPoint(h.to),p=h.pointFrom<r?d.length+1:Math.min(d.length,u);l.point(c,f,h.point,d,p,h.pointRank),u=Math.min(h.openEnd(f),d.length)}else f>c&&(l.span(c,f,h.active,u),u=h.openEnd(f));if(h.to>s)return u+(h.point&&h.to>s?1:0);c=h.to,h.next()}}static of(e,r=!1){let s=new RangeSetBuilder;for(let l of e instanceof Range$1?[e]:r?lazySort(e):e)s.add(l.from,l.to,l.value);return s.finish()}}RangeSet.empty=new RangeSet([],[],null,-1);function lazySort(o){if(o.length>1)for(let e=o[0],r=1;r<o.length;r++){let s=o[r];if(cmpRange(e,s)>0)return o.slice().sort(cmpRange);e=s}return o}RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{finishChunk(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,r,s){this.addInner(e,r,s)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(e,r,s)}addInner(e,r,s){let l=e-this.lastTo||s.startSide-this.last.endSide;if(l<=0&&(e-this.lastFrom||s.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return l<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(r-this.chunkStart),this.last=s,this.lastFrom=e,this.lastTo=r,this.value.push(s),s.point&&(this.maxPoint=Math.max(this.maxPoint,r-e)),!0)}addChunk(e,r){if((e-this.lastTo||r.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,r.maxPoint),this.chunks.push(r),this.chunkPos.push(e);let s=r.value.length-1;return this.last=r.value[s],this.lastFrom=r.from[s]+e,this.lastTo=r.to[s]+e,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let r=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,r}}function findSharedChunks(o,e,r){let s=new Map;for(let a of o)for(let h=0;h<a.chunk.length;h++)a.chunk[h].maxPoint<=0&&s.set(a.chunk[h],a.chunkPos[h]);let l=new Set;for(let a of e)for(let h=0;h<a.chunk.length;h++){let c=s.get(a.chunk[h]);c!=null&&(r?r.mapPos(c):c)==a.chunkPos[h]&&!(r!=null&&r.touchesRange(c,c+a.chunk[h].length))&&l.add(a.chunk[h])}return l}class LayerCursor{constructor(e,r,s,l=0){this.layer=e,this.skip=r,this.minPoint=s,this.rank=l}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,r=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,r,!1),this}gotoInner(e,r,s){for(;this.chunkIndex<this.layer.chunk.length;){let l=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(l)||this.layer.chunkEnd(this.chunkIndex)<e||l.maxPoint<this.minPoint))break;this.chunkIndex++,s=!1}if(this.chunkIndex<this.layer.chunk.length){let l=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],r,!0);(!s||this.rangeIndex<l)&&this.setRangeIndex(l)}this.next()}forward(e,r){(this.to-e||this.endSide-r)<0&&this.gotoInner(e,r,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],r=this.layer.chunk[this.chunkIndex],s=e+r.from[this.rangeIndex];if(this.from=s,this.to=e+r.to[this.rangeIndex],this.value=r.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class HeapCursor{constructor(e){this.heap=e}static from(e,r=null,s=-1){let l=[];for(let a=0;a<e.length;a++)for(let h=e[a];!h.isEmpty;h=h.nextLayer)h.maxPoint>=s&&l.push(new LayerCursor(h,r,s,a));return l.length==1?l[0]:new HeapCursor(l)}get startSide(){return this.value?this.value.startSide:0}goto(e,r=-1e9){for(let s of this.heap)s.goto(e,r);for(let s=this.heap.length>>1;s>=0;s--)heapBubble(this.heap,s);return this.next(),this}forward(e,r){for(let s of this.heap)s.forward(e,r);for(let s=this.heap.length>>1;s>=0;s--)heapBubble(this.heap,s);(this.to-e||this.value.endSide-r)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),heapBubble(this.heap,0)}}}function heapBubble(o,e){for(let r=o[e];;){let s=(e<<1)+1;if(s>=o.length)break;let l=o[s];if(s+1<o.length&&l.compare(o[s+1])>=0&&(l=o[s+1],s++),r.compare(l)<0)break;o[s]=r,o[e]=l,e=s}}class SpanCursor{constructor(e,r,s){this.minPoint=s,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(e,r,s)}goto(e,r=-1e9){return this.cursor.goto(e,r),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=r,this.openStart=-1,this.next(),this}forward(e,r){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-r)<0;)this.removeActive(this.minActive);this.cursor.forward(e,r)}removeActive(e){remove(this.active,e),remove(this.activeTo,e),remove(this.activeRank,e),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(e){let r=0,{value:s,to:l,rank:a}=this.cursor;for(;r<this.activeRank.length&&this.activeRank[r]<=a;)r++;insert(this.active,r,s),insert(this.activeTo,r,l),insert(this.activeRank,r,a),e&&insert(e,r,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let e=this.to,r=this.point;this.point=null;let s=this.openStart<0?[]:null;for(;;){let l=this.minActive;if(l>-1&&(this.activeTo[l]-this.cursor.from||this.active[l].endSide-this.cursor.startSide)<0){if(this.activeTo[l]>e){this.to=this.activeTo[l],this.endSide=this.active[l].endSide;break}this.removeActive(l),s&&remove(s,l)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let a=this.cursor.value;if(!a.point)this.addActive(s),this.cursor.next();else if(r&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=a,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=a.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(s){this.openStart=0;for(let l=s.length-1;l>=0&&s[l]<e;l--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let r=[];for(let s=this.active.length-1;s>=0&&!(this.activeRank[s]<this.pointRank);s--)(this.activeTo[s]>e||this.activeTo[s]==e&&this.active[s].endSide>=this.point.endSide)&&r.push(this.active[s]);return r.reverse()}openEnd(e){let r=0;for(let s=this.activeTo.length-1;s>=0&&this.activeTo[s]>e;s--)r++;return r}}function compare(o,e,r,s,l,a){o.goto(e),r.goto(s);let h=s+l,c=s,u=s-e;for(;;){let f=o.to+u-r.to||o.endSide-r.endSide,d=f<0?o.to+u:r.to,p=Math.min(d,h);if(o.point||r.point?o.point&&r.point&&(o.point==r.point||o.point.eq(r.point))&&sameValues(o.activeForPoint(o.to),r.activeForPoint(r.to))||a.comparePoint(c,p,o.point,r.point):p>c&&!sameValues(o.active,r.active)&&a.compareRange(c,p,o.active,r.active),d>h)break;c=d,f<=0&&o.next(),f>=0&&r.next()}}function sameValues(o,e){if(o.length!=e.length)return!1;for(let r=0;r<o.length;r++)if(o[r]!=e[r]&&!o[r].eq(e[r]))return!1;return!0}function remove(o,e){for(let r=e,s=o.length-1;r<s;r++)o[r]=o[r+1];o.pop()}function insert(o,e,r){for(let s=o.length-1;s>=e;s--)o[s+1]=o[s];o[e]=r}function findMinIndex(o,e){let r=-1,s=1e9;for(let l=0;l<e.length;l++)(e[l]-s||o[l].endSide-o[r].endSide)<0&&(r=l,s=e[l]);return r}function countColumn(o,e,r=o.length){let s=0;for(let l=0;l<r;)o.charCodeAt(l)==9?(s+=e-s%e,l++):(s++,l=findClusterBreak(o,l));return s}function findColumn(o,e,r,s){for(let l=0,a=0;;){if(a>=e)return l;if(l==o.length)break;a+=o.charCodeAt(l)==9?r-a%r:1,l=findClusterBreak(o,l)}return s===!0?-1:o.length}const C="ͼ",COUNT=typeof Symbol>"u"?"__"+C:Symbol.for(C),SET=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),top=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class StyleModule{constructor(e,r){this.rules=[];let{finish:s}=r||{};function l(h){return/^@/.test(h)?[h]:h.split(/,\s*/)}function a(h,c,u,f){let d=[],p=/^@(\w+)\b/.exec(h[0]),g=p&&p[1]=="keyframes";if(p&&c==null)return u.push(h[0]+";");for(let m in c){let w=c[m];if(/&/.test(m))a(m.split(/,\s*/).map(S=>h.map(y=>S.replace(/&/,y))).reduce((S,y)=>S.concat(y)),w,u);else if(w&&typeof w=="object"){if(!p)throw new RangeError("The value of a property ("+m+") should be a primitive value.");a(l(m),w,d,g)}else w!=null&&d.push(m.replace(/_.*/,"").replace(/[A-Z]/g,S=>"-"+S.toLowerCase())+": "+w+";")}(d.length||g)&&u.push((s&&!p&&!f?h.map(s):h).join(", ")+" {"+d.join(" ")+"}")}for(let h in e)a(l(h),e[h],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=top[COUNT]||1;return top[COUNT]=e+1,C+e.toString(36)}static mount(e,r){(e[SET]||new StyleSet(e)).mount(Array.isArray(r)?r:[r])}}let adoptedSet=new Map;class StyleSet{constructor(e){let r=e.ownerDocument||e,s=r.defaultView;if(!e.head&&e.adoptedStyleSheets&&s.CSSStyleSheet){let l=adoptedSet.get(r);if(l)return e.adoptedStyleSheets=[l.sheet,...e.adoptedStyleSheets],e[SET]=l;this.sheet=new s.CSSStyleSheet,e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets],adoptedSet.set(r,this)}else{this.styleTag=r.createElement("style");let l=e.head||e;l.insertBefore(this.styleTag,l.firstChild)}this.modules=[],e[SET]=this}mount(e){let r=this.sheet,s=0,l=0;for(let a=0;a<e.length;a++){let h=e[a],c=this.modules.indexOf(h);if(c<l&&c>-1&&(this.modules.splice(c,1),l--,c=-1),c==-1){if(this.modules.splice(l++,0,h),r)for(let u=0;u<h.rules.length;u++)r.insertRule(h.rules[u],s++)}else{for(;l<c;)s+=this.modules[l++].rules.length;s+=h.rules.length,l++}}if(!r){let a="";for(let h=0;h<this.modules.length;h++)a+=this.modules[h].getRules()+`
`;this.styleTag.textContent=a}}}var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac=typeof navigator<"u"&&/Mac/.test(navigator.platform),ie$1=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(var i=1;i<=24;i++)base[i+111]="F"+i;for(var i=65;i<=90;i++)base[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function keyName(o){var e=mac&&o.metaKey&&o.shiftKey&&!o.ctrlKey&&!o.altKey||ie$1&&o.shiftKey&&o.key&&o.key.length==1||o.key=="Unidentified",r=!e&&o.key||(o.shiftKey?shift:base)[o.keyCode]||o.key||"Unidentified";return r=="Esc"&&(r="Escape"),r=="Del"&&(r="Delete"),r=="Left"&&(r="ArrowLeft"),r=="Up"&&(r="ArrowUp"),r=="Right"&&(r="ArrowRight"),r=="Down"&&(r="ArrowDown"),r}function getSelection(o){let e;return o.nodeType==11?e=o.getSelection?o:o.ownerDocument:e=o,e.getSelection()}function contains(o,e){return e?o==e||o.contains(e.nodeType!=1?e.parentNode:e):!1}function deepActiveElement(o){let e=o.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function hasSelection(o,e){if(!e.anchorNode)return!1;try{return contains(o,e.anchorNode)}catch{return!1}}function clientRectsFor(o){return o.nodeType==3?textRange(o,0,o.nodeValue.length).getClientRects():o.nodeType==1?o.getClientRects():[]}function isEquivalentPosition(o,e,r,s){return r?scanFor(o,e,r,s,-1)||scanFor(o,e,r,s,1):!1}function domIndex(o){for(var e=0;;e++)if(o=o.previousSibling,!o)return e}function scanFor(o,e,r,s,l){for(;;){if(o==r&&e==s)return!0;if(e==(l<0?0:maxOffset(o))){if(o.nodeName=="DIV")return!1;let a=o.parentNode;if(!a||a.nodeType!=1)return!1;e=domIndex(o)+(l<0?0:1),o=a}else if(o.nodeType==1){if(o=o.childNodes[e+(l<0?-1:0)],o.nodeType==1&&o.contentEditable=="false")return!1;e=l<0?maxOffset(o):0}else return!1}}function maxOffset(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}function flattenRect(o,e){let r=e?o.left:o.right;return{left:r,right:r,top:o.top,bottom:o.bottom}}function windowRect(o){return{left:0,right:o.innerWidth,top:0,bottom:o.innerHeight}}function scrollRectIntoView(o,e,r,s,l,a,h,c){let u=o.ownerDocument,f=u.defaultView||window;for(let d=o;d;)if(d.nodeType==1){let p,g=d==u.body;if(g)p=windowRect(f);else{if(d.scrollHeight<=d.clientHeight&&d.scrollWidth<=d.clientWidth){d=d.assignedSlot||d.parentNode;continue}let S=d.getBoundingClientRect();p={left:S.left,right:S.left+d.clientWidth,top:S.top,bottom:S.top+d.clientHeight}}let m=0,w=0;if(l=="nearest")e.top<p.top?(w=-(p.top-e.top+h),r>0&&e.bottom>p.bottom+w&&(w=e.bottom-p.bottom+w+h)):e.bottom>p.bottom&&(w=e.bottom-p.bottom+h,r<0&&e.top-w<p.top&&(w=-(p.top+w-e.top+h)));else{let S=e.bottom-e.top,y=p.bottom-p.top;w=(l=="center"&&S<=y?e.top+S/2-y/2:l=="start"||l=="center"&&r<0?e.top-h:e.bottom-y+h)-p.top}if(s=="nearest"?e.left<p.left?(m=-(p.left-e.left+a),r>0&&e.right>p.right+m&&(m=e.right-p.right+m+a)):e.right>p.right&&(m=e.right-p.right+a,r<0&&e.left<p.left+m&&(m=-(p.left+m-e.left+a))):m=(s=="center"?e.left+(e.right-e.left)/2-(p.right-p.left)/2:s=="start"==c?e.left-a:e.right-(p.right-p.left)+a)-p.left,m||w)if(g)f.scrollBy(m,w);else{let S=0,y=0;if(w){let v=d.scrollTop;d.scrollTop+=w,y=d.scrollTop-v}if(m){let v=d.scrollLeft;d.scrollLeft+=m,S=d.scrollLeft-v}e={left:e.left-S,top:e.top-y,right:e.right-S,bottom:e.bottom-y},S&&Math.abs(S-m)<1&&(s="nearest"),y&&Math.abs(y-w)<1&&(l="nearest")}if(g)break;d=d.assignedSlot||d.parentNode}else if(d.nodeType==11)d=d.host;else break}function scrollableParent(o){let e=o.ownerDocument;for(let r=o.parentNode;r&&r!=e.body;)if(r.nodeType==1){if(r.scrollHeight>r.clientHeight||r.scrollWidth>r.clientWidth)return r;r=r.assignedSlot||r.parentNode}else if(r.nodeType==11)r=r.host;else break;return null}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:r,focusNode:s}=e;this.set(r,Math.min(e.anchorOffset,r?maxOffset(r):0),s,Math.min(e.focusOffset,s?maxOffset(s):0))}set(e,r,s,l){this.anchorNode=e,this.anchorOffset=r,this.focusNode=s,this.focusOffset=l}}let preventScrollSupported=null;function focusPreventScroll(o){if(o.setActive)return o.setActive();if(preventScrollSupported)return o.focus(preventScrollSupported);let e=[];for(let r=o;r&&(e.push(r,r.scrollTop,r.scrollLeft),r!=r.ownerDocument);r=r.parentNode);if(o.focus(preventScrollSupported==null?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let r=0;r<e.length;){let s=e[r++],l=e[r++],a=e[r++];s.scrollTop!=l&&(s.scrollTop=l),s.scrollLeft!=a&&(s.scrollLeft=a)}}}let scratchRange;function textRange(o,e,r=e){let s=scratchRange||(scratchRange=document.createRange());return s.setEnd(o,r),s.setStart(o,e),s}function dispatchKey(o,e,r){let s={key:e,code:e,keyCode:r,which:r,cancelable:!0},l=new KeyboardEvent("keydown",s);l.synthetic=!0,o.dispatchEvent(l);let a=new KeyboardEvent("keyup",s);return a.synthetic=!0,o.dispatchEvent(a),l.defaultPrevented||a.defaultPrevented}function getRoot(o){for(;o;){if(o&&(o.nodeType==9||o.nodeType==11&&o.host))return o;o=o.assignedSlot||o.parentNode}return null}function clearAttributes(o){for(;o.attributes.length;)o.removeAttributeNode(o.attributes[0])}function atElementStart(o,e){let r=e.focusNode,s=e.focusOffset;if(!r||e.anchorNode!=r||e.anchorOffset!=s)return!1;for(s=Math.min(s,maxOffset(r));;)if(s){if(r.nodeType!=1)return!1;let l=r.childNodes[s-1];l.contentEditable=="false"?s--:(r=l,s=maxOffset(r))}else{if(r==o)return!0;s=domIndex(r),r=r.parentNode}}function isScrolledToBottom(o){return o.scrollTop>Math.max(1,o.scrollHeight-o.clientHeight-4)}class DOMPos{constructor(e,r,s=!0){this.node=e,this.offset=r,this.precise=s}static before(e,r){return new DOMPos(e.parentNode,domIndex(e),r)}static after(e,r){return new DOMPos(e.parentNode,domIndex(e)+1,r)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.dirty=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let r=this.posAtStart;for(let s of this.children){if(s==e)return r;r+=s.length+s.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,r){if(this.dirty&2){let s=this.dom,l=null,a;for(let h of this.children){if(h.dirty){if(!h.dom&&(a=l?l.nextSibling:s.firstChild)&&a!=e.docView.compositionNode){let c=ContentView.get(a);(!c||!c.parent&&c.canReuseDOM(h))&&h.reuseDOM(a)}h.sync(e,r),h.dirty=0}if(a=l?l.nextSibling:s.firstChild,r&&!r.written&&r.node==s&&a!=h.dom&&(r.written=!0),h.dom.parentNode==s)for(;a&&a!=h.dom;)a=rm$1(a);else s.insertBefore(h.dom,a);l=h.dom}for(a=l?l.nextSibling:s.firstChild,a&&r&&r.node==s&&(r.written=!0);a;)a=rm$1(a)}else if(this.dirty&1)for(let s of this.children)s.dirty&&(s.sync(e,r),s.dirty=0)}reuseDOM(e){}localPosFromDOM(e,r){let s;if(e==this.dom)s=this.dom.childNodes[r];else{let l=maxOffset(e)==0?0:r==0?-1:1;for(;;){let a=e.parentNode;if(a==this.dom)break;l==0&&a.firstChild!=a.lastChild&&(e==a.firstChild?l=-1:l=1),e=a}l<0?s=e:s=e.nextSibling}if(s==this.dom.firstChild)return 0;for(;s&&!ContentView.get(s);)s=s.nextSibling;if(!s)return this.length;for(let l=0,a=0;;l++){let h=this.children[l];if(h.dom==s)return a;a+=h.length+h.breakAfter}}domBoundsAround(e,r,s=0){let l=-1,a=-1,h=-1,c=-1;for(let u=0,f=s,d=s;u<this.children.length;u++){let p=this.children[u],g=f+p.length;if(f<e&&g>r)return p.domBoundsAround(e,r,f);if(g>=e&&l==-1&&(l=u,a=f),f>r&&p.dom.parentNode==this.dom){h=u,c=d;break}d=g,f=g+p.breakAfter}return{from:a,to:c<0?s+this.length:c,startDOM:(l?this.children[l-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:h<this.children.length&&h>=0?this.children[h].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let r=this.parent;r;r=r.parent){if(e&&(r.dirty|=2),r.dirty&1)return;r.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let r=e.parent;if(!r)return e;e=r}}replaceChildren(e,r,s=noChildren){this.markDirty();for(let l=e;l<r;l++){let a=this.children[l];a.parent==this&&a.destroy()}this.children.splice(e,r-e,...s);for(let l=0;l<s.length;l++)s[l].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ChildCursor(this.children,e,this.children.length)}childPos(e,r=1){return this.childCursor().findPos(e,r)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,r,s,l,a,h){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor}getSide(){return 0}destroy(){this.parent=null}}ContentView.prototype.breakAfter=0;function rm$1(o){let e=o.nextSibling;return o.parentNode.removeChild(o),e}class ChildCursor{constructor(e,r,s){this.children=e,this.pos=r,this.i=s,this.off=0}findPos(e,r=1){for(;;){if(e>this.pos||e==this.pos&&(r>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let s=this.children[--this.i];this.pos-=s.length+s.breakAfter}}}function replaceRange(o,e,r,s,l,a,h,c,u){let{children:f}=o,d=f.length?f[e]:null,p=a.length?a[a.length-1]:null,g=p?p.breakAfter:h;if(!(e==s&&d&&!h&&!g&&a.length<2&&d.merge(r,l,a.length?p:null,r==0,c,u))){if(s<f.length){let m=f[s];m&&l<m.length?(e==s&&(m=m.split(l),l=0),!g&&p&&m.merge(0,l,p,!0,0,u)?a[a.length-1]=m:(l&&m.merge(0,l,null,!1,0,u),a.push(m))):m!=null&&m.breakAfter&&(p?p.breakAfter=1:h=1),s++}for(d&&(d.breakAfter=h,r>0&&(!h&&a.length&&d.merge(r,d.length,a[0],!1,c,0)?d.breakAfter=a.shift().breakAfter:(r<d.length||d.children.length&&d.children[d.children.length-1].length==0)&&d.merge(r,d.length,null,!1,c,0),e++));e<s&&a.length;)if(f[s-1].become(a[a.length-1]))s--,a.pop(),u=a.length?0:c;else if(f[e].become(a[0]))e++,a.shift(),c=a.length?0:u;else break;!a.length&&e&&s<f.length&&!f[e-1].breakAfter&&f[s].merge(0,0,f[e-1],!1,c,u)&&e--,(e<s||a.length)&&o.replaceChildren(e,s,a)}}function mergeChildrenInto(o,e,r,s,l,a){let h=o.childCursor(),{i:c,off:u}=h.findPos(r,1),{i:f,off:d}=h.findPos(e,-1),p=e-r;for(let g of s)p+=g.length;o.length+=p,replaceRange(o,f,d,c,u,s,0,l,a)}let nav=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},doc=typeof document<"u"?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit,safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const MaxJoinLen=256;class TextView extends ContentView{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,r){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(r&&r.node==this.dom&&(r.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,r,s){return s&&(!(s instanceof TextView)||this.length-(r-e)+s.length>MaxJoinLen)?!1:(this.text=this.text.slice(0,e)+(s?s.text:"")+this.text.slice(r),this.markDirty(),!0)}split(e){let r=new TextView(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),r}localPosFromDOM(e,r){return e==this.dom?r:r?this.text.length:0}domAtPos(e){return new DOMPos(this.dom,e)}domBoundsAround(e,r,s){return{from:s,to:s+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,r){return textCoords(this.dom,e,r)}}class MarkView extends ContentView{constructor(e,r=[],s=0){super(),this.mark=e,this.children=r,this.length=s;for(let l of r)l.setParent(this)}setAttrs(e){if(clearAttributes(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let r in this.mark.attrs)e.setAttribute(r,this.mark.attrs[r]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e,r){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,r)}merge(e,r,s,l,a,h){return s&&(!(s instanceof MarkView&&s.mark.eq(this.mark))||e&&a<=0||r<this.length&&h<=0)?!1:(mergeChildrenInto(this,e,r,s?s.children:[],a-1,h-1),this.markDirty(),!0)}split(e){let r=[],s=0,l=-1,a=0;for(let c of this.children){let u=s+c.length;u>e&&r.push(s<e?c.split(e-s):c),l<0&&s>=e&&(l=a),s=u,a++}let h=this.length-e;return this.length=e,l>-1&&(this.children.length=l,this.markDirty()),new MarkView(this.mark,r,h)}domAtPos(e){return inlineDOMAtPos(this,e)}coordsAt(e,r){return coordsInChildren(this,e,r)}}function textCoords(o,e,r){let s=o.nodeValue.length;e>s&&(e=s);let l=e,a=e,h=0;e==0&&r<0||e==s&&r>=0?browser.chrome||browser.gecko||(e?(l--,h=1):a<s&&(a++,h=-1)):r<0?l--:a<s&&a++;let c=textRange(o,l,a).getClientRects();if(!c.length)return null;let u=c[(h?h<0:r>=0)?0:c.length-1];return browser.safari&&!h&&u.width==0&&(u=Array.prototype.find.call(c,f=>f.width)||u),h?flattenRect(u,h<0):u||null}class WidgetView extends ContentView{constructor(e,r,s){super(),this.widget=e,this.length=r,this.side=s,this.prevWidget=null}static create(e,r,s){return new(e.customView||WidgetView)(e,r,s)}split(e){let r=WidgetView.create(this.widget,this.length-e,this.side);return this.length-=e,r}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,r,s,l,a,h){return s&&(!(s instanceof WidgetView)||!this.widget.compare(s.widget)||e>0&&a<=0||r<this.length&&h<=0)?!1:(this.length=e+(s?s.length:0)+(this.length-r),!0)}become(e){return e instanceof WidgetView&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Text.empty;let e=this;for(;e.parent;)e=e.parent;let{view:r}=e,s=r&&r.state.doc,l=this.posAtStart;return s?s.slice(l,l+this.length):Text.empty}domAtPos(e){return(this.length?e==0:this.side>0)?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,r){let s=this.widget.coordsAt(this.dom,e,r);if(s)return s;let l=this.dom.getClientRects(),a=null;if(!l.length)return null;let h=this.side?this.side<0:e>0;for(let c=h?l.length-1:0;a=l[c],!(e>0?c==0:c==l.length-1||a.top<a.bottom);c+=h?-1:1);return flattenRect(a,!h)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class CompositionView extends WidgetView{domAtPos(e){let{topView:r,text:s}=this.widget;return r?scanCompositionTree(e,0,r,s,this.length-r.length,(l,a)=>l.domAtPos(a),(l,a)=>new DOMPos(l,Math.min(a,l.nodeValue.length))):new DOMPos(s,Math.min(e,s.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,r){let{topView:s,text:l}=this.widget;return s?posFromDOMInCompositionTree(e,r,s,l,this.length-s.length):Math.min(r,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,r){let{topView:s,text:l}=this.widget;return s?scanCompositionTree(e,r,s,l,this.length-s.length,(a,h,c)=>a.coordsAt(h,c),(a,h,c)=>textCoords(a,h,c)):textCoords(l,e,r)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}canReuseDOM(){return!0}}function scanCompositionTree(o,e,r,s,l,a,h){if(r instanceof MarkView){for(let c=r.dom.firstChild;c;c=c.nextSibling){let u=ContentView.get(c);if(u){let f=contains(c,s),d=u.length+(f?l:0);if(o<d||o==d&&u.getSide()<=0)return f?scanCompositionTree(o,e,u,s,l,a,h):a(u,o,e);o-=d}else{let f=scanCompositionNode(o,e,c,h);if(typeof f!="number")return f;o=f}}return a(r,r.length,-1)}else return r.dom==s?h(s,o,e):a(r,o,e)}function scanCompositionNode(o,e,r,s){if(r.nodeType==3){let l=r.nodeValue.length;if(o<=l)return s(r,o,e);o-=l}else if(r.nodeType==1&&r.contentEditable!="false")for(let l=r.firstChild;l;l=l.nextSibling){let a=scanCompositionNode(o,e,l,s);if(typeof a!="number")return a;o=a}return o}function posFromDOMInCompositionTree(o,e,r,s,l){if(r instanceof MarkView){let a=0;for(let h=r.dom.firstChild;h;h=h.nextSibling){let c=ContentView.get(h);if(c){let u=contains(h,s);if(contains(h,o))return a+(u?posFromDOMInCompositionTree(o,e,c,s,l):c.localPosFromDOM(o,e));a+=c.length+(u?l:0)}else{let u=posFromDOMInOpaqueNode(o,e,h);if(u.result!=null)return a+u.result;a+=u.size}}}else if(r.dom==s)return Math.min(e,s.nodeValue.length);return r.localPosFromDOM(o,e)}function posFromDOMInOpaqueNode(o,e,r){if(r.nodeType==3)return o==r?{result:e}:{size:r.nodeValue.length};if(r.nodeType==1&&r.contentEditable!="false"){let s=0;for(let l=r.firstChild,a=0;;l=l.nextSibling,a++){if(o==r&&a==e)return{result:s};if(!l)return{size:s};let h=posFromDOMInOpaqueNode(o,e,l);if(h.result!=null)return{result:e+h.result};s+=h.size}}else return r.contains(o)?{result:0}:{size:0}}class WidgetBufferView extends ContentView{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof WidgetBufferView&&e.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?DOMPos.before(this.dom):DOMPos.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Text.empty}get isHidden(){return!0}}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;function inlineDOMAtPos(o,e){let r=o.dom,{children:s}=o,l=0;for(let a=0;l<s.length;l++){let h=s[l],c=a+h.length;if(!(c==a&&h.getSide()<=0)){if(e>a&&e<c&&h.dom.parentNode==r)return h.domAtPos(e-a);if(e<=a)break;a=c}}for(let a=l;a>0;a--){let h=s[a-1];if(h.dom.parentNode==r)return h.domAtPos(h.length)}for(let a=l;a<s.length;a++){let h=s[a];if(h.dom.parentNode==r)return h.domAtPos(0)}return new DOMPos(r,0)}function joinInlineInto(o,e,r){let s,{children:l}=o;r>0&&e instanceof MarkView&&l.length&&(s=l[l.length-1])instanceof MarkView&&s.mark.eq(e.mark)?joinInlineInto(s,e.children[0],r-1):(l.push(e),e.setParent(o)),o.length+=e.length}function coordsInChildren(o,e,r){let s=null,l=-1,a=null,h=-1;function c(f,d){for(let p=0,g=0;p<f.children.length&&g<=d;p++){let m=f.children[p],w=g+m.length;w>=d&&(m.children.length?c(m,d-g):(!a||a.isHidden&&r>0)&&(w>d||g==w&&m.getSide()>0)?(a=m,h=d-g):(g<d||g==w&&m.getSide()<0&&!m.isHidden)&&(s=m,l=d-g)),g=w}}c(o,e);let u=(r<0?s:a)||s||a;return u?u.coordsAt(Math.max(0,u==s?l:h),r):fallbackRect(o)}function fallbackRect(o){let e=o.dom.lastChild;if(!e)return o.dom.getBoundingClientRect();let r=clientRectsFor(e);return r[r.length-1]||null}function combineAttrs(o,e){for(let r in o)r=="class"&&e.class?e.class+=" "+o.class:r=="style"&&e.style?e.style+=";"+o.style:e[r]=o[r];return e}function attrsEq(o,e){if(o==e)return!0;if(!o||!e)return!1;let r=Object.keys(o),s=Object.keys(e);if(r.length!=s.length)return!1;for(let l of r)if(s.indexOf(l)==-1||o[l]!==e[l])return!1;return!0}function updateAttrs(o,e,r){let s=null;if(e)for(let l in e)r&&l in r||o.removeAttribute(s=l);if(r)for(let l in r)e&&e[l]==r[l]||o.setAttribute(s=l,r[l]);return!!s}class WidgetType{eq(e){return!1}updateDOM(e,r){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,r,s){return null}get customView(){return null}get isHidden(){return!1}destroy(e){}}var BlockType=function(o){return o[o.Text=0]="Text",o[o.WidgetBefore=1]="WidgetBefore",o[o.WidgetAfter=2]="WidgetAfter",o[o.WidgetRange=3]="WidgetRange",o}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(e,r,s,l){super(),this.startSide=e,this.endSide=r,this.widget=s,this.spec=l}get heightRelevant(){return!1}static mark(e){return new MarkDecoration(e)}static widget(e){let r=Math.max(-1e4,Math.min(1e4,e.side||0)),s=!!e.block;return r+=s&&!e.inlineOrder?r>0?3e8:-4e8:r>0?1e8:-1e8,new PointDecoration(e,r,r,s,e.widget||null,!1)}static replace(e){let r=!!e.block,s,l;if(e.isBlockGap)s=-5e8,l=4e8;else{let{start:a,end:h}=getInclusive(e,r);s=(a?r?-3e8:-1:5e8)-1,l=(h?r?2e8:1:-6e8)+1}return new PointDecoration(e,s,l,r,e.widget||null,!0)}static line(e){return new LineDecoration(e)}static set(e,r=!1){return RangeSet.of(e,r)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Decoration.none=RangeSet.empty;class MarkDecoration extends Decoration{constructor(e){let{start:r,end:s}=getInclusive(e);super(r?-1:5e8,s?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof MarkDecoration&&this.tagName==e.tagName&&this.class==e.class&&attrsEq(this.attrs,e.attrs)}range(e,r=e){if(e>=r)throw new RangeError("Mark decorations may not be empty");return super.range(e,r)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof LineDecoration&&this.spec.class==e.spec.class&&attrsEq(this.spec.attributes,e.spec.attributes)}range(e,r=e){if(r!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,r)}}LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(e,r,s,l,a,h){super(r,s,a,e),this.block=l,this.isReplace=h,this.mapMode=l?r<=0?MapMode.TrackBefore:MapMode.TrackAfter:MapMode.TrackDel}get type(){return this.startSide<this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof PointDecoration&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,r=e){if(this.isReplace&&(e>r||e==r&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&r!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,r)}}PointDecoration.prototype.point=!0;function getInclusive(o,e=!1){let{inclusiveStart:r,inclusiveEnd:s}=o;return r==null&&(r=o.inclusive),s==null&&(s=o.inclusive),{start:r??e,end:s??e}}function widgetsEq(o,e){return o==e||!!(o&&e&&o.compare(e))}function addRange(o,e,r,s=0){let l=r.length-1;l>=0&&r[l]+s>=o?r[l]=Math.max(r[l],e):r.push(o,e)}class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,r,s,l,a,h){if(s){if(!(s instanceof LineView))return!1;this.dom||s.transferDOM(this)}return l&&this.setDeco(s?s.attrs:null),mergeChildrenInto(this,e,r,s?s.children:[],a,h),!0}split(e){let r=new LineView;if(r.breakAfter=this.breakAfter,this.length==0)return r;let{i:s,off:l}=this.childPos(e);l&&(r.append(this.children[s].split(l),0),this.children[s].merge(l,this.children[s].length,null,!1,0,0),s++);for(let a=s;a<this.children.length;a++)r.append(this.children[a],0);for(;s>0&&this.children[s-1].length==0;)this.children[--s].destroy();return this.children.length=s,this.markDirty(),this.length=e,r}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){attrsEq(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,r){joinInlineInto(this,e,r)}addLineDeco(e){let r=e.spec.attributes,s=e.spec.class;r&&(this.attrs=combineAttrs(r,this.attrs||{})),s&&(this.attrs=combineAttrs({class:s},this.attrs||{}))}domAtPos(e){return inlineDOMAtPos(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e,r){var s;this.dom?this.dirty&4&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,r);let l=this.dom.lastChild;for(;l&&ContentView.get(l)instanceof MarkView;)l=l.lastChild;if(!l||!this.length||l.nodeName!="BR"&&((s=ContentView.get(l))===null||s===void 0?void 0:s.isEditable)==!1&&(!browser.ios||!this.children.some(a=>a instanceof TextView))){let a=document.createElement("BR");a.cmIgnore=!0,this.dom.appendChild(a)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,r;for(let s of this.children){if(!(s instanceof TextView)||/[^ -~]/.test(s.text))return null;let l=clientRectsFor(s.dom);if(l.length!=1)return null;e+=l[0].width,r=l[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:r}:null}coordsAt(e,r){let s=coordsInChildren(this,e,r);if(!this.children.length&&s&&this.parent){let{heightOracle:l}=this.parent.view.viewState,a=s.bottom-s.top;if(Math.abs(a-l.lineHeight)<2&&l.textHeight<a){let h=(a-l.textHeight)/2;return{top:s.top+h,bottom:s.bottom-h,left:s.left,right:s.left}}}return s}become(e){return!1}get type(){return BlockType.Text}static find(e,r){for(let s=0,l=0;s<e.children.length;s++){let a=e.children[s],h=l+a.length;if(h>=r){if(a instanceof LineView)return a;if(h>r)break}l=h+a.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(e,r,s){super(),this.widget=e,this.length=r,this.type=s,this.breakAfter=0,this.prevWidget=null}merge(e,r,s,l,a,h){return s&&(!(s instanceof BlockWidgetView)||!this.widget.compare(s.widget)||e>0&&a<=0||r<this.length&&h<=0)?!1:(this.length=e+(s?s.length:0)+(this.length-r),!0)}domAtPos(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}split(e){let r=this.length-e;this.length=e;let s=new BlockWidgetView(this.widget,r,this.type);return s.breakAfter=this.breakAfter,s}get children(){return noChildren}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}domBoundsAround(){return null}become(e){return e instanceof BlockWidgetView&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.type=e.type,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,r){return this.widget.coordsAt(this.dom,e,r)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class ContentBuilder{constructor(e,r,s,l){this.doc=e,this.pos=r,this.end=s,this.disallowBlockEffectsFor=l,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=r}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof BlockWidgetView&&e.type==BlockType.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||this.getLine()}buildText(e,r,s){for(;e>0;){if(this.textOff==this.text.length){let{value:a,lineBreak:h,done:c}=this.cursor.next(this.skip);if(this.skip=0,c)throw new Error("Ran out of text content when drawing inline views");if(h){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=a,this.textOff=0}let l=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(r.slice(r.length-s)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+l)),r),s),this.atCursorPos=!0,this.textOff+=l,e-=l,s=0}}span(e,r,s,l){this.buildText(r-e,s,l),this.pos=r,this.openStart<0&&(this.openStart=l)}point(e,r,s,l,a,h){if(this.disallowBlockEffectsFor[h]&&s instanceof PointDecoration){if(s.block)throw new RangeError("Block decorations may not be specified via plugins");if(r>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let c=r-e;if(s instanceof PointDecoration)if(s.block){let{type:u}=s;u==BlockType.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(s.widget||new NullWidget("div"),c,u))}else{let u=WidgetView.create(s.widget||new NullWidget("span"),c,c?0:s.startSide),f=this.atCursorPos&&!u.isEditable&&a<=l.length&&(e<r||s.startSide>0),d=!u.isEditable&&(e<r||a>l.length||s.startSide<=0),p=this.getLine();this.pendingBuffer==2&&!f&&!u.isEditable&&(this.pendingBuffer=0),this.flushBuffer(l),f&&(p.append(wrapMarks(new WidgetBufferView(1),l),a),a=l.length+Math.max(0,a-l.length)),p.append(wrapMarks(u,l),a),this.atCursorPos=d,this.pendingBuffer=d?e<r||a>l.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=l.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(s);c&&(this.textOff+c<=this.text.length?this.textOff+=c:(this.skip+=c-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=r),this.openStart<0&&(this.openStart=a)}static build(e,r,s,l,a){let h=new ContentBuilder(e,r,s,a);return h.openEnd=RangeSet.spans(l,r,s,h),h.openStart<0&&(h.openStart=h.openEnd),h.finish(h.openEnd),h}}function wrapMarks(o,e){for(let r of e)o=new MarkView(r,[o],o.length);return o}class NullWidget extends WidgetType{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler$1=Facet.define(),focusChangeEffect=Facet.define(),perLineTextDirection=Facet.define({combine:o=>o.some(e=>e)}),nativeSelectionHidden=Facet.define({combine:o=>o.some(e=>e)});class ScrollTarget{constructor(e,r="nearest",s="nearest",l=5,a=5){this.range=e,this.y=r,this.x=s,this.yMargin=l,this.xMargin=a}map(e){return e.empty?this:new ScrollTarget(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const scrollIntoView$1=StateEffect.define({map:(o,e)=>o.map(e)});function logException(o,e,r){let s=o.facet(exceptionSink);s.length?s[0](e):window.onerror?window.onerror(String(e),r,void 0,void 0,e):r?console.error(r+":",e):console.error(e)}const editable=Facet.define({combine:o=>o.length?o[0]:!0});let nextPluginID=0;const viewPlugin=Facet.define();class ViewPlugin{constructor(e,r,s,l){this.id=e,this.create=r,this.domEventHandlers=s,this.extension=l(this)}static define(e,r){const{eventHandlers:s,provide:l,decorations:a}=r||{};return new ViewPlugin(nextPluginID++,e,s,h=>{let c=[viewPlugin.of(h)];return a&&c.push(decorations.of(u=>{let f=u.plugin(h);return f?a(f):Decoration.none})),l&&c.push(l(h)),c})}static fromClass(e,r){return ViewPlugin.define(s=>new e(s),r)}}class PluginInstance{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let r=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(r)}catch(s){if(logException(r.state,s,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(r){logException(e.state,r,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var r;if(!((r=this.value)===null||r===void 0)&&r.destroy)try{this.value.destroy()}catch(s){logException(e.state,s,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),atomicRanges=Facet.define(),scrollMargins=Facet.define();function getScrollMargins(o){let e=0,r=0,s=0,l=0;for(let a of o.state.facet(scrollMargins)){let h=a(o);h&&(h.left!=null&&(e=Math.max(e,h.left)),h.right!=null&&(r=Math.max(r,h.right)),h.top!=null&&(s=Math.max(s,h.top)),h.bottom!=null&&(l=Math.max(l,h.bottom)))}return{left:e,right:r,top:s,bottom:l}}const styleModule=Facet.define();class ChangedRange{constructor(e,r,s,l){this.fromA=e,this.toA=r,this.fromB=s,this.toB=l}join(e){return new ChangedRange(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let r=e.length,s=this;for(;r>0;r--){let l=e[r-1];if(!(l.fromA>s.toA)){if(l.toA<s.fromA)break;s=s.join(l),e.splice(r-1,1)}}return e.splice(r,0,s),e}static extendWithRanges(e,r){if(r.length==0)return e;let s=[];for(let l=0,a=0,h=0,c=0;;l++){let u=l==e.length?null:e[l],f=h-c,d=u?u.fromB:1e9;for(;a<r.length&&r[a]<d;){let p=r[a],g=r[a+1],m=Math.max(c,p),w=Math.min(d,g);if(m<=w&&new ChangedRange(m+f,w+f,m,w).addToSet(s),g>d)break;a+=2}if(!u)return s;new ChangedRange(u.fromA,u.toA,u.fromB,u.toB).addToSet(s),h=u.toA,c=u.toB}}}class ViewUpdate{constructor(e,r,s){this.view=e,this.state=r,this.transactions=s,this.flags=0,this.startState=e.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let a of s)this.changes=this.changes.compose(a.changes);let l=[];this.changes.iterChangedRanges((a,h,c,u)=>l.push(new ChangedRange(a,h,c,u))),this.changedRanges=l}static create(e,r,s){return new ViewUpdate(e,r,s)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var Direction=function(o){return o[o.LTR=0]="LTR",o[o.RTL=1]="RTL",o}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(o){let e=[];for(let r=0;r<o.length;r++)e.push(1<<+o[r]);return e}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let o of["()","[]","{}"]){let e=o.charCodeAt(0),r=o.charCodeAt(1);Brackets[e]=r,Brackets[r]=-e}function charType(o){return o<=247?LowTypes[o]:1424<=o&&o<=1524?2:1536<=o&&o<=1785?ArabicTypes[o-1536]:1774<=o&&o<=2220?4:8192<=o&&o<=8203?256:64336<=o&&o<=65023?4:o==8204?256:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{constructor(e,r,s){this.from=e,this.to=r,this.level=s}get dir(){return this.level%2?RTL:LTR}side(e,r){return this.dir==r==e?this.to:this.from}static find(e,r,s,l){let a=-1;for(let h=0;h<e.length;h++){let c=e[h];if(c.from<=r&&c.to>=r){if(c.level==s)return h;(a<0||(l!=0?l<0?c.from<r:c.to>r:e[a].level>c.level))&&(a=h)}}if(a<0)throw new RangeError("Index out of range");return a}}const types=[];function computeOrder(o,e){let r=o.length,s=e==LTR?1:2,l=e==LTR?2:1;if(!o||s==1&&!BidiRE.test(o))return trivialOrder(r);for(let h=0,c=s,u=s;h<r;h++){let f=charType(o.charCodeAt(h));f==512?f=c:f==8&&u==4&&(f=16),types[h]=f==4?2:f,f&7&&(u=f),c=f}for(let h=0,c=s,u=s;h<r;h++){let f=types[h];if(f==128)h<r-1&&c==types[h+1]&&c&24?f=types[h]=c:types[h]=256;else if(f==64){let d=h+1;for(;d<r&&types[d]==64;)d++;let p=h&&c==8||d<r&&types[d]==8?u==1?1:8:256;for(let g=h;g<d;g++)types[g]=p;h=d-1}else f==8&&u==1&&(types[h]=1);c=f,f&7&&(u=f)}for(let h=0,c=0,u=0,f,d,p;h<r;h++)if(d=Brackets[f=o.charCodeAt(h)])if(d<0){for(let g=c-3;g>=0;g-=3)if(BracketStack[g+1]==-d){let m=BracketStack[g+2],w=m&2?s:m&4?m&1?l:s:0;w&&(types[h]=types[BracketStack[g]]=w),c=g;break}}else{if(BracketStack.length==189)break;BracketStack[c++]=h,BracketStack[c++]=f,BracketStack[c++]=u}else if((p=types[h])==2||p==1){let g=p==s;u=g?0:1;for(let m=c-3;m>=0;m-=3){let w=BracketStack[m+2];if(w&2)break;if(g)BracketStack[m+2]|=2;else{if(w&4)break;BracketStack[m+2]|=4}}}for(let h=0;h<r;h++)if(types[h]==256){let c=h+1;for(;c<r&&types[c]==256;)c++;let u=(h?types[h-1]:s)==1,f=(c<r?types[c]:s)==1,d=u==f?u?1:2:s;for(let p=h;p<c;p++)types[p]=d;h=c-1}let a=[];if(s==1)for(let h=0;h<r;){let c=h,u=types[h++]!=1;for(;h<r&&u==(types[h]!=1);)h++;if(u)for(let f=h;f>c;){let d=f,p=types[--f]!=2;for(;f>c&&p==(types[f-1]!=2);)f--;a.push(new BidiSpan(f,d,p?2:1))}else a.push(new BidiSpan(c,h,0))}else for(let h=0;h<r;){let c=h,u=types[h++]==2;for(;h<r&&u==(types[h]==2);)h++;a.push(new BidiSpan(c,h,u?1:2))}return a}function trivialOrder(o){return[new BidiSpan(0,o,0)]}let movedOver="";function moveVisually(o,e,r,s,l){var a;let h=s.head-o.from,c=-1;if(h==0){if(!l||!o.length)return null;e[0].level!=r&&(h=e[0].side(!1,r),c=0)}else if(h==o.length){if(l)return null;let g=e[e.length-1];g.level!=r&&(h=g.side(!0,r),c=e.length-1)}c<0&&(c=BidiSpan.find(e,h,(a=s.bidiLevel)!==null&&a!==void 0?a:-1,s.assoc));let u=e[c];h==u.side(l,r)&&(u=e[c+=l?1:-1],h=u.side(!l,r));let f=l==(u.dir==r),d=findClusterBreak(o.text,h,f);if(movedOver=o.text.slice(Math.min(h,d),Math.max(h,d)),d!=u.side(l,r))return EditorSelection.cursor(d+o.from,f?-1:1,u.level);let p=c==(l?e.length-1:0)?null:e[c+(l?1:-1)];return!p&&u.level!=r?EditorSelection.cursor(l?o.to:o.from,l?-1:1,r):p&&p.level<u.level?EditorSelection.cursor(p.side(!l,r)+o.from,l?1:-1,p.level):EditorSelection.cursor(d+o.from,l?-1:1,u.level)}const LineBreakPlaceholder="￿";class DOMReader{constructor(e,r){this.points=e,this.text="",this.lineSeparator=r.facet(EditorState.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=LineBreakPlaceholder}readRange(e,r){if(!e)return this;let s=e.parentNode;for(let l=e;;){this.findPointBefore(s,l);let a=this.text.length;this.readNode(l);let h=l.nextSibling;if(h==r)break;let c=ContentView.get(l),u=ContentView.get(h);(c&&u?c.breakAfter:(c?c.breakAfter:isBlockElement(l))||isBlockElement(h)&&(l.nodeName!="BR"||l.cmIgnore)&&this.text.length>a)&&this.lineBreak(),l=h}return this.findPointBefore(s,r),this}readTextNode(e){let r=e.nodeValue;for(let s of this.points)s.node==e&&(s.pos=this.text.length+Math.min(s.offset,r.length));for(let s=0,l=this.lineSeparator?null:/\r\n?|\n/g;;){let a=-1,h=1,c;if(this.lineSeparator?(a=r.indexOf(this.lineSeparator,s),h=this.lineSeparator.length):(c=l.exec(r))&&(a=c.index,h=c[0].length),this.append(r.slice(s,a<0?r.length:a)),a<0)break;if(this.lineBreak(),h>1)for(let u of this.points)u.node==e&&u.pos>this.text.length&&(u.pos-=h-1);s=a+h}}readNode(e){if(e.cmIgnore)return;let r=ContentView.get(e),s=r&&r.overrideDOMText;if(s!=null){this.findPointInside(e,s.length);for(let l=s.iter();!l.next().done;)l.lineBreak?this.lineBreak():this.append(l.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,r){for(let s of this.points)s.node==e&&e.childNodes[s.offset]==r&&(s.pos=this.text.length)}findPointInside(e,r){for(let s of this.points)(e.nodeType==3?s.node==e:e.contains(s.node))&&(s.pos=this.text.length+Math.min(r,s.offset))}}function isBlockElement(o){return o.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(o.nodeName)}class DOMPoint{constructor(e,r){this.node=e,this.offset=r,this.pos=-1}}class DocView extends ContentView{constructor(e){super(),this.view=e,this.compositionDeco=Decoration.none,this.compositionNode=null,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,e.state.doc.length)],0)}get length(){return this.view.state.doc.length}update(e){let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:h,toA:c})=>c<this.minWidthFrom||h>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),{deco:this.compositionDeco,node:this.compositionNode}=this.view.inputState.composing<0?noComp:computeCompositionDeco(this.view,e.changes),(browser.ie||browser.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let s=this.decorations,l=this.updateDeco(),a=findChangedDeco(s,l,e.changes);return r=ChangedRange.extendWithRanges(r,a),this.dirty==0&&r.length==0?!1:(this.updateInner(r,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,r){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,r);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let a=browser.chrome||browser.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,a),this.dirty=0,a&&(a.written||s.selectionRange.focusNode!=a.node)&&(this.forceSelection=!0),this.dom.style.height=""});let l=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let a of this.children)a instanceof BlockWidgetView&&a.widget instanceof BlockGapWidget&&l.push(a.dom);s.updateGaps(l)}updateChildren(e,r){let s=this.childCursor(r);for(let l=e.length-1;;l--){let a=l>=0?e[l]:null;if(!a)break;let{fromA:h,toA:c,fromB:u,toB:f}=a,{content:d,breakAtStart:p,openStart:g,openEnd:m}=ContentBuilder.build(this.view.state.doc,u,f,this.decorations,this.dynamicDecorationMap),{i:w,off:S}=s.findPos(c,1),{i:y,off:v}=s.findPos(h,-1);replaceRange(this,y,v,w,S,d,p,g,m)}}updateSelection(e=!1,r=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let s=this.view.root.activeElement,l=s==this.dom,a=!l&&hasSelection(this.dom,this.view.observer.selectionRange)&&!(s&&this.dom.contains(s));if(!(l||r||a))return;let h=this.forceSelection;this.forceSelection=!1;let c=this.view.state.selection.main,u=this.domAtPos(c.anchor),f=c.empty?u:this.domAtPos(c.head);if(browser.gecko&&c.empty&&!this.compositionDeco.size&&betweenUneditable(u)){let p=document.createTextNode("");this.view.observer.ignore(()=>u.node.insertBefore(p,u.node.childNodes[u.offset]||null)),u=f=new DOMPos(p,0),h=!0}let d=this.view.observer.selectionRange;(h||!d.focusNode||!isEquivalentPosition(u.node,u.offset,d.anchorNode,d.anchorOffset)||!isEquivalentPosition(f.node,f.offset,d.focusNode,d.focusOffset))&&(this.view.observer.ignore(()=>{browser.android&&browser.chrome&&this.dom.contains(d.focusNode)&&inUneditable(d.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let p=getSelection(this.view.root);if(p)if(c.empty){if(browser.gecko){let g=nextToUneditable(u.node,u.offset);if(g&&g!=3){let m=nearbyTextNode(u.node,u.offset,g==1?1:-1);m&&(u=new DOMPos(m,g==1?0:m.nodeValue.length))}}p.collapse(u.node,u.offset),c.bidiLevel!=null&&d.cursorBidiLevel!=null&&(d.cursorBidiLevel=c.bidiLevel)}else if(p.extend){p.collapse(u.node,u.offset);try{p.extend(f.node,f.offset)}catch{}}else{let g=document.createRange();c.anchor>c.head&&([u,f]=[f,u]),g.setEnd(f.node,f.offset),g.setStart(u.node,u.offset),p.removeAllRanges(),p.addRange(g)}a&&this.view.root.activeElement==this.dom&&(this.dom.blur(),s&&s.focus())}),this.view.observer.setSelectionRange(u,f)),this.impreciseAnchor=u.precise?null:new DOMPos(d.anchorNode,d.anchorOffset),this.impreciseHead=f.precise?null:new DOMPos(d.focusNode,d.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let{view:e}=this,r=e.state.selection.main,s=getSelection(e.root),{anchorNode:l,anchorOffset:a}=e.observer.selectionRange;if(!s||!r.empty||!r.assoc||!s.modify)return;let h=LineView.find(this,r.head);if(!h)return;let c=h.posAtStart;if(r.head==c||r.head==c+h.length)return;let u=this.coordsAt(r.head,-1),f=this.coordsAt(r.head,1);if(!u||!f||u.bottom>f.top)return;let d=this.domAtPos(r.head+r.assoc);s.collapse(d.node,d.offset),s.modify("move",r.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let p=e.observer.selectionRange;e.docView.posFromDOM(p.anchorNode,p.anchorOffset)!=r.from&&s.collapse(l,a)}nearest(e){for(let r=e;r;){let s=ContentView.get(r);if(s&&s.rootView==this)return s;r=r.parentNode}return null}posFromDOM(e,r){let s=this.nearest(e);if(!s)throw new RangeError("Trying to find position for a DOM position outside of the document");return s.localPosFromDOM(e,r)+s.posAtStart}domAtPos(e){let{i:r,off:s}=this.childCursor().findPos(e,-1);for(;r<this.children.length-1;){let l=this.children[r];if(s<l.length||l instanceof LineView)break;r++,s=0}return this.children[r].domAtPos(s)}coordsAt(e,r){for(let s=this.length,l=this.children.length-1;;l--){let a=this.children[l],h=s-a.breakAfter-a.length;if(e>h||e==h&&a.type!=BlockType.WidgetBefore&&a.type!=BlockType.WidgetAfter&&(!l||r==2||this.children[l-1].breakAfter||this.children[l-1].type==BlockType.WidgetBefore&&r>-2))return a.coordsAt(e-h,r);s=h}}measureVisibleLineHeights(e){let r=[],{from:s,to:l}=e,a=this.view.contentDOM.clientWidth,h=a>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,c=-1,u=this.view.textDirection==Direction.LTR;for(let f=0,d=0;d<this.children.length;d++){let p=this.children[d],g=f+p.length;if(g>l)break;if(f>=s){let m=p.dom.getBoundingClientRect();if(r.push(m.height),h){let w=p.dom.lastChild,S=w?clientRectsFor(w):[];if(S.length){let y=S[S.length-1],v=u?y.right-m.left:m.right-y.left;v>c&&(c=v,this.minWidth=a,this.minWidthFrom=f,this.minWidthTo=g)}}}f=g+p.breakAfter}return r}textDirectionAt(e){let{i:r}=this.childPos(e,1);return getComputedStyle(this.children[r].dom).direction=="rtl"?Direction.RTL:Direction.LTR}measureTextSize(){for(let a of this.children)if(a instanceof LineView){let h=a.measureTextSize();if(h)return h}let e=document.createElement("div"),r,s,l;return e.className="cm-line",e.style.width="99999px",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let a=clientRectsFor(e.firstChild)[0];r=e.getBoundingClientRect().height,s=a?a.width/27:7,l=a?a.height:r,e.remove()}),{lineHeight:r,charWidth:s,textHeight:l}}childCursor(e=this.length){let r=this.children.length;return r&&(e-=this.children[--r].length),new ChildCursor(this.children,e,r)}computeBlockGapDeco(){let e=[],r=this.view.viewState;for(let s=0,l=0;;l++){let a=l==r.viewports.length?null:r.viewports[l],h=a?a.from-1:this.length;if(h>s){let c=r.lineBlockAt(h).bottom-r.lineBlockAt(s).top;e.push(Decoration.replace({widget:new BlockGapWidget(c),block:!0,inclusive:!0,isBlockGap:!0}).range(s,h))}if(!a)break;s=a.to+1}return Decoration.set(e)}updateDeco(){let e=this.view.state.facet(decorations).map((r,s)=>(this.dynamicDecorationMap[s]=typeof r=="function")?r(this.view):r);for(let r=e.length;r<e.length+3;r++)this.dynamicDecorationMap[r]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:r}=e,s=this.coordsAt(r.head,r.empty?r.assoc:r.head>r.anchor?-1:1),l;if(!s)return;!r.empty&&(l=this.coordsAt(r.anchor,r.anchor>r.head?-1:1))&&(s={left:Math.min(s.left,l.left),top:Math.min(s.top,l.top),right:Math.max(s.right,l.right),bottom:Math.max(s.bottom,l.bottom)});let a=getScrollMargins(this.view),h={left:s.left-a.left,top:s.top-a.top,right:s.right+a.right,bottom:s.bottom+a.bottom};scrollRectIntoView(this.view.scrollDOM,h,r.head<r.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==Direction.LTR)}}function betweenUneditable(o){return o.node.nodeType==1&&o.node.firstChild&&(o.offset==0||o.node.childNodes[o.offset-1].contentEditable=="false")&&(o.offset==o.node.childNodes.length||o.node.childNodes[o.offset].contentEditable=="false")}class BlockGapWidget extends WidgetType{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function compositionSurroundingNode(o){let e=o.observer.selectionRange,r=e.focusNode&&nearbyTextNode(e.focusNode,e.focusOffset,0);if(!r)return null;let s=o.docView.nearest(r);if(!s)return null;if(s instanceof LineView){let l=r;for(;l.parentNode!=s.dom;)l=l.parentNode;let a=l.previousSibling;for(;a&&!ContentView.get(a);)a=a.previousSibling;let h=a?ContentView.get(a).posAtEnd:s.posAtStart;return{from:h,to:h,node:l,text:r}}else{for(;;){let{parent:a}=s;if(!a)return null;if(a instanceof LineView)break;s=a}let l=s.posAtStart;return{from:l,to:l+s.length,node:s.dom,text:r}}}const noComp={deco:Decoration.none,node:null};function computeCompositionDeco(o,e){let r=compositionSurroundingNode(o);if(!r)return noComp;let{from:s,to:l,node:a,text:h}=r,c=e.mapPos(s,1),u=Math.max(c,e.mapPos(l,-1)),{state:f}=o,d=new DOMReader([],f);a.nodeType==3?d.readTextNode(a):d.readRange(a.firstChild,null);let{text:p}=d;if(p.indexOf(LineBreakPlaceholder)>-1)return noComp;if(u-c<p.length)if(f.doc.sliceString(c,Math.min(f.doc.length,c+p.length))==p)u=c+p.length;else if(f.doc.sliceString(Math.max(0,u-p.length),u)==p)c=u-p.length;else return noComp;else if(f.doc.sliceString(c,u)!=p)return noComp;let g=ContentView.get(a);return g instanceof CompositionView?g=g.widget.topView:g&&(g.parent=null),{deco:Decoration.set(Decoration.replace({widget:new CompositionWidget(a,h,g),inclusive:!0}).range(c,u)),node:a}}class CompositionWidget extends WidgetType{constructor(e,r,s){super(),this.top=e,this.text=r,this.topView=s}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return CompositionView}}function nearbyTextNode(o,e,r){if(r<=0)for(let s=o,l=e;;){if(s.nodeType==3)return s;if(s.nodeType==1&&l>0)s=s.childNodes[l-1],l=maxOffset(s);else break}if(r>=0)for(let s=o,l=e;;){if(s.nodeType==3)return s;if(s.nodeType==1&&l<s.childNodes.length&&r>=0)s=s.childNodes[l],l=0;else break}return null}function nextToUneditable(o,e){return o.nodeType!=1?0:(e&&o.childNodes[e-1].contentEditable=="false"?1:0)|(e<o.childNodes.length&&o.childNodes[e].contentEditable=="false"?2:0)}class DecorationComparator$1{constructor(){this.changes=[]}compareRange(e,r){addRange(e,r,this.changes)}comparePoint(e,r){addRange(e,r,this.changes)}}function findChangedDeco(o,e,r){let s=new DecorationComparator$1;return RangeSet.compare(o,e,r,s),s.changes}function inUneditable(o,e){for(let r=o;r&&r!=e;r=r.assignedSlot||r.parentNode)if(r.nodeType==1&&r.contentEditable=="false")return!0;return!1}function groupAt(o,e,r=1){let s=o.charCategorizer(e),l=o.doc.lineAt(e),a=e-l.from;if(l.length==0)return EditorSelection.cursor(e);a==0?r=1:a==l.length&&(r=-1);let h=a,c=a;r<0?h=findClusterBreak(l.text,a,!1):c=findClusterBreak(l.text,a);let u=s(l.text.slice(h,c));for(;h>0;){let f=findClusterBreak(l.text,h,!1);if(s(l.text.slice(f,h))!=u)break;h=f}for(;c<l.length;){let f=findClusterBreak(l.text,c);if(s(l.text.slice(c,f))!=u)break;c=f}return EditorSelection.range(h+l.from,c+l.from)}function getdx(o,e){return e.left>o?e.left-o:Math.max(0,o-e.right)}function getdy(o,e){return e.top>o?e.top-o:Math.max(0,o-e.bottom)}function yOverlap(o,e){return o.top<e.bottom-1&&o.bottom>e.top+1}function upTop(o,e){return e<o.top?{top:e,left:o.left,right:o.right,bottom:o.bottom}:o}function upBot(o,e){return e>o.bottom?{top:o.top,left:o.left,right:o.right,bottom:e}:o}function domPosAtCoords(o,e,r){let s,l,a,h,c=!1,u,f,d,p;for(let w=o.firstChild;w;w=w.nextSibling){let S=clientRectsFor(w);for(let y=0;y<S.length;y++){let v=S[y];l&&yOverlap(l,v)&&(v=upTop(upBot(v,l.bottom),l.top));let O=getdx(e,v),P=getdy(r,v);if(O==0&&P==0)return w.nodeType==3?domPosInText(w,e,r):domPosAtCoords(w,e,r);if(!s||h>P||h==P&&a>O){s=w,l=v,a=O,h=P;let b=P?r<v.top?-1:1:O?e<v.left?-1:1:0;c=!b||(b>0?y<S.length-1:y>0)}O==0?r>v.bottom&&(!d||d.bottom<v.bottom)?(u=w,d=v):r<v.top&&(!p||p.top>v.top)&&(f=w,p=v):d&&yOverlap(d,v)?d=upBot(d,v.bottom):p&&yOverlap(p,v)&&(p=upTop(p,v.top))}}if(d&&d.bottom>=r?(s=u,l=d):p&&p.top<=r&&(s=f,l=p),!s)return{node:o,offset:0};let g=Math.max(l.left,Math.min(l.right,e));if(s.nodeType==3)return domPosInText(s,g,r);if(c&&s.contentEditable!="false")return domPosAtCoords(s,g,r);let m=Array.prototype.indexOf.call(o.childNodes,s)+(e>=(l.left+l.right)/2?1:0);return{node:o,offset:m}}function domPosInText(o,e,r){let s=o.nodeValue.length,l=-1,a=1e9,h=0;for(let c=0;c<s;c++){let u=textRange(o,c,c+1).getClientRects();for(let f=0;f<u.length;f++){let d=u[f];if(d.top==d.bottom)continue;h||(h=e-d.left);let p=(d.top>r?d.top-r:r-d.bottom)-1;if(d.left-1<=e&&d.right+1>=e&&p<a){let g=e>=(d.left+d.right)/2,m=g;if((browser.chrome||browser.gecko)&&textRange(o,c).getBoundingClientRect().left==d.right&&(m=!g),p<=0)return{node:o,offset:c+(m?1:0)};l=c+(m?1:0),a=p}}}return{node:o,offset:l>-1?l:h>0?o.nodeValue.length:0}}function posAtCoords(o,e,r,s=-1){var l,a;let h=o.contentDOM.getBoundingClientRect(),c=h.top+o.viewState.paddingTop,u,{docHeight:f}=o.viewState,{x:d,y:p}=e,g=p-c;if(g<0)return 0;if(g>f)return o.state.doc.length;for(let b=o.viewState.heightOracle.textHeight/2,k=!1;u=o.elementAtHeight(g),u.type!=BlockType.Text;)for(;g=s>0?u.bottom+b:u.top-b,!(g>=0&&g<=f);){if(k)return r?null:0;k=!0,s=-s}p=c+g;let m=u.from;if(m<o.viewport.from)return o.viewport.from==0?0:r?null:posAtCoordsImprecise(o,h,u,d,p);if(m>o.viewport.to)return o.viewport.to==o.state.doc.length?o.state.doc.length:r?null:posAtCoordsImprecise(o,h,u,d,p);let w=o.dom.ownerDocument,S=o.root.elementFromPoint?o.root:w,y=S.elementFromPoint(d,p);y&&!o.contentDOM.contains(y)&&(y=null),y||(d=Math.max(h.left+1,Math.min(h.right-1,d)),y=S.elementFromPoint(d,p),y&&!o.contentDOM.contains(y)&&(y=null));let v,O=-1;if(y&&((l=o.docView.nearest(y))===null||l===void 0?void 0:l.isEditable)!=!1){if(w.caretPositionFromPoint){let b=w.caretPositionFromPoint(d,p);b&&({offsetNode:v,offset:O}=b)}else if(w.caretRangeFromPoint){let b=w.caretRangeFromPoint(d,p);b&&({startContainer:v,startOffset:O}=b,(!o.contentDOM.contains(v)||browser.safari&&isSuspiciousSafariCaretResult(v,O,d)||browser.chrome&&isSuspiciousChromeCaretResult(v,O,d))&&(v=void 0))}}if(!v||!o.docView.dom.contains(v)){let b=LineView.find(o.docView,m);if(!b)return g>u.top+u.height/2?u.to:u.from;({node:v,offset:O}=domPosAtCoords(b.dom,d,p))}let P=o.docView.nearest(v);if(!P)return null;if(P.isWidget&&((a=P.dom)===null||a===void 0?void 0:a.nodeType)==1){let b=P.dom.getBoundingClientRect();return e.y<b.top||e.y<=b.bottom&&e.x<=(b.left+b.right)/2?P.posAtStart:P.posAtEnd}else return P.localPosFromDOM(v,O)+P.posAtStart}function posAtCoordsImprecise(o,e,r,s,l){let a=Math.round((s-e.left)*o.defaultCharacterWidth);if(o.lineWrapping&&r.height>o.defaultLineHeight*1.5){let c=o.viewState.heightOracle.textHeight,u=Math.floor((l-r.top-(o.defaultLineHeight-c)*.5)/c);a+=u*o.viewState.heightOracle.lineLength}let h=o.state.sliceDoc(r.from,r.to);return r.from+findColumn(h,a,o.state.tabSize)}function isSuspiciousSafariCaretResult(o,e,r){let s;if(o.nodeType!=3||e!=(s=o.nodeValue.length))return!1;for(let l=o.nextSibling;l;l=l.nextSibling)if(l.nodeType!=1||l.nodeName!="BR")return!1;return textRange(o,s-1,s).getBoundingClientRect().left>r}function isSuspiciousChromeCaretResult(o,e,r){if(e!=0)return!1;for(let l=o;;){let a=l.parentNode;if(!a||a.nodeType!=1||a.firstChild!=l)return!1;if(a.classList.contains("cm-line"))break;l=a}let s=o.nodeType==1?o.getBoundingClientRect():textRange(o,0,Math.max(o.nodeValue.length,1)).getBoundingClientRect();return r-s.left>5}function blockAt(o,e){let r=o.lineBlockAt(e);if(Array.isArray(r.type)){for(let s of r.type)if(s.to>e||s.to==e&&(s.to==r.to||s.type==BlockType.Text))return s}return r}function moveToLineBoundary(o,e,r,s){let l=blockAt(o,e.head),a=!s||l.type!=BlockType.Text||!(o.lineWrapping||l.widgetLineBreaks)?null:o.coordsAtPos(e.assoc<0&&e.head>l.from?e.head-1:e.head);if(a){let h=o.dom.getBoundingClientRect(),c=o.textDirectionAt(l.from),u=o.posAtCoords({x:r==(c==Direction.LTR)?h.right-1:h.left+1,y:(a.top+a.bottom)/2});if(u!=null)return EditorSelection.cursor(u,r?-1:1)}return EditorSelection.cursor(r?l.to:l.from,r?-1:1)}function moveByChar(o,e,r,s){let l=o.state.doc.lineAt(e.head),a=o.bidiSpans(l),h=o.textDirectionAt(l.from);for(let c=e,u=null;;){let f=moveVisually(l,a,h,c,r),d=movedOver;if(!f){if(l.number==(r?o.state.doc.lines:1))return c;d=`
`,l=o.state.doc.line(l.number+(r?1:-1)),a=o.bidiSpans(l),f=EditorSelection.cursor(r?l.from:l.to)}if(u){if(!u(d))return c}else{if(!s)return f;u=s(d)}c=f}}function byGroup(o,e,r){let s=o.state.charCategorizer(e),l=s(r);return a=>{let h=s(a);return l==CharCategory.Space&&(l=h),l==h}}function moveVertically(o,e,r,s){let l=e.head,a=r?1:-1;if(l==(r?o.state.doc.length:0))return EditorSelection.cursor(l,e.assoc);let h=e.goalColumn,c,u=o.contentDOM.getBoundingClientRect(),f=o.coordsAtPos(l),d=o.documentTop;if(f)h==null&&(h=f.left-u.left),c=a<0?f.top:f.bottom;else{let m=o.viewState.lineBlockAt(l);h==null&&(h=Math.min(u.right-u.left,o.defaultCharacterWidth*(l-m.from))),c=(a<0?m.top:m.bottom)+d}let p=u.left+h,g=s??o.viewState.heightOracle.textHeight>>1;for(let m=0;;m+=10){let w=c+(g+m)*a,S=posAtCoords(o,{x:p,y:w},!1,a);if(w<u.top||w>u.bottom||(a<0?S<l:S>l))return EditorSelection.cursor(S,e.assoc,void 0,h)}}function skipAtomicRanges(o,e,r){for(;;){let s=0;for(let l of o)l.between(e-1,e+1,(a,h,c)=>{if(e>a&&e<h){let u=s||r||(e-a<h-e?-1:1);e=u<0?a:h,s=u}});if(!s)return e}}function skipAtoms(o,e,r){let s=skipAtomicRanges(o.state.facet(atomicRanges).map(l=>l(o)),r.from,e.head>r.from?-1:1);return s==r.from?r:EditorSelection.cursor(s,s<r.from?1:-1)}class InputState{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null;let r=(s,l)=>{this.ignoreDuringComposition(l)||l.type=="keydown"&&this.keydown(e,l)||(this.mustFlushObserver(l)&&e.observer.forceFlush(),this.runCustomHandlers(l.type,e,l)?l.preventDefault():s(e,l))};for(let s in handlers){let l=handlers[s];e.contentDOM.addEventListener(s,a=>{eventBelongsToEditor(e,a)&&r(l,a)},handlerOptions[s]),this.registeredEvents.push(s)}e.scrollDOM.addEventListener("mousedown",s=>{if(s.target==e.scrollDOM&&s.clientY>e.contentDOM.getBoundingClientRect().bottom&&(r(handlers.mousedown,s),!s.defaultPrevented&&s.button==2)){let l=e.contentDOM.style.minHeight;e.contentDOM.style.minHeight="100%",setTimeout(()=>e.contentDOM.style.minHeight=l,200)}}),e.scrollDOM.addEventListener("drop",s=>{s.target==e.scrollDOM&&s.clientY>e.contentDOM.getBoundingClientRect().bottom&&r(handlers.drop,s)}),browser.chrome&&browser.chrome_version==102&&e.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=e.hasFocus,browser.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,r){var s;let l;this.customHandlers=[];for(let a of r)if(l=(s=a.update(e).spec)===null||s===void 0?void 0:s.domEventHandlers){this.customHandlers.push({plugin:a.value,handlers:l});for(let h in l)this.registeredEvents.indexOf(h)<0&&h!="scroll"&&(this.registeredEvents.push(h),e.contentDOM.addEventListener(h,c=>{eventBelongsToEditor(e,c)&&this.runCustomHandlers(h,e,c)&&c.preventDefault()}))}}runCustomHandlers(e,r,s){for(let l of this.customHandlers){let a=l.handlers[e];if(a)try{if(a.call(l.plugin,s,r)||s.defaultPrevented)return!0}catch(h){logException(r.state,h)}}return!1}runScrollHandlers(e,r){this.lastScrollTop=e.scrollDOM.scrollTop,this.lastScrollLeft=e.scrollDOM.scrollLeft;for(let s of this.customHandlers){let l=s.handlers.scroll;if(l)try{l.call(s.plugin,r,e)}catch(a){logException(e.state,a)}}}keydown(e,r){if(this.lastKeyCode=r.keyCode,this.lastKeyTime=Date.now(),r.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(r.keyCode!=27&&modifierCodes.indexOf(r.keyCode)<0&&(e.inputState.lastEscPress=0),browser.android&&browser.chrome&&!r.synthetic&&(r.keyCode==13||r.keyCode==8))return e.observer.delayAndroidKey(r.key,r.keyCode),!0;let s;return browser.ios&&!r.synthetic&&!r.altKey&&!r.metaKey&&((s=PendingKeys.find(l=>l.keyCode==r.keyCode))&&!r.ctrlKey||EmacsyPendingKeys.indexOf(r.key)>-1&&r.ctrlKey&&!r.shiftKey)?(this.pendingIOSKey=s||r,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let r=this.pendingIOSKey;return r?(this.pendingIOSKey=void 0,dispatchKey(e.contentDOM,r.key,r.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:browser.safari&&!browser.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225],dragScrollMargin=6;function dragScrollSpeed(o){return Math.max(0,o)*.7+8}class MouseSelection{constructor(e,r,s,l){this.view=e,this.style=s,this.mustSelect=l,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=r,this.scrollParent=scrollableParent(e.contentDOM),this.atoms=e.state.facet(atomicRanges).map(h=>h(e));let a=e.contentDOM.ownerDocument;a.addEventListener("mousemove",this.move=this.move.bind(this)),a.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=r.shiftKey,this.multiple=e.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(e,r),this.dragging=isInPrimarySelection(e,r)&&getClickType(r)==1?null:!1}start(e){this.dragging===!1&&(e.preventDefault(),this.select(e))}move(e){var r;if(e.buttons==0)return this.destroy();if(this.dragging!==!1)return;this.select(this.lastEvent=e);let s=0,l=0,a=((r=this.scrollParent)===null||r===void 0?void 0:r.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},h=getScrollMargins(this.view);e.clientX-h.left<=a.left+dragScrollMargin?s=-dragScrollSpeed(a.left-e.clientX):e.clientX+h.right>=a.right-dragScrollMargin&&(s=dragScrollSpeed(e.clientX-a.right)),e.clientY-h.top<=a.top+dragScrollMargin?l=-dragScrollSpeed(a.top-e.clientY):e.clientY+h.bottom>=a.bottom-dragScrollMargin&&(l=dragScrollSpeed(e.clientY-a.bottom)),this.setScrollSpeed(s,l)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}setScrollSpeed(e,r){this.scrollSpeed={x:e,y:r},e||r?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let r=null;for(let s=0;s<e.ranges.length;s++){let l=e.ranges[s],a=null;if(l.empty){let h=skipAtomicRanges(this.atoms,l.from,0);h!=l.from&&(a=EditorSelection.cursor(h,-1))}else{let h=skipAtomicRanges(this.atoms,l.from,-1),c=skipAtomicRanges(this.atoms,l.to,1);(h!=l.from||c!=l.to)&&(a=EditorSelection.range(l.from==l.anchor?h:c,l.from==l.head?h:c))}a&&(r||(r=e.ranges.slice()),r[s]=a)}return r?EditorSelection.create(r,e.mainIndex):e}select(e){let{view:r}=this,s=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!s.eq(r.state.selection)||s.main.assoc!=r.state.selection.main.assoc)&&this.view.dispatch({selection:s,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function addsSelectionRange(o,e){let r=o.state.facet(clickAddsSelectionRange);return r.length?r[0](e):browser.mac?e.metaKey:e.ctrlKey}function dragMovesSelection(o,e){let r=o.state.facet(dragMovesSelection$1);return r.length?r[0](e):browser.mac?!e.altKey:!e.ctrlKey}function isInPrimarySelection(o,e){let{main:r}=o.state.selection;if(r.empty)return!1;let s=getSelection(o.root);if(!s||s.rangeCount==0)return!0;let l=s.getRangeAt(0).getClientRects();for(let a=0;a<l.length;a++){let h=l[a];if(h.left<=e.clientX&&h.right>=e.clientX&&h.top<=e.clientY&&h.bottom>=e.clientY)return!0}return!1}function eventBelongsToEditor(o,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let r=e.target,s;r!=o.contentDOM;r=r.parentNode)if(!r||r.nodeType==11||(s=ContentView.get(r))&&s.ignoreEvent(e))return!1;return!0}const handlers=Object.create(null),handlerOptions=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(o){let e=o.dom.parentNode;if(!e)return;let r=e.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{o.focus(),r.remove(),doPaste(o,r.value)},50)}function doPaste(o,e){let{state:r}=o,s,l=1,a=r.toText(e),h=a.lines==r.selection.ranges.length;if(lastLinewiseCopy!=null&&r.selection.ranges.every(u=>u.empty)&&lastLinewiseCopy==a.toString()){let u=-1;s=r.changeByRange(f=>{let d=r.doc.lineAt(f.from);if(d.from==u)return{range:f};u=d.from;let p=r.toText((h?a.line(l++).text:e)+r.lineBreak);return{changes:{from:d.from,insert:p},range:EditorSelection.cursor(f.from+p.length)}})}else h?s=r.changeByRange(u=>{let f=a.line(l++);return{changes:{from:u.from,to:u.to,insert:f.text},range:EditorSelection.cursor(u.from+f.length)}}):s=r.replaceSelection(a);o.dispatch(s,{userEvent:"input.paste",scrollIntoView:!0})}handlers.keydown=(o,e)=>{o.inputState.setSelectionOrigin("select"),e.keyCode==27&&(o.inputState.lastEscPress=Date.now())};handlers.touchstart=(o,e)=>{o.inputState.lastTouchTime=Date.now(),o.inputState.setSelectionOrigin("select.pointer")};handlers.touchmove=o=>{o.inputState.setSelectionOrigin("select.pointer")};handlerOptions.touchstart=handlerOptions.touchmove={passive:!0};handlers.mousedown=(o,e)=>{if(o.observer.flush(),o.inputState.lastTouchTime>Date.now()-2e3)return;let r=null;for(let s of o.state.facet(mouseSelectionStyle))if(r=s(o,e),r)break;if(!r&&e.button==0&&(r=basicMouseSelection(o,e)),r){let s=!o.hasFocus;o.inputState.startMouseSelection(new MouseSelection(o,e,r,s)),s&&o.observer.ignore(()=>focusPreventScroll(o.contentDOM)),o.inputState.mouseSelection&&o.inputState.mouseSelection.start(e)}};function rangeForClick(o,e,r,s){if(s==1)return EditorSelection.cursor(e,r);if(s==2)return groupAt(o.state,e,r);{let l=LineView.find(o.docView,e),a=o.state.doc.lineAt(l?l.posAtEnd:e),h=l?l.posAtStart:a.from,c=l?l.posAtEnd:a.to;return c<o.state.doc.length&&c==a.to&&c++,EditorSelection.range(h,c)}}let insideY=(o,e)=>o>=e.top&&o<=e.bottom,inside=(o,e,r)=>insideY(e,r)&&o>=r.left&&o<=r.right;function findPositionSide(o,e,r,s){let l=LineView.find(o.docView,e);if(!l)return 1;let a=e-l.posAtStart;if(a==0)return 1;if(a==l.length)return-1;let h=l.coordsAt(a,-1);if(h&&inside(r,s,h))return-1;let c=l.coordsAt(a,1);return c&&inside(r,s,c)?1:h&&insideY(s,h)?-1:1}function queryPos(o,e){let r=o.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:r,bias:findPositionSide(o,r,e.clientX,e.clientY)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(o){if(!BadMouseDetail)return o.detail;let e=lastMouseDown,r=lastMouseDownTime;return lastMouseDown=o,lastMouseDownTime=Date.now(),lastMouseDownCount=!e||r>Date.now()-400&&Math.abs(e.clientX-o.clientX)<2&&Math.abs(e.clientY-o.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(o,e){let r=queryPos(o,e),s=getClickType(e),l=o.state.selection;return{update(a){a.docChanged&&(r.pos=a.changes.mapPos(r.pos),l=l.map(a.changes))},get(a,h,c){let u=queryPos(o,a),f,d=rangeForClick(o,u.pos,u.bias,s);if(r.pos!=u.pos&&!h){let p=rangeForClick(o,r.pos,r.bias,s),g=Math.min(p.from,d.from),m=Math.max(p.to,d.to);d=g<d.from?EditorSelection.range(g,m):EditorSelection.range(m,g)}return h?l.replaceRange(l.main.extend(d.from,d.to)):c&&s==1&&l.ranges.length>1&&(f=removeRangeAround(l,u.pos))?f:c?l.addRange(d):EditorSelection.create([d])}}}function removeRangeAround(o,e){for(let r=0;r<o.ranges.length;r++){let{from:s,to:l}=o.ranges[r];if(s<=e&&l>=e)return EditorSelection.create(o.ranges.slice(0,r).concat(o.ranges.slice(r+1)),o.mainIndex==r?0:o.mainIndex-(o.mainIndex>r?1:0))}return null}handlers.dragstart=(o,e)=>{let{selection:{main:r}}=o.state,{mouseSelection:s}=o.inputState;s&&(s.dragging=r),e.dataTransfer&&(e.dataTransfer.setData("Text",o.state.sliceDoc(r.from,r.to)),e.dataTransfer.effectAllowed="copyMove")};function dropText(o,e,r,s){if(!r)return;let l=o.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:a}=o.inputState,h=s&&a&&a.dragging&&dragMovesSelection(o,e)?{from:a.dragging.from,to:a.dragging.to}:null,c={from:l,insert:r},u=o.state.changes(h?[h,c]:c);o.focus(),o.dispatch({changes:u,selection:{anchor:u.mapPos(l,-1),head:u.mapPos(l,1)},userEvent:h?"move.drop":"input.drop"})}handlers.drop=(o,e)=>{if(!e.dataTransfer)return;if(o.state.readOnly)return e.preventDefault();let r=e.dataTransfer.files;if(r&&r.length){e.preventDefault();let s=Array(r.length),l=0,a=()=>{++l==r.length&&dropText(o,e,s.filter(h=>h!=null).join(o.state.lineBreak),!1)};for(let h=0;h<r.length;h++){let c=new FileReader;c.onerror=a,c.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(c.result)||(s[h]=c.result),a()},c.readAsText(r[h])}}else dropText(o,e,e.dataTransfer.getData("Text"),!0)};handlers.paste=(o,e)=>{if(o.state.readOnly)return e.preventDefault();o.observer.flush();let r=brokenClipboardAPI?null:e.clipboardData;r?(doPaste(o,r.getData("text/plain")||r.getData("text/uri-text")),e.preventDefault()):capturePaste(o)};function captureCopy(o,e){let r=o.dom.parentNode;if(!r)return;let s=r.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.value=e,s.focus(),s.selectionEnd=e.length,s.selectionStart=0,setTimeout(()=>{s.remove(),o.focus()},50)}function copiedRange(o){let e=[],r=[],s=!1;for(let l of o.selection.ranges)l.empty||(e.push(o.sliceDoc(l.from,l.to)),r.push(l));if(!e.length){let l=-1;for(let{from:a}of o.selection.ranges){let h=o.doc.lineAt(a);h.number>l&&(e.push(h.text),r.push({from:h.from,to:Math.min(o.doc.length,h.to+1)})),l=h.number}s=!0}return{text:e.join(o.lineBreak),ranges:r,linewise:s}}let lastLinewiseCopy=null;handlers.copy=handlers.cut=(o,e)=>{let{text:r,ranges:s,linewise:l}=copiedRange(o.state);if(!r&&!l)return;lastLinewiseCopy=l?r:null;let a=brokenClipboardAPI?null:e.clipboardData;a?(e.preventDefault(),a.clearData(),a.setData("text/plain",r)):captureCopy(o,r),e.type=="cut"&&!o.state.readOnly&&o.dispatch({changes:s,scrollIntoView:!0,userEvent:"delete.cut"})};const isFocusChange=Annotation.define();function focusChangeTransaction(o,e){let r=[];for(let s of o.facet(focusChangeEffect)){let l=s(o,e);l&&r.push(l)}return r?o.update({effects:r,annotations:isFocusChange.of(!0)}):null}function updateForFocusChange(o){setTimeout(()=>{let e=o.hasFocus;if(e!=o.inputState.notifiedFocused){let r=focusChangeTransaction(o.state,e);r?o.dispatch(r):o.update([])}},10)}handlers.focus=o=>{o.inputState.lastFocusTime=Date.now(),!o.scrollDOM.scrollTop&&(o.inputState.lastScrollTop||o.inputState.lastScrollLeft)&&(o.scrollDOM.scrollTop=o.inputState.lastScrollTop,o.scrollDOM.scrollLeft=o.inputState.lastScrollLeft),updateForFocusChange(o)};handlers.blur=o=>{o.observer.clearSelectionRange(),updateForFocusChange(o)};handlers.compositionstart=handlers.compositionupdate=o=>{o.inputState.compositionFirstChange==null&&(o.inputState.compositionFirstChange=!0),o.inputState.composing<0&&(o.inputState.composing=0)};handlers.compositionend=o=>{o.inputState.composing=-1,o.inputState.compositionEndedAt=Date.now(),o.inputState.compositionPendingKey=!0,o.inputState.compositionPendingChange=o.observer.pendingRecords().length>0,o.inputState.compositionFirstChange=null,browser.chrome&&browser.android?o.observer.flushSoon():o.inputState.compositionPendingChange?Promise.resolve().then(()=>o.observer.flush()):setTimeout(()=>{o.inputState.composing<0&&o.docView.compositionDeco.size&&o.update([])},50)};handlers.contextmenu=o=>{o.inputState.lastContextMenu=Date.now()};handlers.beforeinput=(o,e)=>{var r;let s;if(browser.chrome&&browser.android&&(s=PendingKeys.find(l=>l.inputType==e.inputType))&&(o.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let l=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var a;(((a=window.visualViewport)===null||a===void 0?void 0:a.height)||0)>l+10&&o.hasFocus&&(o.contentDOM.blur(),o.focus())},100)}};const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];class HeightOracle{constructor(e){this.lineWrapping=e,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,r){let s=this.doc.lineAt(r).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(s+=Math.max(0,Math.ceil((r-e-s*this.lineLength*.5)/this.lineLength))),this.lineHeight*s}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return wrappingWhiteSpace.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let r=!1;for(let s=0;s<e.length;s++){let l=e[s];l<0?s++:this.heightSamples[Math.floor(l*10)]||(r=!0,this.heightSamples[Math.floor(l*10)]=!0)}return r}refresh(e,r,s,l,a,h){let c=wrappingWhiteSpace.indexOf(e)>-1,u=Math.round(r)!=Math.round(this.lineHeight)||this.lineWrapping!=c;if(this.lineWrapping=c,this.lineHeight=r,this.charWidth=s,this.textHeight=l,this.lineLength=a,u){this.heightSamples={};for(let f=0;f<h.length;f++){let d=h[f];d<0?f++:this.heightSamples[Math.floor(d*10)]=!0}}return u}}class MeasuredHeights{constructor(e,r){this.from=e,this.heights=r,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(e,r,s,l,a){this.from=e,this.length=r,this.top=s,this.height=l,this._content=a}get type(){return typeof this._content=="number"?BlockType.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof PointDecoration?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let r=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new BlockInfo(this.from,this.length+e.length,this.top,this.height+e.height,r)}}var QueryType$1=function(o){return o[o.ByPos=0]="ByPos",o[o.ByHeight=1]="ByHeight",o[o.ByPosNoHeight=2]="ByPosNoHeight",o}(QueryType$1||(QueryType$1={}));const Epsilon=.001;class HeightMap{constructor(e,r,s=2){this.length=e,this.height=r,this.flags=s}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,r){this.height!=r&&(Math.abs(this.height-r)>Epsilon&&(e.heightChanged=!0),this.height=r)}replace(e,r,s){return HeightMap.of(s)}decomposeLeft(e,r){r.push(this)}decomposeRight(e,r){r.push(this)}applyChanges(e,r,s,l){let a=this,h=s.doc;for(let c=l.length-1;c>=0;c--){let{fromA:u,toA:f,fromB:d,toB:p}=l[c],g=a.lineAt(u,QueryType$1.ByPosNoHeight,s.setDoc(r),0,0),m=g.to>=f?g:a.lineAt(f,QueryType$1.ByPosNoHeight,s,0,0);for(p+=m.to-f,f=m.to;c>0&&g.from<=l[c-1].toA;)u=l[c-1].fromA,d=l[c-1].fromB,c--,u<g.from&&(g=a.lineAt(u,QueryType$1.ByPosNoHeight,s,0,0));d+=g.from-u,u=g.from;let w=NodeBuilder.build(s.setDoc(h),e,d,p);a=a.replace(u,f,w)}return a.updateHeight(s,0)}static empty(){return new HeightMapText(0,0)}static of(e){if(e.length==1)return e[0];let r=0,s=e.length,l=0,a=0;for(;;)if(r==s)if(l>a*2){let c=e[r-1];c.break?e.splice(--r,1,c.left,null,c.right):e.splice(--r,1,c.left,c.right),s+=1+c.break,l-=c.size}else if(a>l*2){let c=e[s];c.break?e.splice(s,1,c.left,null,c.right):e.splice(s,1,c.left,c.right),s+=2+c.break,a-=c.size}else break;else if(l<a){let c=e[r++];c&&(l+=c.size)}else{let c=e[--s];c&&(a+=c.size)}let h=0;return e[r-1]==null?(h=1,r--):e[r]==null&&(h=1,s++),new HeightMapBranch(HeightMap.of(e.slice(0,r)),h,HeightMap.of(e.slice(s)))}}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(e,r,s){super(e,r),this.deco=s}blockAt(e,r,s,l){return new BlockInfo(l,this.length,s,this.height,this.deco||0)}lineAt(e,r,s,l,a){return this.blockAt(0,s,l,a)}forEachLine(e,r,s,l,a,h){e<=a+this.length&&r>=a&&h(this.blockAt(0,s,l,a))}updateHeight(e,r=0,s=!1,l){return l&&l.from<=r&&l.more&&this.setHeight(e,l.heights[l.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(e,r){super(e,r,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,r,s,l){return new BlockInfo(l,this.length,s,this.height,this.breaks)}replace(e,r,s){let l=s[0];return s.length==1&&(l instanceof HeightMapText||l instanceof HeightMapGap&&l.flags&4)&&Math.abs(this.length-l.length)<10?(l instanceof HeightMapGap?l=new HeightMapText(l.length,this.height):l.height=this.height,this.outdated||(l.outdated=!1),l):HeightMap.of(s)}updateHeight(e,r=0,s=!1,l){return l&&l.from<=r&&l.more?this.setHeight(e,l.heights[l.index++]):(s||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(e){super(e,0)}heightMetrics(e,r){let s=e.doc.lineAt(r).number,l=e.doc.lineAt(r+this.length).number,a=l-s+1,h,c=0;if(e.lineWrapping){let u=Math.min(this.height,e.lineHeight*a);h=u/a,this.length>a+1&&(c=(this.height-u)/(this.length-a-1))}else h=this.height/a;return{firstLine:s,lastLine:l,perLine:h,perChar:c}}blockAt(e,r,s,l){let{firstLine:a,lastLine:h,perLine:c,perChar:u}=this.heightMetrics(r,l);if(r.lineWrapping){let f=l+Math.round(Math.max(0,Math.min(1,(e-s)/this.height))*this.length),d=r.doc.lineAt(f),p=c+d.length*u,g=Math.max(s,e-p/2);return new BlockInfo(d.from,d.length,g,p,0)}else{let f=Math.max(0,Math.min(h-a,Math.floor((e-s)/c))),{from:d,length:p}=r.doc.line(a+f);return new BlockInfo(d,p,s+c*f,c,0)}}lineAt(e,r,s,l,a){if(r==QueryType$1.ByHeight)return this.blockAt(e,s,l,a);if(r==QueryType$1.ByPosNoHeight){let{from:m,to:w}=s.doc.lineAt(e);return new BlockInfo(m,w-m,0,0,0)}let{firstLine:h,perLine:c,perChar:u}=this.heightMetrics(s,a),f=s.doc.lineAt(e),d=c+f.length*u,p=f.number-h,g=l+c*p+u*(f.from-a-p);return new BlockInfo(f.from,f.length,Math.max(l,Math.min(g,l+this.height-d)),d,0)}forEachLine(e,r,s,l,a,h){e=Math.max(e,a),r=Math.min(r,a+this.length);let{firstLine:c,perLine:u,perChar:f}=this.heightMetrics(s,a);for(let d=e,p=l;d<=r;){let g=s.doc.lineAt(d);if(d==e){let w=g.number-c;p+=u*w+f*(e-a-w)}let m=u+f*g.length;h(new BlockInfo(g.from,g.length,p,m,0)),p+=m,d=g.to+1}}replace(e,r,s){let l=this.length-r;if(l>0){let a=s[s.length-1];a instanceof HeightMapGap?s[s.length-1]=new HeightMapGap(a.length+l):s.push(null,new HeightMapGap(l-1))}if(e>0){let a=s[0];a instanceof HeightMapGap?s[0]=new HeightMapGap(e+a.length):s.unshift(new HeightMapGap(e-1),null)}return HeightMap.of(s)}decomposeLeft(e,r){r.push(new HeightMapGap(e-1),null)}decomposeRight(e,r){r.push(null,new HeightMapGap(this.length-e-1))}updateHeight(e,r=0,s=!1,l){let a=r+this.length;if(l&&l.from<=r+this.length&&l.more){let h=[],c=Math.max(r,l.from),u=-1;for(l.from>r&&h.push(new HeightMapGap(l.from-r-1).updateHeight(e,r));c<=a&&l.more;){let d=e.doc.lineAt(c).length;h.length&&h.push(null);let p=l.heights[l.index++];u==-1?u=p:Math.abs(p-u)>=Epsilon&&(u=-2);let g=new HeightMapText(d,p);g.outdated=!1,h.push(g),c+=d+1}c<=a&&h.push(null,new HeightMapGap(a-c).updateHeight(e,c));let f=HeightMap.of(h);return(u<0||Math.abs(f.height-this.height)>=Epsilon||Math.abs(u-this.heightMetrics(e,r).perLine)>=Epsilon)&&(e.heightChanged=!0),f}else(s||this.outdated)&&(this.setHeight(e,e.heightForGap(r,r+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(e,r,s){super(e.length+r+s.length,e.height+s.height,r|(e.outdated||s.outdated?2:0)),this.left=e,this.right=s,this.size=e.size+s.size}get break(){return this.flags&1}blockAt(e,r,s,l){let a=s+this.left.height;return e<a?this.left.blockAt(e,r,s,l):this.right.blockAt(e,r,a,l+this.left.length+this.break)}lineAt(e,r,s,l,a){let h=l+this.left.height,c=a+this.left.length+this.break,u=r==QueryType$1.ByHeight?e<h:e<c,f=u?this.left.lineAt(e,r,s,l,a):this.right.lineAt(e,r,s,h,c);if(this.break||(u?f.to<c:f.from>c))return f;let d=r==QueryType$1.ByPosNoHeight?QueryType$1.ByPosNoHeight:QueryType$1.ByPos;return u?f.join(this.right.lineAt(c,d,s,h,c)):this.left.lineAt(c,d,s,l,a).join(f)}forEachLine(e,r,s,l,a,h){let c=l+this.left.height,u=a+this.left.length+this.break;if(this.break)e<u&&this.left.forEachLine(e,r,s,l,a,h),r>=u&&this.right.forEachLine(e,r,s,c,u,h);else{let f=this.lineAt(u,QueryType$1.ByPos,s,l,a);e<f.from&&this.left.forEachLine(e,f.from-1,s,l,a,h),f.to>=e&&f.from<=r&&h(f),r>f.to&&this.right.forEachLine(f.to+1,r,s,c,u,h)}}replace(e,r,s){let l=this.left.length+this.break;if(r<l)return this.balanced(this.left.replace(e,r,s),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-l,r-l,s));let a=[];e>0&&this.decomposeLeft(e,a);let h=a.length;for(let c of s)a.push(c);if(e>0&&mergeGaps(a,h-1),r<this.length){let c=a.length;this.decomposeRight(r,a),mergeGaps(a,c)}return HeightMap.of(a)}decomposeLeft(e,r){let s=this.left.length;if(e<=s)return this.left.decomposeLeft(e,r);r.push(this.left),this.break&&(s++,e>=s&&r.push(null)),e>s&&this.right.decomposeLeft(e-s,r)}decomposeRight(e,r){let s=this.left.length,l=s+this.break;if(e>=l)return this.right.decomposeRight(e-l,r);e<s&&this.left.decomposeRight(e,r),this.break&&e<l&&r.push(null),r.push(this.right)}balanced(e,r){return e.size>2*r.size||r.size>2*e.size?HeightMap.of(this.break?[e,null,r]:[e,r]):(this.left=e,this.right=r,this.height=e.height+r.height,this.outdated=e.outdated||r.outdated,this.size=e.size+r.size,this.length=e.length+this.break+r.length,this)}updateHeight(e,r=0,s=!1,l){let{left:a,right:h}=this,c=r+a.length+this.break,u=null;return l&&l.from<=r+a.length&&l.more?u=a=a.updateHeight(e,r,s,l):a.updateHeight(e,r,s),l&&l.from<=c+h.length&&l.more?u=h=h.updateHeight(e,c,s,l):h.updateHeight(e,c,s),u?this.balanced(a,h):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(o,e){let r,s;o[e]==null&&(r=o[e-1])instanceof HeightMapGap&&(s=o[e+1])instanceof HeightMapGap&&o.splice(e-1,3,new HeightMapGap(r.length+1+s.length))}const relevantWidgetHeight=5;class NodeBuilder{constructor(e,r){this.pos=e,this.oracle=r,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,r){if(this.lineStart>-1){let s=Math.min(r,this.lineEnd),l=this.nodes[this.nodes.length-1];l instanceof HeightMapText?l.length+=s-this.pos:(s>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(s-this.pos,-1)),this.writtenTo=s,r>s&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=r}point(e,r,s){if(e<r||s.heightRelevant){let l=s.widget?s.widget.estimatedHeight:0,a=s.widget?s.widget.lineBreaks:0;l<0&&(l=this.oracle.lineHeight);let h=r-e;s.block?this.addBlock(new HeightMapBlock(h,l,s)):(h||a||l>=relevantWidgetHeight)&&this.addLineDeco(l,a,h)}else r>e&&this.span(e,r);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:r}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=r,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new HeightMapText(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,r){let s=new HeightMapGap(r-e);return this.oracle.doc.lineAt(e).to==r&&(s.flags|=4),s}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;let r=new HeightMapText(0,-1);return this.nodes.push(r),r}addBlock(e){var r;this.enterLine();let s=(r=e.deco)===null||r===void 0?void 0:r.type;s==BlockType.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,s!=BlockType.WidgetBefore&&(this.covering=e)}addLineDeco(e,r,s){let l=this.ensureLine();l.length+=s,l.collapsed+=s,l.widgetHeight=Math.max(l.widgetHeight,e),l.breaks+=r,this.writtenTo=this.pos=this.pos+s}finish(e){let r=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(r instanceof HeightMapText)&&!this.isCovered?this.nodes.push(new HeightMapText(0,-1)):(this.writtenTo<this.pos||r==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let s=e;for(let l of this.nodes)l instanceof HeightMapText&&l.updateHeight(this.oracle,s),s+=l?l.length:1;return this.nodes}static build(e,r,s,l){let a=new NodeBuilder(s,e);return RangeSet.spans(r,s,l,a,0),a.finish(s)}}function heightRelevantDecoChanges(o,e,r){let s=new DecorationComparator;return RangeSet.compare(o,e,r,s,0),s.changes}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(e,r,s,l){(e<r||s&&s.heightRelevant||l&&l.heightRelevant)&&addRange(e,r,this.changes,5)}}function visiblePixelRange(o,e){let r=o.getBoundingClientRect(),s=o.ownerDocument,l=s.defaultView||window,a=Math.max(0,r.left),h=Math.min(l.innerWidth,r.right),c=Math.max(0,r.top),u=Math.min(l.innerHeight,r.bottom);for(let f=o.parentNode;f&&f!=s.body;)if(f.nodeType==1){let d=f,p=window.getComputedStyle(d);if((d.scrollHeight>d.clientHeight||d.scrollWidth>d.clientWidth)&&p.overflow!="visible"){let g=d.getBoundingClientRect();a=Math.max(a,g.left),h=Math.min(h,g.right),c=Math.max(c,g.top),u=f==o.parentNode?g.bottom:Math.min(u,g.bottom)}f=p.position=="absolute"||p.position=="fixed"?d.offsetParent:d.parentNode}else if(f.nodeType==11)f=f.host;else break;return{left:a-r.left,right:Math.max(a,h)-r.left,top:c-(r.top+e),bottom:Math.max(c,u)-(r.top+e)}}function fullPixelRange(o,e){let r=o.getBoundingClientRect();return{left:0,right:r.right-r.left,top:e,bottom:r.bottom-(r.top+e)}}class LineGap{constructor(e,r,s){this.from=e,this.to=r,this.size=s}static same(e,r){if(e.length!=r.length)return!1;for(let s=0;s<e.length;s++){let l=e[s],a=r[s];if(l.from!=a.from||l.to!=a.to||l.size!=a.size)return!1}return!0}draw(e){return Decoration.replace({widget:new LineGapWidget(this.size,e)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(e,r){super(),this.size=e,this.vertical=r}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!0,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let r=e.facet(contentAttributes).some(s=>typeof s!="function"&&s.class=="cm-lineWrapping");this.heightOracle=new HeightOracle(r),this.stateDeco=e.facet(decorations).filter(s=>typeof s!="function"),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map(s=>s.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:r}=this.state.selection;for(let s=0;s<=1;s++){let l=s?r.head:r.anchor;if(!e.some(({from:a,to:h})=>l>=a&&l<=h)){let{from:a,to:h}=this.lineBlockAt(l);e.push(new Viewport(a,h))}}this.viewports=e.sort((s,l)=>s.from-l.from),this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:scaleBlock(e,this.scaler))})}update(e,r=null){this.state=e.state;let s=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter(d=>typeof d!="function");let l=e.changedRanges,a=ChangedRange.extendWithRanges(l,heightRelevantDecoChanges(s,this.stateDeco,e?e.changes:ChangeSet.empty(this.state.doc.length))),h=this.heightMap.height,c=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),a),this.heightMap.height!=h&&(e.flags|=2),c?(this.scrollAnchorPos=e.changes.mapPos(c.from,-1),this.scrollAnchorHeight=c.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let u=a.length?this.mapViewport(this.viewport,e.changes):this.viewport;(r&&(r.range.head<u.from||r.range.head>u.to)||!this.viewportIsAppropriate(u))&&(u=this.getViewport(0,r));let f=!e.changes.empty||e.flags&2||u.from!=this.viewport.from||u.to!=this.viewport.to;this.viewport=u,this.updateForViewport(),f&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),r&&(this.scrollTarget=r),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let r=e.contentDOM,s=window.getComputedStyle(r),l=this.heightOracle,a=s.whiteSpace;this.defaultTextDirection=s.direction=="rtl"?Direction.RTL:Direction.LTR;let h=this.heightOracle.mustRefreshForWrapping(a),c=r.getBoundingClientRect(),u=h||this.mustMeasureContent||this.contentDOMHeight!=c.height;this.contentDOMHeight=c.height,this.mustMeasureContent=!1;let f=0,d=0,p=parseInt(s.paddingTop)||0,g=parseInt(s.paddingBottom)||0;(this.paddingTop!=p||this.paddingBottom!=g)&&(this.paddingTop=p,this.paddingBottom=g,f|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(l.lineWrapping&&(u=!0),this.editorWidth=e.scrollDOM.clientWidth,f|=8),this.scrollTop!=e.scrollDOM.scrollTop&&(this.scrollAnchorHeight=-1,this.scrollTop=e.scrollDOM.scrollTop),this.scrolledToBottom=isScrolledToBottom(e.scrollDOM);let m=(this.printing?fullPixelRange:visiblePixelRange)(r,this.paddingTop),w=m.top-this.pixelViewport.top,S=m.bottom-this.pixelViewport.bottom;this.pixelViewport=m;let y=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(y!=this.inView&&(this.inView=y,y&&(u=!0)),!this.inView&&!this.scrollTarget)return 0;let v=c.width;if((this.contentDOMWidth!=v||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=c.width,this.editorHeight=e.scrollDOM.clientHeight,f|=8),u){let P=e.docView.measureVisibleLineHeights(this.viewport);if(l.mustRefreshForHeights(P)&&(h=!0),h||l.lineWrapping&&Math.abs(v-this.contentDOMWidth)>l.charWidth){let{lineHeight:b,charWidth:k,textHeight:x}=e.docView.measureTextSize();h=b>0&&l.refresh(a,b,k,x,v/k,P),h&&(e.docView.minWidth=0,f|=8)}w>0&&S>0?d=Math.max(w,S):w<0&&S<0&&(d=Math.min(w,S)),l.heightChanged=!1;for(let b of this.viewports){let k=b.from==this.viewport.from?P:e.docView.measureVisibleLineHeights(b);this.heightMap=(h?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(l,0,h,new MeasuredHeights(b.from,k))}l.heightChanged&&(f|=2)}let O=!this.viewportIsAppropriate(this.viewport,d)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return O&&(this.viewport=this.getViewport(d,this.scrollTarget)),this.updateForViewport(),(f&2||O)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(h?[]:this.lineGaps,e)),f|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),f}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,r){let s=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),l=this.heightMap,a=this.heightOracle,{visibleTop:h,visibleBottom:c}=this,u=new Viewport(l.lineAt(h-s*1e3,QueryType$1.ByHeight,a,0,0).from,l.lineAt(c+(1-s)*1e3,QueryType$1.ByHeight,a,0,0).to);if(r){let{head:f}=r.range;if(f<u.from||f>u.to){let d=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),p=l.lineAt(f,QueryType$1.ByPos,a,0,0),g;r.y=="center"?g=(p.top+p.bottom)/2-d/2:r.y=="start"||r.y=="nearest"&&f<u.from?g=p.top:g=p.bottom-d,u=new Viewport(l.lineAt(g-1e3/2,QueryType$1.ByHeight,a,0,0).from,l.lineAt(g+d+1e3/2,QueryType$1.ByHeight,a,0,0).to)}}return u}mapViewport(e,r){let s=r.mapPos(e.from,-1),l=r.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(s,QueryType$1.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(l,QueryType$1.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:r},s=0){if(!this.inView)return!0;let{top:l}=this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),{bottom:a}=this.heightMap.lineAt(r,QueryType$1.ByPos,this.heightOracle,0,0),{visibleTop:h,visibleBottom:c}=this;return(e==0||l<=h-Math.max(10,Math.min(-s,250)))&&(r==this.state.doc.length||a>=c+Math.max(10,Math.min(s,250)))&&l>h-2*1e3&&a<c+2*1e3}mapLineGaps(e,r){if(!e.length||r.empty)return e;let s=[];for(let l of e)r.touchesRange(l.from,l.to)||s.push(new LineGap(r.mapPos(l.from),r.mapPos(l.to),l.size));return s}ensureLineGaps(e,r){let s=this.heightOracle.lineWrapping,l=s?1e4:2e3,a=l>>1,h=l<<1;if(this.defaultTextDirection!=Direction.LTR&&!s)return[];let c=[],u=(f,d,p,g)=>{if(d-f<a)return;let m=this.state.selection.main,w=[m.from];m.empty||w.push(m.to);for(let y of w)if(y>f&&y<d){u(f,y-10,p,g),u(y+10,d,p,g);return}let S=find(e,y=>y.from>=p.from&&y.to<=p.to&&Math.abs(y.from-f)<a&&Math.abs(y.to-d)<a&&!w.some(v=>y.from<v&&y.to>v));if(!S){if(d<p.to&&r&&s&&r.visibleRanges.some(y=>y.from<=d&&y.to>=d)){let y=r.moveToLineBoundary(EditorSelection.cursor(d),!1,!0).head;y>f&&(d=y)}S=new LineGap(f,d,this.gapSize(p,f,d,g))}c.push(S)};for(let f of this.viewportLines){if(f.length<h)continue;let d=lineStructure(f.from,f.to,this.stateDeco);if(d.total<h)continue;let p=this.scrollTarget?this.scrollTarget.range.head:null,g,m;if(s){let w=l/this.heightOracle.lineLength*this.heightOracle.lineHeight,S,y;if(p!=null){let v=findFraction(d,p),O=((this.visibleBottom-this.visibleTop)/2+w)/f.height;S=v-O,y=v+O}else S=(this.visibleTop-f.top-w)/f.height,y=(this.visibleBottom-f.top+w)/f.height;g=findPosition(d,S),m=findPosition(d,y)}else{let w=d.total*this.heightOracle.charWidth,S=l*this.heightOracle.charWidth,y,v;if(p!=null){let O=findFraction(d,p),P=((this.pixelViewport.right-this.pixelViewport.left)/2+S)/w;y=O-P,v=O+P}else y=(this.pixelViewport.left-S)/w,v=(this.pixelViewport.right+S)/w;g=findPosition(d,y),m=findPosition(d,v)}g>f.from&&u(f.from,g,f,d),m<f.to&&u(m,f.to,f,d)}return c}gapSize(e,r,s,l){let a=findFraction(l,s)-findFraction(l,r);return this.heightOracle.lineWrapping?e.height*a:l.total*this.heightOracle.charWidth*a}updateLineGaps(e){LineGap.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Decoration.set(e.map(r=>r.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let r=[];RangeSet.spans(e,this.viewport.from,this.viewport.to,{span(l,a){r.push({from:l,to:a})},point(){}},20);let s=r.length!=this.visibleRanges.length||this.visibleRanges.some((l,a)=>l.from!=r[a].from||l.to!=r[a].to);return this.visibleRanges=r,s?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(r=>r.from<=e&&r.to>=e)||scaleBlock(this.heightMap.lineAt(e,QueryType$1.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e),QueryType$1.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let r=this.lineBlockAtHeight(e+8);return r.from>=this.viewport.from||this.viewportLines[0].top-e>200?r:this.viewportLines[0]}elementAtHeight(e){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(e,r){this.from=e,this.to=r}}function lineStructure(o,e,r){let s=[],l=o,a=0;return RangeSet.spans(r,o,e,{span(){},point(h,c){h>l&&(s.push({from:l,to:h}),a+=h-l),l=c}},20),l<e&&(s.push({from:l,to:e}),a+=e-l),{total:a,ranges:s}}function findPosition({total:o,ranges:e},r){if(r<=0)return e[0].from;if(r>=1)return e[e.length-1].to;let s=Math.floor(o*r);for(let l=0;;l++){let{from:a,to:h}=e[l],c=h-a;if(s<=c)return a+s;s-=c}}function findFraction(o,e){let r=0;for(let{from:s,to:l}of o.ranges){if(e<=l){r+=e-s;break}r+=l-s}return r/o.total}function find(o,e){for(let r of o)if(e(r))return r}const IdScaler={toDOM(o){return o},fromDOM(o){return o},scale:1};class BigScaler{constructor(e,r,s){let l=0,a=0,h=0;this.viewports=s.map(({from:c,to:u})=>{let f=r.lineAt(c,QueryType$1.ByPos,e,0,0).top,d=r.lineAt(u,QueryType$1.ByPos,e,0,0).bottom;return l+=d-f,{from:c,to:u,top:f,bottom:d,domTop:0,domBottom:0}}),this.scale=(7e6-l)/(r.height-l);for(let c of this.viewports)c.domTop=h+(c.top-a)*this.scale,h=c.domBottom=c.domTop+(c.bottom-c.top),a=c.bottom}toDOM(e){for(let r=0,s=0,l=0;;r++){let a=r<this.viewports.length?this.viewports[r]:null;if(!a||e<a.top)return l+(e-s)*this.scale;if(e<=a.bottom)return a.domTop+(e-a.top);s=a.bottom,l=a.domBottom}}fromDOM(e){for(let r=0,s=0,l=0;;r++){let a=r<this.viewports.length?this.viewports[r]:null;if(!a||e<a.domTop)return s+(e-l)/this.scale;if(e<=a.domBottom)return a.top+(e-a.domTop);s=a.bottom,l=a.domBottom}}}function scaleBlock(o,e){if(e.scale==1)return o;let r=e.toDOM(o.top),s=e.toDOM(o.bottom);return new BlockInfo(o.from,o.length,r,s-r,Array.isArray(o._content)?o._content.map(l=>scaleBlock(l,e)):o._content)}const theme=Facet.define({combine:o=>o.join(" ")}),darkTheme=Facet.define({combine:o=>o.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(o,e,r){return new StyleModule(e,{finish(s){return/&/.test(s)?s.replace(/&\w*/,l=>{if(l=="&")return o;if(!r||!r[l])throw new RangeError(`Unsupported selector: ${l}`);return r[l]}):o+" "+s}})}const baseTheme$1$3=buildTheme("."+baseThemeID,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs);class DOMChange{constructor(e,r,s,l){this.typeOver=l,this.bounds=null,this.text="";let{impreciseHead:a,impreciseAnchor:h}=e.docView;if(e.state.readOnly&&r>-1)this.newSel=null;else if(r>-1&&(this.bounds=e.docView.domBoundsAround(r,s,0))){let c=a||h?[]:selectionPoints(e),u=new DOMReader(c,e.state);u.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=u.text,this.newSel=selectionFromPoints(c,this.bounds.from)}else{let c=e.observer.selectionRange,u=a&&a.node==c.focusNode&&a.offset==c.focusOffset||!contains(e.contentDOM,c.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(c.focusNode,c.focusOffset),f=h&&h.node==c.anchorNode&&h.offset==c.anchorOffset||!contains(e.contentDOM,c.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(c.anchorNode,c.anchorOffset);this.newSel=EditorSelection.single(f,u)}}}function applyDOMChange(o,e){let r,{newSel:s}=e,l=o.state.selection.main,a=o.inputState.lastKeyTime>Date.now()-100?o.inputState.lastKeyCode:-1;if(e.bounds){let{from:h,to:c}=e.bounds,u=l.from,f=null;(a===8||browser.android&&e.text.length<c-h)&&(u=l.to,f="end");let d=findDiff(o.state.doc.sliceString(h,c,LineBreakPlaceholder),e.text,u-h,f);d&&(browser.chrome&&a==13&&d.toB==d.from+2&&e.text.slice(d.from,d.toB)==LineBreakPlaceholder+LineBreakPlaceholder&&d.toB--,r={from:h+d.from,to:h+d.toA,insert:Text.of(e.text.slice(d.from,d.toB).split(LineBreakPlaceholder))})}else s&&(!o.hasFocus&&o.state.facet(editable)||s.main.eq(l))&&(s=null);if(!r&&!s)return!1;if(!r&&e.typeOver&&!l.empty&&s&&s.main.empty?r={from:l.from,to:l.to,insert:o.state.doc.slice(l.from,l.to)}:r&&r.from>=l.from&&r.to<=l.to&&(r.from!=l.from||r.to!=l.to)&&l.to-l.from-(r.to-r.from)<=4?r={from:l.from,to:l.to,insert:o.state.doc.slice(l.from,r.from).append(r.insert).append(o.state.doc.slice(r.to,l.to))}:(browser.mac||browser.android)&&r&&r.from==r.to&&r.from==l.head-1&&/^\. ?$/.test(r.insert.toString())&&o.contentDOM.getAttribute("autocorrect")=="off"?(s&&r.insert.length==2&&(s=EditorSelection.single(s.main.anchor-1,s.main.head-1)),r={from:l.from,to:l.to,insert:Text.of([" "])}):browser.chrome&&r&&r.from==r.to&&r.from==l.head&&r.insert.toString()==`
 `&&o.lineWrapping&&(s&&(s=EditorSelection.single(s.main.anchor-1,s.main.head-1)),r={from:l.from,to:l.to,insert:Text.of([" "])}),r){let h=o.state;if(browser.ios&&o.inputState.flushIOSKey(o)||browser.android&&(r.from==l.from&&r.to==l.to&&r.insert.length==1&&r.insert.lines==2&&dispatchKey(o.contentDOM,"Enter",13)||(r.from==l.from-1&&r.to==l.to&&r.insert.length==0||a==8&&r.insert.length<r.to-r.from)&&dispatchKey(o.contentDOM,"Backspace",8)||r.from==l.from&&r.to==l.to+1&&r.insert.length==0&&dispatchKey(o.contentDOM,"Delete",46)))return!0;let c=r.insert.toString();if(o.state.facet(inputHandler$1).some(d=>d(o,r.from,r.to,c)))return!0;o.inputState.composing>=0&&o.inputState.composing++;let u;if(r.from>=l.from&&r.to<=l.to&&r.to-r.from>=(l.to-l.from)/3&&(!s||s.main.empty&&s.main.from==r.from+r.insert.length)&&o.inputState.composing<0){let d=l.from<r.from?h.sliceDoc(l.from,r.from):"",p=l.to>r.to?h.sliceDoc(r.to,l.to):"";u=h.replaceSelection(o.state.toText(d+r.insert.sliceString(0,void 0,o.state.lineBreak)+p))}else{let d=h.changes(r),p=s&&s.main.to<=d.newLength?s.main:void 0;if(h.selection.ranges.length>1&&o.inputState.composing>=0&&r.to<=l.to&&r.to>=l.to-10){let g=o.state.sliceDoc(r.from,r.to),m=compositionSurroundingNode(o)||o.state.doc.lineAt(l.head),w=l.to-r.to,S=l.to-l.from;u=h.changeByRange(y=>{if(y.from==l.from&&y.to==l.to)return{changes:d,range:p||y.map(d)};let v=y.to-w,O=v-g.length;if(y.to-y.from!=S||o.state.sliceDoc(O,v)!=g||m&&y.to>=m.from&&y.from<=m.to)return{range:y};let P=h.changes({from:O,to:v,insert:r.insert}),b=y.to-l.to;return{changes:P,range:p?EditorSelection.range(Math.max(0,p.anchor+b),Math.max(0,p.head+b)):y.map(P)}})}else u={changes:d,selection:p&&h.selection.replaceRange(p)}}let f="input.type";return(o.composing||o.inputState.compositionPendingChange&&o.inputState.compositionEndedAt>Date.now()-50)&&(o.inputState.compositionPendingChange=!1,f+=".compose",o.inputState.compositionFirstChange&&(f+=".start",o.inputState.compositionFirstChange=!1)),o.dispatch(u,{scrollIntoView:!0,userEvent:f}),!0}else if(s&&!s.main.eq(l)){let h=!1,c="select";return o.inputState.lastSelectionTime>Date.now()-50&&(o.inputState.lastSelectionOrigin=="select"&&(h=!0),c=o.inputState.lastSelectionOrigin),o.dispatch({selection:s,scrollIntoView:h,userEvent:c}),!0}else return!1}function findDiff(o,e,r,s){let l=Math.min(o.length,e.length),a=0;for(;a<l&&o.charCodeAt(a)==e.charCodeAt(a);)a++;if(a==l&&o.length==e.length)return null;let h=o.length,c=e.length;for(;h>0&&c>0&&o.charCodeAt(h-1)==e.charCodeAt(c-1);)h--,c--;if(s=="end"){let u=Math.max(0,a-Math.min(h,c));r-=h+u-a}if(h<a&&o.length<e.length){let u=r<=a&&r>=h?a-r:0;a-=u,c=a+(c-h),h=a}else if(c<a){let u=r<=a&&r>=c?a-r:0;a-=u,h=a+(h-c),c=a}return{from:a,toA:h,toB:c}}function selectionPoints(o){let e=[];if(o.root.activeElement!=o.contentDOM)return e;let{anchorNode:r,anchorOffset:s,focusNode:l,focusOffset:a}=o.observer.selectionRange;return r&&(e.push(new DOMPoint(r,s)),(l!=r||a!=s)&&e.push(new DOMPoint(l,a))),e}function selectionFromPoints(o,e){if(o.length==0)return null;let r=o[0].pos,s=o.length==2?o[1].pos:r;return r>-1&&s>-1?EditorSelection.single(r+e,s+e):null}const observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(e){this.view=e,this.active=!1,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.resizeContent=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(r=>{for(let s of r)this.queue.push(s);(browser.ie&&browser.ie_version<=11||browser.ios&&e.composing)&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),useCharData&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var r;((r=this.view.docView)===null||r===void 0?void 0:r.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM),this.resizeContent=new ResizeObserver(()=>this.view.requestMeasure()),this.resizeContent.observe(e.contentDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(r=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),r.length>0&&r[r.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(r=>{r.length>0&&r[r.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runScrollHandlers(this.view,e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((r,s)=>r!=e[s]))){this.gapIntersection.disconnect();for(let r of e)this.gapIntersection.observe(r);this.gaps=e}}onSelectionChange(e){let r=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:s}=this,l=this.selectionRange;if(s.state.facet(editable)?s.root.activeElement!=this.dom:!hasSelection(s.dom,l))return;let a=l.anchorNode&&s.docView.nearest(l.anchorNode);if(a&&a.ignoreEvent(e)){r||(this.selectionChanged=!1);return}(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!s.state.selection.main.empty&&l.focusNode&&isEquivalentPosition(l.focusNode,l.focusOffset,l.anchorNode,l.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,r=browser.safari&&e.root.nodeType==11&&deepActiveElement(this.dom.ownerDocument)==this.dom&&safariSelectionRangeHack(this.view)||getSelection(e.root);if(!r||this.selectionRange.eq(r))return!1;let s=hasSelection(this.dom,r);return s&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,r)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(r),s&&(this.selectionChanged=!0),!0)}setSelectionRange(e,r){this.selectionRange.set(e.node,e.offset,r.node,r.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,r=null;for(let s=this.dom;s;)if(s.nodeType==1)!r&&e<this.scrollTargets.length&&this.scrollTargets[e]==s?e++:r||(r=this.scrollTargets.slice(0,e)),r&&r.push(s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;if(e<this.scrollTargets.length&&!r&&(r=this.scrollTargets.slice(0,e)),r){for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);for(let s of this.scrollTargets=r)s.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,r){var s;if(!this.delayedAndroidKey){let l=()=>{let a=this.delayedAndroidKey;a&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=a.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&a.force&&dispatchKey(this.dom,a.key,a.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(l)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:r,force:this.lastChange<Date.now()-50||!!(!((s=this.delayedAndroidKey)===null||s===void 0)&&s.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let r=-1,s=-1,l=!1;for(let a of e){let h=this.readMutation(a);h&&(h.typeOver&&(l=!0),r==-1?{from:r,to:s}=h:(r=Math.min(h.from,r),s=Math.max(h.to,s)))}return{from:r,to:s,typeOver:l}}readChange(){let{from:e,to:r,typeOver:s}=this.processRecords(),l=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);return e<0&&!l?null:(e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1,new DOMChange(this.view,e,r,s))}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let r=this.readChange();if(!r)return!1;let s=this.view.state,l=applyDOMChange(this.view,r);return this.view.state==s&&this.view.update([]),l}readMutation(e){let r=this.view.docView.nearest(e.target);if(!r||r.ignoreMutation(e))return null;if(r.markDirty(e.type=="attributes"),e.type=="attributes"&&(r.dirty|=4),e.type=="childList"){let s=findChild(r,e.previousSibling||e.target.previousSibling,-1),l=findChild(r,e.nextSibling||e.target.nextSibling,1);return{from:s?r.posAfter(s):r.posAtStart,to:l?r.posBefore(l):r.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,r,s,l;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(r=this.gapIntersection)===null||r===void 0||r.disconnect(),(s=this.resizeScroll)===null||s===void 0||s.disconnect(),(l=this.resizeContent)===null||l===void 0||l.disconnect();for(let a of this.scrollTargets)a.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function findChild(o,e,r){for(;e;){let s=ContentView.get(e);if(s&&s.parent==o)return s;let l=e.parentNode;e=l!=o.dom?l:r>0?e.nextSibling:e.previousSibling}return null}function safariSelectionRangeHack(o){let e=null;function r(u){u.preventDefault(),u.stopImmediatePropagation(),e=u.getTargetRanges()[0]}if(o.contentDOM.addEventListener("beforeinput",r,!0),o.dom.ownerDocument.execCommand("indent"),o.contentDOM.removeEventListener("beforeinput",r,!0),!e)return null;let s=e.startContainer,l=e.startOffset,a=e.endContainer,h=e.endOffset,c=o.docView.domAtPos(o.state.selection.main.anchor);return isEquivalentPosition(c.node,c.offset,a,h)&&([s,l,a,h]=[a,h,s,l]),{anchorNode:s,anchorOffset:l,focusNode:a,focusOffset:h}}class EditorView{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: fixed; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(r=>this.update([r])),this.dispatch=this.dispatch.bind(this),this._root=e.root||getRoot(e.parent)||document,this.viewState=new ViewState(e.state||EditorState.create(e)),this.plugins=this.state.facet(viewPlugin).map(r=>new PluginInstance(r));for(let r of this.plugins)r.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}dispatch(...e){let r=e.length==1&&e[0]instanceof Transaction?e[0]:this.state.update(...e);this._dispatch(r,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let r=!1,s=!1,l,a=this.state;for(let g of e){if(g.startState!=a)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");a=g.state}if(this.destroyed){this.viewState.state=a;return}let h=this.hasFocus,c=0,u=null;e.some(g=>g.annotation(isFocusChange))?(this.inputState.notifiedFocused=h,c=1):h!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=h,u=focusChangeTransaction(a,h),u||(c=1));let f=this.observer.delayedAndroidKey,d=null;if(f?(this.observer.clearDelayedAndroidKey(),d=this.observer.readChange(),(d&&!this.state.doc.eq(a.doc)||!this.state.selection.eq(a.selection))&&(d=null)):this.observer.clear(),a.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(a);l=ViewUpdate.create(this,a,e),l.flags|=c;let p=this.viewState.scrollTarget;try{this.updateState=2;for(let g of e){if(p&&(p=p.map(g.changes)),g.scrollIntoView){let{main:m}=g.state.selection;p=new ScrollTarget(m.empty?m:EditorSelection.cursor(m.head,m.head>m.anchor?-1:1))}for(let m of g.effects)m.is(scrollIntoView$1)&&(p=m.value)}this.viewState.update(l,p),this.bidiCache=CachedOrder.update(this.bidiCache,l.changes),l.empty||(this.updatePlugins(l),this.inputState.update(l)),r=this.docView.update(l),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),s=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(r,e.some(g=>g.isUserEvent("select.pointer")))}finally{this.updateState=0}if(l.startState.facet(theme)!=l.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(r||s||p||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!l.empty)for(let g of this.state.facet(updateListener))g(l);(u||d)&&Promise.resolve().then(()=>{u&&this.state==u.startState&&this.dispatch(u),d&&!applyDOMChange(this,d)&&f.force&&dispatchKey(this.contentDOM,f.key,f.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let r=this.hasFocus;try{for(let s of this.plugins)s.destroy(this);this.viewState=new ViewState(e),this.plugins=e.facet(viewPlugin).map(s=>new PluginInstance(s)),this.pluginMap.clear();for(let s of this.plugins)s.update(this);this.docView=new DocView(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}r&&this.focus(),this.requestMeasure()}updatePlugins(e){let r=e.startState.facet(viewPlugin),s=e.state.facet(viewPlugin);if(r!=s){let l=[];for(let a of s){let h=r.indexOf(a);if(h<0)l.push(new PluginInstance(a));else{let c=this.plugins[h];c.mustUpdate=e,l.push(c)}}for(let a of this.plugins)a.mustUpdate!=e&&a.destroy(this);this.plugins=l,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let l of this.plugins)l.mustUpdate=e;for(let l=0;l<this.plugins.length;l++)this.plugins[l].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.forceFlush();let r=null,s=this.scrollDOM,{scrollTop:l}=s,{scrollAnchorPos:a,scrollAnchorHeight:h}=this.viewState;l!=this.viewState.scrollTop&&(h=-1),this.viewState.scrollAnchorHeight=-1;try{for(let c=0;;c++){if(h<0)if(isScrolledToBottom(s))a=-1,h=this.viewState.heightMap.height;else{let m=this.viewState.scrollAnchorAt(l);a=m.from,h=m.top}this.updateState=1;let u=this.viewState.measure(this);if(!u&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(c>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let f=[];u&4||([this.measureRequests,f]=[f,this.measureRequests]);let d=f.map(m=>{try{return m.read(this)}catch(w){return logException(this.state,w),BadMeasure}}),p=ViewUpdate.create(this,this.state,[]),g=!1;p.flags|=u,r?r.flags|=u:r=p,this.updateState=2,p.empty||(this.updatePlugins(p),this.inputState.update(p),this.updateAttrs(),g=this.docView.update(p));for(let m=0;m<f.length;m++)if(d[m]!=BadMeasure)try{let w=f[m];w.write&&w.write(d[m],this)}catch(w){logException(this.state,w)}if(g&&this.docView.updateSelection(!0),!p.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null;continue}else{let w=(a<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(a).top)-h;if(w>1||w<-1){l=s.scrollTop=l+w,h=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(r&&!r.empty)for(let c of this.state.facet(updateListener))c(r)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let e=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),r={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(r["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,r);let s=this.observer.ignore(()=>{let l=updateAttrs(this.contentDOM,this.contentAttrs,r),a=updateAttrs(this.dom,this.editorAttrs,e);return l||a});return this.editorAttrs=e,this.contentAttrs=r,s}showAnnouncements(e){let r=!0;for(let s of e)for(let l of s.effects)if(l.is(EditorView.announce)){r&&(this.announceDOM.textContent=""),r=!1;let a=this.announceDOM.appendChild(document.createElement("div"));a.textContent=l.value}}mountStyles(){this.styleModules=this.state.facet(styleModule),StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1$3).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let r=0;r<this.measureRequests.length;r++)if(this.measureRequests[r].key===e.key){this.measureRequests[r]=e;return}}this.measureRequests.push(e)}}plugin(e){let r=this.pluginMap.get(e);return(r===void 0||r&&r.spec!=e)&&this.pluginMap.set(e,r=this.plugins.find(s=>s.spec==e)||null),r&&r.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,r,s){return skipAtoms(this,e,moveByChar(this,e,r,s))}moveByGroup(e,r){return skipAtoms(this,e,moveByChar(this,e,r,s=>byGroup(this,e.head,s)))}moveToLineBoundary(e,r,s=!0){return moveToLineBoundary(this,e,r,s)}moveVertically(e,r,s){return skipAtoms(this,e,moveVertically(this,e,r,s))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,r=0){return this.docView.posFromDOM(e,r)}posAtCoords(e,r=!0){return this.readMeasured(),posAtCoords(this,e,r)}coordsAtPos(e,r=1){this.readMeasured();let s=this.docView.coordsAt(e,r);if(!s||s.left==s.right)return s;let l=this.state.doc.lineAt(e),a=this.bidiSpans(l),h=a[BidiSpan.find(a,e-l.from,-1,r)];return flattenRect(s,h.dir==Direction.LTR==r>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(perLineTextDirection)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>MaxBidiLine)return trivialOrder(e.length);let r=this.textDirectionAt(e.from);for(let l of this.bidiCache)if(l.from==e.from&&l.dir==r)return l.order;let s=computeOrder(e.text,r);return this.bidiCache.push(new CachedOrder(e.from,e.to,r,s)),s}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||browser.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,r={}){return scrollIntoView$1.of(new ScrollTarget(typeof e=="number"?EditorSelection.cursor(e):e,r.y,r.x,r.yMargin,r.xMargin))}static domEventHandlers(e){return ViewPlugin.define(()=>({}),{eventHandlers:e})}static theme(e,r){let s=StyleModule.newName(),l=[theme.of(s),styleModule.of(buildTheme(`.${s}`,e))];return r&&r.dark&&l.push(darkTheme.of(!0)),l}static baseTheme(e){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,e,lightDarkIDs)))}static findFromDOM(e){var r;let s=e.querySelector(".cm-content"),l=s&&ContentView.get(s)||ContentView.get(e);return((r=l==null?void 0:l.rootView)===null||r===void 0?void 0:r.view)||null}}EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler$1;EditorView.focusChangeEffect=focusChangeEffect;EditorView.perLineTextDirection=perLineTextDirection;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.atomicRanges=atomicRanges;EditorView.scrollMargins=scrollMargins;EditorView.darkTheme=darkTheme;EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"});EditorView.announce=StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(e,r,s,l){this.from=e,this.to=r,this.dir=s,this.order=l}static update(e,r){if(r.empty)return e;let s=[],l=e.length?e[e.length-1].dir:Direction.LTR;for(let a=Math.max(0,e.length-10);a<e.length;a++){let h=e[a];h.dir==l&&!r.touchesRange(h.from,h.to)&&s.push(new CachedOrder(r.mapPos(h.from,1),r.mapPos(h.to,-1),h.dir,h.order))}return s}}function attrsFromFacet(o,e,r){for(let s=o.state.facet(e),l=s.length-1;l>=0;l--){let a=s[l],h=typeof a=="function"?a(o):a;h&&combineAttrs(h,r)}return r}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(o,e){const r=o.split(/-(?!$)/);let s=r[r.length-1];s=="Space"&&(s=" ");let l,a,h,c;for(let u=0;u<r.length-1;++u){const f=r[u];if(/^(cmd|meta|m)$/i.test(f))c=!0;else if(/^a(lt)?$/i.test(f))l=!0;else if(/^(c|ctrl|control)$/i.test(f))a=!0;else if(/^s(hift)?$/i.test(f))h=!0;else if(/^mod$/i.test(f))e=="mac"?c=!0:a=!0;else throw new Error("Unrecognized modifier name: "+f)}return l&&(s="Alt-"+s),a&&(s="Ctrl-"+s),c&&(s="Meta-"+s),h&&(s="Shift-"+s),s}function modifiers(o,e,r){return e.altKey&&(o="Alt-"+o),e.ctrlKey&&(o="Ctrl-"+o),e.metaKey&&(o="Meta-"+o),r!==!1&&e.shiftKey&&(o="Shift-"+o),o}const handleKeyEvents=Prec.default(EditorView.domEventHandlers({keydown(o,e){return runHandlers(getKeymap(e.state),o,e,"editor")}})),keymap=Facet.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(o){let e=o.facet(keymap),r=Keymaps.get(e);return r||Keymaps.set(e,r=buildKeymap(e.reduce((s,l)=>s.concat(l),[]))),r}function runScopeHandlers(o,e,r){return runHandlers(getKeymap(o.state),e,o,r)}let storedPrefix=null;const PrefixTimeout=4e3;function buildKeymap(o,e=currentPlatform){let r=Object.create(null),s=Object.create(null),l=(h,c)=>{let u=s[h];if(u==null)s[h]=c;else if(u!=c)throw new Error("Key binding "+h+" is used both as a regular binding and as a multi-stroke prefix")},a=(h,c,u,f)=>{var d,p;let g=r[h]||(r[h]=Object.create(null)),m=c.split(/ (?!$)/).map(y=>normalizeKeyName(y,e));for(let y=1;y<m.length;y++){let v=m.slice(0,y).join(" ");l(v,!0),g[v]||(g[v]={preventDefault:!0,run:[O=>{let P=storedPrefix={view:O,prefix:v,scope:h};return setTimeout(()=>{storedPrefix==P&&(storedPrefix=null)},PrefixTimeout),!0}]})}let w=m.join(" ");l(w,!1);let S=g[w]||(g[w]={preventDefault:!1,run:((p=(d=g._any)===null||d===void 0?void 0:d.run)===null||p===void 0?void 0:p.slice())||[]});u&&S.run.push(u),f&&(S.preventDefault=!0)};for(let h of o){let c=h.scope?h.scope.split(" "):["editor"];if(h.any)for(let f of c){let d=r[f]||(r[f]=Object.create(null));d._any||(d._any={preventDefault:!1,run:[]});for(let p in d)d[p].run.push(h.any)}let u=h[e]||h.key;if(u)for(let f of c)a(f,u,h.run,h.preventDefault),h.shift&&a(f,"Shift-"+u,h.shift,h.preventDefault)}return r}function runHandlers(o,e,r,s){let l=keyName(e),a=codePointAt(l,0),h=codePointSize(a)==l.length&&l!=" ",c="",u=!1;storedPrefix&&storedPrefix.view==r&&storedPrefix.scope==s&&(c=storedPrefix.prefix+" ",(u=modifierCodes.indexOf(e.keyCode)<0)&&(storedPrefix=null));let f=new Set,d=w=>{if(w){for(let S of w.run)if(!f.has(S)&&(f.add(S),S(r,e)))return!0;w.preventDefault&&(u=!0)}return!1},p=o[s],g,m;if(p){if(d(p[c+modifiers(l,e,!h)]))return!0;if(h&&(e.altKey||e.metaKey||e.ctrlKey)&&!(browser.windows&&e.ctrlKey&&e.altKey)&&(g=base[e.keyCode])&&g!=l){if(d(p[c+modifiers(g,e,!0)]))return!0;if(e.shiftKey&&(m=shift[e.keyCode])!=l&&m!=g&&d(p[c+modifiers(m,e,!1)]))return!0}else if(h&&e.shiftKey&&d(p[c+modifiers(l,e,!0)]))return!0;if(d(p._any))return!0}return u}class RectangleMarker{constructor(e,r,s,l,a){this.className=e,this.left=r,this.top=s,this.width=l,this.height=a}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,r){return r.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,r,s){if(s.empty){let l=e.coordsAtPos(s.head,s.assoc||1);if(!l)return[];let a=getBase(e);return[new RectangleMarker(r,l.left-a.left,l.top-a.top,null,l.bottom-l.top)]}else return rectanglesForRange(e,r,s)}}function getBase(o){let e=o.scrollDOM.getBoundingClientRect();return{left:(o.textDirection==Direction.LTR?e.left:e.right-o.scrollDOM.clientWidth)-o.scrollDOM.scrollLeft,top:e.top-o.scrollDOM.scrollTop}}function wrappedLine(o,e,r){let s=EditorSelection.cursor(e);return{from:Math.max(r.from,o.moveToLineBoundary(s,!1,!0).from),to:Math.min(r.to,o.moveToLineBoundary(s,!0,!0).from),type:BlockType.Text}}function rectanglesForRange(o,e,r){if(r.to<=o.viewport.from||r.from>=o.viewport.to)return[];let s=Math.max(r.from,o.viewport.from),l=Math.min(r.to,o.viewport.to),a=o.textDirection==Direction.LTR,h=o.contentDOM,c=h.getBoundingClientRect(),u=getBase(o),f=h.querySelector(".cm-line"),d=f&&window.getComputedStyle(f),p=c.left+(d?parseInt(d.paddingLeft)+Math.min(0,parseInt(d.textIndent)):0),g=c.right-(d?parseInt(d.paddingRight):0),m=blockAt(o,s),w=blockAt(o,l),S=m.type==BlockType.Text?m:null,y=w.type==BlockType.Text?w:null;if(S&&(o.lineWrapping||m.widgetLineBreaks)&&(S=wrappedLine(o,s,S)),y&&(o.lineWrapping||w.widgetLineBreaks)&&(y=wrappedLine(o,l,y)),S&&y&&S.from==y.from)return O(P(r.from,r.to,S));{let k=S?P(r.from,null,S):b(m,!1),x=y?P(null,r.to,y):b(w,!0),T=[];return(S||m).to<(y||w).from-(S&&y?1:0)||m.widgetLineBreaks>1&&k.bottom+o.defaultLineHeight/2<x.top?T.push(v(p,k.bottom,g,x.top)):k.bottom<x.top&&o.elementAtHeight((k.bottom+x.top)/2).type==BlockType.Text&&(k.bottom=x.top=(k.bottom+x.top)/2),O(k).concat(T).concat(O(x))}function v(k,x,T,A){return new RectangleMarker(e,k-u.left,x-u.top-.01,T-k,A-x+.01)}function O({top:k,bottom:x,horizontal:T}){let A=[];for(let M=0;M<T.length;M+=2)A.push(v(T[M],k,T[M+1],x));return A}function P(k,x,T){let A=1e9,M=-1e9,E=[];function D(N,L,I,Q,V){let $=o.coordsAtPos(N,N==T.to?-2:2),B=o.coordsAtPos(I,I==T.from?2:-2);!$||!B||(A=Math.min($.top,B.top,A),M=Math.max($.bottom,B.bottom,M),V==Direction.LTR?E.push(a&&L?p:$.left,a&&Q?g:B.right):E.push(!a&&Q?p:B.left,!a&&L?g:$.right))}let R=k??T.from,_=x??T.to;for(let N of o.visibleRanges)if(N.to>R&&N.from<_)for(let L=Math.max(N.from,R),I=Math.min(N.to,_);;){let Q=o.state.doc.lineAt(L);for(let V of o.bidiSpans(Q)){let $=V.from+Q.from,B=V.to+Q.from;if($>=I)break;B>L&&D(Math.max($,L),k==null&&$<=R,Math.min(B,I),x==null&&B>=_,V.dir)}if(L=Q.to+1,L>=I)break}return E.length==0&&D(R,k==null,_,x==null,o.textDirection),{top:A,bottom:M,horizontal:E}}function b(k,x){let T=c.top+(x?k.top:k.bottom);return{top:T,bottom:T,horizontal:[]}}}function sameMarker(o,e){return o.constructor==e.constructor&&o.eq(e)}class LayerView{constructor(e,r){this.view=e,this.layer=r,this.drawn=[],this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),r.above&&this.dom.classList.add("cm-layer-above"),r.class&&this.dom.classList.add(r.class),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),r.mount&&r.mount(this.dom,e)}update(e){e.startState.facet(layerOrder)!=e.state.facet(layerOrder)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&e.view.requestMeasure(this.measureReq)}setOrder(e){let r=0,s=e.facet(layerOrder);for(;r<s.length&&s[r]!=this.layer;)r++;this.dom.style.zIndex=String((this.layer.above?150:-1)-r)}measure(){return this.layer.markers(this.view)}draw(e){if(e.length!=this.drawn.length||e.some((r,s)=>!sameMarker(r,this.drawn[s]))){let r=this.dom.firstChild,s=0;for(let l of e)l.update&&r&&l.constructor&&this.drawn[s].constructor&&l.update(r,this.drawn[s])?(r=r.nextSibling,s++):this.dom.insertBefore(l.draw(),r);for(;r;){let l=r.nextSibling;r.remove(),r=l}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const layerOrder=Facet.define();function layer(o){return[ViewPlugin.define(e=>new LayerView(e,o)),layerOrder.of(o)]}const CanHidePrimary=!browser.ios,selectionConfig=Facet.define({combine(o){return combineConfig(o,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,r)=>Math.min(e,r),drawRangeCursor:(e,r)=>e||r})}});function drawSelection(o={}){return[selectionConfig.of(o),cursorLayer,selectionLayer,hideNativeSelection,nativeSelectionHidden.of(!0)]}function configChanged(o){return o.startState.facet(selectionConfig)!=o.state.facet(selectionConfig)}const cursorLayer=layer({above:!0,markers(o){let{state:e}=o,r=e.facet(selectionConfig),s=[];for(let l of e.selection.ranges){let a=l==e.selection.main;if(l.empty?!a||CanHidePrimary:r.drawRangeCursor){let h=a?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",c=l.empty?l:EditorSelection.cursor(l.head,l.head>l.anchor?-1:1);for(let u of RectangleMarker.forRange(o,h,c))s.push(u)}}return s},update(o,e){o.transactions.some(s=>s.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let r=configChanged(o);return r&&setBlinkRate(o.state,e),o.docChanged||o.selectionSet||r},mount(o,e){setBlinkRate(e.state,o)},class:"cm-cursorLayer"});function setBlinkRate(o,e){e.style.animationDuration=o.facet(selectionConfig).cursorBlinkRate+"ms"}const selectionLayer=layer({above:!1,markers(o){return o.state.selection.ranges.map(e=>e.empty?[]:RectangleMarker.forRange(o,"cm-selectionBackground",e)).reduce((e,r)=>e.concat(r))},update(o,e){return o.docChanged||o.selectionSet||o.viewportChanged||configChanged(o)},class:"cm-selectionLayer"}),themeSpec={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor="transparent !important");const hideNativeSelection=Prec.highest(EditorView.theme(themeSpec)),setDropCursorPos=StateEffect.define({map(o,e){return o==null?null:e.mapPos(o)}}),dropCursorPos=StateField.define({create(){return null},update(o,e){return o!=null&&(o=e.changes.mapPos(o)),e.effects.reduce((r,s)=>s.is(setDropCursorPos)?s.value:r,o)}}),drawDropCursor=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(o){var e;let r=o.state.field(dropCursorPos);r==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(o.startState.field(dropCursorPos)!=r||o.docChanged||o.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let o=this.view.state.field(dropCursorPos),e=o!=null&&this.view.coordsAtPos(o);if(!e)return null;let r=this.view.scrollDOM.getBoundingClientRect();return{left:e.left-r.left+this.view.scrollDOM.scrollLeft,top:e.top-r.top+this.view.scrollDOM.scrollTop,height:e.bottom-e.top}}drawCursor(o){this.cursor&&(o?(this.cursor.style.left=o.left+"px",this.cursor.style.top=o.top+"px",this.cursor.style.height=o.height+"px"):this.cursor.style.left="-100000px")}destroy(){this.cursor&&this.cursor.remove()}setDropPos(o){this.view.state.field(dropCursorPos)!=o&&this.view.dispatch({effects:setDropCursorPos.of(o)})}},{eventHandlers:{dragover(o){this.setDropPos(this.view.posAtCoords({x:o.clientX,y:o.clientY}))},dragleave(o){(o.target==this.view.contentDOM||!this.view.contentDOM.contains(o.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function dropCursor(){return[dropCursorPos,drawDropCursor]}function iterMatches(o,e,r,s,l){e.lastIndex=0;for(let a=o.iterRange(r,s),h=r,c;!a.next().done;h+=a.value.length)if(!a.lineBreak)for(;c=e.exec(a.value);)l(h+c.index,c)}function matchRanges(o,e){let r=o.visibleRanges;if(r.length==1&&r[0].from==o.viewport.from&&r[0].to==o.viewport.to)return r;let s=[];for(let{from:l,to:a}of r)l=Math.max(o.state.doc.lineAt(l).from,l-e),a=Math.min(o.state.doc.lineAt(a).to,a+e),s.length&&s[s.length-1].to>=l?s[s.length-1].to=a:s.push({from:l,to:a});return s}class MatchDecorator{constructor(e){const{regexp:r,decoration:s,decorate:l,boundary:a,maxLength:h=1e3}=e;if(!r.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=r,l)this.addMatch=(c,u,f,d)=>l(d,f,f+c[0].length,c,u);else if(typeof s=="function")this.addMatch=(c,u,f,d)=>{let p=s(c,u,f);p&&d(f,f+c[0].length,p)};else if(s)this.addMatch=(c,u,f,d)=>d(f,f+c[0].length,s);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=a,this.maxLength=h}createDeco(e){let r=new RangeSetBuilder,s=r.add.bind(r);for(let{from:l,to:a}of matchRanges(e,this.maxLength))iterMatches(e.state.doc,this.regexp,l,a,(h,c)=>this.addMatch(c,e,h,s));return r.finish()}updateDeco(e,r){let s=1e9,l=-1;return e.docChanged&&e.changes.iterChanges((a,h,c,u)=>{u>e.view.viewport.from&&c<e.view.viewport.to&&(s=Math.min(c,s),l=Math.max(u,l))}),e.viewportChanged||l-s>1e3?this.createDeco(e.view):l>-1?this.updateRange(e.view,r.map(e.changes),s,l):r}updateRange(e,r,s,l){for(let a of e.visibleRanges){let h=Math.max(a.from,s),c=Math.min(a.to,l);if(c>h){let u=e.state.doc.lineAt(h),f=u.to<c?e.state.doc.lineAt(c):u,d=Math.max(a.from,u.from),p=Math.min(a.to,f.to);if(this.boundary){for(;h>u.from;h--)if(this.boundary.test(u.text[h-1-u.from])){d=h;break}for(;c<f.to;c++)if(this.boundary.test(f.text[c-f.from])){p=c;break}}let g=[],m,w=(S,y,v)=>g.push(v.range(S,y));if(u==f)for(this.regexp.lastIndex=d-u.from;(m=this.regexp.exec(u.text))&&m.index<p-u.from;)this.addMatch(m,e,m.index+u.from,w);else iterMatches(e.state.doc,this.regexp,d,p,(S,y)=>this.addMatch(y,e,S,w));r=r.update({filterFrom:d,filterTo:p,filter:(S,y)=>S<d||y>p,add:g})}}return r}}const UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g",Specials=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\uFEFF￹-￼]`,UnicodeRegexpSupport),Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _supportsTabSize=null;function supportsTabSize(){var o;if(_supportsTabSize==null&&typeof document<"u"&&document.body){let e=document.body.style;_supportsTabSize=((o=e.tabSize)!==null&&o!==void 0?o:e.MozTabSize)!=null}return _supportsTabSize||!1}const specialCharConfig=Facet.define({combine(o){let e=combineConfig(o,{render:null,specialChars:Specials,addSpecialChars:null});return(e.replaceTabs=!supportsTabSize())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,UnicodeRegexpSupport)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,UnicodeRegexpSupport)),e}});function highlightSpecialChars(o={}){return[specialCharConfig.of(o),specialCharPlugin()]}let _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.decorations=Decoration.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(o.state.facet(specialCharConfig)),this.decorations=this.decorator.createDeco(o)}makeDecorator(o){return new MatchDecorator({regexp:o.specialChars,decoration:(e,r,s)=>{let{doc:l}=r.state,a=codePointAt(e[0],0);if(a==9){let h=l.lineAt(s),c=r.state.tabSize,u=countColumn(h.text,c,s-h.from);return Decoration.replace({widget:new TabWidget((c-u%c)*this.view.defaultCharacterWidth)})}return this.decorationCache[a]||(this.decorationCache[a]=Decoration.replace({widget:new SpecialCharWidget(o,a)}))},boundary:o.replaceTabs?void 0:/[^]/})}update(o){let e=o.state.facet(specialCharConfig);o.startState.facet(specialCharConfig)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(o.view)):this.decorations=this.decorator.updateDeco(o,this.decorations)}},{decorations:o=>o.decorations}))}const DefaultPlaceholder="•";function placeholder$1(o){return o>=32?DefaultPlaceholder:o==10?"␤":String.fromCharCode(9216+o)}class SpecialCharWidget extends WidgetType{constructor(e,r){super(),this.options=e,this.code=r}eq(e){return e.code==this.code}toDOM(e){let r=placeholder$1(this.code),s=e.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16)),l=this.options.render&&this.options.render(this.code,s,r);if(l)return l;let a=document.createElement("span");return a.textContent=r,a.title=s,a.setAttribute("aria-label",s),a.className="cm-specialChar",a}ignoreEvent(){return!1}}class TabWidget extends WidgetType{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function highlightActiveLine(){return activeLineHighlighter}const lineDeco=Decoration.line({class:"cm-activeLine"}),activeLineHighlighter=ViewPlugin.fromClass(class{constructor(o){this.decorations=this.getDeco(o)}update(o){(o.docChanged||o.selectionSet)&&(this.decorations=this.getDeco(o.view))}getDeco(o){let e=-1,r=[];for(let s of o.state.selection.ranges){let l=o.lineBlockAt(s.head);l.from>e&&(r.push(lineDeco.range(l.from)),e=l.from)}return Decoration.set(r)}},{decorations:o=>o.decorations}),MaxOff=2e3;function rectangleFor(o,e,r){let s=Math.min(e.line,r.line),l=Math.max(e.line,r.line),a=[];if(e.off>MaxOff||r.off>MaxOff||e.col<0||r.col<0){let h=Math.min(e.off,r.off),c=Math.max(e.off,r.off);for(let u=s;u<=l;u++){let f=o.doc.line(u);f.length<=c&&a.push(EditorSelection.range(f.from+h,f.to+c))}}else{let h=Math.min(e.col,r.col),c=Math.max(e.col,r.col);for(let u=s;u<=l;u++){let f=o.doc.line(u),d=findColumn(f.text,h,o.tabSize,!0);if(d<0)a.push(EditorSelection.cursor(f.to));else{let p=findColumn(f.text,c,o.tabSize);a.push(EditorSelection.range(f.from+d,f.from+p))}}}return a}function absoluteColumn(o,e){let r=o.coordsAtPos(o.viewport.from);return r?Math.round(Math.abs((r.left-e)/o.defaultCharacterWidth)):-1}function getPos(o,e){let r=o.posAtCoords({x:e.clientX,y:e.clientY},!1),s=o.state.doc.lineAt(r),l=r-s.from,a=l>MaxOff?-1:l==s.length?absoluteColumn(o,e.clientX):countColumn(s.text,o.state.tabSize,r-s.from);return{line:s.number,col:a,off:l}}function rectangleSelectionStyle(o,e){let r=getPos(o,e),s=o.state.selection;return r?{update(l){if(l.docChanged){let a=l.changes.mapPos(l.startState.doc.line(r.line).from),h=l.state.doc.lineAt(a);r={line:h.number,col:r.col,off:Math.min(r.off,h.length)},s=s.map(l.changes)}},get(l,a,h){let c=getPos(o,l);if(!c)return s;let u=rectangleFor(o.state,r,c);return u.length?h?EditorSelection.create(u.concat(s.ranges)):EditorSelection.create(u):s}}:null}function rectangularSelection(o){let e=(o==null?void 0:o.eventFilter)||(r=>r.altKey&&r.button==0);return EditorView.mouseSelectionStyle.of((r,s)=>e(s)?rectangleSelectionStyle(r,s):null)}const keys$1={Alt:[18,o=>!!o.altKey],Control:[17,o=>!!o.ctrlKey],Shift:[16,o=>!!o.shiftKey],Meta:[91,o=>!!o.metaKey]},showCrosshair={style:"cursor: crosshair"};function crosshairCursor(o={}){let[e,r]=keys$1[o.key||"Alt"],s=ViewPlugin.fromClass(class{constructor(l){this.view=l,this.isDown=!1}set(l){this.isDown!=l&&(this.isDown=l,this.view.update([]))}},{eventHandlers:{keydown(l){this.set(l.keyCode==e||r(l))},keyup(l){(l.keyCode==e||!r(l))&&this.set(!1)},mousemove(l){this.set(r(l))}}});return[s,EditorView.contentAttributes.of(l=>{var a;return!((a=l.plugin(s))===null||a===void 0)&&a.isDown?showCrosshair:null})]}const Outside="-10000px";class TooltipViewManager{constructor(e,r,s){this.facet=r,this.createTooltipView=s,this.input=e.state.facet(r),this.tooltips=this.input.filter(l=>l),this.tooltipViews=this.tooltips.map(s)}update(e){var r;let s=e.state.facet(this.facet),l=s.filter(h=>h);if(s===this.input){for(let h of this.tooltipViews)h.update&&h.update(e);return!1}let a=[];for(let h=0;h<l.length;h++){let c=l[h],u=-1;if(c){for(let f=0;f<this.tooltips.length;f++){let d=this.tooltips[f];d&&d.create==c.create&&(u=f)}if(u<0)a[h]=this.createTooltipView(c);else{let f=a[h]=this.tooltipViews[u];f.update&&f.update(e)}}}for(let h of this.tooltipViews)a.indexOf(h)<0&&(h.dom.remove(),(r=h.destroy)===null||r===void 0||r.call(h));return this.input=s,this.tooltips=l,this.tooltipViews=a,!0}}function windowSpace(o){let{win:e}=o;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const tooltipConfig=Facet.define({combine:o=>{var e,r,s;return{position:browser.ios?"absolute":((e=o.find(l=>l.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((r=o.find(l=>l.parent))===null||r===void 0?void 0:r.parent)||null,tooltipSpace:((s=o.find(l=>l.tooltipSpace))===null||s===void 0?void 0:s.tooltipSpace)||windowSpace}}}),knownHeight=new WeakMap,tooltipPlugin=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let e=o.state.facet(tooltipConfig);this.position=e.position,this.parent=e.parent,this.classes=o.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new TooltipViewManager(o,showTooltip,r=>this.createTooltip(r)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(r=>{Date.now()>this.lastTransaction-50&&r.length>0&&r[r.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),o.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let o of this.manager.tooltipViews)this.intersectionObserver.observe(o.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(o){o.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(o);e&&this.observeIntersection();let r=e||o.geometryChanged,s=o.state.facet(tooltipConfig);if(s.position!=this.position){this.position=s.position;for(let l of this.manager.tooltipViews)l.dom.style.position=this.position;r=!0}if(s.parent!=this.parent){this.parent&&this.container.remove(),this.parent=s.parent,this.createContainer();for(let l of this.manager.tooltipViews)this.container.appendChild(l.dom);r=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);r&&this.maybeMeasure()}createTooltip(o){let e=o.create(this.view);if(e.dom.classList.add("cm-tooltip"),o.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let r=document.createElement("div");r.className="cm-tooltip-arrow",e.dom.appendChild(r)}return e.dom.style.position=this.position,e.dom.style.top=Outside,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var o,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let r of this.manager.tooltipViews)r.dom.remove(),(o=r.destroy)===null||o===void 0||o.call(r);(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let o=this.view.dom.getBoundingClientRect();return{editor:o,parent:this.parent?this.container.getBoundingClientRect():o,pos:this.manager.tooltips.map((e,r)=>{let s=this.manager.tooltipViews[r];return s.getCoords?s.getCoords(e.pos):this.view.coordsAtPos(e.pos)}),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view)}}writeMeasure(o){var e;let{editor:r,space:s}=o,l=[];for(let a=0;a<this.manager.tooltips.length;a++){let h=this.manager.tooltips[a],c=this.manager.tooltipViews[a],{dom:u}=c,f=o.pos[a],d=o.size[a];if(!f||f.bottom<=Math.max(r.top,s.top)||f.top>=Math.min(r.bottom,s.bottom)||f.right<Math.max(r.left,s.left)-.1||f.left>Math.min(r.right,s.right)+.1){u.style.top=Outside;continue}let p=h.arrow?c.dom.querySelector(".cm-tooltip-arrow"):null,g=p?7:0,m=d.right-d.left,w=(e=knownHeight.get(c))!==null&&e!==void 0?e:d.bottom-d.top,S=c.offset||noOffset,y=this.view.textDirection==Direction.LTR,v=d.width>s.right-s.left?y?s.left:s.right-d.width:y?Math.min(f.left-(p?14:0)+S.x,s.right-m):Math.max(s.left,f.left-m+(p?14:0)-S.x),O=!!h.above;!h.strictSide&&(O?f.top-(d.bottom-d.top)-S.y<s.top:f.bottom+(d.bottom-d.top)+S.y>s.bottom)&&O==s.bottom-f.bottom>f.top-s.top&&(O=!O);let P=(O?f.top-s.top:s.bottom-f.bottom)-g;if(P<w&&c.resize!==!1){if(P<this.view.defaultLineHeight){u.style.top=Outside;continue}knownHeight.set(c,w),u.style.height=(w=P)+"px"}else u.style.height&&(u.style.height="");let b=O?f.top-w-g-S.y:f.bottom+g+S.y,k=v+m;if(c.overlap!==!0)for(let x of l)x.left<k&&x.right>v&&x.top<b+w&&x.bottom>b&&(b=O?x.top-w-2-g:x.bottom+g+2);this.position=="absolute"?(u.style.top=b-o.parent.top+"px",u.style.left=v-o.parent.left+"px"):(u.style.top=b+"px",u.style.left=v+"px"),p&&(p.style.left=`${f.left+(y?S.x:-S.x)-(v+14-7)}px`),c.overlap!==!0&&l.push({left:v,top:b,right:k,bottom:b+w}),u.classList.toggle("cm-tooltip-above",O),u.classList.toggle("cm-tooltip-below",!O),c.positioned&&c.positioned(o.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let o of this.manager.tooltipViews)o.dom.style.top=Outside}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),baseTheme$4=EditorView.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),noOffset={x:0,y:0},showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$4]}),showHoverTooltip=Facet.define();class HoverTooltipHost{constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new TooltipViewManager(e,showHoverTooltip,r=>this.createHostedView(r))}static create(e){return new HoverTooltipHost(e)}createHostedView(e){let r=e.create(this.view);return r.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(r.dom),this.mounted&&r.mount&&r.mount(this.view),r}mount(e){for(let r of this.manager.tooltipViews)r.mount&&r.mount(e);this.mounted=!0}positioned(e){for(let r of this.manager.tooltipViews)r.positioned&&r.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let r of this.manager.tooltipViews)(e=r.destroy)===null||e===void 0||e.call(r)}}const showHoverTooltipHost=showTooltip.compute([showHoverTooltip],o=>{let e=o.facet(showHoverTooltip).filter(r=>r);return e.length===0?null:{pos:Math.min(...e.map(r=>r.pos)),end:Math.max(...e.filter(r=>r.end!=null).map(r=>r.end)),create:HoverTooltipHost.create,above:e[0].above,arrow:e.some(r=>r.arrow)}});class HoverPlugin{constructor(e,r,s,l,a){this.view=e,this.source=r,this.field=s,this.setHover=l,this.hoverTime=a,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:e}=this,r=this.view.contentDOM.contains(e.target)?this.view.posAtCoords(e):null;if(r==null)return;let s=this.view.coordsAtPos(r);if(s==null||e.y<s.top||e.y>s.bottom||e.x<s.left-this.view.defaultCharacterWidth||e.x>s.right+this.view.defaultCharacterWidth)return;let l=this.view.bidiSpans(this.view.state.doc.lineAt(r)).find(c=>c.from<=r&&c.to>=r),a=l&&l.dir==Direction.RTL?-1:1,h=this.source(this.view,r,e.x<s.left?-a:a);if(h!=null&&h.then){let c=this.pending={pos:r};h.then(u=>{this.pending==c&&(this.pending=null,u&&this.view.dispatch({effects:this.setHover.of(u)}))},u=>logException(this.view.state,u,"hover tooltip"))}else h&&this.view.dispatch({effects:this.setHover.of(h)})}mousemove(e){var r;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let s=this.active;if(s&&!isInTooltip(this.lastMove.target)||this.pending){let{pos:l}=s||this.pending,a=(r=s==null?void 0:s.end)!==null&&r!==void 0?r:l;(l==a?this.view.posAtCoords(this.lastMove)!=l:!isOverRange(this.view,l,a,e.clientX,e.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&!isInTooltip(e.relatedTarget)&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function isInTooltip(o){for(let e=o;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function isOverRange(o,e,r,s,l,a){let h=document.createRange(),c=o.domAtPos(e),u=o.domAtPos(r);h.setEnd(u.node,u.offset),h.setStart(c.node,c.offset);let f=h.getClientRects();h.detach();for(let d=0;d<f.length;d++){let p=f[d];if(Math.max(p.top-l,l-p.bottom,p.left-s,s-p.right)<=a)return!0}return!1}function hoverTooltip(o,e={}){let r=StateEffect.define(),s=StateField.define({create(){return null},update(l,a){if(l&&(e.hideOnChange&&(a.docChanged||a.selection)||e.hideOn&&e.hideOn(a,l)))return null;if(l&&a.docChanged){let h=a.changes.mapPos(l.pos,-1,MapMode.TrackDel);if(h==null)return null;let c=Object.assign(Object.create(null),l);c.pos=h,l.end!=null&&(c.end=a.changes.mapPos(l.end)),l=c}for(let h of a.effects)h.is(r)&&(l=h.value),h.is(closeHoverTooltipEffect)&&(l=null);return l},provide:l=>showHoverTooltip.from(l)});return[s,ViewPlugin.define(l=>new HoverPlugin(l,o,s,r,e.hoverTime||300)),showHoverTooltipHost]}function getTooltip(o,e){let r=o.plugin(tooltipPlugin);if(!r)return null;let s=r.manager.tooltips.indexOf(e);return s<0?null:r.manager.tooltipViews[s]}const closeHoverTooltipEffect=StateEffect.define(),panelConfig=Facet.define({combine(o){let e,r;for(let s of o)e=e||s.topContainer,r=r||s.bottomContainer;return{topContainer:e,bottomContainer:r}}});function getPanel(o,e){let r=o.plugin(panelPlugin),s=r?r.specs.indexOf(e):-1;return s>-1?r.panels[s]:null}const panelPlugin=ViewPlugin.fromClass(class{constructor(o){this.input=o.state.facet(showPanel),this.specs=this.input.filter(r=>r),this.panels=this.specs.map(r=>r(o));let e=o.state.facet(panelConfig);this.top=new PanelGroup(o,!0,e.topContainer),this.bottom=new PanelGroup(o,!1,e.bottomContainer),this.top.sync(this.panels.filter(r=>r.top)),this.bottom.sync(this.panels.filter(r=>!r.top));for(let r of this.panels)r.dom.classList.add("cm-panel"),r.mount&&r.mount()}update(o){let e=o.state.facet(panelConfig);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new PanelGroup(o.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new PanelGroup(o.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let r=o.state.facet(showPanel);if(r!=this.input){let s=r.filter(u=>u),l=[],a=[],h=[],c=[];for(let u of s){let f=this.specs.indexOf(u),d;f<0?(d=u(o.view),c.push(d)):(d=this.panels[f],d.update&&d.update(o)),l.push(d),(d.top?a:h).push(d)}this.specs=s,this.panels=l,this.top.sync(a),this.bottom.sync(h);for(let u of c)u.dom.classList.add("cm-panel"),u.mount&&u.mount()}else for(let s of this.panels)s.update&&s.update(o)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:o=>EditorView.scrollMargins.of(e=>{let r=e.plugin(o);return r&&{top:r.top.scrollMargin(),bottom:r.bottom.scrollMargin()}})});class PanelGroup{constructor(e,r,s){this.view=e,this.top=r,this.container=s,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let r of this.panels)r.destroy&&e.indexOf(r)<0&&r.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let r=this.container||this.view.dom;r.insertBefore(this.dom,this.top?r.firstChild:null)}let e=this.dom.firstChild;for(let r of this.panels)if(r.dom.parentNode==this.dom){for(;e!=r.dom;)e=rm(e);e=e.nextSibling}else this.dom.insertBefore(r.dom,e);for(;e;)e=rm(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function rm(o){let e=o.nextSibling;return o.remove(),e}const showPanel=Facet.define({enables:panelPlugin});class GutterMarker extends RangeValue{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=void 0;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=!0;const gutterLineClass=Facet.define(),defaults$1={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>RangeSet.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},activeGutters=Facet.define();function gutter(o){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults$1),o))]}const unfixGutters=Facet.define({combine:o=>o.some(e=>e)});function gutters(o){let e=[gutterView];return o&&o.fixed===!1&&e.push(unfixGutters.of(!0)),e}const gutterView=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.prevViewport=o.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=o.state.facet(activeGutters).map(e=>new SingleGutterView(o,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!o.state.facet(unfixGutters),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),o.scrollDOM.insertBefore(this.dom,o.contentDOM)}update(o){if(this.updateGutters(o)){let e=this.prevViewport,r=o.view.viewport,s=Math.min(e.to,r.to)-Math.max(e.from,r.from);this.syncGutters(s<(r.to-r.from)*.8)}o.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=o.view.viewport}syncGutters(o){let e=this.dom.nextSibling;o&&this.dom.remove();let r=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from),s=[],l=this.gutters.map(a=>new UpdateContext(a,this.view.viewport,-this.view.documentPadding.top));for(let a of this.view.viewportLineBlocks)if(s.length&&(s=[]),Array.isArray(a.type)){let h=!0;for(let c of a.type)if(c.type==BlockType.Text&&h){advanceCursor(r,s,c.from);for(let u of l)u.line(this.view,c,s);h=!1}else if(c.widget)for(let u of l)u.widget(this.view,c)}else if(a.type==BlockType.Text){advanceCursor(r,s,a.from);for(let h of l)h.line(this.view,a,s)}for(let a of l)a.finish();o&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(o){let e=o.startState.facet(activeGutters),r=o.state.facet(activeGutters),s=o.docChanged||o.heightChanged||o.viewportChanged||!RangeSet.eq(o.startState.facet(gutterLineClass),o.state.facet(gutterLineClass),o.view.viewport.from,o.view.viewport.to);if(e==r)for(let l of this.gutters)l.update(o)&&(s=!0);else{s=!0;let l=[];for(let a of r){let h=e.indexOf(a);h<0?l.push(new SingleGutterView(this.view,a)):(this.gutters[h].update(o),l.push(this.gutters[h]))}for(let a of this.gutters)a.dom.remove(),l.indexOf(a)<0&&a.destroy();for(let a of l)this.dom.appendChild(a.dom);this.gutters=l}return s}destroy(){for(let o of this.gutters)o.destroy();this.dom.remove()}},{provide:o=>EditorView.scrollMargins.of(e=>{let r=e.plugin(o);return!r||r.gutters.length==0||!r.fixed?null:e.textDirection==Direction.LTR?{left:r.dom.offsetWidth}:{right:r.dom.offsetWidth}})});function asArray(o){return Array.isArray(o)?o:[o]}function advanceCursor(o,e,r){for(;o.value&&o.from<=r;)o.from==r&&e.push(o.value),o.next()}class UpdateContext{constructor(e,r,s){this.gutter=e,this.height=s,this.i=0,this.cursor=RangeSet.iter(e.markers,r.from)}addElement(e,r,s){let{gutter:l}=this,a=r.top-this.height;if(this.i==l.elements.length){let h=new GutterElement(e,r.height,a,s);l.elements.push(h),l.dom.appendChild(h.dom)}else l.elements[this.i].update(e,r.height,a,s);this.height=r.bottom,this.i++}line(e,r,s){let l=[];advanceCursor(this.cursor,l,r.from),s.length&&(l=l.concat(s));let a=this.gutter.config.lineMarker(e,r,l);a&&l.unshift(a);let h=this.gutter;l.length==0&&!h.config.renderEmptyElements||this.addElement(e,r,l)}widget(e,r){let s=this.gutter.config.widgetMarker(e,r.widget,r);s&&this.addElement(e,r,[s])}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let r=e.elements.pop();e.dom.removeChild(r.dom),r.destroy()}}}class SingleGutterView{constructor(e,r){this.view=e,this.config=r,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let s in r.domEventHandlers)this.dom.addEventListener(s,l=>{let a=l.target,h;if(a!=this.dom&&this.dom.contains(a)){for(;a.parentNode!=this.dom;)a=a.parentNode;let u=a.getBoundingClientRect();h=(u.top+u.bottom)/2}else h=l.clientY;let c=e.lineBlockAtHeight(h-e.documentTop);r.domEventHandlers[s](e,c,l)&&l.preventDefault()});this.markers=asArray(r.markers(e)),r.initialSpacer&&(this.spacer=new GutterElement(e,0,0,[r.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let r=this.markers;if(this.markers=asArray(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let l=this.config.updateSpacer(this.spacer.markers[0],e);l!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[l])}let s=e.view.viewport;return!RangeSet.eq(this.markers,r,s.from,s.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class GutterElement{constructor(e,r,s,l){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,r,s,l)}update(e,r,s,l){this.height!=r&&(this.dom.style.height=(this.height=r)+"px"),this.above!=s&&(this.dom.style.marginTop=(this.above=s)?s+"px":""),sameMarkers(this.markers,l)||this.setMarkers(e,l)}setMarkers(e,r){let s="cm-gutterElement",l=this.dom.firstChild;for(let a=0,h=0;;){let c=h,u=a<r.length?r[a++]:null,f=!1;if(u){let d=u.elementClass;d&&(s+=" "+d);for(let p=h;p<this.markers.length;p++)if(this.markers[p].compare(u)){c=p,f=!0;break}}else c=this.markers.length;for(;h<c;){let d=this.markers[h++];if(d.toDOM){d.destroy(l);let p=l.nextSibling;l.remove(),l=p}}if(!u)break;u.toDOM&&(f?l=l.nextSibling:this.dom.insertBefore(u.toDOM(e),l)),f&&h++}this.dom.className=s,this.markers=r}destroy(){this.setMarkers(null,[])}}function sameMarkers(o,e){if(o.length!=e.length)return!1;for(let r=0;r<o.length;r++)if(!o[r].compare(e[r]))return!1;return!0}const lineNumberMarkers=Facet.define(),lineNumberConfig=Facet.define({combine(o){return combineConfig(o,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,r){let s=Object.assign({},e);for(let l in r){let a=s[l],h=r[l];s[l]=a?(c,u,f)=>a(c,u,f)||h(c,u,f):h}return s}})}});class NumberMarker extends GutterMarker{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function formatNumber(o,e){return o.state.facet(lineNumberConfig).formatNumber(e,o.state)}const lineNumberGutter=activeGutters.compute([lineNumberConfig],o=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(lineNumberMarkers)},lineMarker(e,r,s){return s.some(l=>l.toDOM)?null:new NumberMarker(formatNumber(e,e.state.doc.lineAt(r.from).number))},widgetMarker:()=>null,lineMarkerChange:e=>e.startState.facet(lineNumberConfig)!=e.state.facet(lineNumberConfig),initialSpacer(e){return new NumberMarker(formatNumber(e,maxLineNumber(e.state.doc.lines)))},updateSpacer(e,r){let s=formatNumber(r.view,maxLineNumber(r.view.state.doc.lines));return s==e.number?e:new NumberMarker(s)},domEventHandlers:o.facet(lineNumberConfig).domEventHandlers}));function lineNumbers(o={}){return[lineNumberConfig.of(o),gutters(),lineNumberGutter]}function maxLineNumber(o){let e=9;for(;e<o;)e=e*10+9;return e}const activeLineGutterMarker=new class extends GutterMarker{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},activeLineGutterHighlighter=gutterLineClass.compute(["selection"],o=>{let e=[],r=-1;for(let s of o.selection.ranges){let l=o.doc.lineAt(s.head).from;l>r&&(r=l,e.push(activeLineGutterMarker.range(l)))}return RangeSet.of(e)});function highlightActiveLineGutter(){return activeLineGutterHighlighter}const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(e,r){this.from=e,this.to=r}}class NodeProp{constructor(e={}){this.id=nextPropID++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=NodeType.match(e)),r=>{let s=e(r);return s===void 0?null:[this,s]}}}NodeProp.closedBy=new NodeProp({deserialize:o=>o.split(" ")});NodeProp.openedBy=new NodeProp({deserialize:o=>o.split(" ")});NodeProp.group=new NodeProp({deserialize:o=>o.split(" ")});NodeProp.contextHash=new NodeProp({perNode:!0});NodeProp.lookAhead=new NodeProp({perNode:!0});NodeProp.mounted=new NodeProp({perNode:!0});const noProps=Object.create(null);class NodeType{constructor(e,r,s,l=0){this.name=e,this.props=r,this.id=s,this.flags=l}static define(e){let r=e.props&&e.props.length?Object.create(null):noProps,s=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),l=new NodeType(e.name||"",r,e.id,s);if(e.props){for(let a of e.props)if(Array.isArray(a)||(a=a(l)),a){if(a[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");r[a[0].id]=a[1]}}return l}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let r=this.prop(NodeProp.group);return r?r.indexOf(e)>-1:!1}return this.id==e}static match(e){let r=Object.create(null);for(let s in e)for(let l of s.split(" "))r[l]=e[s];return s=>{for(let l=s.prop(NodeProp.group),a=-1;a<(l?l.length:0);a++){let h=r[a<0?s.name:l[a]];if(h)return h}}}}NodeType.none=new NodeType("",Object.create(null),0,8);class NodeSet{constructor(e){this.types=e;for(let r=0;r<e.length;r++)if(e[r].id!=r)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let r=[];for(let s of this.types){let l=null;for(let a of e){let h=a(s);h&&(l||(l=Object.assign({},s.props)),l[h[0].id]=h[1])}r.push(l?new NodeType(s.name,l,s.id,s.flags):s)}return new NodeSet(r)}}const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode;(function(o){o[o.ExcludeBuffers=1]="ExcludeBuffers",o[o.IncludeAnonymous=2]="IncludeAnonymous",o[o.IgnoreMounts=4]="IgnoreMounts",o[o.IgnoreOverlays=8]="IgnoreOverlays"})(IterMode||(IterMode={}));class Tree{constructor(e,r,s,l,a){if(this.type=e,this.children=r,this.positions=s,this.length=l,this.props=null,a&&a.length){this.props=Object.create(null);for(let[h,c]of a)this.props[typeof h=="number"?h:h.id]=c}}toString(){let e=this.prop(NodeProp.mounted);if(e&&!e.overlay)return e.tree.toString();let r="";for(let s of this.children){let l=s.toString();l&&(r&&(r+=","),r+=l)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(r.length?"("+r+")":""):r}cursor(e=0){return new TreeCursor(this.topNode,e)}cursorAt(e,r=0,s=0){let l=CachedNode.get(this)||this.topNode,a=new TreeCursor(l);return a.moveTo(e,r),CachedNode.set(this,a._tree),a}get topNode(){return new TreeNode(this,0,0,null)}resolve(e,r=0){let s=resolveNode(CachedNode.get(this)||this.topNode,e,r,!1);return CachedNode.set(this,s),s}resolveInner(e,r=0){let s=resolveNode(CachedInnerNode.get(this)||this.topNode,e,r,!0);return CachedInnerNode.set(this,s),s}iterate(e){let{enter:r,leave:s,from:l=0,to:a=this.length}=e,h=e.mode||0,c=(h&IterMode.IncludeAnonymous)>0;for(let u=this.cursor(h|IterMode.IncludeAnonymous);;){let f=!1;if(u.from<=a&&u.to>=l&&(!c&&u.type.isAnonymous||r(u)!==!1)){if(u.firstChild())continue;f=!0}for(;f&&s&&(c||!u.type.isAnonymous)&&s(u),!u.nextSibling();){if(!u.parent())return;f=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let r in this.props)e.push([+r,this.props[r]]);return e}balance(e={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(r,s,l)=>new Tree(this.type,r,s,l,this.propValues),e.makeTree||((r,s,l)=>new Tree(NodeType.none,r,s,l)))}static build(e){return buildTree(e)}}Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(e,r){this.buffer=e,this.index=r}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(e,r,s){this.buffer=e,this.length=r,this.set=s}get type(){return NodeType.none}toString(){let e=[];for(let r=0;r<this.buffer.length;)e.push(this.childString(r)),r=this.buffer[r+3];return e.join(",")}childString(e){let r=this.buffer[e],s=this.buffer[e+3],l=this.set.types[r],a=l.name;if(/\W/.test(a)&&!l.isError&&(a=JSON.stringify(a)),e+=4,s==e)return a;let h=[];for(;e<s;)h.push(this.childString(e)),e=this.buffer[e+3];return a+"("+h.join(",")+")"}findChild(e,r,s,l,a){let{buffer:h}=this,c=-1;for(let u=e;u!=r&&!(checkSide(a,l,h[u+1],h[u+2])&&(c=u,s>0));u=h[u+3]);return c}slice(e,r,s){let l=this.buffer,a=new Uint16Array(r-e),h=0;for(let c=e,u=0;c<r;){a[u++]=l[c++],a[u++]=l[c++]-s;let f=a[u++]=l[c++]-s;a[u++]=l[c++]-e,h=Math.max(h,f)}return new TreeBuffer(a,h,this.set)}}function checkSide(o,e,r,s){switch(o){case-2:return r<e;case-1:return s>=e&&r<e;case 0:return r<e&&s>e;case 1:return r<=e&&s>e;case 2:return s>e;case 4:return!0}}function enterUnfinishedNodesBefore(o,e){let r=o.childBefore(e);for(;r;){let s=r.lastChild;if(!s||s.to!=r.to)break;s.type.isError&&s.from==s.to?(o=r,r=s.prevSibling):r=s}return o}function resolveNode(o,e,r,s){for(var l;o.from==o.to||(r<1?o.from>=e:o.from>e)||(r>-1?o.to<=e:o.to<e);){let h=!s&&o instanceof TreeNode&&o.index<0?null:o.parent;if(!h)return o;o=h}let a=s?0:IterMode.IgnoreOverlays;if(s)for(let h=o,c=h.parent;c;h=c,c=h.parent)h instanceof TreeNode&&h.index<0&&((l=c.enter(e,r,a))===null||l===void 0?void 0:l.from)!=h.from&&(o=c);for(;;){let h=o.enter(e,r,a);if(!h)return o;o=h}}class TreeNode{constructor(e,r,s,l){this._tree=e,this.from=r,this.index=s,this._parent=l}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,r,s,l,a=0){for(let h=this;;){for(let{children:c,positions:u}=h._tree,f=r>0?c.length:-1;e!=f;e+=r){let d=c[e],p=u[e]+h.from;if(checkSide(l,s,p,p+d.length)){if(d instanceof TreeBuffer){if(a&IterMode.ExcludeBuffers)continue;let g=d.findChild(0,d.buffer.length,r,s-p,l);if(g>-1)return new BufferNode(new BufferContext(h,d,e,p),null,g)}else if(a&IterMode.IncludeAnonymous||!d.type.isAnonymous||hasChild(d)){let g;if(!(a&IterMode.IgnoreMounts)&&d.props&&(g=d.prop(NodeProp.mounted))&&!g.overlay)return new TreeNode(g.tree,p,e,h);let m=new TreeNode(d,p,e,h);return a&IterMode.IncludeAnonymous||!m.type.isAnonymous?m:m.nextChild(r<0?d.children.length-1:0,r,s,l)}}}if(a&IterMode.IncludeAnonymous||!h.type.isAnonymous||(h.index>=0?e=h.index+r:e=r<0?-1:h._parent._tree.children.length,h=h._parent,!h))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,r,s=0){let l;if(!(s&IterMode.IgnoreOverlays)&&(l=this._tree.prop(NodeProp.mounted))&&l.overlay){let a=e-this.from;for(let{from:h,to:c}of l.overlay)if((r>0?h<=a:h<a)&&(r<0?c>=a:c>a))return new TreeNode(l.tree,l.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,r,s)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new TreeCursor(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,r=0){return resolveNode(this,e,r,!1)}resolveInner(e,r=0){return resolveNode(this,e,r,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}getChild(e,r=null,s=null){let l=getChildren(this,e,r,s);return l.length?l[0]:null}getChildren(e,r=null,s=null){return getChildren(this,e,r,s)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return matchNodeContext(this,e)}}function getChildren(o,e,r,s){let l=o.cursor(),a=[];if(!l.firstChild())return a;if(r!=null){for(;!l.type.is(r);)if(!l.nextSibling())return a}for(;;){if(s!=null&&l.type.is(s))return a;if(l.type.is(e)&&a.push(l.node),!l.nextSibling())return s==null?a:[]}}function matchNodeContext(o,e,r=e.length-1){for(let s=o.parent;r>=0;s=s.parent){if(!s)return!1;if(!s.type.isAnonymous){if(e[r]&&e[r]!=s.name)return!1;r--}}return!0}class BufferContext{constructor(e,r,s,l){this.parent=e,this.buffer=r,this.index=s,this.start=l}}class BufferNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,r,s){this.context=e,this._parent=r,this.index=s,this.type=e.buffer.set.types[e.buffer.buffer[s]]}child(e,r,s){let{buffer:l}=this.context,a=l.findChild(this.index+4,l.buffer[this.index+3],e,r-this.context.start,s);return a<0?null:new BufferNode(this.context,this,a)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,r,s=0){if(s&IterMode.ExcludeBuffers)return null;let{buffer:l}=this.context,a=l.findChild(this.index+4,l.buffer[this.index+3],r>0?1:-1,e-this.context.start,r);return a<0?null:new BufferNode(this.context,this,a)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,r=e.buffer[this.index+3];return r<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,r):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,r=this._parent?this._parent.index+4:0;return this.index==r?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(r,this.index,-1,0,4))}cursor(e=0){return new TreeCursor(this,e)}get tree(){return null}toTree(){let e=[],r=[],{buffer:s}=this.context,l=this.index+4,a=s.buffer[this.index+3];if(a>l){let h=s.buffer[this.index+1];e.push(s.slice(l,a,h)),r.push(0)}return new Tree(this.type,e,r,this.to-this.from)}resolve(e,r=0){return resolveNode(this,e,r,!1)}resolveInner(e,r=0){return resolveNode(this,e,r,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,r=null,s=null){let l=getChildren(this,e,r,s);return l.length?l[0]:null}getChildren(e,r=null,s=null){return getChildren(this,e,r,s)}get node(){return this}matchContext(e){return matchNodeContext(this,e)}}class TreeCursor{get name(){return this.type.name}constructor(e,r=0){if(this.mode=r,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let s=e._parent;s;s=s._parent)this.stack.unshift(s.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,r){this.index=e;let{start:s,buffer:l}=this.buffer;return this.type=r||l.set.types[l.buffer[e]],this.from=s+l.buffer[e+1],this.to=s+l.buffer[e+2],!0}yield(e){return e?e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,r,s){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,r,s,this.mode));let{buffer:l}=this.buffer,a=l.findChild(this.index+4,l.buffer[this.index+3],e,r-this.buffer.start,s);return a<0?!1:(this.stack.push(this.index),this.yieldBuf(a))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,r,s=this.mode){return this.buffer?s&IterMode.ExcludeBuffers?!1:this.enterChild(1,e,r):this.yield(this._tree.enter(e,r,s))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:r}=this.buffer,s=this.stack.length-1;if(e<0){let l=s<0?0:this.stack[s]+4;if(this.index!=l)return this.yieldBuf(r.findChild(l,this.index,-1,0,4))}else{let l=r.buffer[this.index+3];if(l<(s<0?r.buffer.length:r.buffer[this.stack[s]+3]))return this.yieldBuf(l)}return s<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let r,s,{buffer:l}=this;if(l){if(e>0){if(this.index<l.buffer.buffer.length)return!1}else for(let a=0;a<this.index;a++)if(l.buffer.buffer[a+3]<this.index)return!1;({index:r,parent:s}=l)}else({index:r,_parent:s}=this._tree);for(;s;{index:r,_parent:s}=s)if(r>-1)for(let a=r+e,h=e<0?-1:s._tree.children.length;a!=h;a+=e){let c=s._tree.children[a];if(this.mode&IterMode.IncludeAnonymous||c instanceof TreeBuffer||!c.type.isAnonymous||hasChild(c))return!1}return!0}move(e,r){if(r&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,r=0){for(;(this.from==this.to||(r<1?this.from>=e:this.from>e)||(r>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,r););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,r=null,s=0;if(e&&e.context==this.buffer)e:for(let l=this.index,a=this.stack.length;a>=0;){for(let h=e;h;h=h._parent)if(h.index==l){if(l==this.index)return h;r=h,s=a+1;break e}l=this.stack[--a]}for(let l=s;l<this.stack.length;l++)r=new BufferNode(this.buffer,r,this.stack[l]);return this.bufferNode=new BufferNode(this.buffer,r,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,r){for(let s=0;;){let l=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){s++;continue}this.type.isAnonymous||(l=!0)}for(;l&&r&&r(this),l=this.type.isAnonymous,!this.nextSibling();){if(!s)return;this.parent(),s--,l=!0}}}matchContext(e){if(!this.buffer)return matchNodeContext(this.node,e);let{buffer:r}=this.buffer,{types:s}=r.set;for(let l=e.length-1,a=this.stack.length-1;l>=0;a--){if(a<0)return matchNodeContext(this.node,e,l);let h=s[r.buffer[this.stack[a]]];if(!h.isAnonymous){if(e[l]&&e[l]!=h.name)return!1;l--}}return!0}}function hasChild(o){return o.children.some(e=>e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))}function buildTree(o){var e;let{buffer:r,nodeSet:s,maxBufferLength:l=DefaultBufferLength,reused:a=[],minRepeatType:h=s.types.length}=o,c=Array.isArray(r)?new FlatBufferCursor(r,r.length):r,u=s.types,f=0,d=0;function p(b,k,x,T,A){let{id:M,start:E,end:D,size:R}=c,_=d;for(;R<0;)if(c.next(),R==-1){let V=a[M];x.push(V),T.push(E-b);return}else if(R==-3){f=M;return}else if(R==-4){d=M;return}else throw new RangeError(`Unrecognized record size: ${R}`);let N=u[M],L,I,Q=E-b;if(D-E<=l&&(I=S(c.pos-k,A))){let V=new Uint16Array(I.size-I.skip),$=c.pos-I.size,B=V.length;for(;c.pos>$;)B=y(I.start,V,B);L=new TreeBuffer(V,D-I.start,s),Q=I.start-b}else{let V=c.pos-R;c.next();let $=[],B=[],F=M>=h?M:-1,z=0,H=D;for(;c.pos>V;)F>=0&&c.id==F&&c.size>=0?(c.end<=H-l&&(m($,B,E,z,c.end,H,F,_),z=$.length,H=c.end),c.next()):p(E,V,$,B,F);if(F>=0&&z>0&&z<$.length&&m($,B,E,z,E,H,F,_),$.reverse(),B.reverse(),F>-1&&z>0){let q=g(N);L=balanceRange(N,$,B,0,$.length,0,D-E,q,q)}else L=w(N,$,B,D-E,_-D)}x.push(L),T.push(Q)}function g(b){return(k,x,T)=>{let A=0,M=k.length-1,E,D;if(M>=0&&(E=k[M])instanceof Tree){if(!M&&E.type==b&&E.length==T)return E;(D=E.prop(NodeProp.lookAhead))&&(A=x[M]+E.length+D)}return w(b,k,x,T,A)}}function m(b,k,x,T,A,M,E,D){let R=[],_=[];for(;b.length>T;)R.push(b.pop()),_.push(k.pop()+x-A);b.push(w(s.types[E],R,_,M-A,D-M)),k.push(A-x)}function w(b,k,x,T,A=0,M){if(f){let E=[NodeProp.contextHash,f];M=M?[E].concat(M):[E]}if(A>25){let E=[NodeProp.lookAhead,A];M=M?[E].concat(M):[E]}return new Tree(b,k,x,T,M)}function S(b,k){let x=c.fork(),T=0,A=0,M=0,E=x.end-l,D={size:0,start:0,skip:0};e:for(let R=x.pos-b;x.pos>R;){let _=x.size;if(x.id==k&&_>=0){D.size=T,D.start=A,D.skip=M,M+=4,T+=4,x.next();continue}let N=x.pos-_;if(_<0||N<R||x.start<E)break;let L=x.id>=h?4:0,I=x.start;for(x.next();x.pos>N;){if(x.size<0)if(x.size==-3)L+=4;else break e;else x.id>=h&&(L+=4);x.next()}A=I,T+=_,M+=L}return(k<0||T==b)&&(D.size=T,D.start=A,D.skip=M),D.size>4?D:void 0}function y(b,k,x){let{id:T,start:A,end:M,size:E}=c;if(c.next(),E>=0&&T<h){let D=x;if(E>4){let R=c.pos-(E-4);for(;c.pos>R;)x=y(b,k,x)}k[--x]=D,k[--x]=M-b,k[--x]=A-b,k[--x]=T}else E==-3?f=T:E==-4&&(d=T);return x}let v=[],O=[];for(;c.pos>0;)p(o.start||0,o.bufferStart||0,v,O,-1);let P=(e=o.length)!==null&&e!==void 0?e:v.length?O[0]+v[0].length:0;return new Tree(u[o.topID],v.reverse(),O.reverse(),P)}const nodeSizeCache=new WeakMap;function nodeSize(o,e){if(!o.isAnonymous||e instanceof TreeBuffer||e.type!=o)return 1;let r=nodeSizeCache.get(e);if(r==null){r=1;for(let s of e.children){if(s.type!=o||!(s instanceof Tree)){r=1;break}r+=nodeSize(o,s)}nodeSizeCache.set(e,r)}return r}function balanceRange(o,e,r,s,l,a,h,c,u){let f=0;for(let w=s;w<l;w++)f+=nodeSize(o,e[w]);let d=Math.ceil(f*1.5/8),p=[],g=[];function m(w,S,y,v,O){for(let P=y;P<v;){let b=P,k=S[P],x=nodeSize(o,w[P]);for(P++;P<v;P++){let T=nodeSize(o,w[P]);if(x+T>=d)break;x+=T}if(P==b+1){if(x>d){let T=w[b];m(T.children,T.positions,0,T.children.length,S[b]+O);continue}p.push(w[b])}else{let T=S[P-1]+w[P-1].length-k;p.push(balanceRange(o,w,S,b,P,k,T,null,u))}g.push(k+O-a)}}return m(e,r,s,l,0),(c||u)(p,g,h)}class TreeFragment{constructor(e,r,s,l,a=!1,h=!1){this.from=e,this.to=r,this.tree=s,this.offset=l,this.open=(a?1:0)|(h?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,r=[],s=!1){let l=[new TreeFragment(0,e.length,e,0,!1,s)];for(let a of r)a.to>e.length&&l.push(a);return l}static applyChanges(e,r,s=128){if(!r.length)return e;let l=[],a=1,h=e.length?e[0]:null;for(let c=0,u=0,f=0;;c++){let d=c<r.length?r[c]:null,p=d?d.fromA:1e9;if(p-u>=s)for(;h&&h.from<p;){let g=h;if(u>=g.from||p<=g.to||f){let m=Math.max(g.from,u)-f,w=Math.min(g.to,p)-f;g=m>=w?null:new TreeFragment(m,w,g.tree,g.offset+f,c>0,!!d)}if(g&&l.push(g),h.to>p)break;h=a<e.length?e[a++]:null}if(!d)break;u=d.toA,f=d.toA-d.toB}return l}}class Parser{startParse(e,r,s){return typeof e=="string"&&(e=new StringInput(e)),s=s?s.length?s.map(l=>new Range(l.from,l.to)):[new Range(0,0)]:[new Range(0,e.length)],this.createParse(e,r||[],s)}parse(e,r,s){let l=this.startParse(e,r,s);for(;;){let a=l.advance();if(a)return a}}}class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,r){return this.string.slice(e,r)}}new NodeProp({perNode:!0});let nextTagID=0;class Tag{constructor(e,r,s){this.set=e,this.base=r,this.modified=s,this.id=nextTagID++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let r=new Tag([],null,[]);if(r.set.push(r),e)for(let s of e.set)r.set.push(s);return r}static defineModifier(){let e=new Modifier;return r=>r.modified.indexOf(e)>-1?r:Modifier.get(r.base||r,r.modified.concat(e).sort((s,l)=>s.id-l.id))}}let nextModifierID=0;class Modifier{constructor(){this.instances=[],this.id=nextModifierID++}static get(e,r){if(!r.length)return e;let s=r[0].instances.find(c=>c.base==e&&sameArray(r,c.modified));if(s)return s;let l=[],a=new Tag(l,e,r);for(let c of r)c.instances.push(a);let h=powerSet(r);for(let c of e.set)if(!c.modified.length)for(let u of h)l.push(Modifier.get(c,u));return a}}function sameArray(o,e){return o.length==e.length&&o.every((r,s)=>r==e[s])}function powerSet(o){let e=[[]];for(let r=0;r<o.length;r++)for(let s=0,l=e.length;s<l;s++)e.push(e[s].concat(o[r]));return e.sort((r,s)=>s.length-r.length)}function styleTags(o){let e=Object.create(null);for(let r in o){let s=o[r];Array.isArray(s)||(s=[s]);for(let l of r.split(" "))if(l){let a=[],h=2,c=l;for(let p=0;;){if(c=="..."&&p>0&&p+3==l.length){h=1;break}let g=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(c);if(!g)throw new RangeError("Invalid path: "+l);if(a.push(g[0]=="*"?"":g[0][0]=='"'?JSON.parse(g[0]):g[0]),p+=g[0].length,p==l.length)break;let m=l[p++];if(p==l.length&&m=="!"){h=0;break}if(m!="/")throw new RangeError("Invalid path: "+l);c=l.slice(p)}let u=a.length-1,f=a[u];if(!f)throw new RangeError("Invalid path: "+l);let d=new Rule(s,h,u>0?a.slice(0,u):null);e[f]=d.sort(e[f])}}return ruleNodeProp.add(e)}const ruleNodeProp=new NodeProp;class Rule{constructor(e,r,s,l){this.tags=e,this.mode=r,this.context=s,this.next=l}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Rule.empty=new Rule([],2,null);function tagHighlighter(o,e){let r=Object.create(null);for(let a of o)if(!Array.isArray(a.tag))r[a.tag.id]=a.class;else for(let h of a.tag)r[h.id]=a.class;let{scope:s,all:l=null}=e||{};return{style:a=>{let h=l;for(let c of a)for(let u of c.set){let f=r[u.id];if(f){h=h?h+" "+f:f;break}}return h},scope:s}}function highlightTags(o,e){let r=null;for(let s of o){let l=s.style(e);l&&(r=r?r+" "+l:l)}return r}function highlightTree(o,e,r,s=0,l=o.length){let a=new HighlightBuilder(s,Array.isArray(e)?e:[e],r);a.highlightRange(o.cursor(),s,l,"",a.highlighters),a.flush(l)}class HighlightBuilder{constructor(e,r,s){this.at=e,this.highlighters=r,this.span=s,this.class=""}startSpan(e,r){r!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=r)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,r,s,l,a){let{type:h,from:c,to:u}=e;if(c>=s||u<=r)return;h.isTop&&(a=this.highlighters.filter(m=>!m.scope||m.scope(h)));let f=l,d=getStyleTags(e)||Rule.empty,p=highlightTags(a,d.tags);if(p&&(f&&(f+=" "),f+=p,d.mode==1&&(l+=(l?" ":"")+p)),this.startSpan(Math.max(r,c),f),d.opaque)return;let g=e.tree&&e.tree.prop(NodeProp.mounted);if(g&&g.overlay){let m=e.node.enter(g.overlay[0].from+c,1),w=this.highlighters.filter(y=>!y.scope||y.scope(g.tree.type)),S=e.firstChild();for(let y=0,v=c;;y++){let O=y<g.overlay.length?g.overlay[y]:null,P=O?O.from+c:u,b=Math.max(r,v),k=Math.min(s,P);if(b<k&&S)for(;e.from<k&&(this.highlightRange(e,b,k,l,a),this.startSpan(Math.min(k,e.to),f),!(e.to>=P||!e.nextSibling())););if(!O||P>s)break;v=O.to+c,v>r&&(this.highlightRange(m.cursor(),Math.max(r,O.from+c),Math.min(s,v),"",w),this.startSpan(Math.min(s,v),f))}S&&e.parent()}else if(e.firstChild()){g&&(l="");do if(!(e.to<=r)){if(e.from>=s)break;this.highlightRange(e,r,s,l,a),this.startSpan(Math.min(s,e.to),f)}while(e.nextSibling());e.parent()}}}function getStyleTags(o){let e=o.type.prop(ruleNodeProp);for(;e&&e.context&&!o.matchContext(e.context);)e=e.next;return e||null}const t=Tag.define,comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta$1=t(),tags={comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name,variableName:t(name),typeName,tagName:t(typeName),propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal,string,docString:t(string),character:t(string),attributeValue:t(string),number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation,separator:t(punctuation),bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content,heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta:meta$1,documentMeta:t(meta$1),annotation:t(meta$1),processingInstruction:t(meta$1),definition:Tag.defineModifier(),constant:Tag.defineModifier(),function:Tag.defineModifier(),standard:Tag.defineModifier(),local:Tag.defineModifier(),special:Tag.defineModifier()};tagHighlighter([{tag:tags.link,class:"tok-link"},{tag:tags.heading,class:"tok-heading"},{tag:tags.emphasis,class:"tok-emphasis"},{tag:tags.strong,class:"tok-strong"},{tag:tags.keyword,class:"tok-keyword"},{tag:tags.atom,class:"tok-atom"},{tag:tags.bool,class:"tok-bool"},{tag:tags.url,class:"tok-url"},{tag:tags.labelName,class:"tok-labelName"},{tag:tags.inserted,class:"tok-inserted"},{tag:tags.deleted,class:"tok-deleted"},{tag:tags.literal,class:"tok-literal"},{tag:tags.string,class:"tok-string"},{tag:tags.number,class:"tok-number"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],class:"tok-string2"},{tag:tags.variableName,class:"tok-variableName"},{tag:tags.local(tags.variableName),class:"tok-variableName tok-local"},{tag:tags.definition(tags.variableName),class:"tok-variableName tok-definition"},{tag:tags.special(tags.variableName),class:"tok-variableName2"},{tag:tags.definition(tags.propertyName),class:"tok-propertyName tok-definition"},{tag:tags.typeName,class:"tok-typeName"},{tag:tags.namespace,class:"tok-namespace"},{tag:tags.className,class:"tok-className"},{tag:tags.macroName,class:"tok-macroName"},{tag:tags.propertyName,class:"tok-propertyName"},{tag:tags.operator,class:"tok-operator"},{tag:tags.comment,class:"tok-comment"},{tag:tags.meta,class:"tok-meta"},{tag:tags.invalid,class:"tok-invalid"},{tag:tags.punctuation,class:"tok-punctuation"}]);var _a;const languageDataProp=new NodeProp;function defineLanguageFacet(o){return Facet.define({combine:o?e=>e.concat(o):void 0})}const sublanguageProp=new NodeProp;class Language{constructor(e,r,s=[],l=""){this.data=e,this.name=l,EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(EditorState.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=r,this.extension=[language.of(this),EditorState.languageData.of((a,h,c)=>{let u=topNodeAt(a,h,c),f=u.type.prop(languageDataProp);if(!f)return[];let d=a.facet(f),p=u.type.prop(sublanguageProp);if(p){let g=u.resolve(h-u.from,c);for(let m of p)if(m.test(g,a)){let w=a.facet(m.facet);return m.type=="replace"?w:w.concat(d)}}return d})].concat(s)}isActiveAt(e,r,s=-1){return topNodeAt(e,r,s).type.prop(languageDataProp)==this.data}findRegions(e){let r=e.facet(language);if((r==null?void 0:r.data)==this.data)return[{from:0,to:e.doc.length}];if(!r||!r.allowsNesting)return[];let s=[],l=(a,h)=>{if(a.prop(languageDataProp)==this.data){s.push({from:h,to:h+a.length});return}let c=a.prop(NodeProp.mounted);if(c){if(c.tree.prop(languageDataProp)==this.data){if(c.overlay)for(let u of c.overlay)s.push({from:u.from+h,to:u.to+h});else s.push({from:h,to:h+a.length});return}else if(c.overlay){let u=s.length;if(l(c.tree,c.overlay[0].from+h),s.length>u)return}}for(let u=0;u<a.children.length;u++){let f=a.children[u];f instanceof Tree&&l(f,a.positions[u]+h)}};return l(syntaxTree(e),0),s}get allowsNesting(){return!0}}Language.setState=StateEffect.define();function topNodeAt(o,e,r){let s=o.facet(language),l=syntaxTree(o).topNode;if(!s||s.allowsNesting)for(let a=l;a;a=a.enter(e,r,IterMode.ExcludeBuffers))a.type.isTop&&(l=a);return l}class LRLanguage extends Language{constructor(e,r,s){super(e,r,[],s),this.parser=r}static define(e){let r=defineLanguageFacet(e.languageData);return new LRLanguage(r,e.parser.configure({props:[languageDataProp.add(s=>s.isTop?r:void 0)]}),e.name)}configure(e,r){return new LRLanguage(this.data,this.parser.configure(e),r||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function syntaxTree(o){let e=o.field(Language.state,!1);return e?e.tree:Tree.empty}class DocInput{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,r){let s=this.cursorPos-this.string.length;return e<s||r>=this.cursorPos?this.doc.sliceString(e,r):this.string.slice(e-s,r-s)}}let currentContext=null;class ParseContext{constructor(e,r,s=[],l,a,h,c,u){this.parser=e,this.state=r,this.fragments=s,this.tree=l,this.treeLen=a,this.viewport=h,this.skipped=c,this.scheduleOn=u,this.parse=null,this.tempSkipped=[]}static create(e,r,s){return new ParseContext(e,r,[],Tree.empty,0,s,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(e,r){return r!=null&&r>=this.state.doc.length&&(r=void 0),this.tree!=Tree.empty&&this.isDone(r??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var s;if(typeof e=="number"){let l=Date.now()+e;e=()=>Date.now()>l}for(this.parse||(this.parse=this.startParse()),r!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>r)&&r<this.state.doc.length&&this.parse.stopAt(r);;){let l=this.parse.advance();if(l)if(this.fragments=this.withoutTempSkipped(TreeFragment.addTree(l,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(s=this.parse.stoppedAt)!==null&&s!==void 0?s:this.state.doc.length,this.tree=l,this.parse=null,this.treeLen<(r??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,r;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(r=this.parse.advance()););}),this.treeLen=e,this.tree=r,this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let r=currentContext;currentContext=this;try{return e()}finally{currentContext=r}}withoutTempSkipped(e){for(let r;r=this.tempSkipped.pop();)e=cutFragments(e,r.from,r.to);return e}changes(e,r){let{fragments:s,tree:l,treeLen:a,viewport:h,skipped:c}=this;if(this.takeTree(),!e.empty){let u=[];if(e.iterChangedRanges((f,d,p,g)=>u.push({fromA:f,toA:d,fromB:p,toB:g})),s=TreeFragment.applyChanges(s,u),l=Tree.empty,a=0,h={from:e.mapPos(h.from,-1),to:e.mapPos(h.to,1)},this.skipped.length){c=[];for(let f of this.skipped){let d=e.mapPos(f.from,1),p=e.mapPos(f.to,-1);d<p&&c.push({from:d,to:p})}}}return new ParseContext(this.parser,r,s,l,a,h,c,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let r=this.skipped.length;for(let s=0;s<this.skipped.length;s++){let{from:l,to:a}=this.skipped[s];l<e.to&&a>e.from&&(this.fragments=cutFragments(this.fragments,l,a),this.skipped.splice(s--,1))}return this.skipped.length>=r?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,r){this.skipped.push({from:e,to:r})}static getSkippingParser(e){return new class extends Parser{createParse(r,s,l){let a=l[0].from,h=l[l.length-1].to;return{parsedPos:a,advance(){let u=currentContext;if(u){for(let f of l)u.tempSkipped.push(f);e&&(u.scheduleOn=u.scheduleOn?Promise.all([u.scheduleOn,e]):e)}return this.parsedPos=h,new Tree(NodeType.none,[],[],h-a)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let r=this.fragments;return this.treeLen>=e&&r.length&&r[0].from==0&&r[0].to>=e}static get(){return currentContext}}function cutFragments(o,e,r){return TreeFragment.applyChanges(o,[{fromA:e,toA:r,fromB:e,toB:r}])}class LanguageState{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let r=this.context.changes(e.changes,e.state),s=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),r.viewport.to);return r.work(20,s)||r.takeTree(),new LanguageState(r)}static init(e){let r=Math.min(3e3,e.doc.length),s=ParseContext.create(e.facet(language).parser,e,{from:0,to:r});return s.work(20,r)||s.takeTree(),new LanguageState(s)}}Language.state=StateField.define({create:LanguageState.init,update(o,e){for(let r of e.effects)if(r.is(Language.setState))return r.value;return e.startState.facet(language)!=e.state.facet(language)?LanguageState.init(e.state):o.apply(e)}});let requestIdle=o=>{let e=setTimeout(()=>o(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(requestIdle=o=>{let e=-1,r=setTimeout(()=>{e=requestIdleCallback(o,{timeout:500-100})},100);return()=>e<0?clearTimeout(r):cancelIdleCallback(e)});const isInputPending=typeof navigator<"u"&&(!((_a=navigator.scheduling)===null||_a===void 0)&&_a.isInputPending)?()=>navigator.scheduling.isInputPending():null,parseWorker=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let r=this.view.state.field(Language.state).context;(r.updateViewport(e.view.viewport)||this.view.viewport.to>r.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(r)}scheduleWork(){if(this.working)return;let{state:e}=this.view,r=e.field(Language.state);(r.tree!=r.context.tree||!r.context.isDone(e.doc.length))&&(this.working=requestIdle(this.work))}work(e){this.working=null;let r=Date.now();if(this.chunkEnd<r&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=r+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:s,viewport:{to:l}}=this.view,a=s.field(Language.state);if(a.tree==a.context.tree&&a.context.isDone(l+1e5))return;let h=Date.now()+Math.min(this.chunkBudget,100,e&&!isInputPending?Math.max(25,e.timeRemaining()-5):1e9),c=a.context.treeLen<l&&s.doc.length>l+1e3,u=a.context.work(()=>isInputPending&&isInputPending()||Date.now()>h,l+(c?0:1e5));this.chunkBudget-=Date.now()-r,(u||this.chunkBudget<=0)&&(a.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(a.context))})),this.chunkBudget>0&&!(u&&!c)&&this.scheduleWork(),this.checkAsyncSchedule(a.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(r=>logException(this.view.state,r)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=Facet.define({combine(o){return o.length?o[0]:null},enables:o=>[Language.state,parseWorker,EditorView.contentAttributes.compute([o],e=>{let r=e.facet(o);return r&&r.name?{"data-language":r.name}:{}})]});class LanguageSupport{constructor(e,r=[]){this.language=e,this.support=r,this.extension=[e,r]}}const indentService=Facet.define(),indentUnit=Facet.define({combine:o=>{if(!o.length)return"  ";let e=o[0];if(!e||/\S/.test(e)||Array.from(e).some(r=>r!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(o[0]));return e}});function getIndentUnit(o){let e=o.facet(indentUnit);return e.charCodeAt(0)==9?o.tabSize*e.length:e.length}function indentString(o,e){let r="",s=o.tabSize,l=o.facet(indentUnit)[0];if(l=="	"){for(;e>=s;)r+="	",e-=s;l=" "}for(let a=0;a<e;a++)r+=l;return r}function getIndentation(o,e){o instanceof EditorState&&(o=new IndentContext(o));for(let s of o.state.facet(indentService)){let l=s(o,e);if(l!==void 0)return l}let r=syntaxTree(o.state);return r?syntaxIndentation(o,r,e):null}class IndentContext{constructor(e,r={}){this.state=e,this.options=r,this.unit=getIndentUnit(e)}lineAt(e,r=1){let s=this.state.doc.lineAt(e),{simulateBreak:l,simulateDoubleBreak:a}=this.options;return l!=null&&l>=s.from&&l<=s.to?a&&l==e?{text:"",from:e}:(r<0?l<e:l<=e)?{text:s.text.slice(l-s.from),from:l}:{text:s.text.slice(0,l-s.from),from:s.from}:s}textAfterPos(e,r=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:s,from:l}=this.lineAt(e,r);return s.slice(e-l,Math.min(s.length,e+100-l))}column(e,r=1){let{text:s,from:l}=this.lineAt(e,r),a=this.countColumn(s,e-l),h=this.options.overrideIndentation?this.options.overrideIndentation(l):-1;return h>-1&&(a+=h-this.countColumn(s,s.search(/\S|$/))),a}countColumn(e,r=e.length){return countColumn(e,this.state.tabSize,r)}lineIndent(e,r=1){let{text:s,from:l}=this.lineAt(e,r),a=this.options.overrideIndentation;if(a){let h=a(l);if(h>-1)return h}return this.countColumn(s,s.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const indentNodeProp=new NodeProp;function syntaxIndentation(o,e,r){return indentFrom(e.resolveInner(r).enterUnfinishedNodesBefore(r),r,o)}function ignoreClosed(o){return o.pos==o.options.simulateBreak&&o.options.simulateDoubleBreak}function indentStrategy(o){let e=o.type.prop(indentNodeProp);if(e)return e;let r=o.firstChild,s;if(r&&(s=r.type.prop(NodeProp.closedBy))){let l=o.lastChild,a=l&&s.indexOf(l.name)>-1;return h=>delimitedStrategy(h,!0,1,void 0,a&&!ignoreClosed(h)?l.from:void 0)}return o.parent==null?topIndent:null}function indentFrom(o,e,r){for(;o;o=o.parent){let s=indentStrategy(o);if(s)return s(TreeIndentContext.create(r,e,o))}return null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(e,r,s){super(e.state,e.options),this.base=e,this.pos=r,this.node=s}static create(e,r,s){return new TreeIndentContext(e,r,s)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let r=this.state.doc.lineAt(e.from);for(;;){let s=e.resolve(r.from);for(;s.parent&&s.parent.from==s.from;)s=s.parent;if(isParent(s,e))break;r=this.state.doc.lineAt(s.from)}return this.lineIndent(r.from)}continue(){let e=this.node.parent;return e?indentFrom(e,this.pos,this.base):0}}function isParent(o,e){for(let r=e;r;r=r.parent)if(o==r)return!0;return!1}function bracketedAligned(o){let e=o.node,r=e.childAfter(e.from),s=e.lastChild;if(!r)return null;let l=o.options.simulateBreak,a=o.state.doc.lineAt(r.from),h=l==null||l<=a.from?a.to:Math.min(a.to,l);for(let c=r.to;;){let u=e.childAfter(c);if(!u||u==s)return null;if(!u.type.isSkipped)return u.from<h?r:null;c=u.to}}function delimitedStrategy(o,e,r,s,l){let a=o.textAfter,h=a.match(/^\s*/)[0].length,c=s&&a.slice(h,h+s.length)==s||l==o.pos+h,u=e?bracketedAligned(o):null;return u?c?o.column(u.from):o.column(u.to):o.baseIndent+(c?0:o.unit*r)}const DontIndentBeyond=200;function indentOnInput(){return EditorState.transactionFilter.of(o=>{if(!o.docChanged||!o.isUserEvent("input.type")&&!o.isUserEvent("input.complete"))return o;let e=o.startState.languageDataAt("indentOnInput",o.startState.selection.main.head);if(!e.length)return o;let r=o.newDoc,{head:s}=o.newSelection.main,l=r.lineAt(s);if(s>l.from+DontIndentBeyond)return o;let a=r.sliceString(l.from,s);if(!e.some(f=>f.test(a)))return o;let{state:h}=o,c=-1,u=[];for(let{head:f}of h.selection.ranges){let d=h.doc.lineAt(f);if(d.from==c)continue;c=d.from;let p=getIndentation(h,d.from);if(p==null)continue;let g=/^\s*/.exec(d.text)[0],m=indentString(h,p);g!=m&&u.push({from:d.from,to:d.from+g.length,insert:m})}return u.length?[o,{changes:u,sequential:!0}]:o})}const foldService=Facet.define(),foldNodeProp=new NodeProp;function foldInside(o){let e=o.firstChild,r=o.lastChild;return e&&e.to<r.from?{from:e.to,to:r.type.isError?o.to:r.from}:null}function syntaxFolding(o,e,r){let s=syntaxTree(o);if(s.length<r)return null;let l=s.resolveInner(r,1),a=null;for(let h=l;h;h=h.parent){if(h.to<=r||h.from>r)continue;if(a&&h.from<e)break;let c=h.type.prop(foldNodeProp);if(c&&(h.to<s.length-50||s.length==o.doc.length||!isUnfinished(h))){let u=c(h,o);u&&u.from<=r&&u.from>=e&&u.to>r&&(a=u)}}return a}function isUnfinished(o){let e=o.lastChild;return e&&e.to==o.to&&e.type.isError}function foldable(o,e,r){for(let s of o.facet(foldService)){let l=s(o,e,r);if(l)return l}return syntaxFolding(o,e,r)}function mapRange(o,e){let r=e.mapPos(o.from,1),s=e.mapPos(o.to,-1);return r>=s?void 0:{from:r,to:s}}const foldEffect=StateEffect.define({map:mapRange}),unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(o){let e=[];for(let{head:r}of o.state.selection.ranges)e.some(s=>s.from<=r&&s.to>=r)||e.push(o.lineBlockAt(r));return e}const foldState=StateField.define({create(){return Decoration.none},update(o,e){o=o.map(e.changes);for(let r of e.effects)r.is(foldEffect)&&!foldExists(o,r.value.from,r.value.to)?o=o.update({add:[foldWidget.range(r.value.from,r.value.to)]}):r.is(unfoldEffect)&&(o=o.update({filter:(s,l)=>r.value.from!=s||r.value.to!=l,filterFrom:r.value.from,filterTo:r.value.to}));if(e.selection){let r=!1,{head:s}=e.selection.main;o.between(s,s,(l,a)=>{l<s&&a>s&&(r=!0)}),r&&(o=o.update({filterFrom:s,filterTo:s,filter:(l,a)=>a<=s||l>=s}))}return o},provide:o=>EditorView.decorations.from(o),toJSON(o,e){let r=[];return o.between(0,e.doc.length,(s,l)=>{r.push(s,l)}),r},fromJSON(o){if(!Array.isArray(o)||o.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let r=0;r<o.length;){let s=o[r++],l=o[r++];if(typeof s!="number"||typeof l!="number")throw new RangeError("Invalid JSON for fold state");e.push(foldWidget.range(s,l))}return Decoration.set(e,!0)}});function findFold(o,e,r){var s;let l=null;return(s=o.field(foldState,!1))===null||s===void 0||s.between(e,r,(a,h)=>{(!l||l.from>a)&&(l={from:a,to:h})}),l}function foldExists(o,e,r){let s=!1;return o.between(e,e,(l,a)=>{l==e&&a==r&&(s=!0)}),s}function maybeEnable(o,e){return o.field(foldState,!1)?e:e.concat(StateEffect.appendConfig.of(codeFolding()))}const foldCode=o=>{for(let e of selectedLines(o)){let r=foldable(o.state,e.from,e.to);if(r)return o.dispatch({effects:maybeEnable(o.state,[foldEffect.of(r),announceFold(o,r)])}),!0}return!1},unfoldCode=o=>{if(!o.state.field(foldState,!1))return!1;let e=[];for(let r of selectedLines(o)){let s=findFold(o.state,r.from,r.to);s&&e.push(unfoldEffect.of(s),announceFold(o,s,!1))}return e.length&&o.dispatch({effects:e}),e.length>0};function announceFold(o,e,r=!0){let s=o.state.doc.lineAt(e.from).number,l=o.state.doc.lineAt(e.to).number;return EditorView.announce.of(`${o.state.phrase(r?"Folded lines":"Unfolded lines")} ${s} ${o.state.phrase("to")} ${l}.`)}const foldAll=o=>{let{state:e}=o,r=[];for(let s=0;s<e.doc.length;){let l=o.lineBlockAt(s),a=foldable(e,l.from,l.to);a&&r.push(foldEffect.of(a)),s=(a?o.lineBlockAt(a.to):l).to+1}return r.length&&o.dispatch({effects:maybeEnable(o.state,r)}),!!r.length},unfoldAll=o=>{let e=o.state.field(foldState,!1);if(!e||!e.size)return!1;let r=[];return e.between(0,o.state.doc.length,(s,l)=>{r.push(unfoldEffect.of({from:s,to:l}))}),o.dispatch({effects:r}),!0},foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}],defaultConfig={placeholderDOM:null,placeholderText:"…"},foldConfig=Facet.define({combine(o){return combineConfig(o,defaultConfig)}});function codeFolding(o){let e=[foldState,baseTheme$1$2];return o&&e.push(foldConfig.of(o)),e}const foldWidget=Decoration.replace({widget:new class extends WidgetType{toDOM(o){let{state:e}=o,r=e.facet(foldConfig),s=a=>{let h=o.lineBlockAt(o.posAtDOM(a.target)),c=findFold(o.state,h.from,h.to);c&&o.dispatch({effects:unfoldEffect.of(c)}),a.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(o,s);let l=document.createElement("span");return l.textContent=r.placeholderText,l.setAttribute("aria-label",e.phrase("folded code")),l.title=e.phrase("unfold"),l.className="cm-foldPlaceholder",l.onclick=s,l}}}),foldGutterDefaults={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class FoldMarker extends GutterMarker{constructor(e,r){super(),this.config=e,this.open=r}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let r=document.createElement("span");return r.textContent=this.open?this.config.openText:this.config.closedText,r.title=e.state.phrase(this.open?"Fold line":"Unfold line"),r}}function foldGutter(o={}){let e=Object.assign(Object.assign({},foldGutterDefaults),o),r=new FoldMarker(e,!0),s=new FoldMarker(e,!1),l=ViewPlugin.fromClass(class{constructor(h){this.from=h.viewport.from,this.markers=this.buildMarkers(h)}update(h){(h.docChanged||h.viewportChanged||h.startState.facet(language)!=h.state.facet(language)||h.startState.field(foldState,!1)!=h.state.field(foldState,!1)||syntaxTree(h.startState)!=syntaxTree(h.state)||e.foldingChanged(h))&&(this.markers=this.buildMarkers(h.view))}buildMarkers(h){let c=new RangeSetBuilder;for(let u of h.viewportLineBlocks){let f=findFold(h.state,u.from,u.to)?s:foldable(h.state,u.from,u.to)?r:null;f&&c.add(u.from,u.from,f)}return c.finish()}}),{domEventHandlers:a}=e;return[l,gutter({class:"cm-foldGutter",markers(h){var c;return((c=h.plugin(l))===null||c===void 0?void 0:c.markers)||RangeSet.empty},initialSpacer(){return new FoldMarker(e,!1)},domEventHandlers:Object.assign(Object.assign({},a),{click:(h,c,u)=>{if(a.click&&a.click(h,c,u))return!0;let f=findFold(h.state,c.from,c.to);if(f)return h.dispatch({effects:unfoldEffect.of(f)}),!0;let d=foldable(h.state,c.from,c.to);return d?(h.dispatch({effects:foldEffect.of(d)}),!0):!1}})}),codeFolding()]}const baseTheme$1$2=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class HighlightStyle{constructor(e,r){this.specs=e;let s;function l(c){let u=StyleModule.newName();return(s||(s=Object.create(null)))["."+u]=c,u}const a=typeof r.all=="string"?r.all:r.all?l(r.all):void 0,h=r.scope;this.scope=h instanceof Language?c=>c.prop(languageDataProp)==h.data:h?c=>c==h:void 0,this.style=tagHighlighter(e.map(c=>({tag:c.tag,class:c.class||l(Object.assign({},c,{tag:null}))})),{all:a}).style,this.module=s?new StyleModule(s):null,this.themeType=r.themeType}static define(e,r){return new HighlightStyle(e,r||{})}}const highlighterFacet=Facet.define(),fallbackHighlighter=Facet.define({combine(o){return o.length?[o[0]]:null}});function getHighlighters(o){let e=o.facet(highlighterFacet);return e.length?e:o.facet(fallbackHighlighter)}function syntaxHighlighting(o,e){let r=[treeHighlighter],s;return o instanceof HighlightStyle&&(o.module&&r.push(EditorView.styleModule.of(o.module)),s=o.themeType),e!=null&&e.fallback?r.push(fallbackHighlighter.of(o)):s?r.push(highlighterFacet.computeN([EditorView.darkTheme],l=>l.facet(EditorView.darkTheme)==(s=="dark")?[o]:[])):r.push(highlighterFacet.of(o)),r}class TreeHighlighter{constructor(e){this.markCache=Object.create(null),this.tree=syntaxTree(e.state),this.decorations=this.buildDeco(e,getHighlighters(e.state))}update(e){let r=syntaxTree(e.state),s=getHighlighters(e.state),l=s!=getHighlighters(e.startState);r.length<e.view.viewport.to&&!l&&r.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(r!=this.tree||e.viewportChanged||l)&&(this.tree=r,this.decorations=this.buildDeco(e.view,s))}buildDeco(e,r){if(!r||!this.tree.length)return Decoration.none;let s=new RangeSetBuilder;for(let{from:l,to:a}of e.visibleRanges)highlightTree(this.tree,r,(h,c,u)=>{s.add(h,c,this.markCache[u]||(this.markCache[u]=Decoration.mark({class:u})))},l,a);return s.finish()}}const treeHighlighter=Prec.high(ViewPlugin.fromClass(TreeHighlighter,{decorations:o=>o.decorations})),defaultHighlightStyle=HighlightStyle.define([{tag:tags.meta,color:"#404740"},{tag:tags.link,textDecoration:"underline"},{tag:tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strong,fontWeight:"bold"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.keyword,color:"#708"},{tag:[tags.atom,tags.bool,tags.url,tags.contentSeparator,tags.labelName],color:"#219"},{tag:[tags.literal,tags.inserted],color:"#164"},{tag:[tags.string,tags.deleted],color:"#a11"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],color:"#e40"},{tag:tags.definition(tags.variableName),color:"#00f"},{tag:tags.local(tags.variableName),color:"#30a"},{tag:[tags.typeName,tags.namespace],color:"#085"},{tag:tags.className,color:"#167"},{tag:[tags.special(tags.variableName),tags.macroName],color:"#256"},{tag:tags.definition(tags.propertyName),color:"#00c"},{tag:tags.comment,color:"#940"},{tag:tags.invalid,color:"#f00"}]),baseTheme$3=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),DefaultScanDist=1e4,DefaultBrackets="()[]{}",bracketMatchingConfig=Facet.define({combine(o){return combineConfig(o,{afterCursor:!0,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist,renderMatch:defaultRenderMatch})}}),matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});function defaultRenderMatch(o){let e=[],r=o.matched?matchingMark:nonmatchingMark;return e.push(r.range(o.start.from,o.start.to)),o.end&&e.push(r.range(o.end.from,o.end.to)),e}const bracketMatchingState=StateField.define({create(){return Decoration.none},update(o,e){if(!e.docChanged&&!e.selection)return o;let r=[],s=e.state.facet(bracketMatchingConfig);for(let l of e.state.selection.ranges){if(!l.empty)continue;let a=matchBrackets(e.state,l.head,-1,s)||l.head>0&&matchBrackets(e.state,l.head-1,1,s)||s.afterCursor&&(matchBrackets(e.state,l.head,1,s)||l.head<e.state.doc.length&&matchBrackets(e.state,l.head+1,-1,s));a&&(r=r.concat(s.renderMatch(a,e.state)))}return Decoration.set(r,!0)},provide:o=>EditorView.decorations.from(o)}),bracketMatchingUnique=[bracketMatchingState,baseTheme$3];function bracketMatching(o={}){return[bracketMatchingConfig.of(o),bracketMatchingUnique]}const bracketMatchingHandle=new NodeProp;function matchingNodes(o,e,r){let s=o.prop(e<0?NodeProp.openedBy:NodeProp.closedBy);if(s)return s;if(o.name.length==1){let l=r.indexOf(o.name);if(l>-1&&l%2==(e<0?1:0))return[r[l+e]]}return null}function findHandle(o){let e=o.type.prop(bracketMatchingHandle);return e?e(o.node):o}function matchBrackets(o,e,r,s={}){let l=s.maxScanDistance||DefaultScanDist,a=s.brackets||DefaultBrackets,h=syntaxTree(o),c=h.resolveInner(e,r);for(let u=c;u;u=u.parent){let f=matchingNodes(u.type,r,a);if(f&&u.from<u.to){let d=findHandle(u);if(d&&(r>0?e>=d.from&&e<d.to:e>d.from&&e<=d.to))return matchMarkedBrackets(o,e,r,u,d,f,a)}}return matchPlainBrackets(o,e,r,h,c.type,l,a)}function matchMarkedBrackets(o,e,r,s,l,a,h){let c=s.parent,u={from:l.from,to:l.to},f=0,d=c==null?void 0:c.cursor();if(d&&(r<0?d.childBefore(s.from):d.childAfter(s.to)))do if(r<0?d.to<=s.from:d.from>=s.to){if(f==0&&a.indexOf(d.type.name)>-1&&d.from<d.to){let p=findHandle(d);return{start:u,end:p?{from:p.from,to:p.to}:void 0,matched:!0}}else if(matchingNodes(d.type,r,h))f++;else if(matchingNodes(d.type,-r,h)){if(f==0){let p=findHandle(d);return{start:u,end:p&&p.from<p.to?{from:p.from,to:p.to}:void 0,matched:!1}}f--}}while(r<0?d.prevSibling():d.nextSibling());return{start:u,matched:!1}}function matchPlainBrackets(o,e,r,s,l,a,h){let c=r<0?o.sliceDoc(e-1,e):o.sliceDoc(e,e+1),u=h.indexOf(c);if(u<0||u%2==0!=r>0)return null;let f={from:r<0?e-1:e,to:r>0?e+1:e},d=o.doc.iterRange(e,r>0?o.doc.length:0),p=0;for(let g=0;!d.next().done&&g<=a;){let m=d.value;r<0&&(g+=m.length);let w=e+g*r;for(let S=r>0?0:m.length-1,y=r>0?m.length:-1;S!=y;S+=r){let v=h.indexOf(m[S]);if(!(v<0||s.resolveInner(w+S,1).type!=l))if(v%2==0==r>0)p++;else{if(p==1)return{start:f,end:{from:w+S,to:w+S+1},matched:v>>1==u>>1};p--}}r>0&&(g+=m.length)}return d.done?{start:f,matched:!1}:null}const noTokens=Object.create(null),typeArray=[NodeType.none],warned=[],defaultTable=Object.create(null);for(let[o,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[o]=createTokenType(noTokens,e);function warnForPart(o,e){warned.indexOf(o)>-1||(warned.push(o),console.warn(e))}function createTokenType(o,e){let r=null;for(let a of e.split(".")){let h=o[a]||tags[a];h?typeof h=="function"?r?r=h(r):warnForPart(a,`Modifier ${a} used at start of tag`):r?warnForPart(a,`Tag ${a} used as modifier`):r=h:warnForPart(a,`Unknown highlighting tag ${a}`)}if(!r)return 0;let s=e.replace(/ /g,"_"),l=NodeType.define({id:typeArray.length,name:s,props:[styleTags({[s]:r})]});return typeArray.push(l),l.id}const toggleComment=o=>{let{state:e}=o,r=e.doc.lineAt(e.selection.main.from),s=getConfig(o.state,r.from);return s.line?toggleLineComment(o):s.block?toggleBlockCommentByLine(o):!1};function command(o,e){return({state:r,dispatch:s})=>{if(r.readOnly)return!1;let l=o(e,r);return l?(s(r.update(l)),!0):!1}}const toggleLineComment=command(changeLineComment,0),toggleBlockComment=command(changeBlockComment,0),toggleBlockCommentByLine=command((o,e)=>changeBlockComment(o,e,selectedLineRanges(e)),0);function getConfig(o,e){let r=o.languageDataAt("commentTokens",e);return r.length?r[0]:{}}const SearchMargin=50;function findBlockComment(o,{open:e,close:r},s,l){let a=o.sliceDoc(s-SearchMargin,s),h=o.sliceDoc(l,l+SearchMargin),c=/\s*$/.exec(a)[0].length,u=/^\s*/.exec(h)[0].length,f=a.length-c;if(a.slice(f-e.length,f)==e&&h.slice(u,u+r.length)==r)return{open:{pos:s-c,margin:c&&1},close:{pos:l+u,margin:u&&1}};let d,p;l-s<=2*SearchMargin?d=p=o.sliceDoc(s,l):(d=o.sliceDoc(s,s+SearchMargin),p=o.sliceDoc(l-SearchMargin,l));let g=/^\s*/.exec(d)[0].length,m=/\s*$/.exec(p)[0].length,w=p.length-m-r.length;return d.slice(g,g+e.length)==e&&p.slice(w,w+r.length)==r?{open:{pos:s+g+e.length,margin:/\s/.test(d.charAt(g+e.length))?1:0},close:{pos:l-m-r.length,margin:/\s/.test(p.charAt(w-1))?1:0}}:null}function selectedLineRanges(o){let e=[];for(let r of o.selection.ranges){let s=o.doc.lineAt(r.from),l=r.to<=s.to?s:o.doc.lineAt(r.to),a=e.length-1;a>=0&&e[a].to>s.from?e[a].to=l.to:e.push({from:s.from+/^\s*/.exec(s.text)[0].length,to:l.to})}return e}function changeBlockComment(o,e,r=e.selection.ranges){let s=r.map(a=>getConfig(e,a.from).block);if(!s.every(a=>a))return null;let l=r.map((a,h)=>findBlockComment(e,s[h],a.from,a.to));if(o!=2&&!l.every(a=>a))return{changes:e.changes(r.map((a,h)=>l[h]?[]:[{from:a.from,insert:s[h].open+" "},{from:a.to,insert:" "+s[h].close}]))};if(o!=1&&l.some(a=>a)){let a=[];for(let h=0,c;h<l.length;h++)if(c=l[h]){let u=s[h],{open:f,close:d}=c;a.push({from:f.pos-u.open.length,to:f.pos+f.margin},{from:d.pos-d.margin,to:d.pos+u.close.length})}return{changes:a}}return null}function changeLineComment(o,e,r=e.selection.ranges){let s=[],l=-1;for(let{from:a,to:h}of r){let c=s.length,u=1e9,f=getConfig(e,a).line;if(f){for(let d=a;d<=h;){let p=e.doc.lineAt(d);if(p.from>l&&(a==h||h>p.from)){l=p.from;let g=/^\s*/.exec(p.text)[0].length,m=g==p.length,w=p.text.slice(g,g+f.length)==f?g:-1;g<p.text.length&&g<u&&(u=g),s.push({line:p,comment:w,token:f,indent:g,empty:m,single:!1})}d=p.to+1}if(u<1e9)for(let d=c;d<s.length;d++)s[d].indent<s[d].line.text.length&&(s[d].indent=u);s.length==c+1&&(s[c].single=!0)}}if(o!=2&&s.some(a=>a.comment<0&&(!a.empty||a.single))){let a=[];for(let{line:c,token:u,indent:f,empty:d,single:p}of s)(p||!d)&&a.push({from:c.from+f,insert:u+" "});let h=e.changes(a);return{changes:h,selection:e.selection.map(h,1)}}else if(o!=1&&s.some(a=>a.comment>=0)){let a=[];for(let{line:h,comment:c,token:u}of s)if(c>=0){let f=h.from+c,d=f+u.length;h.text[d-h.from]==" "&&d++,a.push({from:f,to:d})}return{changes:a}}return null}const fromHistory=Annotation.define(),isolateHistory=Annotation.define(),invertedEffects=Facet.define(),historyConfig=Facet.define({combine(o){return combineConfig(o,{minDepth:100,newGroupDelay:500,joinToEvent:(e,r)=>r},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,r)=>(s,l)=>e(s,l)||r(s,l)})}});function changeEnd(o){let e=0;return o.iterChangedRanges((r,s)=>e=s),e}const historyField_=StateField.define({create(){return HistoryState.empty},update(o,e){let r=e.state.facet(historyConfig),s=e.annotation(fromHistory);if(s){let u=e.docChanged?EditorSelection.single(changeEnd(e.changes)):void 0,f=HistEvent.fromTransaction(e,u),d=s.side,p=d==0?o.undone:o.done;return f?p=updateBranch(p,p.length,r.minDepth,f):p=addSelection(p,e.startState.selection),new HistoryState(d==0?s.rest:p,d==0?p:s.rest)}let l=e.annotation(isolateHistory);if((l=="full"||l=="before")&&(o=o.isolate()),e.annotation(Transaction.addToHistory)===!1)return e.changes.empty?o:o.addMapping(e.changes.desc);let a=HistEvent.fromTransaction(e),h=e.annotation(Transaction.time),c=e.annotation(Transaction.userEvent);return a?o=o.addChanges(a,h,c,r,e):e.selection&&(o=o.addSelection(e.startState.selection,h,c,r.newGroupDelay)),(l=="full"||l=="after")&&(o=o.isolate()),o},toJSON(o){return{done:o.done.map(e=>e.toJSON()),undone:o.undone.map(e=>e.toJSON())}},fromJSON(o){return new HistoryState(o.done.map(HistEvent.fromJSON),o.undone.map(HistEvent.fromJSON))}});function history(o={}){return[historyField_,historyConfig.of(o),EditorView.domEventHandlers({beforeinput(e,r){let s=e.inputType=="historyUndo"?undo:e.inputType=="historyRedo"?redo:null;return s?(e.preventDefault(),s(r)):!1}})]}function cmd(o,e){return function({state:r,dispatch:s}){if(!e&&r.readOnly)return!1;let l=r.field(historyField_,!1);if(!l)return!1;let a=l.pop(o,r,e);return a?(s(a),!0):!1}}const undo=cmd(0,!1),redo=cmd(1,!1),undoSelection=cmd(0,!0),redoSelection=cmd(1,!0);class HistEvent{constructor(e,r,s,l,a){this.changes=e,this.effects=r,this.mapped=s,this.startSelection=l,this.selectionsAfter=a}setSelAfter(e){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,r,s;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(r=this.mapped)===null||r===void 0?void 0:r.toJSON(),startSelection:(s=this.startSelection)===null||s===void 0?void 0:s.toJSON(),selectionsAfter:this.selectionsAfter.map(l=>l.toJSON())}}static fromJSON(e){return new HistEvent(e.changes&&ChangeSet.fromJSON(e.changes),[],e.mapped&&ChangeDesc.fromJSON(e.mapped),e.startSelection&&EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(EditorSelection.fromJSON))}static fromTransaction(e,r){let s=none$1;for(let l of e.startState.facet(invertedEffects)){let a=l(e);a.length&&(s=s.concat(a))}return!s.length&&e.changes.empty?null:new HistEvent(e.changes.invert(e.startState.doc),s,void 0,r||e.startState.selection,none$1)}static selection(e){return new HistEvent(void 0,none$1,void 0,void 0,e)}}function updateBranch(o,e,r,s){let l=e+1>r+20?e-r-1:0,a=o.slice(l,e);return a.push(s),a}function isAdjacent(o,e){let r=[],s=!1;return o.iterChangedRanges((l,a)=>r.push(l,a)),e.iterChangedRanges((l,a,h,c)=>{for(let u=0;u<r.length;){let f=r[u++],d=r[u++];c>=f&&h<=d&&(s=!0)}}),s}function eqSelectionShape(o,e){return o.ranges.length==e.ranges.length&&o.ranges.filter((r,s)=>r.empty!=e.ranges[s].empty).length===0}function conc(o,e){return o.length?e.length?o.concat(e):o:e}const none$1=[],MaxSelectionsPerEvent=200;function addSelection(o,e){if(o.length){let r=o[o.length-1],s=r.selectionsAfter.slice(Math.max(0,r.selectionsAfter.length-MaxSelectionsPerEvent));return s.length&&s[s.length-1].eq(e)?o:(s.push(e),updateBranch(o,o.length-1,1e9,r.setSelAfter(s)))}else return[HistEvent.selection([e])]}function popSelection(o){let e=o[o.length-1],r=o.slice();return r[o.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),r}function addMappingToBranch(o,e){if(!o.length)return o;let r=o.length,s=none$1;for(;r;){let l=mapEvent(o[r-1],e,s);if(l.changes&&!l.changes.empty||l.effects.length){let a=o.slice(0,r);return a[r-1]=l,a}else e=l.mapped,r--,s=l.selectionsAfter}return s.length?[HistEvent.selection(s)]:none$1}function mapEvent(o,e,r){let s=conc(o.selectionsAfter.length?o.selectionsAfter.map(c=>c.map(e)):none$1,r);if(!o.changes)return HistEvent.selection(s);let l=o.changes.map(e),a=e.mapDesc(o.changes,!0),h=o.mapped?o.mapped.composeDesc(a):a;return new HistEvent(l,StateEffect.mapEffects(o.effects,e),h,o.startSelection.map(a),s)}const joinableUserEvent=/^(input\.type|delete)($|\.)/;class HistoryState{constructor(e,r,s=0,l=void 0){this.done=e,this.undone=r,this.prevTime=s,this.prevUserEvent=l}isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this}addChanges(e,r,s,l,a){let h=this.done,c=h[h.length-1];return c&&c.changes&&!c.changes.empty&&e.changes&&(!s||joinableUserEvent.test(s))&&(!c.selectionsAfter.length&&r-this.prevTime<l.newGroupDelay&&l.joinToEvent(a,isAdjacent(c.changes,e.changes))||s=="input.type.compose")?h=updateBranch(h,h.length-1,l.minDepth,new HistEvent(e.changes.compose(c.changes),conc(e.effects,c.effects),c.mapped,c.startSelection,none$1)):h=updateBranch(h,h.length,l.minDepth,e),new HistoryState(h,none$1,r,s)}addSelection(e,r,s,l){let a=this.done.length?this.done[this.done.length-1].selectionsAfter:none$1;return a.length>0&&r-this.prevTime<l&&s==this.prevUserEvent&&s&&/^select($|\.)/.test(s)&&eqSelectionShape(a[a.length-1],e)?this:new HistoryState(addSelection(this.done,e),this.undone,r,s)}addMapping(e){return new HistoryState(addMappingToBranch(this.done,e),addMappingToBranch(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,r,s){let l=e==0?this.done:this.undone;if(l.length==0)return null;let a=l[l.length-1];if(s&&a.selectionsAfter.length)return r.update({selection:a.selectionsAfter[a.selectionsAfter.length-1],annotations:fromHistory.of({side:e,rest:popSelection(l)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(a.changes){let h=l.length==1?none$1:l.slice(0,l.length-1);return a.mapped&&(h=addMappingToBranch(h,a.mapped)),r.update({changes:a.changes,selection:a.startSelection,effects:a.effects,annotations:fromHistory.of({side:e,rest:h}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}HistoryState.empty=new HistoryState(none$1,none$1);const historyKeymap=[{key:"Mod-z",run:undo,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:!0},{linux:"Ctrl-Shift-z",run:redo,preventDefault:!0},{key:"Mod-u",run:undoSelection,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:!0}];function updateSel(o,e){return EditorSelection.create(o.ranges.map(e),o.mainIndex)}function setSel(o,e){return o.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function moveSel({state:o,dispatch:e},r){let s=updateSel(o.selection,r);return s.eq(o.selection)?!1:(e(setSel(o,s)),!0)}function rangeEnd(o,e){return EditorSelection.cursor(e?o.to:o.from)}function cursorByChar(o,e){return moveSel(o,r=>r.empty?o.moveByChar(r,e):rangeEnd(r,e))}function ltrAtCursor(o){return o.textDirectionAt(o.state.selection.main.head)==Direction.LTR}const cursorCharLeft=o=>cursorByChar(o,!ltrAtCursor(o)),cursorCharRight=o=>cursorByChar(o,ltrAtCursor(o));function cursorByGroup(o,e){return moveSel(o,r=>r.empty?o.moveByGroup(r,e):rangeEnd(r,e))}const cursorGroupLeft=o=>cursorByGroup(o,!ltrAtCursor(o)),cursorGroupRight=o=>cursorByGroup(o,ltrAtCursor(o));function interestingNode(o,e,r){if(e.type.prop(r))return!0;let s=e.to-e.from;return s&&(s>2||/[^\s,.;:]/.test(o.sliceDoc(e.from,e.to)))||e.firstChild}function moveBySyntax(o,e,r){let s=syntaxTree(o).resolveInner(e.head),l=r?NodeProp.closedBy:NodeProp.openedBy;for(let u=e.head;;){let f=r?s.childAfter(u):s.childBefore(u);if(!f)break;interestingNode(o,f,l)?s=f:u=r?f.to:f.from}let a=s.type.prop(l),h,c;return a&&(h=r?matchBrackets(o,s.from,1):matchBrackets(o,s.to,-1))&&h.matched?c=r?h.end.to:h.end.from:c=r?s.to:s.from,EditorSelection.cursor(c,r?-1:1)}const cursorSyntaxLeft=o=>moveSel(o,e=>moveBySyntax(o.state,e,!ltrAtCursor(o))),cursorSyntaxRight=o=>moveSel(o,e=>moveBySyntax(o.state,e,ltrAtCursor(o)));function cursorByLine(o,e){return moveSel(o,r=>{if(!r.empty)return rangeEnd(r,e);let s=o.moveVertically(r,e);return s.head!=r.head?s:o.moveToLineBoundary(r,e)})}const cursorLineUp=o=>cursorByLine(o,!1),cursorLineDown=o=>cursorByLine(o,!0);function pageInfo(o){let e=o.scrollDOM.clientHeight<o.scrollDOM.scrollHeight-2,r=0,s=0,l;if(e){for(let a of o.state.facet(EditorView.scrollMargins)){let h=a(o);h!=null&&h.top&&(r=Math.max(h==null?void 0:h.top,r)),h!=null&&h.bottom&&(s=Math.max(h==null?void 0:h.bottom,s))}l=o.scrollDOM.clientHeight-r-s}else l=(o.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:r,marginBottom:s,selfScroll:e,height:Math.max(o.defaultLineHeight,l-5)}}function cursorByPage(o,e){let r=pageInfo(o),{state:s}=o,l=updateSel(s.selection,h=>h.empty?o.moveVertically(h,e,r.height):rangeEnd(h,e));if(l.eq(s.selection))return!1;let a;if(r.selfScroll){let h=o.coordsAtPos(s.selection.main.head),c=o.scrollDOM.getBoundingClientRect(),u=c.top+r.marginTop,f=c.bottom-r.marginBottom;h&&h.top>u&&h.bottom<f&&(a=EditorView.scrollIntoView(l.main.head,{y:"start",yMargin:h.top-u}))}return o.dispatch(setSel(s,l),{effects:a}),!0}const cursorPageUp=o=>cursorByPage(o,!1),cursorPageDown=o=>cursorByPage(o,!0);function moveByLineBoundary(o,e,r){let s=o.lineBlockAt(e.head),l=o.moveToLineBoundary(e,r);if(l.head==e.head&&l.head!=(r?s.to:s.from)&&(l=o.moveToLineBoundary(e,r,!1)),!r&&l.head==s.from&&s.length){let a=/^\s*/.exec(o.state.sliceDoc(s.from,Math.min(s.from+100,s.to)))[0].length;a&&e.head!=s.from+a&&(l=EditorSelection.cursor(s.from+a))}return l}const cursorLineBoundaryForward=o=>moveSel(o,e=>moveByLineBoundary(o,e,!0)),cursorLineBoundaryBackward=o=>moveSel(o,e=>moveByLineBoundary(o,e,!1)),cursorLineBoundaryLeft=o=>moveSel(o,e=>moveByLineBoundary(o,e,!ltrAtCursor(o))),cursorLineBoundaryRight=o=>moveSel(o,e=>moveByLineBoundary(o,e,ltrAtCursor(o))),cursorLineStart=o=>moveSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).from,1)),cursorLineEnd=o=>moveSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).to,-1));function toMatchingBracket(o,e,r){let s=!1,l=updateSel(o.selection,a=>{let h=matchBrackets(o,a.head,-1)||matchBrackets(o,a.head,1)||a.head>0&&matchBrackets(o,a.head-1,1)||a.head<o.doc.length&&matchBrackets(o,a.head+1,-1);if(!h||!h.end)return a;s=!0;let c=h.start.from==a.head?h.end.to:h.end.from;return r?EditorSelection.range(a.anchor,c):EditorSelection.cursor(c)});return s?(e(setSel(o,l)),!0):!1}const cursorMatchingBracket=({state:o,dispatch:e})=>toMatchingBracket(o,e,!1);function extendSel(o,e){let r=updateSel(o.state.selection,s=>{let l=e(s);return EditorSelection.range(s.anchor,l.head,l.goalColumn,l.bidiLevel||void 0)});return r.eq(o.state.selection)?!1:(o.dispatch(setSel(o.state,r)),!0)}function selectByChar(o,e){return extendSel(o,r=>o.moveByChar(r,e))}const selectCharLeft=o=>selectByChar(o,!ltrAtCursor(o)),selectCharRight=o=>selectByChar(o,ltrAtCursor(o));function selectByGroup(o,e){return extendSel(o,r=>o.moveByGroup(r,e))}const selectGroupLeft=o=>selectByGroup(o,!ltrAtCursor(o)),selectGroupRight=o=>selectByGroup(o,ltrAtCursor(o)),selectSyntaxLeft=o=>extendSel(o,e=>moveBySyntax(o.state,e,!ltrAtCursor(o))),selectSyntaxRight=o=>extendSel(o,e=>moveBySyntax(o.state,e,ltrAtCursor(o)));function selectByLine(o,e){return extendSel(o,r=>o.moveVertically(r,e))}const selectLineUp=o=>selectByLine(o,!1),selectLineDown=o=>selectByLine(o,!0);function selectByPage(o,e){return extendSel(o,r=>o.moveVertically(r,e,pageInfo(o).height))}const selectPageUp=o=>selectByPage(o,!1),selectPageDown=o=>selectByPage(o,!0),selectLineBoundaryForward=o=>extendSel(o,e=>moveByLineBoundary(o,e,!0)),selectLineBoundaryBackward=o=>extendSel(o,e=>moveByLineBoundary(o,e,!1)),selectLineBoundaryLeft=o=>extendSel(o,e=>moveByLineBoundary(o,e,!ltrAtCursor(o))),selectLineBoundaryRight=o=>extendSel(o,e=>moveByLineBoundary(o,e,ltrAtCursor(o))),selectLineStart=o=>extendSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).from)),selectLineEnd=o=>extendSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).to)),cursorDocStart=({state:o,dispatch:e})=>(e(setSel(o,{anchor:0})),!0),cursorDocEnd=({state:o,dispatch:e})=>(e(setSel(o,{anchor:o.doc.length})),!0),selectDocStart=({state:o,dispatch:e})=>(e(setSel(o,{anchor:o.selection.main.anchor,head:0})),!0),selectDocEnd=({state:o,dispatch:e})=>(e(setSel(o,{anchor:o.selection.main.anchor,head:o.doc.length})),!0),selectAll=({state:o,dispatch:e})=>(e(o.update({selection:{anchor:0,head:o.doc.length},userEvent:"select"})),!0),selectLine=({state:o,dispatch:e})=>{let r=selectedLineBlocks(o).map(({from:s,to:l})=>EditorSelection.range(s,Math.min(l+1,o.doc.length)));return e(o.update({selection:EditorSelection.create(r),userEvent:"select"})),!0},selectParentSyntax=({state:o,dispatch:e})=>{let r=updateSel(o.selection,s=>{var l;let a=syntaxTree(o).resolveInner(s.head,1);for(;!(a.from<s.from&&a.to>=s.to||a.to>s.to&&a.from<=s.from||!(!((l=a.parent)===null||l===void 0)&&l.parent));)a=a.parent;return EditorSelection.range(a.to,a.from)});return e(setSel(o,r)),!0},simplifySelection=({state:o,dispatch:e})=>{let r=o.selection,s=null;return r.ranges.length>1?s=EditorSelection.create([r.main]):r.main.empty||(s=EditorSelection.create([EditorSelection.cursor(r.main.head)])),s?(e(setSel(o,s)),!0):!1};function deleteBy(o,e){if(o.state.readOnly)return!1;let r="delete.selection",{state:s}=o,l=s.changeByRange(a=>{let{from:h,to:c}=a;if(h==c){let u=e(h);u<h?(r="delete.backward",u=skipAtomic(o,u,!1)):u>h&&(r="delete.forward",u=skipAtomic(o,u,!0)),h=Math.min(h,u),c=Math.max(c,u)}else h=skipAtomic(o,h,!1),c=skipAtomic(o,c,!0);return h==c?{range:a}:{changes:{from:h,to:c},range:EditorSelection.cursor(h)}});return l.changes.empty?!1:(o.dispatch(s.update(l,{scrollIntoView:!0,userEvent:r,effects:r=="delete.selection"?EditorView.announce.of(s.phrase("Selection deleted")):void 0})),!0)}function skipAtomic(o,e,r){if(o instanceof EditorView)for(let s of o.state.facet(EditorView.atomicRanges).map(l=>l(o)))s.between(e,e,(l,a)=>{l<e&&a>e&&(e=r?a:l)});return e}const deleteByChar=(o,e)=>deleteBy(o,r=>{let{state:s}=o,l=s.doc.lineAt(r),a,h;if(!e&&r>l.from&&r<l.from+200&&!/[^ \t]/.test(a=l.text.slice(0,r-l.from))){if(a[a.length-1]=="	")return r-1;let c=countColumn(a,s.tabSize),u=c%getIndentUnit(s)||getIndentUnit(s);for(let f=0;f<u&&a[a.length-1-f]==" ";f++)r--;h=r}else h=findClusterBreak(l.text,r-l.from,e,e)+l.from,h==r&&l.number!=(e?s.doc.lines:1)&&(h+=e?1:-1);return h}),deleteCharBackward=o=>deleteByChar(o,!1),deleteCharForward=o=>deleteByChar(o,!0),deleteByGroup=(o,e)=>deleteBy(o,r=>{let s=r,{state:l}=o,a=l.doc.lineAt(s),h=l.charCategorizer(s);for(let c=null;;){if(s==(e?a.to:a.from)){s==r&&a.number!=(e?l.doc.lines:1)&&(s+=e?1:-1);break}let u=findClusterBreak(a.text,s-a.from,e)+a.from,f=a.text.slice(Math.min(s,u)-a.from,Math.max(s,u)-a.from),d=h(f);if(c!=null&&d!=c)break;(f!=" "||s!=r)&&(c=d),s=u}return s}),deleteGroupBackward=o=>deleteByGroup(o,!1),deleteGroupForward=o=>deleteByGroup(o,!0),deleteToLineEnd=o=>deleteBy(o,e=>{let r=o.lineBlockAt(e).to;return e<r?r:Math.min(o.state.doc.length,e+1)}),deleteToLineStart=o=>deleteBy(o,e=>{let r=o.lineBlockAt(e).from;return e>r?r:Math.max(0,e-1)}),splitLine=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let r=o.changeByRange(s=>({changes:{from:s.from,to:s.to,insert:Text.of(["",""])},range:EditorSelection.cursor(s.from)}));return e(o.update(r,{scrollIntoView:!0,userEvent:"input"})),!0},transposeChars=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let r=o.changeByRange(s=>{if(!s.empty||s.from==0||s.from==o.doc.length)return{range:s};let l=s.from,a=o.doc.lineAt(l),h=l==a.from?l-1:findClusterBreak(a.text,l-a.from,!1)+a.from,c=l==a.to?l+1:findClusterBreak(a.text,l-a.from,!0)+a.from;return{changes:{from:h,to:c,insert:o.doc.slice(l,c).append(o.doc.slice(h,l))},range:EditorSelection.cursor(c)}});return r.changes.empty?!1:(e(o.update(r,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function selectedLineBlocks(o){let e=[],r=-1;for(let s of o.selection.ranges){let l=o.doc.lineAt(s.from),a=o.doc.lineAt(s.to);if(!s.empty&&s.to==a.from&&(a=o.doc.lineAt(s.to-1)),r>=l.number){let h=e[e.length-1];h.to=a.to,h.ranges.push(s)}else e.push({from:l.from,to:a.to,ranges:[s]});r=a.number+1}return e}function moveLine(o,e,r){if(o.readOnly)return!1;let s=[],l=[];for(let a of selectedLineBlocks(o)){if(r?a.to==o.doc.length:a.from==0)continue;let h=o.doc.lineAt(r?a.to+1:a.from-1),c=h.length+1;if(r){s.push({from:a.to,to:h.to},{from:a.from,insert:h.text+o.lineBreak});for(let u of a.ranges)l.push(EditorSelection.range(Math.min(o.doc.length,u.anchor+c),Math.min(o.doc.length,u.head+c)))}else{s.push({from:h.from,to:a.from},{from:a.to,insert:o.lineBreak+h.text});for(let u of a.ranges)l.push(EditorSelection.range(u.anchor-c,u.head-c))}}return s.length?(e(o.update({changes:s,scrollIntoView:!0,selection:EditorSelection.create(l,o.selection.mainIndex),userEvent:"move.line"})),!0):!1}const moveLineUp=({state:o,dispatch:e})=>moveLine(o,e,!1),moveLineDown=({state:o,dispatch:e})=>moveLine(o,e,!0);function copyLine(o,e,r){if(o.readOnly)return!1;let s=[];for(let l of selectedLineBlocks(o))r?s.push({from:l.from,insert:o.doc.slice(l.from,l.to)+o.lineBreak}):s.push({from:l.to,insert:o.lineBreak+o.doc.slice(l.from,l.to)});return e(o.update({changes:s,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const copyLineUp=({state:o,dispatch:e})=>copyLine(o,e,!1),copyLineDown=({state:o,dispatch:e})=>copyLine(o,e,!0),deleteLine=o=>{if(o.state.readOnly)return!1;let{state:e}=o,r=e.changes(selectedLineBlocks(e).map(({from:l,to:a})=>(l>0?l--:a<e.doc.length&&a++,{from:l,to:a}))),s=updateSel(e.selection,l=>o.moveVertically(l,!0)).map(r);return o.dispatch({changes:r,selection:s,scrollIntoView:!0,userEvent:"delete.line"}),!0};function isBetweenBrackets(o,e){if(/\(\)|\[\]|\{\}/.test(o.sliceDoc(e-1,e+1)))return{from:e,to:e};let r=syntaxTree(o).resolveInner(e),s=r.childBefore(e),l=r.childAfter(e),a;return s&&l&&s.to<=e&&l.from>=e&&(a=s.type.prop(NodeProp.closedBy))&&a.indexOf(l.name)>-1&&o.doc.lineAt(s.to).from==o.doc.lineAt(l.from).from?{from:s.to,to:l.from}:null}const insertNewlineAndIndent=newlineAndIndent(!1),insertBlankLine=newlineAndIndent(!0);function newlineAndIndent(o){return({state:e,dispatch:r})=>{if(e.readOnly)return!1;let s=e.changeByRange(l=>{let{from:a,to:h}=l,c=e.doc.lineAt(a),u=!o&&a==h&&isBetweenBrackets(e,a);o&&(a=h=(h<=c.to?c:e.doc.lineAt(h)).to);let f=new IndentContext(e,{simulateBreak:a,simulateDoubleBreak:!!u}),d=getIndentation(f,a);for(d==null&&(d=/^\s*/.exec(e.doc.lineAt(a).text)[0].length);h<c.to&&/\s/.test(c.text[h-c.from]);)h++;u?{from:a,to:h}=u:a>c.from&&a<c.from+100&&!/\S/.test(c.text.slice(0,a))&&(a=c.from);let p=["",indentString(e,d)];return u&&p.push(indentString(e,f.lineIndent(c.from,-1))),{changes:{from:a,to:h,insert:Text.of(p)},range:EditorSelection.cursor(a+1+p[1].length)}});return r(e.update(s,{scrollIntoView:!0,userEvent:"input"})),!0}}function changeBySelectedLine(o,e){let r=-1;return o.changeByRange(s=>{let l=[];for(let h=s.from;h<=s.to;){let c=o.doc.lineAt(h);c.number>r&&(s.empty||s.to>c.from)&&(e(c,l,s),r=c.number),h=c.to+1}let a=o.changes(l);return{changes:l,range:EditorSelection.range(a.mapPos(s.anchor,1),a.mapPos(s.head,1))}})}const indentSelection=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let r=Object.create(null),s=new IndentContext(o,{overrideIndentation:a=>{let h=r[a];return h??-1}}),l=changeBySelectedLine(o,(a,h,c)=>{let u=getIndentation(s,a.from);if(u==null)return;/\S/.test(a.text)||(u=0);let f=/^\s*/.exec(a.text)[0],d=indentString(o,u);(f!=d||c.from<a.from+f.length)&&(r[a.from]=u,h.push({from:a.from,to:a.from+f.length,insert:d}))});return l.changes.empty||e(o.update(l,{userEvent:"indent"})),!0},indentMore=({state:o,dispatch:e})=>o.readOnly?!1:(e(o.update(changeBySelectedLine(o,(r,s)=>{s.push({from:r.from,insert:o.facet(indentUnit)})}),{userEvent:"input.indent"})),!0),indentLess=({state:o,dispatch:e})=>o.readOnly?!1:(e(o.update(changeBySelectedLine(o,(r,s)=>{let l=/^\s*/.exec(r.text)[0];if(!l)return;let a=countColumn(l,o.tabSize),h=0,c=indentString(o,Math.max(0,a-getIndentUnit(o)));for(;h<l.length&&h<c.length&&l.charCodeAt(h)==c.charCodeAt(h);)h++;s.push({from:r.from+h,to:r.from+l.length,insert:c.slice(h)})}),{userEvent:"delete.dedent"})),!0),emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}],standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:!0},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:!0},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:!0},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:!0},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:!0},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:!0},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:!0},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteToLineStart},{mac:"Mod-Delete",run:deleteToLineEnd}].concat(emacsStyleKeymap.map(o=>({mac:o.key,run:o.run,shift:o.shift}))),defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:!0},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment}].concat(standardKeymap);function crelt(){var o=arguments[0];typeof o=="string"&&(o=document.createElement(o));var e=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s)){var l=r[s];typeof l=="string"?o.setAttribute(s,l):l!=null&&(o[s]=l)}e++}for(;e<arguments.length;e++)add(o,arguments[e]);return o}function add(o,e){if(typeof e=="string")o.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)o.appendChild(e);else if(Array.isArray(e))for(var r=0;r<e.length;r++)add(o,e[r]);else throw new RangeError("Unsupported child node: "+e)}const basicNormalize=typeof String.prototype.normalize=="function"?o=>o.normalize("NFKD"):o=>o;class SearchCursor{constructor(e,r,s=0,l=e.length,a,h){this.test=h,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(s,l),this.bufferStart=s,this.normalize=a?c=>a(basicNormalize(c)):basicNormalize,this.query=this.normalize(r)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return codePointAt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let r=fromCodePoint(e),s=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(e);let l=this.normalize(r);for(let a=0,h=s;;a++){let c=l.charCodeAt(a),u=this.match(c,h);if(u)return this.value=u,this;if(a==l.length-1)break;h==s&&a<r.length&&r.charCodeAt(a)==c&&h++}}}match(e,r){let s=null;for(let l=0;l<this.matches.length;l+=2){let a=this.matches[l],h=!1;this.query.charCodeAt(a)==e&&(a==this.query.length-1?s={from:this.matches[l+1],to:r+1}:(this.matches[l]++,h=!0)),h||(this.matches.splice(l,2),l-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?s={from:r,to:r+1}:this.matches.push(1,r)),s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferPos)&&(s=null),s}}typeof Symbol<"u"&&(SearchCursor.prototype[Symbol.iterator]=function(){return this});const empty={from:-1,to:-1,match:/.*/.exec("")},baseFlags="gm"+(/x/.unicode==null?"":"u");class RegExpCursor{constructor(e,r,s,l=0,a=e.length){if(this.text=e,this.to=a,this.curLine="",this.done=!1,this.value=empty,/\\[sWDnr]|\n|\r|\[\^/.test(r))return new MultilineRegExpCursor(e,r,s,l,a);this.re=new RegExp(r,baseFlags+(s!=null&&s.ignoreCase?"i":"")),this.test=s==null?void 0:s.test,this.iter=e.iter();let h=e.lineAt(l);this.curLineStart=h.from,this.matchPos=toCharEnd(e,l),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let r=this.matchPos<=this.to&&this.re.exec(this.curLine);if(r){let s=this.curLineStart+r.index,l=s+r[0].length;if(this.matchPos=toCharEnd(this.text,l+(s==l?1:0)),s==this.curLineStart+this.curLine.length&&this.nextLine(),(s<l||s>this.value.to)&&(!this.test||this.test(s,l,r)))return this.value={from:s,to:l,match:r},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const flattened=new WeakMap;class FlattenedDoc{constructor(e,r){this.from=e,this.text=r}get to(){return this.from+this.text.length}static get(e,r,s){let l=flattened.get(e);if(!l||l.from>=s||l.to<=r){let c=new FlattenedDoc(r,e.sliceString(r,s));return flattened.set(e,c),c}if(l.from==r&&l.to==s)return l;let{text:a,from:h}=l;return h>r&&(a=e.sliceString(r,h)+a,h=r),l.to<s&&(a+=e.sliceString(l.to,s)),flattened.set(e,new FlattenedDoc(h,a)),new FlattenedDoc(r,a.slice(r-h,s-h))}}class MultilineRegExpCursor{constructor(e,r,s,l,a){this.text=e,this.to=a,this.done=!1,this.value=empty,this.matchPos=toCharEnd(e,l),this.re=new RegExp(r,baseFlags+(s!=null&&s.ignoreCase?"i":"")),this.test=s==null?void 0:s.test,this.flat=FlattenedDoc.get(e,l,this.chunkEnd(l+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,r=this.re.exec(this.flat.text);if(r&&!r[0]&&r.index==e&&(this.re.lastIndex=e+1,r=this.re.exec(this.flat.text)),r){let s=this.flat.from+r.index,l=s+r[0].length;if((this.flat.to>=this.to||r.index+r[0].length<=this.flat.text.length-10)&&(!this.test||this.test(s,l,r)))return this.value={from:s,to:l,match:r},this.matchPos=toCharEnd(this.text,l+(s==l?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this});function validRegExp(o){try{return new RegExp(o,baseFlags),!0}catch{return!1}}function toCharEnd(o,e){if(e>=o.length)return e;let r=o.lineAt(e),s;for(;e<r.to&&(s=r.text.charCodeAt(e-r.from))>=56320&&s<57344;)e++;return e}function createLineDialog(o){let e=crelt("input",{class:"cm-textfield",name:"line"}),r=crelt("form",{class:"cm-gotoLine",onkeydown:l=>{l.keyCode==27?(l.preventDefault(),o.dispatch({effects:dialogEffect.of(!1)}),o.focus()):l.keyCode==13&&(l.preventDefault(),s())},onsubmit:l=>{l.preventDefault(),s()}},crelt("label",o.state.phrase("Go to line"),": ",e)," ",crelt("button",{class:"cm-button",type:"submit"},o.state.phrase("go")));function s(){let l=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!l)return;let{state:a}=o,h=a.doc.lineAt(a.selection.main.head),[,c,u,f,d]=l,p=f?+f.slice(1):0,g=u?+u:h.number;if(u&&d){let w=g/100;c&&(w=w*(c=="-"?-1:1)+h.number/a.doc.lines),g=Math.round(a.doc.lines*w)}else u&&c&&(g=g*(c=="-"?-1:1)+h.number);let m=a.doc.line(Math.max(1,Math.min(a.doc.lines,g)));o.dispatch({effects:dialogEffect.of(!1),selection:EditorSelection.cursor(m.from+Math.max(0,Math.min(p,m.length))),scrollIntoView:!0}),o.focus()}return{dom:r}}const dialogEffect=StateEffect.define(),dialogField=StateField.define({create(){return!0},update(o,e){for(let r of e.effects)r.is(dialogEffect)&&(o=r.value);return o},provide:o=>showPanel.from(o,e=>e?createLineDialog:null)}),gotoLine=o=>{let e=getPanel(o,createLineDialog);if(!e){let r=[dialogEffect.of(!0)];o.state.field(dialogField,!1)==null&&r.push(StateEffect.appendConfig.of([dialogField,baseTheme$1$1])),o.dispatch({effects:r}),e=getPanel(o,createLineDialog)}return e&&e.dom.querySelector("input").focus(),!0},baseTheme$1$1=EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),defaultHighlightOptions={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},highlightConfig=Facet.define({combine(o){return combineConfig(o,defaultHighlightOptions,{highlightWordAroundCursor:(e,r)=>e||r,minSelectionLength:Math.min,maxMatches:Math.min})}});function highlightSelectionMatches(o){let e=[defaultTheme,matchHighlighter];return o&&e.push(highlightConfig.of(o)),e}const matchDeco=Decoration.mark({class:"cm-selectionMatch"}),mainMatchDeco=Decoration.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function insideWordBoundaries(o,e,r,s){return(r==0||o(e.sliceDoc(r-1,r))!=CharCategory.Word)&&(s==e.doc.length||o(e.sliceDoc(s,s+1))!=CharCategory.Word)}function insideWord(o,e,r,s){return o(e.sliceDoc(r,r+1))==CharCategory.Word&&o(e.sliceDoc(s-1,s))==CharCategory.Word}const matchHighlighter=ViewPlugin.fromClass(class{constructor(o){this.decorations=this.getDeco(o)}update(o){(o.selectionSet||o.docChanged||o.viewportChanged)&&(this.decorations=this.getDeco(o.view))}getDeco(o){let e=o.state.facet(highlightConfig),{state:r}=o,s=r.selection;if(s.ranges.length>1)return Decoration.none;let l=s.main,a,h=null;if(l.empty){if(!e.highlightWordAroundCursor)return Decoration.none;let u=r.wordAt(l.head);if(!u)return Decoration.none;h=r.charCategorizer(l.head),a=r.sliceDoc(u.from,u.to)}else{let u=l.to-l.from;if(u<e.minSelectionLength||u>200)return Decoration.none;if(e.wholeWords){if(a=r.sliceDoc(l.from,l.to),h=r.charCategorizer(l.head),!(insideWordBoundaries(h,r,l.from,l.to)&&insideWord(h,r,l.from,l.to)))return Decoration.none}else if(a=r.sliceDoc(l.from,l.to).trim(),!a)return Decoration.none}let c=[];for(let u of o.visibleRanges){let f=new SearchCursor(r.doc,a,u.from,u.to);for(;!f.next().done;){let{from:d,to:p}=f.value;if((!h||insideWordBoundaries(h,r,d,p))&&(l.empty&&d<=l.from&&p>=l.to?c.push(mainMatchDeco.range(d,p)):(d>=l.to||p<=l.from)&&c.push(matchDeco.range(d,p)),c.length>e.maxMatches))return Decoration.none}}return Decoration.set(c)}},{decorations:o=>o.decorations}),defaultTheme=EditorView.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),selectWord=({state:o,dispatch:e})=>{let{selection:r}=o,s=EditorSelection.create(r.ranges.map(l=>o.wordAt(l.head)||EditorSelection.cursor(l.head)),r.mainIndex);return s.eq(r)?!1:(e(o.update({selection:s})),!0)};function findNextOccurrence(o,e){let{main:r,ranges:s}=o.selection,l=o.wordAt(r.head),a=l&&l.from==r.from&&l.to==r.to;for(let h=!1,c=new SearchCursor(o.doc,e,s[s.length-1].to);;)if(c.next(),c.done){if(h)return null;c=new SearchCursor(o.doc,e,0,Math.max(0,s[s.length-1].from-1)),h=!0}else{if(h&&s.some(u=>u.from==c.value.from))continue;if(a){let u=o.wordAt(c.value.from);if(!u||u.from!=c.value.from||u.to!=c.value.to)continue}return c.value}}const selectNextOccurrence=({state:o,dispatch:e})=>{let{ranges:r}=o.selection;if(r.some(a=>a.from===a.to))return selectWord({state:o,dispatch:e});let s=o.sliceDoc(r[0].from,r[0].to);if(o.selection.ranges.some(a=>o.sliceDoc(a.from,a.to)!=s))return!1;let l=findNextOccurrence(o,s);return l?(e(o.update({selection:o.selection.addRange(EditorSelection.range(l.from,l.to),!1),effects:EditorView.scrollIntoView(l.to)})),!0):!1},searchConfigFacet=Facet.define({combine(o){return combineConfig(o,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new SearchPanel(e),scrollToMatch:e=>EditorView.scrollIntoView(e)})}});class SearchQuery{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||validRegExp(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(r,s)=>s=="n"?`
`:s=="r"?"\r":s=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new RegExpQuery(this):new StringQuery(this)}getCursor(e,r=0,s){let l=e.doc?e:EditorState.create({doc:e});return s==null&&(s=l.doc.length),this.regexp?regexpCursor(this,l,r,s):stringCursor(this,l,r,s)}}class QueryType{constructor(e){this.spec=e}}function stringCursor(o,e,r,s){return new SearchCursor(e.doc,o.unquoted,r,s,o.caseSensitive?void 0:l=>l.toLowerCase(),o.wholeWord?stringWordTest(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function stringWordTest(o,e){return(r,s,l,a)=>((a>r||a+l.length<s)&&(a=Math.max(0,r-2),l=o.sliceString(a,Math.min(o.length,s+2))),(e(charBefore(l,r-a))!=CharCategory.Word||e(charAfter(l,r-a))!=CharCategory.Word)&&(e(charAfter(l,s-a))!=CharCategory.Word||e(charBefore(l,s-a))!=CharCategory.Word))}class StringQuery extends QueryType{constructor(e){super(e)}nextMatch(e,r,s){let l=stringCursor(this.spec,e,s,e.doc.length).nextOverlapping();return l.done&&(l=stringCursor(this.spec,e,0,r).nextOverlapping()),l.done?null:l.value}prevMatchInRange(e,r,s){for(let l=s;;){let a=Math.max(r,l-1e4-this.spec.unquoted.length),h=stringCursor(this.spec,e,a,l),c=null;for(;!h.nextOverlapping().done;)c=h.value;if(c)return c;if(a==r)return null;l-=1e4}}prevMatch(e,r,s){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,s,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,r){let s=stringCursor(this.spec,e,0,e.doc.length),l=[];for(;!s.next().done;){if(l.length>=r)return null;l.push(s.value)}return l}highlight(e,r,s,l){let a=stringCursor(this.spec,e,Math.max(0,r-this.spec.unquoted.length),Math.min(s+this.spec.unquoted.length,e.doc.length));for(;!a.next().done;)l(a.value.from,a.value.to)}}function regexpCursor(o,e,r,s){return new RegExpCursor(e.doc,o.search,{ignoreCase:!o.caseSensitive,test:o.wholeWord?regexpWordTest(e.charCategorizer(e.selection.main.head)):void 0},r,s)}function charBefore(o,e){return o.slice(findClusterBreak(o,e,!1),e)}function charAfter(o,e){return o.slice(e,findClusterBreak(o,e))}function regexpWordTest(o){return(e,r,s)=>!s[0].length||(o(charBefore(s.input,s.index))!=CharCategory.Word||o(charAfter(s.input,s.index))!=CharCategory.Word)&&(o(charAfter(s.input,s.index+s[0].length))!=CharCategory.Word||o(charBefore(s.input,s.index+s[0].length))!=CharCategory.Word)}class RegExpQuery extends QueryType{nextMatch(e,r,s){let l=regexpCursor(this.spec,e,s,e.doc.length).next();return l.done&&(l=regexpCursor(this.spec,e,0,r).next()),l.done?null:l.value}prevMatchInRange(e,r,s){for(let l=1;;l++){let a=Math.max(r,s-l*1e4),h=regexpCursor(this.spec,e,a,s),c=null;for(;!h.next().done;)c=h.value;if(c&&(a==r||c.from>a+10))return c;if(a==r)return null}}prevMatch(e,r,s){return this.prevMatchInRange(e,0,r)||this.prevMatchInRange(e,s,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,(r,s)=>s=="$"?"$":s=="&"?e.match[0]:s!="0"&&+s<e.match.length?e.match[s]:r))}matchAll(e,r){let s=regexpCursor(this.spec,e,0,e.doc.length),l=[];for(;!s.next().done;){if(l.length>=r)return null;l.push(s.value)}return l}highlight(e,r,s,l){let a=regexpCursor(this.spec,e,Math.max(0,r-250),Math.min(s+250,e.doc.length));for(;!a.next().done;)l(a.value.from,a.value.to)}}const setSearchQuery=StateEffect.define(),togglePanel$1=StateEffect.define(),searchState=StateField.define({create(o){return new SearchState(defaultQuery(o).create(),null)},update(o,e){for(let r of e.effects)r.is(setSearchQuery)?o=new SearchState(r.value.create(),o.panel):r.is(togglePanel$1)&&(o=new SearchState(o.query,r.value?createSearchPanel:null));return o},provide:o=>showPanel.from(o,e=>e.panel)});class SearchState{constructor(e,r){this.query=e,this.panel=r}}const matchMark=Decoration.mark({class:"cm-searchMatch"}),selectedMatchMark=Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"}),searchHighlighter=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.decorations=this.highlight(o.state.field(searchState))}update(o){let e=o.state.field(searchState);(e!=o.startState.field(searchState)||o.docChanged||o.selectionSet||o.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:o,panel:e}){if(!e||!o.spec.valid)return Decoration.none;let{view:r}=this,s=new RangeSetBuilder;for(let l=0,a=r.visibleRanges,h=a.length;l<h;l++){let{from:c,to:u}=a[l];for(;l<h-1&&u>a[l+1].from-2*250;)u=a[++l].to;o.highlight(r.state,c,u,(f,d)=>{let p=r.state.selection.ranges.some(g=>g.from==f&&g.to==d);s.add(f,d,p?selectedMatchMark:matchMark)})}return s.finish()}},{decorations:o=>o.decorations});function searchCommand(o){return e=>{let r=e.state.field(searchState,!1);return r&&r.query.spec.valid?o(e,r):openSearchPanel(e)}}const findNext=searchCommand((o,{query:e})=>{let{to:r}=o.state.selection.main,s=e.nextMatch(o.state,r,r);if(!s)return!1;let l=EditorSelection.single(s.from,s.to),a=o.state.facet(searchConfigFacet);return o.dispatch({selection:l,effects:[announceMatch(o,s),a.scrollToMatch(l.main,o)],userEvent:"select.search"}),selectSearchInput(o),!0}),findPrevious=searchCommand((o,{query:e})=>{let{state:r}=o,{from:s}=r.selection.main,l=e.prevMatch(r,s,s);if(!l)return!1;let a=EditorSelection.single(l.from,l.to),h=o.state.facet(searchConfigFacet);return o.dispatch({selection:a,effects:[announceMatch(o,l),h.scrollToMatch(a.main,o)],userEvent:"select.search"}),selectSearchInput(o),!0}),selectMatches=searchCommand((o,{query:e})=>{let r=e.matchAll(o.state,1e3);return!r||!r.length?!1:(o.dispatch({selection:EditorSelection.create(r.map(s=>EditorSelection.range(s.from,s.to))),userEvent:"select.search.matches"}),!0)}),selectSelectionMatches=({state:o,dispatch:e})=>{let r=o.selection;if(r.ranges.length>1||r.main.empty)return!1;let{from:s,to:l}=r.main,a=[],h=0;for(let c=new SearchCursor(o.doc,o.sliceDoc(s,l));!c.next().done;){if(a.length>1e3)return!1;c.value.from==s&&(h=a.length),a.push(EditorSelection.range(c.value.from,c.value.to))}return e(o.update({selection:EditorSelection.create(a,h),userEvent:"select.search.matches"})),!0},replaceNext=searchCommand((o,{query:e})=>{let{state:r}=o,{from:s,to:l}=r.selection.main;if(r.readOnly)return!1;let a=e.nextMatch(r,s,s);if(!a)return!1;let h=[],c,u,f=[];if(a.from==s&&a.to==l&&(u=r.toText(e.getReplacement(a)),h.push({from:a.from,to:a.to,insert:u}),a=e.nextMatch(r,a.from,a.to),f.push(EditorView.announce.of(r.phrase("replaced match on line $",r.doc.lineAt(s).number)+"."))),a){let d=h.length==0||h[0].from>=a.to?0:a.to-a.from-u.length;c=EditorSelection.single(a.from-d,a.to-d),f.push(announceMatch(o,a)),f.push(r.facet(searchConfigFacet).scrollToMatch(c.main,o))}return o.dispatch({changes:h,selection:c,effects:f,userEvent:"input.replace"}),!0}),replaceAll=searchCommand((o,{query:e})=>{if(o.state.readOnly)return!1;let r=e.matchAll(o.state,1e9).map(l=>{let{from:a,to:h}=l;return{from:a,to:h,insert:e.getReplacement(l)}});if(!r.length)return!1;let s=o.state.phrase("replaced $ matches",r.length)+".";return o.dispatch({changes:r,effects:EditorView.announce.of(s),userEvent:"input.replace.all"}),!0});function createSearchPanel(o){return o.state.facet(searchConfigFacet).createPanel(o)}function defaultQuery(o,e){var r,s,l,a,h;let c=o.selection.main,u=c.empty||c.to>c.from+100?"":o.sliceDoc(c.from,c.to);if(e&&!u)return e;let f=o.facet(searchConfigFacet);return new SearchQuery({search:((r=e==null?void 0:e.literal)!==null&&r!==void 0?r:f.literal)?u:u.replace(/\n/g,"\\n"),caseSensitive:(s=e==null?void 0:e.caseSensitive)!==null&&s!==void 0?s:f.caseSensitive,literal:(l=e==null?void 0:e.literal)!==null&&l!==void 0?l:f.literal,regexp:(a=e==null?void 0:e.regexp)!==null&&a!==void 0?a:f.regexp,wholeWord:(h=e==null?void 0:e.wholeWord)!==null&&h!==void 0?h:f.wholeWord})}function getSearchInput(o){let e=getPanel(o,createSearchPanel);return e&&e.dom.querySelector("[main-field]")}function selectSearchInput(o){let e=getSearchInput(o);e&&e==o.root.activeElement&&e.select()}const openSearchPanel=o=>{let e=o.state.field(searchState,!1);if(e&&e.panel){let r=getSearchInput(o);if(r&&r!=o.root.activeElement){let s=defaultQuery(o.state,e.query.spec);s.valid&&o.dispatch({effects:setSearchQuery.of(s)}),r.focus(),r.select()}}else o.dispatch({effects:[togglePanel$1.of(!0),e?setSearchQuery.of(defaultQuery(o.state,e.query.spec)):StateEffect.appendConfig.of(searchExtensions)]});return!0},closeSearchPanel=o=>{let e=o.state.field(searchState,!1);if(!e||!e.panel)return!1;let r=getPanel(o,createSearchPanel);return r&&r.dom.contains(o.root.activeElement)&&o.focus(),o.dispatch({effects:togglePanel$1.of(!1)}),!0},searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence,preventDefault:!0}];class SearchPanel{constructor(e){this.view=e;let r=this.query=e.state.field(searchState).query.spec;this.commit=this.commit.bind(this),this.searchField=crelt("input",{value:r.search,placeholder:phrase(e,"Find"),"aria-label":phrase(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=crelt("input",{value:r.replace,placeholder:phrase(e,"Replace"),"aria-label":phrase(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=crelt("input",{type:"checkbox",name:"case",form:"",checked:r.caseSensitive,onchange:this.commit}),this.reField=crelt("input",{type:"checkbox",name:"re",form:"",checked:r.regexp,onchange:this.commit}),this.wordField=crelt("input",{type:"checkbox",name:"word",form:"",checked:r.wholeWord,onchange:this.commit});function s(l,a,h){return crelt("button",{class:"cm-button",name:l,onclick:a,type:"button"},h)}this.dom=crelt("div",{onkeydown:l=>this.keydown(l),class:"cm-search"},[this.searchField,s("next",()=>findNext(e),[phrase(e,"next")]),s("prev",()=>findPrevious(e),[phrase(e,"previous")]),s("select",()=>selectMatches(e),[phrase(e,"all")]),crelt("label",null,[this.caseField,phrase(e,"match case")]),crelt("label",null,[this.reField,phrase(e,"regexp")]),crelt("label",null,[this.wordField,phrase(e,"by word")]),...e.state.readOnly?[]:[crelt("br"),this.replaceField,s("replace",()=>replaceNext(e),[phrase(e,"replace")]),s("replaceAll",()=>replaceAll(e),[phrase(e,"replace all")])],crelt("button",{name:"close",onclick:()=>closeSearchPanel(e),"aria-label":phrase(e,"close"),type:"button"},["×"])])}commit(){let e=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:setSearchQuery.of(e)}))}keydown(e){runScopeHandlers(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?findPrevious:findNext)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),replaceNext(this.view))}update(e){for(let r of e.transactions)for(let s of r.effects)s.is(setSearchQuery)&&!s.value.eq(this.query)&&this.setQuery(s.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(searchConfigFacet).top}}function phrase(o,e){return o.state.phrase(e)}const AnnounceMargin=30,Break=/[\s\.,:;?!]/;function announceMatch(o,{from:e,to:r}){let s=o.state.doc.lineAt(e),l=o.state.doc.lineAt(r).to,a=Math.max(s.from,e-AnnounceMargin),h=Math.min(l,r+AnnounceMargin),c=o.state.sliceDoc(a,h);if(a!=s.from){for(let u=0;u<AnnounceMargin;u++)if(!Break.test(c[u+1])&&Break.test(c[u])){c=c.slice(u);break}}if(h!=l){for(let u=c.length-1;u>c.length-AnnounceMargin;u--)if(!Break.test(c[u-1])&&Break.test(c[u])){c=c.slice(0,u);break}}return EditorView.announce.of(`${o.state.phrase("current match")}. ${c} ${o.state.phrase("on line")} ${s.number}.`)}const baseTheme$2=EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),searchExtensions=[searchState,Prec.lowest(searchHighlighter),baseTheme$2];class CompletionContext{constructor(e,r,s){this.state=e,this.pos=r,this.explicit=s,this.abortListeners=[]}tokenBefore(e){let r=syntaxTree(this.state).resolveInner(this.pos,-1);for(;r&&e.indexOf(r.name)<0;)r=r.parent;return r?{from:r.from,to:this.pos,text:this.state.sliceDoc(r.from,this.pos),type:r.type}:null}matchBefore(e){let r=this.state.doc.lineAt(this.pos),s=Math.max(r.from,this.pos-250),l=r.text.slice(s-r.from,this.pos-r.from),a=l.search(ensureAnchor(e,!1));return a<0?null:{from:s+a,to:this.pos,text:l.slice(a)}}get aborted(){return this.abortListeners==null}addEventListener(e,r){e=="abort"&&this.abortListeners&&this.abortListeners.push(r)}}function toSet(o){let e=Object.keys(o).join(""),r=/\w/.test(e);return r&&(e=e.replace(/\w/g,"")),`[${r?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function prefixMatch(o){let e=Object.create(null),r=Object.create(null);for(let{label:l}of o){e[l[0]]=!0;for(let a=1;a<l.length;a++)r[l[a]]=!0}let s=toSet(e)+toSet(r)+"*$";return[new RegExp("^"+s),new RegExp(s)]}function completeFromList(o){let e=o.map(l=>typeof l=="string"?{label:l}:l),[r,s]=e.every(l=>/^\w+$/.test(l.label))?[/\w*$/,/\w+$/]:prefixMatch(e);return l=>{let a=l.matchBefore(s);return a||l.explicit?{from:a?a.from:l.pos,options:e,validFor:r}:null}}class Option{constructor(e,r,s,l){this.completion=e,this.source=r,this.match=s,this.score=l}}function cur(o){return o.selection.main.from}function ensureAnchor(o,e){var r;let{source:s}=o,l=e&&s[0]!="^",a=s[s.length-1]!="$";return!l&&!a?o:new RegExp(`${l?"^":""}(?:${s})${a?"$":""}`,(r=o.flags)!==null&&r!==void 0?r:o.ignoreCase?"i":"")}const pickedCompletion=Annotation.define();function insertCompletionText(o,e,r,s){let{main:l}=o.selection,a=r-l.from,h=s-l.from;return Object.assign(Object.assign({},o.changeByRange(c=>c!=l&&r!=s&&o.sliceDoc(c.from+a,c.from+h)!=o.sliceDoc(r,s)?{range:c}:{changes:{from:c.from+a,to:s==l.from?c.to:c.from+h,insert:e},range:EditorSelection.cursor(c.from+a+e.length)})),{userEvent:"input.complete"})}const SourceCache=new WeakMap;function asSource(o){if(!Array.isArray(o))return o;let e=SourceCache.get(o);return e||SourceCache.set(o,e=completeFromList(o)),e}const startCompletionEffect=StateEffect.define(),closeCompletionEffect=StateEffect.define();class FuzzyMatcher{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[];for(let r=0;r<e.length;){let s=codePointAt(e,r),l=codePointSize(s);this.chars.push(s);let a=e.slice(r,r+l),h=a.toUpperCase();this.folded.push(codePointAt(h==a?a.toLowerCase():h,0)),r+=l}this.astral=e.length!=this.chars.length}match(e){if(this.pattern.length==0)return[-100];if(e.length<this.pattern.length)return null;let{chars:r,folded:s,any:l,precise:a,byWord:h}=this;if(r.length==1){let O=codePointAt(e,0),P=codePointSize(O),b=P==e.length?0:-100;if(O!=r[0])if(O==s[0])b+=-200;else return null;return[b,0,P]}let c=e.indexOf(this.pattern);if(c==0)return[e.length==this.pattern.length?0:-100,0,this.pattern.length];let u=r.length,f=0;if(c<0){for(let O=0,P=Math.min(e.length,200);O<P&&f<u;){let b=codePointAt(e,O);(b==r[f]||b==s[f])&&(l[f++]=O),O+=codePointSize(b)}if(f<u)return null}let d=0,p=0,g=!1,m=0,w=-1,S=-1,y=/[a-z]/.test(e),v=!0;for(let O=0,P=Math.min(e.length,200),b=0;O<P&&p<u;){let k=codePointAt(e,O);c<0&&(d<u&&k==r[d]&&(a[d++]=O),m<u&&(k==r[m]||k==s[m]?(m==0&&(w=O),S=O+1,m++):m=0));let x,T=k<255?k>=48&&k<=57||k>=97&&k<=122?2:k>=65&&k<=90?1:0:(x=fromCodePoint(k))!=x.toLowerCase()?1:x!=x.toUpperCase()?2:0;(!O||T==1&&y||b==0&&T!=0)&&(r[p]==k||s[p]==k&&(g=!0)?h[p++]=O:h.length&&(v=!1)),b=T,O+=codePointSize(k)}return p==u&&h[0]==0&&v?this.result(-100+(g?-200:0),h,e):m==u&&w==0?[-200-e.length+(S==e.length?0:-100),0,S]:c>-1?[-700-e.length,c,c+this.pattern.length]:m==u?[-200+-700-e.length,w,S]:p==u?this.result(-100+(g?-200:0)+-700+(v?0:-1100),h,e):r.length==2?null:this.result((l[0]?-700:0)+-200+-1100,l,e)}result(e,r,s){let l=[e-s.length],a=1;for(let h of r){let c=h+(this.astral?codePointSize(codePointAt(s,h)):1);a>1&&l[a-1]==h?l[a-1]=c:(l[a++]=h,l[a++]=c)}return l}}const completionConfig=Facet.define({combine(o){return combineConfig(o,{activateOnTyping:!0,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:defaultPositionInfo,compareCompletions:(e,r)=>e.label.localeCompare(r.label),interactionDelay:75},{defaultKeymap:(e,r)=>e&&r,closeOnBlur:(e,r)=>e&&r,icons:(e,r)=>e&&r,tooltipClass:(e,r)=>s=>joinClass(e(s),r(s)),optionClass:(e,r)=>s=>joinClass(e(s),r(s)),addToOptions:(e,r)=>e.concat(r)})}});function joinClass(o,e){return o?e?o+" "+e:o:e}function defaultPositionInfo(o,e,r,s,l){let a=o.textDirection==Direction.RTL,h=a,c=!1,u="top",f,d,p=e.left-l.left,g=l.right-e.right,m=s.right-s.left,w=s.bottom-s.top;if(h&&p<Math.min(m,g)?h=!1:!h&&g<Math.min(m,p)&&(h=!0),m<=(h?p:g))f=Math.max(l.top,Math.min(r.top,l.bottom-w))-e.top,d=Math.min(400,h?p:g);else{c=!0,d=Math.min(400,(a?e.right:l.right-e.left)-30);let S=l.bottom-e.bottom;S>=w||S>e.top?f=r.bottom-e.top:(u="bottom",f=e.bottom-r.top)}return{style:`${u}: ${f}px; max-width: ${d}px`,class:"cm-completionInfo-"+(c?a?"left-narrow":"right-narrow":h?"left":"right")}}function optionContent(o){let e=o.addToOptions.slice();return o.icons&&e.push({render(r){let s=document.createElement("div");return s.classList.add("cm-completionIcon"),r.type&&s.classList.add(...r.type.split(/\s+/g).map(l=>"cm-completionIcon-"+l)),s.setAttribute("aria-hidden","true"),s},position:20}),e.push({render(r,s,l){let a=document.createElement("span");a.className="cm-completionLabel";let{label:h}=r,c=0;for(let u=1;u<l.length;){let f=l[u++],d=l[u++];f>c&&a.appendChild(document.createTextNode(h.slice(c,f)));let p=a.appendChild(document.createElement("span"));p.appendChild(document.createTextNode(h.slice(f,d))),p.className="cm-completionMatchedText",c=d}return c<h.length&&a.appendChild(document.createTextNode(h.slice(c))),a},position:50},{render(r){if(!r.detail)return null;let s=document.createElement("span");return s.className="cm-completionDetail",s.textContent=r.detail,s},position:80}),e.sort((r,s)=>r.position-s.position).map(r=>r.render)}function rangeAroundSelected(o,e,r){if(o<=r)return{from:0,to:o};if(e<0&&(e=0),e<=o>>1){let l=Math.floor(e/r);return{from:l*r,to:(l+1)*r}}let s=Math.floor((o-e)/r);return{from:o-(s+1)*r,to:o-s*r}}class CompletionTooltip{constructor(e,r,s){this.view=e,this.stateField=r,this.applyCompletion=s,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:u=>this.placeInfo(u),key:this},this.space=null,this.currentClass="";let l=e.state.field(r),{options:a,selected:h}=l.open,c=e.state.facet(completionConfig);this.optionContent=optionContent(c),this.optionClass=c.optionClass,this.tooltipClass=c.tooltipClass,this.range=rangeAroundSelected(a.length,h,c.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",u=>{for(let f=u.target,d;f&&f!=this.dom;f=f.parentNode)if(f.nodeName=="LI"&&(d=/-(\d+)$/.exec(f.id))&&+d[1]<a.length){this.applyCompletion(e,a[+d[1]]),u.preventDefault();return}}),this.dom.addEventListener("focusout",u=>{let f=e.state.field(this.stateField,!1);f&&f.tooltip&&e.state.facet(completionConfig).closeOnBlur&&u.relatedTarget!=e.contentDOM&&e.dispatch({effects:closeCompletionEffect.of(null)})}),this.list=this.dom.appendChild(this.createListBox(a,l.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}mount(){this.updateSel()}update(e){var r,s,l;let a=e.state.field(this.stateField),h=e.startState.field(this.stateField);this.updateTooltipClass(e.state),a!=h&&(this.updateSel(),((r=a.open)===null||r===void 0?void 0:r.disabled)!=((s=h.open)===null||s===void 0?void 0:s.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!(!((l=a.open)===null||l===void 0)&&l.disabled)))}updateTooltipClass(e){let r=this.tooltipClass(e);if(r!=this.currentClass){for(let s of this.currentClass.split(" "))s&&this.dom.classList.remove(s);for(let s of r.split(" "))s&&this.dom.classList.add(s);this.currentClass=r}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),r=e.open;if((r.selected>-1&&r.selected<this.range.from||r.selected>=this.range.to)&&(this.range=rangeAroundSelected(r.options.length,r.selected,this.view.state.facet(completionConfig).maxRenderedOptions),this.list.remove(),this.list=this.dom.appendChild(this.createListBox(r.options,e.id,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})),this.updateSelectedOption(r.selected)){this.destroyInfo();let{completion:s}=r.options[r.selected],{info:l}=s;if(!l)return;let a=typeof l=="string"?document.createTextNode(l):l(s);if(!a)return;"then"in a?a.then(h=>{h&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(h,s)}).catch(h=>logException(this.view.state,h,"completion info")):this.addInfoPane(a,s)}}addInfoPane(e,r){this.destroyInfo();let s=this.info=document.createElement("div");if(s.className="cm-tooltip cm-completionInfo",e.nodeType!=null)s.appendChild(e),this.infoDestroy=null;else{let{dom:l,destroy:a}=e;s.appendChild(l),this.infoDestroy=a||null}this.dom.appendChild(s),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let r=null;for(let s=this.list.firstChild,l=this.range.from;s;s=s.nextSibling,l++)s.nodeName!="LI"||!s.id?l--:l==e?s.hasAttribute("aria-selected")||(s.setAttribute("aria-selected","true"),r=s):s.hasAttribute("aria-selected")&&s.removeAttribute("aria-selected");return r&&scrollIntoView(this.list,r),r}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let r=this.dom.getBoundingClientRect(),s=this.info.getBoundingClientRect(),l=e.getBoundingClientRect(),a=this.space;if(!a){let h=this.dom.ownerDocument.defaultView||window;a={left:0,top:0,right:h.innerWidth,bottom:h.innerHeight}}return l.top>Math.min(a.bottom,r.bottom)-10||l.bottom<Math.max(a.top,r.top)+10?null:this.view.state.facet(completionConfig).positionInfo(this.view,r,l,s,a)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,r,s){const l=document.createElement("ul");l.id=r,l.setAttribute("role","listbox"),l.setAttribute("aria-expanded","true"),l.setAttribute("aria-label",this.view.state.phrase("Completions"));let a=null;for(let h=s.from;h<s.to;h++){let{completion:c,match:u}=e[h],{section:f}=c;if(f){let g=typeof f=="string"?f:f.name;if(g!=a&&(h>s.from||s.from==0))if(a=g,typeof f!="string"&&f.header)l.appendChild(f.header(f));else{let m=l.appendChild(document.createElement("completion-section"));m.textContent=g}}const d=l.appendChild(document.createElement("li"));d.id=r+"-"+h,d.setAttribute("role","option");let p=this.optionClass(c);p&&(d.className=p);for(let g of this.optionContent){let m=g(c,this.view.state,u);m&&d.appendChild(m)}}return s.from&&l.classList.add("cm-completionListIncompleteTop"),s.to<e.length&&l.classList.add("cm-completionListIncompleteBottom"),l}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function completionTooltip(o,e){return r=>new CompletionTooltip(r,o,e)}function scrollIntoView(o,e){let r=o.getBoundingClientRect(),s=e.getBoundingClientRect();s.top<r.top?o.scrollTop-=r.top-s.top:s.bottom>r.bottom&&(o.scrollTop+=s.bottom-r.bottom)}function score(o){return(o.boost||0)*100+(o.apply?10:0)+(o.info?5:0)+(o.type?1:0)}function sortOptions(o,e){let r=[],s=null,l=u=>{r.push(u);let{section:f}=u.completion;if(f){s||(s=[]);let d=typeof f=="string"?f:f.name;s.some(p=>p.name==d)||s.push(typeof f=="string"?{name:d}:f)}};for(let u of o)if(u.hasResult())if(u.result.filter===!1){let f=u.result.getMatch;for(let d of u.result.options){let p=[1e9-r.length];if(f)for(let g of f(d))p.push(g);l(new Option(d,u.source,p,p[0]))}}else{let f=new FuzzyMatcher(e.sliceDoc(u.from,u.to)),d;for(let p of u.result.options)(d=f.match(p.label))&&l(new Option(p,u.source,d,d[0]+(p.boost||0)))}if(s){let u=Object.create(null),f=0,d=(p,g)=>{var m,w;return((m=p.rank)!==null&&m!==void 0?m:1e9)-((w=g.rank)!==null&&w!==void 0?w:1e9)||(p.name<g.name?-1:1)};for(let p of s.sort(d))f-=1e5,u[p.name]=f;for(let p of r){let{section:g}=p.completion;g&&(p.score+=u[typeof g=="string"?g:g.name])}}let a=[],h=null,c=e.facet(completionConfig).compareCompletions;for(let u of r.sort((f,d)=>d.score-f.score||c(f.completion,d.completion))){let f=u.completion;!h||h.label!=f.label||h.detail!=f.detail||h.type!=null&&f.type!=null&&h.type!=f.type||h.apply!=f.apply||h.boost!=f.boost?a.push(u):score(u.completion)>score(h)&&(a[a.length-1]=u),h=u.completion}return a}class CompletionDialog{constructor(e,r,s,l,a,h){this.options=e,this.attrs=r,this.tooltip=s,this.timestamp=l,this.selected=a,this.disabled=h}setSelected(e,r){return e==this.selected||e>=this.options.length?this:new CompletionDialog(this.options,makeAttrs(r,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,r,s,l,a){let h=sortOptions(e,r);if(!h.length)return l&&e.some(u=>u.state==1)?new CompletionDialog(l.options,l.attrs,l.tooltip,l.timestamp,l.selected,!0):null;let c=r.facet(completionConfig).selectOnOpen?0:-1;if(l&&l.selected!=c&&l.selected!=-1){let u=l.options[l.selected].completion;for(let f=0;f<h.length;f++)if(h[f].completion==u){c=f;break}}return new CompletionDialog(h,makeAttrs(s,c),{pos:e.reduce((u,f)=>f.hasResult()?Math.min(u,f.from):u,1e8),create:completionTooltip(completionState,applyCompletion),above:a.aboveCursor},l?l.timestamp:Date.now(),c,!1)}map(e){return new CompletionDialog(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class CompletionState{constructor(e,r,s){this.active=e,this.id=r,this.open=s}static start(){return new CompletionState(none,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:r}=e,s=r.facet(completionConfig),a=(s.override||r.languageDataAt("autocomplete",cur(r)).map(asSource)).map(c=>(this.active.find(f=>f.source==c)||new ActiveSource(c,this.active.some(f=>f.state!=0)?1:0)).update(e,s));a.length==this.active.length&&a.every((c,u)=>c==this.active[u])&&(a=this.active);let h=this.open;h&&e.docChanged&&(h=h.map(e.changes)),e.selection||a.some(c=>c.hasResult()&&e.changes.touchesRange(c.from,c.to))||!sameResults(a,this.active)?h=CompletionDialog.build(a,r,this.id,h,s):h&&h.disabled&&!a.some(c=>c.state==1)&&(h=null),!h&&a.every(c=>c.state!=1)&&a.some(c=>c.hasResult())&&(a=a.map(c=>c.hasResult()?new ActiveSource(c.source,0):c));for(let c of e.effects)c.is(setSelectedEffect)&&(h=h&&h.setSelected(c.value,this.id));return a==this.active&&h==this.open?this:new CompletionState(a,this.id,h)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:baseAttrs}}function sameResults(o,e){if(o==e)return!0;for(let r=0,s=0;;){for(;r<o.length&&!o[r].hasResult;)r++;for(;s<e.length&&!e[s].hasResult;)s++;let l=r==o.length,a=s==e.length;if(l||a)return l==a;if(o[r++].result!=e[s++].result)return!1}}const baseAttrs={"aria-autocomplete":"list"};function makeAttrs(o,e){let r={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":o};return e>-1&&(r["aria-activedescendant"]=o+"-"+e),r}const none=[];function getUserEvent(o){return o.isUserEvent("input.type")?"input":o.isUserEvent("delete.backward")?"delete":null}class ActiveSource{constructor(e,r,s=-1){this.source=e,this.state=r,this.explicitPos=s}hasResult(){return!1}update(e,r){let s=getUserEvent(e),l=this;s?l=l.handleUserEvent(e,s,r):e.docChanged?l=l.handleChange(e):e.selection&&l.state!=0&&(l=new ActiveSource(l.source,0));for(let a of e.effects)if(a.is(startCompletionEffect))l=new ActiveSource(l.source,1,a.value?cur(e.state):-1);else if(a.is(closeCompletionEffect))l=new ActiveSource(l.source,0);else if(a.is(setActiveEffect))for(let h of a.value)h.source==l.source&&(l=h);return l}handleUserEvent(e,r,s){return r=="delete"||!s.activateOnTyping?this.map(e.changes):new ActiveSource(this.source,1)}handleChange(e){return e.changes.touchesRange(cur(e.startState))?new ActiveSource(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new ActiveSource(this.source,this.state,e.mapPos(this.explicitPos))}}class ActiveResult extends ActiveSource{constructor(e,r,s,l,a){super(e,2,r),this.result=s,this.from=l,this.to=a}hasResult(){return!0}handleUserEvent(e,r,s){var l;let a=e.changes.mapPos(this.from),h=e.changes.mapPos(this.to,1),c=cur(e.state);if((this.explicitPos<0?c<=a:c<this.from)||c>h||r=="delete"&&cur(e.startState)==this.from)return new ActiveSource(this.source,r=="input"&&s.activateOnTyping?1:0);let u=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),f;return checkValid(this.result.validFor,e.state,a,h)?new ActiveResult(this.source,u,this.result,a,h):this.result.update&&(f=this.result.update(this.result,a,h,new CompletionContext(e.state,c,u>=0)))?new ActiveResult(this.source,u,f,f.from,(l=f.to)!==null&&l!==void 0?l:cur(e.state)):new ActiveSource(this.source,1,u)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new ActiveSource(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new ActiveResult(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}function checkValid(o,e,r,s){if(!o)return!1;let l=e.sliceDoc(r,s);return typeof o=="function"?o(l,r,s,e):ensureAnchor(o,!0).test(l)}const setActiveEffect=StateEffect.define({map(o,e){return o.map(r=>r.map(e))}}),setSelectedEffect=StateEffect.define(),completionState=StateField.define({create(){return CompletionState.start()},update(o,e){return o.update(e)},provide:o=>[showTooltip.from(o,e=>e.tooltip),EditorView.contentAttributes.from(o,e=>e.attrs)]});function applyCompletion(o,e){const r=e.completion.apply||e.completion.label;let s=o.state.field(completionState).active.find(l=>l.source==e.source);return s instanceof ActiveResult?(typeof r=="string"?o.dispatch(Object.assign(Object.assign({},insertCompletionText(o.state,r,s.from,s.to)),{annotations:pickedCompletion.of(e.completion)})):r(o,e.completion,s.from,s.to),!0):!1}function moveCompletionSelection(o,e="option"){return r=>{let s=r.state.field(completionState,!1);if(!s||!s.open||s.open.disabled||Date.now()-s.open.timestamp<r.state.facet(completionConfig).interactionDelay)return!1;let l=1,a;e=="page"&&(a=getTooltip(r,s.open.tooltip))&&(l=Math.max(2,Math.floor(a.dom.offsetHeight/a.dom.querySelector("li").offsetHeight)-1));let{length:h}=s.open.options,c=s.open.selected>-1?s.open.selected+l*(o?1:-1):o?0:h-1;return c<0?c=e=="page"?0:h-1:c>=h&&(c=e=="page"?h-1:0),r.dispatch({effects:setSelectedEffect.of(c)}),!0}}const acceptCompletion=o=>{let e=o.state.field(completionState,!1);return o.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<o.state.facet(completionConfig).interactionDelay?!1:applyCompletion(o,e.open.options[e.open.selected])},startCompletion=o=>o.state.field(completionState,!1)?(o.dispatch({effects:startCompletionEffect.of(!0)}),!0):!1,closeCompletion=o=>{let e=o.state.field(completionState,!1);return!e||!e.active.some(r=>r.state!=0)?!1:(o.dispatch({effects:closeCompletionEffect.of(null)}),!0)};class RunningQuery{constructor(e,r){this.active=e,this.context=r,this.time=Date.now(),this.updates=[],this.done=void 0}}const DebounceTime=50,MaxUpdateCount=50,MinAbortTime=1e3,completionPlugin=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of o.state.field(completionState).active)e.state==1&&this.startQuery(e)}update(o){let e=o.state.field(completionState);if(!o.selectionSet&&!o.docChanged&&o.startState.field(completionState)==e)return;let r=o.transactions.some(s=>(s.selection||s.docChanged)&&!getUserEvent(s));for(let s=0;s<this.running.length;s++){let l=this.running[s];if(r||l.updates.length+o.transactions.length>MaxUpdateCount&&Date.now()-l.time>MinAbortTime){for(let a of l.context.abortListeners)try{a()}catch(h){logException(this.view.state,h)}l.context.abortListeners=null,this.running.splice(s--,1)}else l.updates.push(...o.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(s=>s.state==1&&!this.running.some(l=>l.active.source==s.source))?setTimeout(()=>this.startUpdate(),DebounceTime):-1,this.composing!=0)for(let s of o.transactions)getUserEvent(s)=="input"?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:o}=this.view,e=o.field(completionState);for(let r of e.active)r.state==1&&!this.running.some(s=>s.active.source==r.source)&&this.startQuery(r)}startQuery(o){let{state:e}=this.view,r=cur(e),s=new CompletionContext(e,r,o.explicitPos==r),l=new RunningQuery(o,s);this.running.push(l),Promise.resolve(o.source(s)).then(a=>{l.context.aborted||(l.done=a||null,this.scheduleAccept())},a=>{this.view.dispatch({effects:closeCompletionEffect.of(null)}),logException(this.view.state,a)})}scheduleAccept(){this.running.every(o=>o.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),DebounceTime))}accept(){var o;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],r=this.view.state.facet(completionConfig);for(let s=0;s<this.running.length;s++){let l=this.running[s];if(l.done===void 0)continue;if(this.running.splice(s--,1),l.done){let h=new ActiveResult(l.active.source,l.active.explicitPos,l.done,l.done.from,(o=l.done.to)!==null&&o!==void 0?o:cur(l.updates.length?l.updates[0].startState:this.view.state));for(let c of l.updates)h=h.update(c,r);if(h.hasResult()){e.push(h);continue}}let a=this.view.state.field(completionState).active.find(h=>h.source==l.active.source);if(a&&a.state==1)if(l.done==null){let h=new ActiveSource(l.active.source,0);for(let c of l.updates)h=h.update(c,r);h.state!=1&&e.push(h)}else this.startQuery(a)}e.length&&this.view.dispatch({effects:setActiveEffect.of(e)})}},{eventHandlers:{blur(o){let e=this.view.state.field(completionState,!1);if(e&&e.tooltip&&this.view.state.facet(completionConfig).closeOnBlur){let r=e.open&&getTooltip(this.view,e.open.tooltip);(!r||!r.dom.contains(o.relatedTarget))&&this.view.dispatch({effects:closeCompletionEffect.of(null)})}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:startCompletionEffect.of(!1)}),20),this.composing=0}}}),baseTheme$1=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),defaults={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},closeBracketEffect=StateEffect.define({map(o,e){let r=e.mapPos(o,-1,MapMode.TrackAfter);return r??void 0}}),closedBracket=new class extends RangeValue{};closedBracket.startSide=1;closedBracket.endSide=-1;const bracketState=StateField.define({create(){return RangeSet.empty},update(o,e){if(e.selection){let r=e.state.doc.lineAt(e.selection.main.head).from,s=e.startState.doc.lineAt(e.startState.selection.main.head).from;r!=e.changes.mapPos(s,-1)&&(o=RangeSet.empty)}o=o.map(e.changes);for(let r of e.effects)r.is(closeBracketEffect)&&(o=o.update({add:[closedBracket.range(r.value,r.value+1)]}));return o}});function closeBrackets(){return[inputHandler,bracketState]}const definedClosing="()[]{}<>";function closing(o){for(let e=0;e<definedClosing.length;e+=2)if(definedClosing.charCodeAt(e)==o)return definedClosing.charAt(e+1);return fromCodePoint(o<128?o:o+1)}function config(o,e){return o.languageDataAt("closeBrackets",e)[0]||defaults}const android=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),inputHandler=EditorView.inputHandler.of((o,e,r,s)=>{if((android?o.composing:o.compositionStarted)||o.state.readOnly)return!1;let l=o.state.selection.main;if(s.length>2||s.length==2&&codePointSize(codePointAt(s,0))==1||e!=l.from||r!=l.to)return!1;let a=insertBracket(o.state,s);return a?(o.dispatch(a),!0):!1}),deleteBracketPair=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let s=config(o,o.selection.main.head).brackets||defaults.brackets,l=null,a=o.changeByRange(h=>{if(h.empty){let c=prevChar(o.doc,h.head);for(let u of s)if(u==c&&nextChar(o.doc,h.head)==closing(codePointAt(u,0)))return{changes:{from:h.head-u.length,to:h.head+u.length},range:EditorSelection.cursor(h.head-u.length)}}return{range:l=h}});return l||e(o.update(a,{scrollIntoView:!0,userEvent:"delete.backward"})),!l},closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(o,e){let r=config(o,o.selection.main.head),s=r.brackets||defaults.brackets;for(let l of s){let a=closing(codePointAt(l,0));if(e==l)return a==l?handleSame(o,l,s.indexOf(l+l+l)>-1,r):handleOpen(o,l,a,r.before||defaults.before);if(e==a&&closedBracketAt(o,o.selection.main.from))return handleClose(o,l,a)}return null}function closedBracketAt(o,e){let r=!1;return o.field(bracketState).between(0,o.doc.length,s=>{s==e&&(r=!0)}),r}function nextChar(o,e){let r=o.sliceString(e,e+2);return r.slice(0,codePointSize(codePointAt(r,0)))}function prevChar(o,e){let r=o.sliceString(e-2,e);return codePointSize(codePointAt(r,0))==r.length?r:r.slice(1)}function handleOpen(o,e,r,s){let l=null,a=o.changeByRange(h=>{if(!h.empty)return{changes:[{insert:e,from:h.from},{insert:r,from:h.to}],effects:closeBracketEffect.of(h.to+e.length),range:EditorSelection.range(h.anchor+e.length,h.head+e.length)};let c=nextChar(o.doc,h.head);return!c||/\s/.test(c)||s.indexOf(c)>-1?{changes:{insert:e+r,from:h.head},effects:closeBracketEffect.of(h.head+e.length),range:EditorSelection.cursor(h.head+e.length)}:{range:l=h}});return l?null:o.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function handleClose(o,e,r){let s=null,l=o.changeByRange(a=>a.empty&&nextChar(o.doc,a.head)==r?{changes:{from:a.head,to:a.head+r.length,insert:r},range:EditorSelection.cursor(a.head+r.length)}:s={range:a});return s?null:o.update(l,{scrollIntoView:!0,userEvent:"input.type"})}function handleSame(o,e,r,s){let l=s.stringPrefixes||defaults.stringPrefixes,a=null,h=o.changeByRange(c=>{if(!c.empty)return{changes:[{insert:e,from:c.from},{insert:e,from:c.to}],effects:closeBracketEffect.of(c.to+e.length),range:EditorSelection.range(c.anchor+e.length,c.head+e.length)};let u=c.head,f=nextChar(o.doc,u),d;if(f==e){if(nodeStart(o,u))return{changes:{insert:e+e,from:u},effects:closeBracketEffect.of(u+e.length),range:EditorSelection.cursor(u+e.length)};if(closedBracketAt(o,u)){let g=r&&o.sliceDoc(u,u+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:u,to:u+g.length,insert:g},range:EditorSelection.cursor(u+g.length)}}}else{if(r&&o.sliceDoc(u-2*e.length,u)==e+e&&(d=canStartStringAt(o,u-2*e.length,l))>-1&&nodeStart(o,d))return{changes:{insert:e+e+e+e,from:u},effects:closeBracketEffect.of(u+e.length),range:EditorSelection.cursor(u+e.length)};if(o.charCategorizer(u)(f)!=CharCategory.Word&&canStartStringAt(o,u,l)>-1&&!probablyInString(o,u,e,l))return{changes:{insert:e+e,from:u},effects:closeBracketEffect.of(u+e.length),range:EditorSelection.cursor(u+e.length)}}return{range:a=c}});return a?null:o.update(h,{scrollIntoView:!0,userEvent:"input.type"})}function nodeStart(o,e){let r=syntaxTree(o).resolveInner(e+1);return r.parent&&r.from==e}function probablyInString(o,e,r,s){let l=syntaxTree(o).resolveInner(e,-1),a=s.reduce((h,c)=>Math.max(h,c.length),0);for(let h=0;h<5;h++){let c=o.sliceDoc(l.from,Math.min(l.to,l.from+r.length+a)),u=c.indexOf(r);if(!u||u>-1&&s.indexOf(c.slice(0,u))>-1){let d=l.firstChild;for(;d&&d.from==l.from&&d.to-d.from>r.length+u;){if(o.sliceDoc(d.to-r.length,d.to)==r)return!1;d=d.firstChild}return!0}let f=l.to==e&&l.parent;if(!f)break;l=f}return!1}function canStartStringAt(o,e,r){let s=o.charCategorizer(e);if(s(o.sliceDoc(e-1,e))!=CharCategory.Word)return e;for(let l of r){let a=e-l.length;if(o.sliceDoc(a,e)==l&&s(o.sliceDoc(a-1,a))!=CharCategory.Word)return a}return-1}function autocompletion(o={}){return[completionState,completionConfig.of(o),completionPlugin,completionKeymapExt,baseTheme$1]}const completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(!0)},{key:"ArrowUp",run:moveCompletionSelection(!1)},{key:"PageDown",run:moveCompletionSelection(!0,"page")},{key:"PageUp",run:moveCompletionSelection(!1,"page")},{key:"Enter",run:acceptCompletion}],completionKeymapExt=Prec.highest(keymap.computeN([completionConfig],o=>o.facet(completionConfig).defaultKeymap?[completionKeymap]:[]));class SelectedDiagnostic{constructor(e,r,s){this.from=e,this.to=r,this.diagnostic=s}}class LintState{constructor(e,r,s){this.diagnostics=e,this.panel=r,this.selected=s}static init(e,r,s){let l=e,a=s.facet(lintConfig).markerFilter;a&&(l=a(l));let h=Decoration.set(l.map(c=>c.from==c.to||c.from==c.to-1&&s.doc.lineAt(c.from).to==c.from?Decoration.widget({widget:new DiagnosticWidget(c),diagnostic:c}).range(c.from):Decoration.mark({attributes:{class:"cm-lintRange cm-lintRange-"+c.severity+(c.markClass?" "+c.markClass:"")},diagnostic:c}).range(c.from,c.to)),!0);return new LintState(h,r,findDiagnostic(h))}}function findDiagnostic(o,e=null,r=0){let s=null;return o.between(r,1e9,(l,a,{spec:h})=>{if(!(e&&h.diagnostic!=e))return s=new SelectedDiagnostic(l,a,h.diagnostic),!1}),s}function hideTooltip(o,e){let r=o.startState.doc.lineAt(e.pos);return!!(o.effects.some(s=>s.is(setDiagnosticsEffect))||o.changes.touchesRange(r.from,r.to))}function maybeEnableLint(o,e){return o.field(lintState,!1)?e:e.concat(StateEffect.appendConfig.of(lintExtensions))}const setDiagnosticsEffect=StateEffect.define(),togglePanel=StateEffect.define(),movePanelSelection=StateEffect.define(),lintState=StateField.define({create(){return new LintState(Decoration.none,null,null)},update(o,e){if(e.docChanged){let r=o.diagnostics.map(e.changes),s=null;if(o.selected){let l=e.changes.mapPos(o.selected.from,1);s=findDiagnostic(r,o.selected.diagnostic,l)||findDiagnostic(r,null,l)}o=new LintState(r,o.panel,s)}for(let r of e.effects)r.is(setDiagnosticsEffect)?o=LintState.init(r.value,o.panel,e.state):r.is(togglePanel)?o=new LintState(o.diagnostics,r.value?LintPanel.open:null,o.selected):r.is(movePanelSelection)&&(o=new LintState(o.diagnostics,o.panel,r.value));return o},provide:o=>[showPanel.from(o,e=>e.panel),EditorView.decorations.from(o,e=>e.diagnostics)]}),activeMark=Decoration.mark({class:"cm-lintRange cm-lintRange-active"});function lintTooltip(o,e,r){let{diagnostics:s}=o.state.field(lintState),l=[],a=2e8,h=0;s.between(e-(r<0?1:0),e+(r>0?1:0),(u,f,{spec:d})=>{e>=u&&e<=f&&(u==f||(e>u||r>0)&&(e<f||r<0))&&(l.push(d.diagnostic),a=Math.min(u,a),h=Math.max(f,h))});let c=o.state.facet(lintConfig).tooltipFilter;return c&&(l=c(l)),l.length?{pos:a,end:h,above:o.state.doc.lineAt(a).to<h,create(){return{dom:diagnosticsTooltip(o,l)}}}:null}function diagnosticsTooltip(o,e){return crelt("ul",{class:"cm-tooltip-lint"},e.map(r=>renderDiagnostic(o,r,!1)))}const openLintPanel=o=>{let e=o.state.field(lintState,!1);(!e||!e.panel)&&o.dispatch({effects:maybeEnableLint(o.state,[togglePanel.of(!0)])});let r=getPanel(o,LintPanel.open);return r&&r.dom.querySelector(".cm-panel-lint ul").focus(),!0},closeLintPanel=o=>{let e=o.state.field(lintState,!1);return!e||!e.panel?!1:(o.dispatch({effects:togglePanel.of(!1)}),!0)},nextDiagnostic=o=>{let e=o.state.field(lintState,!1);if(!e)return!1;let r=o.state.selection.main,s=e.diagnostics.iter(r.to+1);return!s.value&&(s=e.diagnostics.iter(0),!s.value||s.from==r.from&&s.to==r.to)?!1:(o.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0}),!0)},lintKeymap=[{key:"Mod-Shift-m",run:openLintPanel,preventDefault:!0},{key:"F8",run:nextDiagnostic}],lintConfig=Facet.define({combine(o){return Object.assign({sources:o.map(e=>e.source)},combineConfig(o.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(e,r)=>e?r?s=>e(s)||r(s):e:r}))}});function assignKeys(o){let e=[];if(o)e:for(let{name:r}of o){for(let s=0;s<r.length;s++){let l=r[s];if(/[a-zA-Z]/.test(l)&&!e.some(a=>a.toLowerCase()==l.toLowerCase())){e.push(l);continue e}}e.push("")}return e}function renderDiagnostic(o,e,r){var s;let l=r?assignKeys(e.actions):[];return crelt("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},crelt("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(s=e.actions)===null||s===void 0?void 0:s.map((a,h)=>{let c=!1,u=g=>{if(g.preventDefault(),c)return;c=!0;let m=findDiagnostic(o.state.field(lintState).diagnostics,e);m&&a.apply(o,m.from,m.to)},{name:f}=a,d=l[h]?f.indexOf(l[h]):-1,p=d<0?f:[f.slice(0,d),crelt("u",f.slice(d,d+1)),f.slice(d+1)];return crelt("button",{type:"button",class:"cm-diagnosticAction",onclick:u,onmousedown:u,"aria-label":` Action: ${f}${d<0?"":` (access key "${l[h]})"`}.`},p)}),e.source&&crelt("div",{class:"cm-diagnosticSource"},e.source))}class DiagnosticWidget extends WidgetType{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return crelt("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class PanelItem{constructor(e,r){this.diagnostic=r,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=renderDiagnostic(e,r,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class LintPanel{constructor(e){this.view=e,this.items=[];let r=l=>{if(l.keyCode==27)closeLintPanel(this.view),this.view.focus();else if(l.keyCode==38||l.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(l.keyCode==40||l.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(l.keyCode==36)this.moveSelection(0);else if(l.keyCode==35)this.moveSelection(this.items.length-1);else if(l.keyCode==13)this.view.focus();else if(l.keyCode>=65&&l.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:a}=this.items[this.selectedIndex],h=assignKeys(a.actions);for(let c=0;c<h.length;c++)if(h[c].toUpperCase().charCodeAt(0)==l.keyCode){let u=findDiagnostic(this.view.state.field(lintState).diagnostics,a);u&&a.actions[c].apply(e,u.from,u.to)}}else return;l.preventDefault()},s=l=>{for(let a=0;a<this.items.length;a++)this.items[a].dom.contains(l.target)&&this.moveSelection(a)};this.list=crelt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:r,onclick:s}),this.dom=crelt("div",{class:"cm-panel-lint"},this.list,crelt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>closeLintPanel(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(lintState).selected;if(!e)return-1;for(let r=0;r<this.items.length;r++)if(this.items[r].diagnostic==e.diagnostic)return r;return-1}update(){let{diagnostics:e,selected:r}=this.view.state.field(lintState),s=0,l=!1,a=null;for(e.between(0,this.view.state.doc.length,(h,c,{spec:u})=>{let f=-1,d;for(let p=s;p<this.items.length;p++)if(this.items[p].diagnostic==u.diagnostic){f=p;break}f<0?(d=new PanelItem(this.view,u.diagnostic),this.items.splice(s,0,d),l=!0):(d=this.items[f],f>s&&(this.items.splice(s,f-s),l=!0)),r&&d.diagnostic==r.diagnostic?d.dom.hasAttribute("aria-selected")||(d.dom.setAttribute("aria-selected","true"),a=d):d.dom.hasAttribute("aria-selected")&&d.dom.removeAttribute("aria-selected"),s++});s<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)l=!0,this.items.pop();this.items.length==0&&(this.items.push(new PanelItem(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),l=!0),a?(this.list.setAttribute("aria-activedescendant",a.id),this.view.requestMeasure({key:this,read:()=>({sel:a.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:h,panel:c})=>{h.top<c.top?this.list.scrollTop-=c.top-h.top:h.bottom>c.bottom&&(this.list.scrollTop+=h.bottom-c.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),l&&this.sync()}sync(){let e=this.list.firstChild;function r(){let s=e;e=s.nextSibling,s.remove()}for(let s of this.items)if(s.dom.parentNode==this.list){for(;e!=s.dom;)r();e=s.dom.nextSibling}else this.list.insertBefore(s.dom,e);for(;e;)r()}moveSelection(e){if(this.selectedIndex<0)return;let r=this.view.state.field(lintState),s=findDiagnostic(r.diagnostics,this.items[e].diagnostic);s&&this.view.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:!0,effects:movePanelSelection.of(s)})}static open(e){return new LintPanel(e)}}function svg(o,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(o)}</svg>')`}function underline(o){return svg(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${o}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const baseTheme=EditorView.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:underline("#d11")},".cm-lintRange-warning":{backgroundImage:underline("orange")},".cm-lintRange-info":{backgroundImage:underline("#999")},".cm-lintRange-hint":{backgroundImage:underline("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),lintExtensions=[lintState,EditorView.decorations.compute([lintState],o=>{let{selected:e,panel:r}=o.field(lintState);return!e||!r||e.from==e.to?Decoration.none:Decoration.set([activeMark.range(e.from,e.to)])}),hoverTooltip(lintTooltip,{hideOn:hideTooltip}),baseTheme],basicSetup=(()=>[lineNumbers(),highlightActiveLineGutter(),highlightSpecialChars(),history(),foldGutter(),drawSelection(),dropCursor(),EditorState.allowMultipleSelections.of(!0),indentOnInput(),syntaxHighlighting(defaultHighlightStyle,{fallback:!0}),bracketMatching(),closeBrackets(),autocompletion(),rectangularSelection(),crosshairCursor(),highlightActiveLine(),highlightSelectionMatches(),keymap.of([...closeBracketsKeymap,...defaultKeymap,...searchKeymap,...historyKeymap,...foldKeymap,...completionKeymap,...lintKeymap])])();class Stack{constructor(e,r,s,l,a,h,c,u,f,d=0,p){this.p=e,this.stack=r,this.state=s,this.reducePos=l,this.pos=a,this.score=h,this.buffer=c,this.bufferBase=u,this.curContext=f,this.lookAhead=d,this.parent=p}toString(){return`[${this.stack.filter((e,r)=>r%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,r,s=0){let l=e.parser.context;return new Stack(e,[],r,s,s,0,[],0,l?new StackContext(l,l.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,r){this.stack.push(this.state,r,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var r;let s=e>>19,l=e&65535,{parser:a}=this.p,h=a.dynamicPrecedence(l);if(h&&(this.score+=h),s==0){this.pushState(a.getGoto(this.state,l,!0),this.reducePos),l<a.minRepeatTerm&&this.storeNode(l,this.reducePos,this.reducePos,4,!0),this.reduceContext(l,this.reducePos);return}let c=this.stack.length-(s-1)*3-(e&262144?6:0),u=c?this.stack[c-2]:this.p.ranges[0].from,f=this.reducePos-u;f>=2e3&&!(!((r=this.p.parser.nodeSet.types[l])===null||r===void 0)&&r.isAnonymous)&&(u==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=f):this.p.lastBigReductionSize<f&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=u,this.p.lastBigReductionSize=f));let d=c?this.stack[c-1]:0,p=this.bufferBase+this.buffer.length-d;if(l<a.minRepeatTerm||e&131072){let g=a.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(l,u,g,p+4,!0)}if(e&262144)this.state=this.stack[c];else{let g=this.stack[c-3];this.state=a.getGoto(g,l,!0)}for(;this.stack.length>c;)this.stack.pop();this.reduceContext(l,u)}storeNode(e,r,s,l=4,a=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let h=this,c=this.buffer.length;if(c==0&&h.parent&&(c=h.bufferBase-h.parent.bufferBase,h=h.parent),c>0&&h.buffer[c-4]==0&&h.buffer[c-1]>-1){if(r==s)return;if(h.buffer[c-2]>=r){h.buffer[c-2]=s;return}}}if(!a||this.pos==s)this.buffer.push(e,r,s,l);else{let h=this.buffer.length;if(h>0&&this.buffer[h-4]!=0)for(;h>0&&this.buffer[h-2]>s;)this.buffer[h]=this.buffer[h-4],this.buffer[h+1]=this.buffer[h-3],this.buffer[h+2]=this.buffer[h-2],this.buffer[h+3]=this.buffer[h-1],h-=4,l>4&&(l-=4);this.buffer[h]=e,this.buffer[h+1]=r,this.buffer[h+2]=s,this.buffer[h+3]=l}}shift(e,r,s){let l=this.pos;if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=s,this.shiftContext(r,l),r<=this.p.parser.maxNode&&this.buffer.push(r,l,s,4);else{let a=e,{parser:h}=this.p;(s>this.pos||r<=h.maxNode)&&(this.pos=s,h.stateFlag(a,1)||(this.reducePos=s)),this.pushState(a,l),this.shiftContext(r,l),r<=h.maxNode&&this.buffer.push(r,l,s,4)}}apply(e,r,s){e&65536?this.reduce(e):this.shift(e,r,s)}useNode(e,r){let s=this.p.reused.length-1;(s<0||this.p.reused[s]!=e)&&(this.p.reused.push(e),s++);let l=this.pos;this.reducePos=this.pos=l+e.length,this.pushState(r,l),this.buffer.push(s,l,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,r=e.buffer.length;for(;r>0&&e.buffer[r-2]>e.reducePos;)r-=4;let s=e.buffer.slice(r),l=e.bufferBase+r;for(;e&&l==e.bufferBase;)e=e.parent;return new Stack(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,s,l,this.curContext,this.lookAhead,e)}recoverByDelete(e,r){let s=e<=this.p.parser.maxNode;s&&this.storeNode(e,this.pos,r,4),this.storeNode(0,this.pos,r,s?8:4),this.pos=this.reducePos=r,this.score-=190}canShift(e){for(let r=new SimulatedStack(this);;){let s=this.p.parser.stateSlot(r.state,4)||this.p.parser.hasAction(r.state,e);if(s==0)return!1;if(!(s&65536))return!0;r.reduce(s)}}recoverByInsert(e){if(this.stack.length>=300)return[];let r=this.p.parser.nextStates(this.state);if(r.length>8||this.stack.length>=120){let l=[];for(let a=0,h;a<r.length;a+=2)(h=r[a+1])!=this.state&&this.p.parser.hasAction(h,e)&&l.push(r[a],h);if(this.stack.length<120)for(let a=0;l.length<8&&a<r.length;a+=2){let h=r[a+1];l.some((c,u)=>u&1&&c==h)||l.push(r[a],h)}r=l}let s=[];for(let l=0;l<r.length&&s.length<4;l+=2){let a=r[l+1];if(a==this.state)continue;let h=this.split();h.pushState(a,this.pos),h.storeNode(0,h.pos,h.pos,4,!0),h.shiftContext(r[l],this.pos),h.score-=200,s.push(h)}return s}forceReduce(){let{parser:e}=this.p,r=e.stateSlot(this.state,5);if(!(r&65536))return!1;if(!e.validAction(this.state,r)){let s=r>>19,l=r&65535,a=this.stack.length-s*3;if(a<0||e.getGoto(this.stack[a],l,!1)<0){let h=this.findForcedReduction();if(h==null)return!1;r=h}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(r),!0}findForcedReduction(){let{parser:e}=this.p,r=[],s=(l,a)=>{if(!r.includes(l))return r.push(l),e.allActions(l,h=>{if(!(h&393216))if(h&65536){let c=(h>>19)-a;if(c>1){let u=h&65535,f=this.stack.length-c*3;if(f>=0&&e.getGoto(this.stack[f],u,!1)>=0)return c<<19|65536|u}}else{let c=s(h,a+1);if(c!=null)return c}})};return s(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let r=0;r<this.stack.length;r+=3)if(this.stack[r]!=e.stack[r])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,r){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(r)))}reduceContext(e,r){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(r)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let r=new StackContext(this.curContext.tracker,e);r.hash!=this.curContext.hash&&this.emitContext(),this.curContext=r}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class StackContext{constructor(e,r){this.tracker=e,this.context=r,this.hash=e.strict?e.hash(r):0}}var Recover;(function(o){o[o.Insert=200]="Insert",o[o.Delete=190]="Delete",o[o.Reduce=100]="Reduce",o[o.MaxNext=4]="MaxNext",o[o.MaxInsertStackDepth=300]="MaxInsertStackDepth",o[o.DampenInsertStackDepth=120]="DampenInsertStackDepth",o[o.MinBigReduction=2e3]="MinBigReduction"})(Recover||(Recover={}));class SimulatedStack{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let r=e&65535,s=e>>19;s==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(s-1)*3;let l=this.start.p.parser.getGoto(this.stack[this.base-3],r,!0);this.state=l}}class StackBufferCursor{constructor(e,r,s){this.stack=e,this.pos=r,this.index=s,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,r=e.bufferBase+e.buffer.length){return new StackBufferCursor(e,r,r-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new StackBufferCursor(this.stack,this.pos,this.index)}}function decodeArray(o,e=Uint16Array){if(typeof o!="string")return o;let r=null;for(let s=0,l=0;s<o.length;){let a=0;for(;;){let h=o.charCodeAt(s++),c=!1;if(h==126){a=65535;break}h>=92&&h--,h>=34&&h--;let u=h-32;if(u>=46&&(u-=46,c=!0),a+=u,c)break;a*=46}r?r[l++]=a:r=new e(a)}return r}class CachedToken{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const nullToken=new CachedToken;class InputStream{constructor(e,r){this.input=e,this.ranges=r,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=nullToken,this.rangeIndex=0,this.pos=this.chunkPos=r[0].from,this.range=r[0],this.end=r[r.length-1].to,this.readNext()}resolveOffset(e,r){let s=this.range,l=this.rangeIndex,a=this.pos+e;for(;a<s.from;){if(!l)return null;let h=this.ranges[--l];a-=s.from-h.to,s=h}for(;r<0?a>s.to:a>=s.to;){if(l==this.ranges.length-1)return null;let h=this.ranges[++l];a+=h.from-s.to,s=h}return a}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let r of this.ranges)if(r.to>e)return Math.max(e,r.from);return this.end}peek(e){let r=this.chunkOff+e,s,l;if(r>=0&&r<this.chunk.length)s=this.pos+e,l=this.chunk.charCodeAt(r);else{let a=this.resolveOffset(e,1);if(a==null)return-1;if(s=a,s>=this.chunk2Pos&&s<this.chunk2Pos+this.chunk2.length)l=this.chunk2.charCodeAt(s-this.chunk2Pos);else{let h=this.rangeIndex,c=this.range;for(;c.to<=s;)c=this.ranges[++h];this.chunk2=this.input.chunk(this.chunk2Pos=s),s+this.chunk2.length>c.to&&(this.chunk2=this.chunk2.slice(0,c.to-s)),l=this.chunk2.charCodeAt(0)}}return s>=this.token.lookAhead&&(this.token.lookAhead=s+1),l}acceptToken(e,r=0){let s=r?this.resolveOffset(r,-1):this.pos;if(s==null||s<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=s}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:r}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=r,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),r=this.pos+e.length;this.chunk=r>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,r){if(r?(this.token=r,r.start=e,r.lookAhead=e+1,r.value=r.extended=-1):this.token=nullToken,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,r){if(e>=this.chunkPos&&r<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,r-this.chunkPos);if(e>=this.chunk2Pos&&r<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,r-this.chunk2Pos);if(e>=this.range.from&&r<=this.range.to)return this.input.read(e,r);let s="";for(let l of this.ranges){if(l.from>=r)break;l.to>e&&(s+=this.input.read(Math.max(l.from,e),Math.min(l.to,r)))}return s}}class TokenGroup{constructor(e,r){this.data=e,this.id=r}token(e,r){let{parser:s}=r.p;readToken(this.data,e,r,this.id,s.data,s.tokenPrecTable)}}TokenGroup.prototype.contextual=TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;TokenGroup.prototype.fallback=TokenGroup.prototype.extend=!1;function readToken(o,e,r,s,l,a){let h=0,c=1<<s,{dialect:u}=r.p.parser;e:for(;c&o[h];){let f=o[h+1];for(let m=h+3;m<f;m+=2)if((o[m+1]&c)>0){let w=o[m];if(u.allows(w)&&(e.token.value==-1||e.token.value==w||overrides(w,e.token.value,l,a))){e.acceptToken(w);break}}let d=e.next,p=0,g=o[h+2];if(e.next<0&&g>p&&o[f+g*3-3]==65535&&o[f+g*3-3]==65535){h=o[f+g*3-1];continue e}for(;p<g;){let m=p+g>>1,w=f+m+(m<<1),S=o[w],y=o[w+1]||65536;if(d<S)g=m;else if(d>=y)p=m+1;else{h=o[w+2],e.advance();continue e}}break}}function findOffset(o,e,r){for(let s=e,l;(l=o[s])!=65535;s++)if(l==r)return s-e;return-1}function overrides(o,e,r,s){let l=findOffset(r,s,e);return l<0||findOffset(r,s,o)<l}const verbose=typeof process<"u"&&process.env&&/\bparse\b/.test({}.LOG);let stackIDs=null;var Safety;(function(o){o[o.Margin=25]="Margin"})(Safety||(Safety={}));function cutAt(o,e,r){let s=o.cursor(IterMode.IncludeAnonymous);for(s.moveTo(e);;)if(!(r<0?s.childBefore(e):s.childAfter(e)))for(;;){if((r<0?s.to<e:s.from>e)&&!s.type.isError)return r<0?Math.max(0,Math.min(s.to-1,e-25)):Math.min(o.length,Math.max(s.from+1,e+25));if(r<0?s.prevSibling():s.nextSibling())break;if(!s.parent())return r<0?0:o.length}}class FragmentCursor{constructor(e,r){this.fragments=e,this.nodeSet=r,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?cutAt(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?cutAt(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let r=this.trees.length-1;if(r<0)return this.nextFragment(),null;let s=this.trees[r],l=this.index[r];if(l==s.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let a=s.children[l],h=this.start[r]+s.positions[l];if(h>e)return this.nextStart=h,null;if(a instanceof Tree){if(h==e){if(h<this.safeFrom)return null;let c=h+a.length;if(c<=this.safeTo){let u=a.prop(NodeProp.lookAhead);if(!u||c+u<this.fragment.to)return a}}this.index[r]++,h+a.length>=Math.max(this.safeFrom,e)&&(this.trees.push(a),this.start.push(h),this.index.push(0))}else this.index[r]++,this.nextStart=h+a.length}}}class TokenCache{constructor(e,r){this.stream=r,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(s=>new CachedToken)}getActions(e){let r=0,s=null,{parser:l}=e.p,{tokenizers:a}=l,h=l.stateSlot(e.state,3),c=e.curContext?e.curContext.hash:0,u=0;for(let f=0;f<a.length;f++){if(!(1<<f&h))continue;let d=a[f],p=this.tokens[f];if(!(s&&!d.fallback)&&((d.contextual||p.start!=e.pos||p.mask!=h||p.context!=c)&&(this.updateCachedToken(p,d,e),p.mask=h,p.context=c),p.lookAhead>p.end+25&&(u=Math.max(p.lookAhead,u)),p.value!=0)){let g=r;if(p.extended>-1&&(r=this.addActions(e,p.extended,p.end,r)),r=this.addActions(e,p.value,p.end,r),!d.extend&&(s=p,r>g))break}}for(;this.actions.length>r;)this.actions.pop();return u&&e.setLookAhead(u),!s&&e.pos==this.stream.end&&(s=new CachedToken,s.value=e.p.parser.eofTerm,s.start=s.end=e.pos,r=this.addActions(e,s.value,s.end,r)),this.mainToken=s,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let r=new CachedToken,{pos:s,p:l}=e;return r.start=s,r.end=Math.min(s+1,l.stream.end),r.value=s==l.stream.end?l.parser.eofTerm:0,r}updateCachedToken(e,r,s){let l=this.stream.clipPos(s.pos);if(r.token(this.stream.reset(l,e),s),e.value>-1){let{parser:a}=s.p;for(let h=0;h<a.specialized.length;h++)if(a.specialized[h]==e.value){let c=a.specializers[h](this.stream.read(e.start,e.end),s);if(c>=0&&s.p.parser.dialect.allows(c>>1)){c&1?e.extended=c>>1:e.value=c>>1;break}}}else e.value=0,e.end=this.stream.clipPos(l+1)}putAction(e,r,s,l){for(let a=0;a<l;a+=3)if(this.actions[a]==e)return l;return this.actions[l++]=e,this.actions[l++]=r,this.actions[l++]=s,l}addActions(e,r,s,l){let{state:a}=e,{parser:h}=e.p,{data:c}=h;for(let u=0;u<2;u++)for(let f=h.stateSlot(a,u?2:1);;f+=3){if(c[f]==65535)if(c[f+1]==1)f=pair(c,f+2);else{l==0&&c[f+1]==2&&(l=this.putAction(pair(c,f+2),r,s,l));break}c[f]==r&&(l=this.putAction(pair(c,f+1),r,s,l))}return l}}var Rec;(function(o){o[o.Distance=5]="Distance",o[o.MaxRemainingPerStep=3]="MaxRemainingPerStep",o[o.MinBufferLengthPrune=500]="MinBufferLengthPrune",o[o.ForceReduceLimit=10]="ForceReduceLimit",o[o.CutDepth=15e3]="CutDepth",o[o.CutTo=9e3]="CutTo",o[o.MaxLeftAssociativeReductionCount=300]="MaxLeftAssociativeReductionCount",o[o.MaxStackCount=12]="MaxStackCount"})(Rec||(Rec={}));class Parse{constructor(e,r,s,l){this.parser=e,this.input=r,this.ranges=l,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new InputStream(r,l),this.tokens=new TokenCache(e,this.stream),this.topTerm=e.top[1];let{from:a}=l[0];this.stacks=[Stack.start(this,e.top[0],a)],this.fragments=s.length&&this.stream.end-a>e.bufferLength*4?new FragmentCursor(s,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,r=this.minStackPos,s=this.stacks=[],l,a;if(this.bigReductionCount>300&&e.length==1){let[h]=e;for(;h.forceReduce()&&h.stack.length&&h.stack[h.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let h=0;h<e.length;h++){let c=e[h];for(;;){if(this.tokens.mainToken=null,c.pos>r)s.push(c);else{if(this.advanceStack(c,s,e))continue;{l||(l=[],a=[]),l.push(c);let u=this.tokens.getMainToken(c);a.push(u.value,u.end)}}break}}if(!s.length){let h=l&&findFinished(l);if(h)return this.stackToTree(h);if(this.parser.strict)throw verbose&&l&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+r);this.recovering||(this.recovering=5)}if(this.recovering&&l){let h=this.stoppedAt!=null&&l[0].pos>this.stoppedAt?l[0]:this.runRecovery(l,a,s);if(h)return this.stackToTree(h.forceAll())}if(this.recovering){let h=this.recovering==1?1:this.recovering*3;if(s.length>h)for(s.sort((c,u)=>u.score-c.score);s.length>h;)s.pop();s.some(c=>c.reducePos>r)&&this.recovering--}else if(s.length>1){e:for(let h=0;h<s.length-1;h++){let c=s[h];for(let u=h+1;u<s.length;u++){let f=s[u];if(c.sameState(f)||c.buffer.length>500&&f.buffer.length>500)if((c.score-f.score||c.buffer.length-f.buffer.length)>0)s.splice(u--,1);else{s.splice(h--,1);continue e}}}s.length>12&&s.splice(12,s.length-12)}this.minStackPos=s[0].pos;for(let h=1;h<s.length;h++)s[h].pos<this.minStackPos&&(this.minStackPos=s[h].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,r,s){let l=e.pos,{parser:a}=this,h=verbose?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&l>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let f=e.curContext&&e.curContext.tracker.strict,d=f?e.curContext.hash:0;for(let p=this.fragments.nodeAt(l);p;){let g=this.parser.nodeSet.types[p.type.id]==p.type?a.getGoto(e.state,p.type.id):-1;if(g>-1&&p.length&&(!f||(p.prop(NodeProp.contextHash)||0)==d))return e.useNode(p,g),verbose&&console.log(h+this.stackID(e)+` (via reuse of ${a.getName(p.type.id)})`),!0;if(!(p instanceof Tree)||p.children.length==0||p.positions[0]>0)break;let m=p.children[0];if(m instanceof Tree&&p.positions[0]==0)p=m;else break}}let c=a.stateSlot(e.state,4);if(c>0)return e.reduce(c),verbose&&console.log(h+this.stackID(e)+` (via always-reduce ${a.getName(c&65535)})`),!0;if(e.stack.length>=15e3)for(;e.stack.length>9e3&&e.forceReduce(););let u=this.tokens.getActions(e);for(let f=0;f<u.length;){let d=u[f++],p=u[f++],g=u[f++],m=f==u.length||!s,w=m?e:e.split();if(w.apply(d,p,g),verbose&&console.log(h+this.stackID(w)+` (via ${d&65536?`reduce of ${a.getName(d&65535)}`:"shift"} for ${a.getName(p)} @ ${l}${w==e?"":", split"})`),m)return!0;w.pos>l?r.push(w):s.push(w)}return!1}advanceFully(e,r){let s=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>s)return pushStackDedup(e,r),!0}}runRecovery(e,r,s){let l=null,a=!1;for(let h=0;h<e.length;h++){let c=e[h],u=r[h<<1],f=r[(h<<1)+1],d=verbose?this.stackID(c)+" -> ":"";if(c.deadEnd&&(a||(a=!0,c.restart(),verbose&&console.log(d+this.stackID(c)+" (restarted)"),this.advanceFully(c,s))))continue;let p=c.split(),g=d;for(let m=0;p.forceReduce()&&m<10&&(verbose&&console.log(g+this.stackID(p)+" (via force-reduce)"),!this.advanceFully(p,s));m++)verbose&&(g=this.stackID(p)+" -> ");for(let m of c.recoverByInsert(u))verbose&&console.log(d+this.stackID(m)+" (via recover-insert)"),this.advanceFully(m,s);this.stream.end>c.pos?(f==c.pos&&(f++,u=0),c.recoverByDelete(u,f),verbose&&console.log(d+this.stackID(c)+` (via recover-delete ${this.parser.getName(u)})`),pushStackDedup(c,s)):(!l||l.score<c.score)&&(l=c)}return l}stackToTree(e){return e.close(),Tree.build({buffer:StackBufferCursor.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let r=(stackIDs||(stackIDs=new WeakMap)).get(e);return r||stackIDs.set(e,r=String.fromCodePoint(this.nextStackID++)),r+e}}function pushStackDedup(o,e){for(let r=0;r<e.length;r++){let s=e[r];if(s.pos==o.pos&&s.sameState(o)){e[r].score<o.score&&(e[r]=o);return}}e.push(o)}class Dialect{constructor(e,r,s){this.source=e,this.flags=r,this.disabled=s}allows(e){return!this.disabled||this.disabled[e]==0}}class LRParser extends Parser{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let r=e.nodeNames.split(" ");this.minRepeatTerm=r.length;for(let c=0;c<e.repeatNodeCount;c++)r.push("");let s=Object.keys(e.topRules).map(c=>e.topRules[c][1]),l=[];for(let c=0;c<r.length;c++)l.push([]);function a(c,u,f){l[c].push([u,u.deserialize(String(f))])}if(e.nodeProps)for(let c of e.nodeProps){let u=c[0];typeof u=="string"&&(u=NodeProp[u]);for(let f=1;f<c.length;){let d=c[f++];if(d>=0)a(d,u,c[f++]);else{let p=c[f+-d];for(let g=-d;g>0;g--)a(c[f++],u,p);f++}}}this.nodeSet=new NodeSet(r.map((c,u)=>NodeType.define({name:u>=this.minRepeatTerm?void 0:c,id:u,props:l[u],top:s.indexOf(u)>-1,error:u==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(u)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=DefaultBufferLength;let h=decodeArray(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let c=0;c<this.specializerSpecs.length;c++)this.specialized[c]=this.specializerSpecs[c].term;this.specializers=this.specializerSpecs.map(getSpecializer),this.states=decodeArray(e.states,Uint32Array),this.data=decodeArray(e.stateData),this.goto=decodeArray(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(c=>typeof c=="number"?new TokenGroup(h,c):c),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,r,s){let l=new Parse(this,e,r,s);for(let a of this.wrappers)l=a(l,e,r,s);return l}getGoto(e,r,s=!1){let l=this.goto;if(r>=l[0])return-1;for(let a=l[r+1];;){let h=l[a++],c=h&1,u=l[a++];if(c&&s)return u;for(let f=a+(h>>1);a<f;a++)if(l[a]==e)return u;if(c)return-1}}hasAction(e,r){let s=this.data;for(let l=0;l<2;l++)for(let a=this.stateSlot(e,l?2:1),h;;a+=3){if((h=s[a])==65535)if(s[a+1]==1)h=s[a=pair(s,a+2)];else{if(s[a+1]==2)return pair(s,a+2);break}if(h==r||h==0)return pair(s,a+1)}return 0}stateSlot(e,r){return this.states[e*6+r]}stateFlag(e,r){return(this.stateSlot(e,0)&r)>0}validAction(e,r){return!!this.allActions(e,s=>s==r?!0:null)}allActions(e,r){let s=this.stateSlot(e,4),l=s?r(s):void 0;for(let a=this.stateSlot(e,1);l==null;a+=3){if(this.data[a]==65535)if(this.data[a+1]==1)a=pair(this.data,a+2);else break;l=r(pair(this.data,a+1))}return l}nextStates(e){let r=[];for(let s=this.stateSlot(e,1);;s+=3){if(this.data[s]==65535)if(this.data[s+1]==1)s=pair(this.data,s+2);else break;if(!(this.data[s+2]&1)){let l=this.data[s+1];r.some((a,h)=>h&1&&a==l)||r.push(this.data[s],l)}}return r}configure(e){let r=Object.assign(Object.create(LRParser.prototype),this);if(e.props&&(r.nodeSet=this.nodeSet.extend(...e.props)),e.top){let s=this.topRules[e.top];if(!s)throw new RangeError(`Invalid top rule name ${e.top}`);r.top=s}return e.tokenizers&&(r.tokenizers=this.tokenizers.map(s=>{let l=e.tokenizers.find(a=>a.from==s);return l?l.to:s})),e.specializers&&(r.specializers=this.specializers.slice(),r.specializerSpecs=this.specializerSpecs.map((s,l)=>{let a=e.specializers.find(c=>c.from==s.external);if(!a)return s;let h=Object.assign(Object.assign({},s),{external:a.to});return r.specializers[l]=getSpecializer(h),h})),e.contextTracker&&(r.context=e.contextTracker),e.dialect&&(r.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(r.strict=e.strict),e.wrap&&(r.wrappers=r.wrappers.concat(e.wrap)),e.bufferLength!=null&&(r.bufferLength=e.bufferLength),r}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let r=this.dynamicPrecedences;return r==null?0:r[e]||0}parseDialect(e){let r=Object.keys(this.dialects),s=r.map(()=>!1);if(e)for(let a of e.split(" ")){let h=r.indexOf(a);h>=0&&(s[h]=!0)}let l=null;for(let a=0;a<r.length;a++)if(!s[a])for(let h=this.dialects[r[a]],c;(c=this.data[h++])!=65535;)(l||(l=new Uint8Array(this.maxTerm+1)))[c]=1;return new Dialect(e,s,l)}static deserialize(e){return new LRParser(e)}}function pair(o,e){return o[e]|o[e+1]<<16}function findFinished(o){let e=null;for(let r of o){let s=r.p.stoppedAt;(r.pos==r.p.stream.end||s!=null&&r.pos>s)&&r.p.parser.stateFlag(r.state,2)&&(!e||e.score<r.score)&&(e=r)}return e}function getSpecializer(o){if(o.external){let e=o.extend?1:0;return(r,s)=>o.external(r,s)<<1|e}return o.get}let flag=()=>new NodeProp({deserialize:o=>!0});const coll$1=flag(),prefixColl=flag(),prefixEdge=flag(),sameEdge=flag(),prefixContainer=flag();var props=Object.freeze({__proto__:null,coll:coll$1,prefixColl,prefixEdge,sameEdge,prefixContainer});const spec_Symbol={__proto__:null,true:136,false:136,nil:138,def:147,defn:147,"defn-":147,defmacro:147,definline:147,defonce:147,deftest:147,defcard:147,ns:155},parser=LRParser.deserialize({version:14,states:"-zQ]QPOOP!pOPOOOOQO'#C`'#C`OOQO'#Cb'#CbO]QPO'#CcO]QPO'#CeO]QPO'#CgO]QPO'#CiO]QPO'#CkO]OPO'#CtO]OPO'#CvO!uOQO'#C|OOQO'#Dm'#DmQ]QPOOO$hQPO'#CqO$oQPO'#DUO$vQPO'#DXO$}OSO'#DZO%cOPO'#D]O%hOPO'#D`O%mOPO'#DbO%uOWO'#DdO]QPO'#DgO]QPO'#DhO%zQPO'#DjOOQO'#Dq'#DqP&SQPO'#C^POOO)C?e)C?eOOQO,58},58}OOQO,59P,59POOQO,59R,59ROOQO,59T,59TOOQO,59V,59VOOQO,59`,59`OOQO,59b,59bOOQO,59h,59hO'gOPO,59hOOQO-E7k-E7kOOQO'#Cr'#CrO!}QPO'#CsOOQO'#Dv'#DvO'lQPO'#D|O'sQPO'#DuOOQO'#DO'#DOOOQO'#Dz'#DzO'sQPO'#DyOOQO'#DQ'#DQOOQO'#D}'#D}O'lQPO'#D|OOQO'#Dt'#DtO(OQPO,59]O(TQPO,59pOOQO,59p,59pO([QPO,59sOOQO,59s,59sOOQO,59u,59uOOOO,59x,59xOOQO,59y,59yOOQO,5:Q,5:QOOQO,5:T,5:TOOQO,5:V,5:VOOQO,59w,59wOOQO,59z,59zOOQO,59|,59|OOQO,5:O,5:OOOQO,5:R,5:ROOQO,5:S,5:SOOQO,5:U,5:UPOOO,58x,58xOOQO1G/S1G/SOOQO,59_,59_OOQO,59k,59kOOQO,59m,59mOOQO'#Cx'#CxO'sQPO'#CyOOQO'#Dx'#DxO(cQPO,5:aO(jQPO,5:eO(qQPO,5:hOOQO1G.w1G.wOOQO1G/[1G/[OOQO1G/_1G/_OOQO,59e,59eO(xQPO'#CzO*`QPO1G/{O]QPO1G/{OOQO'#Cz'#CzO*gQPO1G0PO*gQPO1G0PO*nQPO7+%gO*uQPO7+%kP&SQPO'#CcP&SQPO'#CeP&SQPO'#CgP&SQPO'#CiP&SQPO'#CkP*|OPO'#DbP&SQPO'#DgP&SQPO'#Dh",stateData:"+[~O!dOSPOSRPQ~OTiOWSOYTO[UO^VO`WOaiObiOd^OiXOkYOoZOw_Oz`O|iO!OaO!TcO!VdO!XeO!fQO!gRO~ORjO~OosOqtO~OT!OOWSOYTO[UO^VO`WOaiObiOd^OiXOkYOoZOw_Oz`O|iO!OaO!TcO!VdO!XeO!fQO!gRO!kvO!o{O~Oc!pP~P!}Ov!UO~P]Oy!WO~P]Od^OoZOz`O!r!YO!t!]O!u!^O~Oz`O~OT!`O~OWSOd^O~O!s!bO~Ow_Oz`O~OTiOW!}OY#OO[#PO^#QO`#ROaiObiOd^OiXOkYOoZOw_Oz`O|iO!OaO!TcO!V#SO!XeO!fQO!gRO~Oo!gO~Oc!pX~P]OT!kOiXOkYO~Oc!qO~Ov!rO~P]Oy!sO~P]Oc!ia~P]Oc!ma~P]Oc!pa~P]OTnXWnXYnX[nX^nX`nXanXbnXc!eXdnXinXknXonXwnXznX|nX!OnX!TnX!VnX!XnX!fnX!gnX~Oc!ii~P]Oc!mi~P]Oc!iq~P]Oc!mq~P]OW!}Od^O~Oa!u!tT!t~",goto:"/]!rPP!sP!vP!v#nP!vP!vP!vP!vPPPPP$j%i%i%mP%mP&n&n&sP&yP'x'x'|'|PP(QPP({P!vP!v)|!v!vP!vP!vP!v!v!v*t!v+nP,fPPP-^PP.j.m.pP.v.m/PP.m/VRkP!kiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#U!jiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UT!ad#S!jiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UQ![aT!ad#STx^w!UfOSTUVWXY]_`fgy!Q!T!V!n!o!p!v!w!y!z!{!|Sw^wU!lz}!la#Tj!}#O#P#Q#R#T#UV!mz}!lQ!w!nR!z!o!fiOSTUVWXY]^_`fgjwy!Q!T!V!p!v!w!y!z!{!|!}#O#P#Q#R#T#UQ!ZaQ!u!nR!x!oT|^wT!P^w!jiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UR!eh!jiOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UQ!XaQ!_bR!eh!kbOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#U!YgOSTUVWXY]^_`fgwy!Q!T!V!n!o!p!v!w!y!z!{!|a#Uj!}#O#P#Q#R#T#U!khOSTUVWXY]^_`fgjwy!Q!T!V!n!o!p!v!w!y!z!{!|!}#O#P#Q#R#T#UQ]Obu]y!T!V!p!v!y!{!|Qy^Q!T_Q!V`Q!p!QQ!v!nQ!y!oQ!{!wR!|!zt[O]^_`y!Q!T!V!n!o!p!v!w!y!z!{!|SlS!}SmT#OSnU#PSoV#QSpW#RQqXQrYU!cfw#TS!dg#UR!fjR!S^R!R^Qz^R!hwQ!nzQ!o}R!t!lQ}^R!iwQ!Q^R!jw",nodeNames:"⚠ LineComment Discard #_ Boolean Symbol Nil Deref @ Quote ' SyntaxQuote ` Unquote ~ UnquoteSplice ~@ Number Keyword ) ( List DefLike Meta Metadata ^ ReaderMetadata #^ VarName Meta DocString \" String StringContent NS Meta Operator Meta ] [ Vector } { Map Character Set # NamespacedMap KeywordPrefix RegExp Var #' ReaderConditional #? SymbolicValue ## AnonymousFunction Meta TaggedLiteral ReaderTag ConstructorCall ConstructorPrefix Program",maxTerm:83,nodeProps:[[prefixEdge,-14,3,8,10,12,14,16,25,27,46,48,51,53,55,61,""],[prefixColl,-13,7,9,11,13,15,24,26,45,47,49,50,52,56,""],["openedBy",19,"(",31,'"',38,"[",41,"{"],["closedBy",20,")",31,'"',39,"]",42,"}"],[coll$1,-3,21,40,43,""],[prefixContainer,-7,23,29,35,37,57,58,60,""],[sameEdge,31,""]],skippedNodes:[0,1,2,3],repeatNodeCount:1,tokenData:"#6x~R![OX$wX^%n^p$wpq%nqr'grs,Tst,Ytu/Yuv'gvw'gwx6Vxy6jyz6}z{'g{|7b|}%n}!O7b!O!P9t!P!Q)v!Q!R!8[!R![!>t![!]!Cp!]!^!J]!^!_'g!_!`'g!`!a'g!a!b'g!b!c!Kr!c!}/Y!}#O!LV#O#P!Lj#P#Q#3w#Q#R#4[#R#S/Y#S#T#4o#T#o/Y#o#p#5S#p#q$w#q#r#5g#r#s#5z#s#y$w#y#z%n#z$f$w$f$g%n$g##l/Y##l#BY$w#BY#BZ%n#BZ$IS$w$IS$I_%n$I_$I|$w$I|$JO%n$JO$JT$w$JT$JU%n$JU$KV$w$KV$KW%n$KW&FU$w&FU&FV%n&FV~$wQ$|SqQOr$ws#O$w#O#P%Y#P~$wQ%_TqQOr$wrs$ws#O$w#O#P%Y#P~$wR%ujqQ!dPOX$wX^%n^p$wpq%nqr$ws|$w|}%n}#O$w#O#P%Y#P#y$w#y#z%n#z$f$w$f$g%n$g#BY$w#BY#BZ%n#BZ$IS$w$IS$I_%n$I_$I|$w$I|$JO%n$JO$JT$w$JT$JU%n$JU$KV$w$KV$KW%n$KW&FU$w&FU&FV%n&FV~$w_'rpqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q!['g![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$wZ*PpqQ!sWTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![)v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$w~,YOo~R,a[!OPqQOr$wst-Vtw$wwx-jx!a$w!a!b-}!b#O$w#O#P%Y#P#Q$w#Q#R.b#R#S.u#S~$wR-^S!XPqQOr$ws#O$w#O#P%Y#P~$wR-qS!TPqQOr$ws#O$w#O#P%Y#P~$wR.US!VPqQOr$ws#O$w#O#P%Y#P~$wR.iSkPqQOr$ws#O$w#O#P%Y#P~$wR.|SRPqQOr$ws#O$w#O#P%Y#P~$w_/epqQ!sW!tSTPOq$wqr'gst)vtu/Yuv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P1i!P!Q'g!Q![/Y![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}/Y!}#O$w#O#P%Y#P#R$w#R#S/Y#S#T$w#T#o/Y#o$g$w$g##l/Y##l~$w_1rpqQ!sWTPOq$wqr)vst)vtu3vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![)v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!}3v!}#O$w#O#P%Y#P#R$w#R#S3v#S#T$w#T#o3v#o$g$w$g##l3v##l~$w_4RpqQ!sW!uSTPOq$wqr)vst)vtu3vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P1i!P!Q)v!Q![3v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!}3v!}#O$w#O#P%Y#P#R$w#R#S3v#S#T$w#T#o3v#o$g$w$g##l3v##l~$wR6^SYPqQOr$ws#O$w#O#P%Y#P~$wV6qSdTqQOr$ws#O$w#O#P%Y#P~$wR7UScPqQOr$ws#O$w#O#P%Y#P~$w_7mqqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P9t!P!Q'g!Q!RHO!R![!&|![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$wZ9}pqQ!sWTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![<R![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$wZ<^tqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![<R![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!g)v!g!h>n!h!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#X)v#X#Y>n#Y#o)v#o$g$w$g##l)v##l~$wZ>wpqQ!sWTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|@{|}$w}!O@{!O!P)v!P!Q)v!Q![CY![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$wZAUpqQ!sWTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![CY![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$wZCerqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![CY![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!o)v!o!pEo!p!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$wZEzpqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![)v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#o)v#o$g$w$g##l)v##l~$w_H]yqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!PJ|!P!Q!![!Q![!&|![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!g'g!g!h!)t!h!o'g!o!p!0{!p!q!0{!q!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#X'g#X#Y!)t#Y#l'g#l#m!3^#m#o'g#o$g$w$g##l'g##l~$wZKXvqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![J|![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!g)v!g!h>n!h!o)v!o!pMo!p!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#X)v#X#Y>n#Y#o)v#o$g$w$g##l)v##l~$wZMztqQ!sWaPTPOq$wqr)vst)vtu)vuv)vvw)vwx)vxz$wz{)v{|)v|}$w}!O)v!O!P)v!P!Q)v!Q![)v![!])v!]!^$w!^!_)v!_!`)v!`!a)v!a!b)v!b!c$w!c!g)v!g!h>n!h!})v!}#O$w#O#P%Y#P#R$w#R#S)v#S#T$w#T#X)v#X#Y>n#Y#o)v#o$g$w$g##l)v##l~$w_!!gpqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!$k![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!$xpqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!$k![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!'ZwqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!PJ|!P!Q!![!Q![!&|![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!g'g!g!h!)t!h!o'g!o!p!0{!p!q!0{!q!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#X'g#X#Y!)t#Y#o'g#o$g$w$g##l'g##l~$w_!*PpqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|!,T|}$w}!O!,T!O!P)v!P!Q'g!Q![!.d![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!,`pqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!.d![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!.qrqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!.d![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!o'g!o!p!0{!p!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!1YpqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q!['g![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#o'g#o$g$w$g##l'g##l~$w_!3irqQ!sW!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!5s![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!i!5s!i!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#Z!5s#Z#o'g#o$g$w$g##l'g##l~$w_!6QrqQ!sWaP!tSTPOq$wqr'gst)vtu'guv'gvw'gwx)vxz$wz{'g{|'g|}$w}!O'g!O!P)v!P!Q'g!Q![!5s![!])v!]!^$w!^!_'g!_!`'g!`!a'g!a!b'g!b!c$w!c!i!5s!i!}'g!}#O$w#O#P%Y#P#R$w#R#S'g#S#T$w#T#Z!5s#Z#o'g#o$g$w$g##l'g##l~$wR!8ceqQaPOr$ws!O$w!O!P!9t!P!Q!=r!Q![!>t![!g$w!g!h!:q!h!o$w!o!p!<n!p!q!<n!q#O$w#O#P%Y#P#U$w#U#V!?z#V#X$w#X#Y!:q#Y#c$w#c#d!AS#d#l$w#l#m!BU#m~$wR!9{[qQaPOr$ws!Q$w!Q![!9t![!g$w!g!h!:q!h!o$w!o!p!=R!p#O$w#O#P%Y#P#X$w#X#Y!:q#Y~$wR!:vYqQOr$ws{$w{|!;f|}$w}!O!;f!O!Q$w!Q![!;}![#O$w#O#P%Y#P~$wR!;kUqQOr$ws!Q$w!Q![!;}![#O$w#O#P%Y#P~$wR!<UWqQaPOr$ws!Q$w!Q![!;}![!o$w!o!p!<n!p#O$w#O#P%Y#P~$wR!<uSqQaPOr$ws#O$w#O#P%Y#P~$wR!=YWqQaPOr$ws!g$w!g!h!:q!h#O$w#O#P%Y#P#X$w#X#Y!:q#Y~$wR!=wUqQOr$ws!Q$w!Q![!>Z![#O$w#O#P%Y#P~$wR!>bUqQaPOr$ws!Q$w!Q![!>Z![#O$w#O#P%Y#P~$wR!>{_qQaPOr$ws!O$w!O!P!9t!P!Q!=r!Q![!>t![!g$w!g!h!:q!h!o$w!o!p!<n!p!q!<n!q#O$w#O#P%Y#P#X$w#X#Y!:q#Y~$wR!@PVqQOr$ws!Q$w!Q!R!@f!R!S!@f!S#O$w#O#P%Y#P~$wR!@mVqQaPOr$ws!Q$w!Q!R!@f!R!S!@f!S#O$w#O#P%Y#P~$wR!AXUqQOr$ws!Q$w!Q!Y!Ak!Y#O$w#O#P%Y#P~$wR!ArUqQaPOr$ws!Q$w!Q!Y!Ak!Y#O$w#O#P%Y#P~$wR!BZYqQOr$ws!Q$w!Q![!By![!c$w!c!i!By!i#O$w#O#P%Y#P#T$w#T#Z!By#Z~$wR!CQYqQaPOr$ws!Q$w!Q![!By![!c$w!c!i!By!i#O$w#O#P%Y#P#T$w#T#Z!By#Z~$wV!CyobPqQ!rSOq$wqr!Ezst$wtu!Ezuv!Ezvw!Ezwz$wz{!Ez{|!Ez|}$w}!O!Ez!O!P!Ez!P!Q!Ez!Q![$w![!]!HX!]!^$w!^!_!Ez!_!`!Ez!`!a!Ez!a!b!Ez!b!c$w!c!}!Ez!}#O$w#O#P%Y#P#R$w#R#S!Ez#S#T$w#T#o!Ez#o$g$w$g##l!Ez##l~$wV!FTpbPqQ!rSOq$wqr!Ezst!Eztu!Ezuv!Ezvw!Ezwx!Ezxz$wz{!Ez{|!Ez|}$w}!O!Ez!O!P!Ez!P!Q!Ez!Q![!Ez![!]!Ez!]!^$w!^!_!Ez!_!`!Ez!`!a!Ez!a!b!Ez!b!c$w!c!}!Ez!}#O$w#O#P%Y#P#R$w#R#S!Ez#S#T$w#T#o!Ez#o$g$w$g##l!Ez##l~$wV!HbmbPqQ!rSOq$wqr!Ezst$wtu!Ezuv!Ezvw!Ezwz$wz{!Ez{|!Ez|}$w}!O!Ez!O!P!Ez!P!Q!Ez!Q!^$w!^!_!Ez!_!`!Ez!`!a!Ez!a!b!Ez!b!c$w!c!}!Ez!}#O$w#O#P%Y#P#R$w#R#S!Ez#S#T$w#T#o!Ez#o$g$w$g##l!Ez##l~$wR!JdVPPqQOY!J]YZ$wZr!J]rs!Jys#O!J]#O#P!KU#P~!J]P!KOQPPOY!JyZ~!JyR!K]VPPqQOY!J]YZ$wZr!J]rs!J]s#O!J]#O#P!KU#P~!J]R!KySWPqQOr$ws#O$w#O#P%Y#P~$wR!L^SwPqQOr$ws#O$w#O#P%Y#P~$wR!LocqQOY!MzYZ$wZr!Mzrs!Mzs#O!Mz#O#P!N_#P#U!Mz#U#V!Nu#V#Y!Mz#Y#Z#$w#Z#b!Mz#b#c#(b#c#d#*{#d#f!Mz#f#g#,m#g#h#/W#h#i#/q#i#j#0s#j~!MzR!NRS|PqQOr$ws#O$w#O#P%Y#P~$wR!NfT|PqQOr$wrs$ws#O$w#O#P%Y#P~$wR!N|U|PqQOr$ws#O$w#O#P%Y#P#T$w#T#U# `#U~$wR# eUqQOr$ws#O$w#O#P%Y#P#V$w#V#W# w#W~$wR# |UqQOr$ws#O$w#O#P%Y#P#_$w#_#`#!`#`~$wR#!eUqQOr$ws#O$w#O#P%Y#P#g$w#g#h#!w#h~$wR#!|UqQOr$ws#O$w#O#P%Y#P#d$w#d#e##`#e~$wR##eUqQOr$ws#O$w#O#P%Y#P#T$w#T#U##w#U~$wR##|UqQOr$ws#O$w#O#P%Y#P#V$w#V#W#$`#W~$wR#$eUqQOr$ws#O$w#O#P%Y#P#X$w#X#Y!Mz#Y~$wR#%OU|PqQOr$ws#O$w#O#P%Y#P#c$w#c#d#%b#d~$wR#%gUqQOr$ws#O$w#O#P%Y#P#f$w#f#g#%y#g~$wR#&OUqQOr$ws#O$w#O#P%Y#P#a$w#a#b#&b#b~$wR#&gUqQOr$ws#O$w#O#P%Y#P#Y$w#Y#Z#&y#Z~$wR#'OUqQOr$ws#O$w#O#P%Y#P#X$w#X#Y#'b#Y~$wR#'gUqQOr$ws#O$w#O#P%Y#P#X$w#X#Y#'y#Y~$wR#(OUqQOr$ws#O$w#O#P%Y#P#W$w#W#X!Mz#X~$wR#(iU|PqQOr$ws#O$w#O#P%Y#P#X$w#X#Y#({#Y~$wR#)QUqQOr$ws#O$w#O#P%Y#P#k$w#k#l#)d#l~$wR#)iUqQOr$ws#O$w#O#P%Y#P#`$w#`#a#){#a~$wR#*QUqQOr$ws#O$w#O#P%Y#P#]$w#]#^#*d#^~$wR#*iUqQOr$ws#O$w#O#P%Y#P#b$w#b#c#$`#c~$wR#+SV|PqQOr$ws!Q$w!Q!U#+i!U!Y#,S!Y#O$w#O#P%Y#P~$wR#+pU|PqQOr$ws!Q$w!Q!Y#,S!Y#O$w#O#P%Y#P~$wR#,ZU|PqQOr$ws!Q$w!Q!Y!Mz!Y#O$w#O#P%Y#P~$wR#,tU|PqQOr$ws#O$w#O#P%Y#P#X$w#X#Y#-W#Y~$wR#-]UqQOr$ws#O$w#O#P%Y#P#h$w#h#i#-o#i~$wR#-tUqQOr$ws#O$w#O#P%Y#P#i$w#i#j#.W#j~$wR#.]UqQOr$ws#O$w#O#P%Y#P#f$w#f#g#.o#g~$wR#.tUqQOr$ws#O$w#O#P%Y#P#b$w#b#c!Mz#c~$wR#/_U|PqQOr$ws#O$w#O#P%Y#P#d$w#d#e##`#e~$wR#/xU|PqQOr$ws#O$w#O#P%Y#P#T$w#T#U#0[#U~$wR#0aUqQOr$ws#O$w#O#P%Y#P#U$w#U#V!Mz#V~$wR#0zY|PqQOr$ws!Q$w!Q![#1j![!c$w!c!i#1j!i#O$w#O#P%Y#P#T$w#T#Z#1j#Z~$wR#1oYqQOr$ws!Q$w!Q![#2_![!c$w!c!i#2_!i#O$w#O#P%Y#P#T$w#T#Z#2_#Z~$wR#2dYqQOr$ws!Q$w!Q![#3S![!c$w!c!i#3S!i#O$w#O#P%Y#P#T$w#T#Z#3S#Z~$wR#3XYqQOr$ws!Q$w!Q![!Mz![!c$w!c!i!Mz!i#O$w#O#P%Y#P#T$w#T#Z!Mz#Z~$wR#4OSvPqQOr$ws#O$w#O#P%Y#P~$wR#4cSiPqQOr$ws#O$w#O#P%Y#P~$wR#4vS[PqQOr$ws#O$w#O#P%Y#P~$wV#5ZSzTqQOr$ws#O$w#O#P%Y#P~$wR#5nSyPqQOr$ws#O$w#O#P%Y#P~$wR#6RU^PqQOr$ws!b$w!b!c#6e!c#O$w#O#P%Y#P~$wR#6lS`PqQOr$ws#O$w#O#P%Y#P~$w",tokenizers:[0,1,2,3],topRules:{Program:[0,62]},dynamicPrecedences:{22:1,34:2},specialized:[{term:5,get:o=>spec_Symbol[o]||-1}],tokenPrec:466}),init_env={data:{},outer:null};let currentEnv=init_env;function bindExprs$1(o,e,r){for(var s=0;s<e.length;s++)if(e[s].toString()==="&"){o.data[e[s+1].toString()]=Array.prototype.slice.call(r,s);break}else console.log("Binding",e[s].toString(),"to",r[s]),o.data[e[s].toString()]=r[s];return o}function addToEnv(o,e,r){return o.data[e.toString()]=r,r}function findKeyInEnv(o,e){return e.toString()in o.data?o:o.outer&&e in o.outer.data?findKeyInEnv(o.outer,e):null}function getKeyInEnv(o,e){return findKeyInEnv(o,e)?findKeyInEnv(o,e).data[e.toString()]:"Error: "+e+" is undefined"}function setInEnv(o,e,r){return console.log(e.toString()),console.log("setting",e,"in env",o),o.data[e.toString()]=r,r}function newScope(o){return{data:{},outer:o}}function _obj_type(o){if(_symbol_Q(o))return"symbol";if(_list_Q(o))return"list";if(_vector_Q(o))return"vector";if(_hash_map_Q(o))return"hash-map";if(_nil_Q(o))return"nil";if(_true_Q(o))return"true";if(_false_Q(o))return"false";if(_atom_Q(o))return"atom";switch(typeof o){case"number":return"number";case"function":return"function";case"string":return o[0]=="ʞ"?"keyword":"string";default:throw new Error("Unknown type '"+typeof o+"'")}}function _sequential_Q(o){return _list_Q(o)||_vector_Q(o)}function _equal_Q(o,e){var r=_obj_type(o),s=_obj_type(e);if(!(r===s||_sequential_Q(o)&&_sequential_Q(e)))return!1;switch(r){case"symbol":return o.value===e.value;case"list":case"vector":if(o.length!==e.length)return!1;for(var l=0;l<o.length;l++)if(!_equal_Q(o[l],e[l]))return!1;return!0;case"hash-map":if(Object.keys(o).length!==Object.keys(e).length)return!1;for(var a in o)if(!_equal_Q(o[a],e[a]))return!1;return!0;default:return o===e}}function _clone(o){var e;switch(_obj_type(o)){case"list":e=o.slice(0);break;case"vector":e=o.slice(0),e.__isvector__=!0;break;case"hash-map":e={};for(var r in o)o.hasOwnProperty(r)&&(e[r]=o[r]);break;case"function":e=o.clone();break;default:throw new Error("Cannot clone a "+_obj_type(o))}return Object.defineProperty(e,"__meta__",{enumerable:!1,writable:!0}),e}function _nil_Q(o){return o===null}function _true_Q(o){return o===!0}function _false_Q(o){return o===!1}function _number_Q(o){return typeof o=="number"}function _string_Q(o){return typeof o=="string"&&o[0]!=="ʞ"}let Symbol$1=class{constructor(e){return this.value=e,this}toString(){return this.value}};function _symbol(o){return new Symbol$1(o)}function _symbol_Q(o){return o instanceof Symbol$1}function _keyword(o){return typeof o=="string"&&o[0]==="ʞ"?o:"ʞ"+o}function _keyword_Q(o){return typeof o=="string"&&o[0]==="ʞ"}function walk(o,e,r){if(_list_Q(r))return e(r.map(o));if(_vector_Q(r)){let s=e(r.map(o));return s.__isvector__=!0,s}else if(r.__mapEntry__){const s=o(r[0]),l=o(r[1]);let a=[s,l];return a.__mapEntry__=!0,e(a)}else if(_hash_map_Q(r)){const s=seq(r).map(o);let l={};return s.forEach(a=>{l[a[0]]=a[1]}),e(l)}else return e(r)}function postwalk(o,e){return walk(r=>postwalk(o,r),o,e)}function _function(o,e,r,s){let l=newScope(r);const a=function(){return o(h,bindExprs$1(l,s,arguments))},h=postwalk(c=>c.value==_symbol("recur")?a:c,e);return a.__meta__=null,a.__ast__=h,a.__gen_env__=function(c){return bindExprs$1(l,s,c)},a._ismacro_=!1,a}function _function_Q(o){return typeof o=="function"}Function.prototype.clone=function(){var o=this,e=function(){return o.apply(this,arguments)};for(const r in this)e[r]=this[r];return e};function _fn_Q(o){return _function_Q(o)&&!o._ismacro_}function _macro_Q(o){return _function_Q(o)&&!!o._ismacro_}function _list(){return Array.prototype.slice.call(arguments,0)}function _list_Q(o){return Array.isArray(o)&&!o.__isvector__}function _vector(){var o=Array.prototype.slice.call(arguments,0);return o.__isvector__=!0,o}function _vector_Q(o){return Array.isArray(o)&&!!o.__isvector__}function _hash_map(){if(arguments.length%2===1)throw new Error("Odd number of hash map arguments");var o=[{}].concat(Array.prototype.slice.call(arguments,0));return _assoc.apply(null,o)}function _hash_map_Q(o){return typeof o=="object"&&!Array.isArray(o)&&o!==null&&!(o instanceof Symbol$1)&&!(o instanceof Atom)}function _assoc(o){if(arguments.length%2!==1)throw new Error("Odd number of assoc arguments");for(var e=1;e<arguments.length;e+=2){var r=arguments[e],s=arguments[e+1];if(typeof r!="string")throw new Error("expected hash-map key string, got: "+typeof r);o[r]=s}return o}function _dissoc(o){for(var e=1;e<arguments.length;e++){var r=arguments[e];delete o[r]}return o}class Atom{constructor(e){this.val=e}}function _atom(o){return new Atom(o)}function _atom_Q(o){return o instanceof Atom}class Reader{constructor(e){this.tokens=e.map(function(r){return r}),this.position=0}next(){return this.tokens[this.position++]}peek(){return this.tokens[this.position]}}function tokenize(o){var e=/[\s,]*(~@|[\[\]{}()'`~^@]|"(?:\\.|[^\\"])*"?|;.*|[^\s\[\]{}('"`,;)]*)/g,r=[];let s="";for(;(s=e.exec(o)[1])!="";)s[0]!==";"&&r.push(s);return r}function read_atom(o){var e=o.next();if(e.match(/^-?[0-9]+$/))return parseInt(e,10);if(e.match(/^-?[0-9][0-9.]*$/))return parseFloat(e,10);if(e.match(/^"(?:\\.|[^\\"])*"$/))return e.slice(1,e.length-1).replace(/\\(.)/g,function(r,s){return s==="n"?`
`:s});if(e[0]==='"')throw new Error(`expected '"', got EOF`);return e[0]===":"?_keyword(e.slice(1)):e==="nil"?null:e==="true"?!0:e==="false"?!1:_symbol(e)}function read_list(o,e,r){e=e||"(",r=r||")";var s=[],l=o.next();if(l!==e)throw new Error("expected '"+e+"'");for(;(l=o.peek())!==r;){if(!l)throw new Error("expected '"+r+"', got EOF");s.push(read_form(o))}return o.next(),s}function read_vector(o){var e=read_list(o,"[","]");return _vector.apply(null,e)}function read_hash_map(o){var e=read_list(o,"{","}");return _hash_map.apply(null,e)}function read_form(o){var e=o.peek();switch(e){case";":return null;case"'":return o.next(),[_symbol("quote"),read_form(o)];case"`":return o.next(),[_symbol("quasiquote"),read_form(o)];case"~":return o.next(),[_symbol("unquote"),read_form(o)];case"~@":return o.next(),[_symbol("splice-unquote"),read_form(o)];case"^":o.next();var r=read_form(o);return[_symbol("with-meta"),read_form(o),r];case"@":return o.next(),[_symbol("deref"),read_form(o)];case"#":return o.next(),[_symbol("dispatch"),read_form(o)];case")":throw new Error("unexpected ')'");case"(":return read_list(o);case"]":throw new Error("unexpected ']'");case"[":return read_vector(o);case"}":throw new Error("unexpected '}'");case"{":return read_hash_map(o);default:return read_atom(o)}}function BlankException(o){}function read_str(o){var e=tokenize(o);if(e.length===0)throw new BlankException;return read_form(new Reader(e))}function _pr_str(o,e){typeof e>"u"&&(e=!0);var r=e,s=_obj_type(o);switch(s){case"list":var l=o.map(function(h){return _pr_str(h,r)});return"("+l.join(" ")+")";case"vector":var l=o.map(function(h){return _pr_str(h,r)});return"["+l.join(" ")+"]";case"hash-map":var l=[];for(var a in o)l.push(_pr_str(a,r),_pr_str(o[a],r));return"{"+l.join(" ")+"}";case"string":return o[0]==="ʞ"?":"+o.slice(1):r?'"'+o.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':o;case"keyword":return":"+o.slice(1);case"nil":return"nil";case"atom":return"(atom "+_pr_str(o.val,r)+")";default:return o.toString()}}function resolve_js(str){if(str.match(/\./)){var re=/^(.*)\.[^\.]*$/,match=re.exec(str);return[eval(match[1]),eval(str)]}else return[GLOBAL,eval(str)]}function js_to_mal(o){if(o==null)return null;var e=[],r=JSON.stringify(o,function(s,l){if(typeof l=="object"&&l!==null){if(e.indexOf(l)!==-1)return;e.push(l)}return l});return e=null,JSON.parse(r)}const _resolve_js=resolve_js,_js_to_mal=js_to_mal;function mal_throw(o){throw o}function pr_str(){return Array.prototype.map.call(arguments,function(o){return _pr_str(o,!0)}).join(" ")}function str(){return Array.prototype.map.call(arguments,function(o){return _pr_str(o,!1)}).join("")}function print(){return Array.prototype.map.call(arguments,function(o){return _pr_str(o,!1)}).join("")}function prn(){return Array.prototype.map.call(arguments,function(o){return _pr_str(o,!1)}).join("")}function println(){return Array.prototype.map.call(arguments,function(o){return _pr_str(o,!1)}).join("")}function slurp(o){var e=new XMLHttpRequest;if(e.open("GET",o,!1),e.send(),e.status==200)return e.responseText;throw new Error("Failed to slurp file: "+o)}function time_ms(){return new Date().getTime()}function assoc(o){if(_vector_Q(o)){const s=arguments[1],l=arguments[2];let a=_clone(o);const h=a.slice(0,s),c=a.slice(s+1);return h.push(l),a=h.concat(c),a.__isvector__=!0,a}var e=_clone(o),r=[e].concat(Array.prototype.slice.call(arguments,1));return _assoc.apply(null,r)}function dissoc(o){if(_vector_Q(o)){let s=_clone(o);const l=arguments[1],a=s.slice(0,l),h=s.slice(l+1);return s=a.concat(h),s.__isvector__=!0,s}var e=_clone(o),r=[e].concat(Array.prototype.slice.call(arguments,1));return _dissoc.apply(null,r)}function get(o,e){return o!=null&&e in o?o[e]:null}function contains_Q(o,e){return e in o}function keys(o){return Object.keys(o)}function vals(o){return Object.keys(o).map(function(e){return o[e]})}function cons(o,e){return[o].concat(e)}function concat(o){return o=o||[],o.concat.apply(o,Array.prototype.slice.call(arguments,1))}function vec(o){if(_list_Q(o)){var e=Array.prototype.slice.call(o,0);return e.__isvector__=!0,e}else return o}function nth(o,e){if(e<o.length)return o[e];throw new Error("nth: index out of range")}function range(o,e){if(!e)return range(0,o);var r=[];for(let s=o;s<=e;s++)r.push(s);return r}function first(o){return o===null?null:o[0]}function last(o){return o===null?null:o.slice(-1)[0]}function rest(o){return o==null?[]:o.slice(1)}function empty_Q(o){return o.length===0}function count(o){return Array.isArray(o)?o.length:o===null?0:Object.keys(o).length}function conj(o){if(_list_Q(o))return Array.prototype.slice.call(arguments,1).reverse().concat(o);var e=o.concat(Array.prototype.slice.call(arguments,1));return e.__isvector__=!0,e}function pop(o){if(_list_Q(o))return o.slice(1);var e=o.slice(0,-1);return e.__isvector__=!0,e}function seq$1(o){if(_list_Q(o))return o.length>0?o:null;if(_vector_Q(o))return o.length>0?Array.prototype.slice.call(o,0):null;if(_string_Q(o))return o.length>0?o.split(""):null;if(_hash_map_Q(o)){let e=[];return Object.entries(o).forEach(r=>{r.__mapEntry__=!0,e.push(r)}),e}else{if(o===null)return null;throw new Error("seq: called on non-sequence")}}function apply(o){var e=Array.prototype.slice.call(arguments,1);return o.apply(o,e.slice(0,e.length-1).concat(e[e.length-1]))}function map(o,e){return e.map(function(r){return o(r)})}function with_meta(o,e){var r=_clone(o);return r.__meta__=e,r}function meta(o){if(!_sequential_Q(o)&&!_hash_map_Q(o)&&!_function_Q(o))throw new Error("attempt to get metadata from: "+_obj_type(o));return o.__meta__}function deref(o){return o.val}function reset_BANG(o,e){return o.val=e}function swap_BANG(o,e){var r=[o.val].concat(Array.prototype.slice.call(arguments,2));return o.val=e.apply(e,r),o.val}function js_eval(str){return _js_to_mal(eval(str.toString()))}function js_method_call(o){var e=Array.prototype.slice.call(arguments,1),r=_resolve_js(o),s=r[0],l=r[1],a=l.apply(s,e);return _js_to_mal(a)}const ns={type:_obj_type,"=":_equal_Q,throw:mal_throw,"nil?":_nil_Q,"true?":_true_Q,"false?":_false_Q,"number?":_number_Q,"string?":_string_Q,symbol:_symbol,"symbol?":_symbol_Q,keyword:_keyword,"keyword?":_keyword_Q,"fn?":_fn_Q,"macro?":_macro_Q,"pr-str":pr_str,print,str,prn,println,"read-string":read_str,slurp,"<":function(o,e){return o<e},"<=":function(o,e){return o<=e},">":function(o,e){return o>e},">=":function(o,e){return o>=e},"+":function(o,e){return o+e},"-":function(o,e){return o-e},"*":function(o,e){return o*e},"/":function(o,e){return o/e},inc:function(o){return o+1},"time-ms":time_ms,list:_list,"list?":_list_Q,vector:_vector,"vector?":_vector_Q,"hash-map":_hash_map,"map?":_hash_map_Q,assoc,dissoc,get,"contains?":contains_Q,keys,vals,"sequential?":_sequential_Q,cons,concat,vec,nth,first,last,rest,"empty?":empty_Q,count,apply,map,range,conj,seq:seq$1,pop,"with-meta":with_meta,meta,atom:_atom,"atom?":_atom_Q,deref,"reset!":reset_BANG,"swap!":swap_BANG,"js-eval":js_eval,".":js_method_call};function READ(o){return read_str(o)}function qqLoop(o,e){return _list_Q(e)&&e.length&&_symbol_Q(e[0])&&e[0].value=="splice-unquote"?[_symbol("concat"),e[1],o]:[_symbol("cons"),quasiquote(e),o]}function quasiquote(o){return _list_Q(o)&&0<o.length&&_symbol_Q(o[0])&&o[0].value=="unquote"?o[1]:_list_Q(o)?o.reduceRight(qqLoop,[]):_vector_Q(o)?[_symbol("vec"),o.reduceRight(qqLoop,[])]:_symbol_Q(o)||_hash_map_Q(o)?[_symbol("quote"),o]:o}console.log(Object.entries(currentEnv));console.log("wtf",getKeyInEnv(currentEnv,"apply"));function macroexpand(o,e){return console.log("ast[0]:",o[0]),o}function eval_ast(o,e){if(_symbol_Q(o))return console.log(o.value,"resolved","in env:",e),getKeyInEnv(e,o);if(_list_Q(o))return o.map(function(s){return EVAL(s,e)});if(_vector_Q(o)){var r=o.map(function(s){return EVAL(s,e)});return r.__isvector__=!0,r}else if(_hash_map_Q(o)){let s={};for(const l in o)s[l]=EVAL(o[l],e);return s}else return o}function threadFirst(o,e){let r=e.slice(0,1),s=e.slice(1)[0];return r.push(o),s&&r.push(s),r}function threadLast(o,e){let r=e;return r.push(o),r}let namespace="user";function _EVAL(o,e){for(;;){if(!_list_Q(o))return eval_ast(o,e);if(o=macroexpand(o),console.log("expanded:",o),o.length===0)return o;var r=o[0],s=o[1],l=o[2],a=o[3];switch(r.value){case"ns":return namespace=s,null;case"def":var h=EVAL(l,e);return addToEnv(e,s,h),"#'"+namespace+"/"+s;case"defn":const p=_function(EVAL,a,e,l);return addToEnv(e,s,p),"#'"+namespace+"/"+s;case"let":for(var c=newScope(e),u=0;u<s.length;u+=2)setInEnv(c,s[u],EVAL(s[u+1],c));o=l,e=c;break;case"->":const g=s,m=o.slice(2);let w=[];for(let A=0;A<m.length;A++)_list_Q(m[A])?w.push(m[A]):w.push([m[A]]);console.log("lists:",w);let S=g;console.log(g);for(let A=0;A<w.length;A++)S=threadFirst(S,w[A]),console.log(S);return EVAL(S,e);case"->>":const y=s,v=o.slice(2);let O=[];for(let A=0;A<v.length;A++)_list_Q(v[A])?O.push(v[A]):O.push([v[A]]);let P=y;for(let A=0;A<O.length;A++)P=threadLast(P,O[A]);return EVAL(P,e);case"dispatch":_symbol("fn");const b=o.toString().match(/%\d?/g).map(_symbol);let k=o.slice(1)[0];return _function(EVAL,k,e,b);case"quote":return s;case"quasiquoteexpand":return quasiquote(s);case"quasiquote":o=quasiquote(s);break;case"defmacro":var f=_clone(EVAL(l,e));return f._ismacro_=!0,setInEnv(e,s,f);case"macroexpand":return macroexpand(s);case"try":try{return EVAL(s,e)}catch(A){if(l&&l[0].value==="catch")return A instanceof Error&&(A=A.message),EVAL(l[2],bindExprs(e,[l[1]],[A]));throw A}case"do":eval_ast(o.slice(1,-1),e),o=o[o.length-1];break;case"if":var d=EVAL(s,e);d===null||d===!1?o=typeof a<"u"?a:null:o=l;break;case"fn":return _function(EVAL,l,e,s);default:const x=eval_ast(o,e),T=x[0];if(T.__ast__)o=T.__ast__,e=T.__gen_env__(x.slice(1));else return T.apply(T,x.slice(1))}}}function EVAL(o,e){var r=_EVAL(o,e);return typeof r<"u"?r:null}function evalString(o){return _pr_str(EVAL(READ(o),currentEnv))}for(var n in ns)addToEnv(init_env,_symbol(n),ns[n]);evalString("(def not (fn (a) (if a false true)))");evalString(`(def reduce
  (fn (f init xs)
    (if (empty? xs)
      init
      (reduce f (f init (first xs)) (rest xs)))))`);evalString(`(defmacro cond 
  (fn (& xs) 
    (if (> (count xs) 0) 
       (list 'if (first xs) 
                (if (> (count xs) 1) 
                    (nth xs 1) 
                    (throw "odd number of forms to cond"))
                (cons 'cond (rest (rest xs)))))))`);const up=o=>o.parent,isTopType=o=>o.isTop,isTop=o=>isTopType(o.type),mainSelection=o=>o.selection.asSingle().ranges[0],tree=(o,e,r)=>syntaxTree(o).resolveInner(e,r),nearestTouching=(o,e)=>tree(o,e,-1),parents=(o,e)=>isTop(o)?e:parents(up(o),e.concat(o)),rangeStr=(o,e)=>o.doc.slice(e.from,e.to).toString(),uppermostEdge=(o,e)=>{const r=parents(e,[]).filter(s=>o==s.to&&o==e.to);return r[r.length-1]||e},nodeAtCursor=o=>{const e=mainSelection(o).from,r=nearestTouching(o,e);return uppermostEdge(e,r)};let posAtFormEnd=0;const topLevelNode=o=>{const e=mainSelection(o).from,r=parents(nearestTouching(o,e),[]);return r.length===0?nodeAtCursor(o):r[r.length-1]},cursorNodeString=o=>rangeStr(o,nodeAtCursor(o)),topLevelString=o=>rangeStr(o,topLevelNode(o));let evalResult="",codeBeforeEval="",posBeforeEval=0;const updateEditor=(o,e,r)=>{const s=o.state.doc.toString();codeBeforeEval=s;const l=s.length;o.dispatch({changes:{from:0,to:l,insert:e},selection:{anchor:r,head:r}})};function tryEval(o){try{return evalString(o)}catch(e){return console.log(e),`
Error: `+e.message}}const clearEval=o=>{evalResult.length!=0&&(evalResult="",updateEditor(o,codeBeforeEval,posBeforeEval))},evalAtCursor=o=>{clearEval(o),codeBeforeEval=o.state.doc.toString(),posBeforeEval=o.state.selection.main.head;const r=codeBeforeEval.slice(0,posBeforeEval),s=codeBeforeEval.slice(posBeforeEval,codeBeforeEval.length);evalResult=tryEval(cursorNodeString(o.state));const l=r+" => "+evalResult+" "+s;return updateEditor(o,l,posBeforeEval),o.dispatch({selection:{anchor:posBeforeEval,head:posBeforeEval}}),!0},evalTopLevel=o=>{clearEval(o),posAtFormEnd=topLevelNode(o.state).to;const e=o.state.doc.toString();posBeforeEval=o.state.selection.main.head,codeBeforeEval=e;const r=codeBeforeEval.slice(0,posAtFormEnd),s=codeBeforeEval.slice(posAtFormEnd,codeBeforeEval.length);evalResult=tryEval(topLevelString(o.state));const l=r+" => "+evalResult+" "+s;return updateEditor(o,l,posBeforeEval),!0},evalCell=o=>{clearEval(o);const e=o.state.doc.toString();posBeforeEval=o.state.selection.main.head,evalResult=tryEval("(do "+o.state.doc.text.join(" ")+")");const r=e+`
 => `+evalResult;return updateEditor(o,r,posBeforeEval),!0},alpha=Array.from(Array(58)).map((o,e)=>e+65),alphabet=alpha.map(o=>String.fromCharCode(o));let letterKeys=[];for(let o=0;o<alphabet.length;o++)letterKeys=letterKeys.concat({key:alphabet[o],run:clearEval});const evalExtension=Prec.highest(keymap.of([{key:"Shift-Enter",run:evalCell},{key:"Mod-Enter",run:evalAtCursor},{key:"Alt-Enter",run:evalTopLevel},{key:"Escape",run:clearEval},{key:"ArrowLeft",run:clearEval},{key:"ArrowRight",run:clearEval},{key:"ArrowUp",run:clearEval},{key:"ArrowDown",run:clearEval},{key:"Backspace",run:clearEval},{key:"Enter",run:clearEval},{key:"Tab",run:clearEval},{key:"Delete",run:clearEval},{key:"0",run:clearEval},{key:"1",run:clearEval},{key:"2",run:clearEval},{key:"3",run:clearEval},{key:"4",run:clearEval},{key:"5",run:clearEval},{key:"6",run:clearEval},{key:"7",run:clearEval},{key:"8",run:clearEval},{key:"9",run:clearEval},{key:"!",run:clearEval},{key:"@",run:clearEval},{key:"#",run:clearEval},{key:"$",run:clearEval},{key:"%",run:clearEval},{key:"^",run:clearEval},{key:"&",run:clearEval},{key:"*",run:clearEval},{key:"-",run:clearEval},{key:"=",run:clearEval},{key:"+",run:clearEval},{key:"/",run:clearEval},{key:"`",run:clearEval},{key:'"',run:clearEval},{key:"'",run:clearEval},{key:";",run:clearEval},{key:":",run:clearEval},{key:"[",run:clearEval},{key:"]",run:clearEval},{key:"{",run:clearEval},{key:"}",run:clearEval},{key:"(",run:clearEval},{key:")",run:clearEval},{key:"Space",run:clearEval}].concat(letterKeys))),{coll}=props,clojureLanguage=LRLanguage.define({parser:parser.configure({props:[styleTags({NS:tags.keyword,DefLike:tags.keyword,"Operator/Symbol":tags.keyword,"VarName/Symbol":tags.definition(tags.variableName),Boolean:tags.atom,"DocString/...":tags.emphasis,"Discard!":tags.comment,Number:tags.number,StringContent:tags.string,'"\\""':tags.string,Keyword:tags.atom,Nil:tags.null,LineComment:tags.lineComment,RegExp:tags.regexp}),indentNodeProp.add(o=>e=>{let{pos:r,unit:s,node:l,state:a,baseIndent:h,textAfter:c}=e;if(o.prop(coll)){let u=e.column(l.firstChild.to);return o.name=="List"&&["NS","DefLike","Operator"].includes(l.firstChild.nextSibling.type.name)?u+1:u}else return 0}),foldNodeProp.add({"Vector Map List":foldInside})]}),languageData:{commentTokens:{line:";;"}}});function clojure(){return new LanguageSupport(clojureLanguage,[evalExtension])}let editorState=EditorState.create({doc:`(defn pos-neg-or-zero
  "Determines whether or not n is positive, negative, or zero"
  [n]
  (cond
    (< n 0) "negative"
    (> n 0) "positive"
    :else "zero"))

(pos-neg-or-zero 5)`,extensions:[basicSetup,clojure()]});new EditorView({state:editorState,parent:document.querySelector("#app")}).focus();let topLevelText="Alt+Enter = Eval top-level form",keyBindings="<strong>Key bindings:</strong>,Shift+Enter = Eval cell,"+topLevelText+",Ctrl/Cmd+Enter = Eval at cursor";keyBindings=keyBindings.split(",");for(let o=0;o<keyBindings.length;o++)keyBindings[o]=""+keyBindings[o]+"<br>";keyBindings=keyBindings.join("");document.getElementById("keymap").innerHTML=keyBindings;
